{"version":3,"file":"gallery.js","sources":["../../src/plugins/gallery/constants.js","../../src/plugins/gallery/GalleryButton.js","../../src/plugins/gallery/GalleryComponent.js","../../src/plugins/gallery/index.js"],"sourcesContent":["import { utils } from '../..';\r\n\r\n/**\r\n * @summary Available events\r\n * @enum {string}\r\n * @memberof PSV.plugins.GalleryPlugin\r\n * @constant\r\n */\r\nexport const EVENTS = {\r\n  /**\r\n   * @event show-gallery\r\n   * @memberof PSV.plugins.GalleryPlugin\r\n   * @summary Triggered when the gallery is shown\r\n   */\r\n  SHOW_GALLERY: 'show-gallery',\r\n  /**\r\n   * @event hide-gallery\r\n   * @memberof PSV.plugins.GalleryPlugin\r\n   * @summary Triggered when the gallery is hidden\r\n   */\r\n  HIDE_GALLERY: 'hide-gallery',\r\n};\r\n\r\nexport const GALLERY_ITEM_DATA = 'psvGalleryItem';\r\nexport const GALLERY_ITEM_DATA_KEY = utils.dasherize(GALLERY_ITEM_DATA);\r\n\r\nexport const ITEMS_TEMPLATE = (items, dataKey) => `\r\n<div class=\"psv-gallery-container\">\r\n  ${items.map(item => `\r\n  <div class=\"psv-gallery-item\" data-${dataKey}=\"${item.id}\">\r\n    ${item.name ? `<div class=\"psv-gallery-item-title\"><span>${item.name}</span></div>` : ''}\r\n    <svg class=\"psv-gallery-item-thumb\" viewBox=\"0 0 200 100\"><use href=\"#psvGalleryBlankIcon\"></use></svg>\r\n    ${item.thumbnail ? `<div class=\"psv-gallery-item-thumb\" data-src=\"${item.thumbnail}\"></div>` : ''}\r\n  </div>\r\n  `).join('')}\r\n</div>\r\n`;\r\n","import { AbstractButton } from '../..';\r\nimport { EVENTS } from './constants';\r\nimport gallery from './gallery.svg';\r\n\r\n/**\r\n * @summary Navigation bar gallery button class\r\n * @extends PSV.buttons.AbstractButton\r\n * @memberof PSV.buttons\r\n */\r\nexport class GalleryButton extends AbstractButton {\r\n\r\n  static id = 'gallery';\r\n  static icon = gallery;\r\n\r\n  /**\r\n   * @param {PSV.components.Navbar} navbar\r\n   */\r\n  constructor(navbar) {\r\n    super(navbar, 'psv-button--hover-scale psv-gallery-button', true);\r\n\r\n    /**\r\n     * @type {PSV.plugins.GalleryPlugin}\r\n     * @readonly\r\n     * @private\r\n     */\r\n    this.plugin = this.psv.getPlugin('gallery');\r\n\r\n    if (this.plugin) {\r\n      this.plugin.on(EVENTS.SHOW_GALLERY, this);\r\n      this.plugin.on(EVENTS.HIDE_GALLERY, this);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @override\r\n   */\r\n  destroy() {\r\n    if (this.plugin) {\r\n      this.plugin.off(EVENTS.SHOW_GALLERY, this);\r\n      this.plugin.off(EVENTS.HIDE_GALLERY, this);\r\n    }\r\n\r\n    delete this.plugin;\r\n\r\n    super.destroy();\r\n  }\r\n\r\n  /**\r\n   * @summary Handles events\r\n   * @param {Event} e\r\n   * @private\r\n   */\r\n  handleEvent(e) {\r\n    if (e.type === EVENTS.SHOW_GALLERY) {\r\n      this.toggleActive(true);\r\n    }\r\n    else if (e.type === EVENTS.HIDE_GALLERY) {\r\n      this.toggleActive(false);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @override\r\n   */\r\n  isSupported() {\r\n    return !!this.plugin;\r\n  }\r\n\r\n  /**\r\n   * @override\r\n   * @description Toggles gallery\r\n   */\r\n  onClick() {\r\n    this.plugin.toggle();\r\n  }\r\n\r\n}\r\n","import { AbstractComponent, SYSTEM, utils } from '../..';\r\nimport blankIcon from './blank.svg';\r\nimport { GALLERY_ITEM_DATA, GALLERY_ITEM_DATA_KEY, ITEMS_TEMPLATE } from './constants';\r\n\r\nconst ACTIVE_CLASS = 'psv-gallery-item--active';\r\n\r\n/**\r\n * @private\r\n */\r\nexport class GalleryComponent extends AbstractComponent {\r\n\r\n  constructor(plugin) {\r\n    super(plugin.psv, 'psv-gallery psv--capture-event');\r\n\r\n    /**\r\n     * @type {SVGElement}\r\n     * @private\r\n     * @readonly\r\n     */\r\n    this.blankIcon = (() => {\r\n      const temp = document.createElement('div');\r\n      temp.innerHTML = blankIcon;\r\n      return temp.firstChild;\r\n    })();\r\n    this.blankIcon.style.display = 'none';\r\n    this.psv.container.appendChild(this.blankIcon);\r\n\r\n    if ('IntersectionObserver' in window) {\r\n      /**\r\n       * @type {IntersectionObserver}\r\n       * @private\r\n       * @readonly\r\n       */\r\n      this.observer = new IntersectionObserver((entries) => {\r\n        entries.forEach((entry) => {\r\n          if (entry.intersectionRatio > 0) {\r\n            entry.target.style.backgroundImage = `url(${entry.target.dataset.src})`;\r\n            delete entry.target.dataset.src;\r\n            this.observer.unobserve(entry.target);\r\n          }\r\n        });\r\n      }, {\r\n        root: this.psv.container,\r\n      });\r\n    }\r\n\r\n    /**\r\n     * @type {PSV.plugins.GalleryPlugin}\r\n     * @private\r\n     * @readonly\r\n     */\r\n    this.plugin = plugin;\r\n\r\n    /**\r\n     * @type {Object}\r\n     * @private\r\n     */\r\n    this.prop = {\r\n      ...this.prop,\r\n      mousedown : false,\r\n      initMouseX: null,\r\n      mouseX    : null,\r\n    };\r\n\r\n    this.container.addEventListener(SYSTEM.mouseWheelEvent, this);\r\n    this.container.addEventListener('mousedown', this);\r\n    this.container.addEventListener('mousemove', this);\r\n    this.container.addEventListener('click', this);\r\n    window.addEventListener('mouseup', this);\r\n\r\n    this.hide();\r\n  }\r\n\r\n  /**\r\n   * @override\r\n   */\r\n  destroy() {\r\n    this.psv.container.removeChild(this.blankIcon);\r\n\r\n    window.removeEventListener('mouseup', this);\r\n\r\n    this.observer?.disconnect();\r\n\r\n    delete this.plugin;\r\n    delete this.blankIcon;\r\n    delete this.observer;\r\n\r\n    super.destroy();\r\n  }\r\n\r\n  /**\r\n   * @private\r\n   */\r\n  handleEvent(e) {\r\n    /* eslint-disable */\r\n    switch (e.type) {\r\n      case SYSTEM.mouseWheelEvent:\r\n        const spinY = utils.normalizeWheel(e).spinY;\r\n        this.container.scrollLeft += spinY * 50;\r\n        e.preventDefault();\r\n        break;\r\n\r\n      case 'mousedown':\r\n        this.prop.mousedown = true;\r\n        this.prop.initMouseX = e.clientX;\r\n        this.prop.mouseX = e.clientX;\r\n        break;\r\n\r\n      case 'mousemove':\r\n        if (this.prop.mousedown) {\r\n          const delta = this.prop.mouseX - e.clientX;\r\n          this.container.scrollLeft += delta;\r\n          this.prop.mouseX = e.clientX;\r\n        }\r\n        break;\r\n\r\n      case 'mouseup':\r\n        this.prop.mousedown = false;\r\n        this.prop.mouseX = null;\r\n        e.preventDefault();\r\n        break;\r\n\r\n      case 'click':\r\n        // prevent click on drag\r\n        if (Math.abs(this.prop.initMouseX - e.clientX) < 10) {\r\n          const item = utils.getClosest(e.target, `[data-${GALLERY_ITEM_DATA_KEY}]`);\r\n          if (item) {\r\n            this.plugin.__click(item.dataset[GALLERY_ITEM_DATA]);\r\n          }\r\n        }\r\n        break;\r\n    }\r\n    /* eslint-enable */\r\n  }\r\n\r\n  /**\r\n   * @override\r\n   */\r\n  show() {\r\n    this.container.classList.add('psv-gallery--open');\r\n    this.prop.visible = true;\r\n  }\r\n\r\n  /**\r\n   * @override\r\n   */\r\n  hide() {\r\n    this.container.classList.remove('psv-gallery--open');\r\n    this.prop.visible = false;\r\n  }\r\n\r\n  /**\r\n   * @summary Sets the list of items\r\n   * @param {PSV.plugins.GalleryPlugin.Item[]} items\r\n   */\r\n  setItems(items) {\r\n    this.container.innerHTML = ITEMS_TEMPLATE(items, GALLERY_ITEM_DATA_KEY);\r\n\r\n    if (this.observer) {\r\n      this.observer.disconnect();\r\n\r\n      for (const child of this.container.querySelectorAll('[data-src]')) {\r\n        this.observer.observe(child);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @param {number | string} id\r\n   */\r\n  setActive(id) {\r\n    const currentActive = this.container.querySelector('.' + ACTIVE_CLASS);\r\n    currentActive?.classList.remove(ACTIVE_CLASS);\r\n\r\n    if (id) {\r\n      const nextActive = this.container.querySelector(`[data-${GALLERY_ITEM_DATA_KEY}=\"${id}\"]`);\r\n      nextActive?.classList.add(ACTIVE_CLASS);\r\n    }\r\n  }\r\n\r\n}\r\n","import { AbstractPlugin, CONSTANTS, DEFAULTS, PSVError, registerButton, utils } from '../..';\r\nimport { EVENTS } from './constants';\r\nimport { GalleryButton } from './GalleryButton';\r\nimport { GalleryComponent } from './GalleryComponent';\r\nimport './style.scss';\r\n\r\n/**\r\n * @typedef {Object} PSV.plugins.GalleryPlugin.Item\r\n * @property {number|string} id - Unique identifier of the item\r\n * @property {*} panorama\r\n * @property {string} [thumbnail] - URL of the thumbnail\r\n * @property {string} [name] - Text visible over the thumbnail\r\n * @property {PSV.PanoramaOptions} [options] - Any option supported by the `setPanorama()` method\r\n */\r\n\r\n/**\r\n * @typedef {Object} PSV.plugins.GalleryPlugin.Options\r\n * @property {PSV.plugins.GalleryPlugin.Item[]} [items]\r\n * @property {boolean} [visibleOnLoad=false] - Displays the gallery when loading the first panorama\r\n */\r\n\r\n\r\n// add gallery button\r\nDEFAULTS.lang[GalleryButton.id] = 'Gallery';\r\nregisterButton(GalleryButton, 'caption:left');\r\n\r\n\r\nexport { EVENTS } from './constants';\r\n\r\n\r\n/**\r\n * @summary Adds a gallery of multiple panoramas\r\n * @extends PSV.plugins.AbstractPlugin\r\n * @memberof PSV.plugins\r\n */\r\nexport class GalleryPlugin extends AbstractPlugin {\r\n\r\n  static id = 'gallery';\r\n\r\n  static EVENTS = EVENTS;\r\n\r\n  /**\r\n   * @param {PSV.Viewer} psv\r\n   * @param {PSV.plugins.GalleryPlugin.Options} options\r\n   */\r\n  constructor(psv, options) {\r\n    super(psv);\r\n\r\n    /**\r\n     * @member {PSV.plugins.GalleryPlugin.Options}\r\n     * @private\r\n     */\r\n    this.config = {\r\n      items        : null,\r\n      visibleOnLoad: false,\r\n      ...options,\r\n    };\r\n\r\n    /**\r\n     * @type {Object}\r\n     * @private\r\n     */\r\n    this.prop = {\r\n      handler  : null,\r\n      currentId: null,\r\n    };\r\n\r\n    /**\r\n     * @type {GalleryComponent}\r\n     * @private\r\n     * @readonly\r\n     */\r\n    this.gallery = new GalleryComponent(this);\r\n\r\n    /**\r\n     * @type {PSV.plugins.GalleryPlugin.Item[]}\r\n     * @private\r\n     */\r\n    this.items = [];\r\n  }\r\n\r\n  /**\r\n   * @package\r\n   */\r\n  init() {\r\n    super.init();\r\n\r\n    this.psv.on(CONSTANTS.EVENTS.PANORAMA_LOADED, this);\r\n\r\n    if (this.config.visibleOnLoad) {\r\n      this.psv.once(CONSTANTS.EVENTS.READY, () => {\r\n        this.show();\r\n      });\r\n    }\r\n\r\n    this.setItems(this.config.items);\r\n    delete this.config.items;\r\n  }\r\n\r\n  /**\r\n   * @package\r\n   */\r\n  destroy() {\r\n    this.psv.off(CONSTANTS.EVENTS.PANORAMA_LOADED, this);\r\n\r\n    this.gallery.destroy();\r\n\r\n    super.destroy();\r\n  }\r\n\r\n  /**\r\n   * @private\r\n   */\r\n  handleEvent(e) {\r\n    /* eslint-disable */\r\n    switch (e.type) {\r\n      case CONSTANTS.EVENTS.PANORAMA_LOADED:\r\n        const item = this.items.find(i => utils.deepEqual(i.panorama, e.args[0].panorama));\r\n        this.prop.currentId = item?.id;\r\n        this.gallery.setActive(item?.id);\r\n        break;\r\n    }\r\n    /* eslint-enable */\r\n  }\r\n\r\n  /**\r\n   * @summary Shows the gallery\r\n   * @fires PSV.plugins.GalleryPlugin.show-gallery\r\n   */\r\n  show() {\r\n    this.trigger(EVENTS.SHOW_GALLERY);\r\n    return this.gallery.show();\r\n  }\r\n\r\n  /**\r\n   * @summary Hides the carousem\r\n   * @fires PSV.plugins.GalleryPlugin.hide-gallery\r\n   */\r\n  hide() {\r\n    this.trigger(EVENTS.HIDE_GALLERY);\r\n    return this.gallery.hide();\r\n  }\r\n\r\n  /**\r\n   * @summary Hides or shows the gallery\r\n   */\r\n  toggle() {\r\n    return this.gallery.toggle();\r\n  }\r\n\r\n  /**\r\n   * @summary Sets the list of items\r\n   * @param {PSV.plugins.GalleryPlugin.Item[]} items\r\n   * @param {function} [handler] function that will be called when an item is clicked instead of the default behavior\r\n   */\r\n  setItems(items, handler) {\r\n    if (!items?.length) {\r\n      items = [];\r\n    }\r\n    else {\r\n      items.forEach((item, i) => {\r\n        if (!item.id) {\r\n          throw new PSVError(`Item ${i} has no \"id\".`);\r\n        }\r\n        if (!item.panorama) {\r\n          throw new PSVError(`Item ${item.id} has no \"panorama\".`);\r\n        }\r\n      });\r\n    }\r\n\r\n    this.prop.handler = handler;\r\n    this.items = items.map(item => ({\r\n      ...item,\r\n      id: `${item.id}`,\r\n    }));\r\n\r\n    this.gallery.setItems(items);\r\n  }\r\n\r\n  /**\r\n   * @param {string} id\r\n   * @package\r\n   */\r\n  __click(id) {\r\n    if (id === this.prop.currentId) {\r\n      return;\r\n    }\r\n\r\n    if (this.prop.handler) {\r\n      this.prop.handler(id);\r\n    }\r\n    else {\r\n      const item = this.items.find(i => i.id === id);\r\n      this.psv.setPanorama(item.panorama, {\r\n        caption: item.name,\r\n        ...item.options,\r\n      });\r\n    }\r\n\r\n    this.prop.currentId = id;\r\n    this.gallery.setActive(id);\r\n  }\r\n\r\n}\r\n"],"names":["EVENTS","SHOW_GALLERY","HIDE_GALLERY","GALLERY_ITEM_DATA","GALLERY_ITEM_DATA_KEY","utils","dasherize","ITEMS_TEMPLATE","items","dataKey","map","item","id","name","thumbnail","join","GalleryButton","navbar","plugin","psv","getPlugin","on","destroy","off","handleEvent","e","type","toggleActive","isSupported","onClick","toggle","AbstractButton","icon","gallery","ACTIVE_CLASS","GalleryComponent","blankIcon","temp","document","createElement","innerHTML","firstChild","style","display","container","appendChild","window","observer","IntersectionObserver","entries","forEach","entry","intersectionRatio","target","backgroundImage","dataset","src","unobserve","root","prop","mousedown","initMouseX","mouseX","addEventListener","SYSTEM","mouseWheelEvent","hide","removeChild","removeEventListener","disconnect","spinY","normalizeWheel","scrollLeft","preventDefault","clientX","delta","Math","abs","getClosest","__click","show","classList","add","visible","remove","setItems","querySelectorAll","child","observe","setActive","currentActive","querySelector","nextActive","AbstractComponent","DEFAULTS","lang","registerButton","GalleryPlugin","options","config","visibleOnLoad","handler","currentId","init","CONSTANTS","PANORAMA_LOADED","once","READY","find","i","deepEqual","panorama","args","trigger","length","PSVError","setPanorama","caption","AbstractPlugin"],"mappings":"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"}