{"version":3,"file":"photo-sphere-viewer.js","sources":["../src/PSVError.js","../src/adapters/AbstractAdapter.js","../src/data/constants.js","../src/data/system.js","../src/utils/browser.js","../src/utils/math.js","../src/utils/misc.js","../src/utils/psv.js","../src/utils/Animation.js","../src/utils/Dynamic.js","../src/utils/MultiDynamic.js","../src/utils/Slider.js","../src/utils/index.js","../src/adapters/equirectangular/index.js","../src/components/AbstractComponent.js","../src/buttons/AbstractButton.js","../src/buttons/AutorotateButton.js","../src/buttons/CustomButton.js","../src/buttons/DescriptionButton.js","../src/buttons/DownloadButton.js","../src/buttons/FullscreenButton.js","../src/buttons/MenuButton.js","../src/utils/PressHandler.js","../src/buttons/AbstractMoveButton.js","../src/buttons/MoveDownButton.js","../src/buttons/MoveLeftButton.js","../src/buttons/MoveRightButton.js","../src/buttons/MoveUpButton.js","../src/buttons/AbstractZoomButton.js","../src/buttons/ZoomInButton.js","../src/buttons/ZoomOutButton.js","../src/buttons/ZoomRangeButton.js","../src/plugins/AbstractPlugin.js","../src/data/config.js","../src/components/NavbarCaption.js","../src/components/Navbar.js","../src/components/Loader.js","../src/components/Notification.js","../src/components/Overlay.js","../src/components/Panel.js","../src/services/AbstractService.js","../src/services/DataHelper.js","../src/services/EventsHandler.js","../src/services/Renderer.js","../src/services/TextureLoader.js","../src/components/Tooltip.js","../src/services/TooltipRenderer.js","../src/Viewer.js"],"sourcesContent":["/**\r\n * @summary Custom error used in the lib\r\n * @param {string} message\r\n * @constructor\r\n * @memberOf PSV\r\n */\r\nfunction PSVError(message) {\r\n  this.message = message;\r\n\r\n  // Use V8's native method if available, otherwise fallback\r\n  if ('captureStackTrace' in Error) {\r\n    Error.captureStackTrace(this, PSVError);\r\n  }\r\n  else {\r\n    this.stack = (new Error()).stack;\r\n  }\r\n}\r\n\r\nPSVError.prototype = Object.create(Error.prototype);\r\nPSVError.prototype.name = 'PSVError';\r\nPSVError.prototype.constructor = PSVError;\r\n\r\nexport { PSVError };\r\n","import { PSVError } from '../PSVError';\r\n\r\n/**\r\n * @namespace PSV.adapters\r\n */\r\n\r\n/**\r\n * @summary Base adapters class\r\n * @memberof PSV.adapters\r\n * @abstract\r\n */\r\nexport class AbstractAdapter {\r\n\r\n  /**\r\n   * @summary Unique identifier of the adapter\r\n   * @member {string}\r\n   * @readonly\r\n   * @static\r\n   */\r\n  static id = null;\r\n\r\n  /**\r\n   * @summary Indicates if the adapter supports panorama download natively\r\n   * @type {boolean}\r\n   * @readonly\r\n   * @static\r\n   */\r\n  static supportsDownload = false;\r\n\r\n  /**\r\n   * @param {PSV.Viewer} psv\r\n   */\r\n  constructor(psv) {\r\n    /**\r\n     * @summary Reference to main controller\r\n     * @type {PSV.Viewer}\r\n     * @readonly\r\n     */\r\n    this.psv = psv;\r\n  }\r\n\r\n  /**\r\n   * @summary Destroys the adapter\r\n   */\r\n  destroy() {\r\n    delete this.psv;\r\n  }\r\n\r\n  /**\r\n   * @summary Indicates if the adapter supports transitions between panoramas\r\n   * @param {*} panorama\r\n   * @return {boolean}\r\n   */\r\n  supportsTransition(panorama) { // eslint-disable-line no-unused-vars\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * @summary Indicates if the adapter supports preload of a panorama\r\n   * @param {*} panorama\r\n   * @return {boolean}\r\n   */\r\n  supportsPreload(panorama) { // eslint-disable-line no-unused-vars\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * @abstract\r\n   * @summary Loads the panorama texture(s)\r\n   * @param {*} panorama\r\n   * @param {PSV.PanoData | PSV.PanoDataProvider} [newPanoData]\r\n   * @returns {Promise.<PSV.TextureData>}\r\n   */\r\n  loadTexture(panorama, newPanoData) { // eslint-disable-line no-unused-vars\r\n    throw new PSVError('loadTexture not implemented');\r\n  }\r\n\r\n  /**\r\n   * @abstract\r\n   * @summary Creates the cube mesh\r\n   * @param {number} [scale=1]\r\n   * @returns {external:THREE.Mesh}\r\n   */\r\n  createMesh(scale = 1) { // eslint-disable-line no-unused-vars\r\n    throw new PSVError('createMesh not implemented');\r\n  }\r\n\r\n  /**\r\n   * @abstract\r\n   * @summary Applies the texture to the mesh\r\n   * @param {external:THREE.Mesh} mesh\r\n   * @param {PSV.TextureData} textureData\r\n   * @param {boolean} [transition=false]\r\n   */\r\n  setTexture(mesh, textureData, transition = false) { // eslint-disable-line no-unused-vars\r\n    throw new PSVError('setTexture not implemented');\r\n  }\r\n\r\n  /**\r\n   * @abstract\r\n   * @summary Changes the opacity of the mesh\r\n   * @param {external:THREE.Mesh} mesh\r\n   * @param {number} opacity\r\n   */\r\n  setTextureOpacity(mesh, opacity) { // eslint-disable-line no-unused-vars\r\n    throw new PSVError('setTextureOpacity not implemented');\r\n  }\r\n\r\n  /**\r\n   * @abstract\r\n   * @summary Clear a loaded texture from memory\r\n   * @param {PSV.TextureData} textureData\r\n   */\r\n  disposeTexture(textureData) { // eslint-disable-line no-unused-vars\r\n    throw new PSVError('disposeTexture not implemented');\r\n  }\r\n\r\n}\r\n","/**\r\n * @namespace PSV.constants\r\n */\r\n\r\n/**\r\n * @summary Default duration of the transition between panoramas\r\n * @memberOf PSV.constants\r\n * @type {number}\r\n * @constant\r\n */\r\nexport const DEFAULT_TRANSITION = 1500;\r\n\r\n/**\r\n * @summary Number of pixels bellow which a mouse move will be considered as a click\r\n * @memberOf PSV.constants\r\n * @type {number}\r\n * @constant\r\n */\r\nexport const MOVE_THRESHOLD = 4;\r\n\r\n/**\r\n * @summary Delay in milliseconds between two clicks to consider a double click\r\n * @memberOf PSV.constants\r\n * @type {number}\r\n * @constant\r\n */\r\nexport const DBLCLICK_DELAY = 300;\r\n\r\n/**\r\n * @summary Delay in milliseconds to emulate a long touch\r\n * @memberOf PSV.constants\r\n * @type {number}\r\n * @constant\r\n */\r\nexport const LONGTOUCH_DELAY = 500;\r\n\r\n/**\r\n * @summary Delay in milliseconds to for the two fingers overlay to appear\r\n * @memberOf PSV.constants\r\n * @type {number}\r\n * @constant\r\n */\r\nexport const TWOFINGERSOVERLAY_DELAY = 100;\r\n\r\n/**\r\n * @summary Duration in milliseconds of the \"ctrl zoom\" overlay\r\n * @memberOf PSV.constants\r\n * @type {number}\r\n * @constant\r\n */\r\nexport const CTRLZOOM_TIMEOUT = 2000;\r\n\r\n/**\r\n * @summary Time size of the mouse position history used to compute inertia\r\n * @memberOf PSV.constants\r\n * @type {number}\r\n * @constant\r\n */\r\nexport const INERTIA_WINDOW = 300;\r\n\r\n/**\r\n * @summary Radius of the THREE.SphereGeometry, Half-length of the THREE.BoxGeometry\r\n * @memberOf PSV.constants\r\n * @type {number}\r\n * @constant\r\n */\r\nexport const SPHERE_RADIUS = 10;\r\n\r\n/**\r\n * @summary Property name added to viewer element\r\n * @memberOf PSV.constants\r\n * @type {string}\r\n * @constant\r\n */\r\nexport const VIEWER_DATA = 'photoSphereViewer';\r\n\r\n/**\r\n * @summary Property added the the main Mesh object\r\n * @memberOf PSV.constants\r\n * @type {string}\r\n * @constant\r\n */\r\nexport const MESH_USER_DATA = 'psvSphere';\r\n\r\n/**\r\n * @summary Available actions\r\n * @memberOf PSV.constants\r\n * @enum {string}\r\n * @constant\r\n */\r\nexport const ACTIONS = {\r\n  ROTATE_LAT_UP    : 'rotateLatitudeUp',\r\n  ROTATE_LAT_DOWN  : 'rotateLatitudeDown',\r\n  ROTATE_LONG_RIGHT: 'rotateLongitudeRight',\r\n  ROTATE_LONG_LEFT : 'rotateLongitudeLeft',\r\n  ZOOM_IN          : 'zoomIn',\r\n  ZOOM_OUT         : 'zoomOut',\r\n  TOGGLE_AUTOROTATE: 'toggleAutorotate',\r\n};\r\n\r\n/**\r\n * @summary Available events names\r\n * @memberOf PSV.constants\r\n * @enum {string}\r\n * @constant\r\n */\r\nexport const EVENTS = {\r\n  /**\r\n   * @event autorotate\r\n   * @memberof PSV\r\n   * @summary Triggered when the automatic rotation is enabled/disabled\r\n   * @param {boolean} enabled\r\n   */\r\n  AUTOROTATE        : 'autorotate',\r\n  /**\r\n   * @event before-render\r\n   * @memberof PSV\r\n   * @summary Triggered before a render, used to modify the view\r\n   * @param {number} timestamp - time provided by requestAnimationFrame\r\n   * @param {number} elapsed - time elapsed from the previous frame\r\n   */\r\n  BEFORE_RENDER     : 'before-render',\r\n  /**\r\n   * @event before-rotate\r\n   * @memberOf PSV\r\n   * @summary Triggered before a rotate operation, can be cancelled\r\n   * @param {PSV.ExtendedPosition}\r\n   */\r\n  BEFORE_ROTATE     : 'before-rotate',\r\n  /**\r\n   * @event click\r\n   * @memberof PSV\r\n   * @summary Triggered when the user clicks on the viewer (everywhere excluding the navbar and the side panel)\r\n   * @param {PSV.ClickData} data\r\n   */\r\n  CLICK             : 'click',\r\n  /**\r\n   * @event close-panel\r\n   * @memberof PSV\r\n   * @summary Triggered when the panel is closed\r\n   * @param {string} [id]\r\n   */\r\n  CLOSE_PANEL       : 'close-panel',\r\n  /**\r\n   * @event config-changed\r\n   * @memberOf PSV\r\n   * @summary Triggered after a call to setOption/setOptions\r\n   * @param {string[]} name of changed options\r\n   */\r\n  CONFIG_CHANGED    : 'config-changed',\r\n  /**\r\n   * @event dblclick\r\n   * @memberof PSV\r\n   * @summary Triggered when the user double clicks on the viewer. The simple `click` event is always fired before `dblclick`\r\n   * @param {PSV.ClickData} data\r\n   */\r\n  DOUBLE_CLICK      : 'dblclick',\r\n  /**\r\n   * @event fullscreen-updated\r\n   * @memberof PSV\r\n   * @summary Triggered when the fullscreen mode is enabled/disabled\r\n   * @param {boolean} enabled\r\n   */\r\n  FULLSCREEN_UPDATED: 'fullscreen-updated',\r\n  /**\r\n   * @event hide-notification\r\n   * @memberof PSV\r\n   * @summary Triggered when the notification is hidden\r\n   * @param {string} [id]\r\n   */\r\n  HIDE_NOTIFICATION : 'hide-notification',\r\n  /**\r\n   * @event hide-overlay\r\n   * @memberof PSV\r\n   * @summary Triggered when the overlay is hidden\r\n   * @param {string} [id]\r\n   */\r\n  HIDE_OVERLAY      : 'hide-overlay',\r\n  /**\r\n   * @event hide-tooltip\r\n   * @memberof PSV\r\n   * @summary Triggered when the tooltip is hidden\r\n   * @param {*} Data associated to this tooltip\r\n   */\r\n  HIDE_TOOLTIP      : 'hide-tooltip',\r\n  /**\r\n   * @event key-press\r\n   * @memberof PSV\r\n   * @summary Triggered when a key is pressed, can be cancelled\r\n   * @param {string} key\r\n   */\r\n  KEY_PRESS         : 'key-press',\r\n  /**\r\n   * @event load-progress\r\n   * @memberof PSV\r\n   * @summary Triggered when the loader value changes\r\n   * @param {number} value from 0 to 100\r\n   */\r\n  LOAD_PROGRESS     : 'load-progress',\r\n  /**\r\n   * @event open-panel\r\n   * @memberof PSV\r\n   * @summary Triggered when the panel is opened\r\n   * @param {string} [id]\r\n   */\r\n  OPEN_PANEL        : 'open-panel',\r\n  /**\r\n   * @event panorama-loaded\r\n   * @memberof PSV\r\n   * @summary Triggered when a panorama image has been loaded\r\n   * @param {PSV.TextureData} textureData\r\n   */\r\n  PANORAMA_LOADED   : 'panorama-loaded',\r\n  /**\r\n   * @event position-updated\r\n   * @memberof PSV\r\n   * @summary Triggered when the view longitude and/or latitude changes\r\n   * @param {PSV.Position} position\r\n   */\r\n  POSITION_UPDATED  : 'position-updated',\r\n  /**\r\n   * @event ready\r\n   * @memberof PSV\r\n   * @summary Triggered when the panorama image has been loaded and the viewer is ready to perform the first render\r\n   */\r\n  READY             : 'ready',\r\n  /**\r\n   * @event render\r\n   * @memberof PSV\r\n   * @summary Triggered on each viewer render, **this event is triggered very often**\r\n   */\r\n  RENDER            : 'render',\r\n  /**\r\n   * @event show-notification\r\n   * @memberof PSV\r\n   * @summary Triggered when the notification is shown\r\n   * @param {string} [id]\r\n   */\r\n  SHOW_NOTIFICATION : 'show-notification',\r\n  /**\r\n   * @event show-overlay\r\n   * @memberof PSV\r\n   * @summary Triggered when the overlay is shown\r\n   * @param {string} [id]\r\n   */\r\n  SHOW_OVERLAY      : 'show-overlay',\r\n  /**\r\n   * @event show-tooltip\r\n   * @memberof PSV\r\n   * @summary Triggered when the tooltip is shown\r\n   * @param {*} Data associated to this tooltip\r\n   * @param {PSV.components.Tooltip} Instance of the tooltip\r\n   */\r\n  SHOW_TOOLTIP      : 'show-tooltip',\r\n  /**\r\n   * @event size-updated\r\n   * @memberof PSV\r\n   * @summary Triggered when the viewer size changes\r\n   * @param {PSV.Size} size\r\n   */\r\n  SIZE_UPDATED      : 'size-updated',\r\n  /**\r\n   * @event stop-all\r\n   * @memberof PSV\r\n   * @summary Triggered when all current animations are stopped\r\n   */\r\n  STOP_ALL          : 'stop-all',\r\n  /**\r\n   * @event zoom-updated\r\n   * @memberof PSV\r\n   * @summary Triggered when the zoom level changes\r\n   * @param {number} zoomLevel\r\n   */\r\n  ZOOM_UPDATED      : 'zoom-updated',\r\n};\r\n\r\n/**\r\n * @summary Available change events names\r\n * @memberOf PSV.constants\r\n * @enum {string}\r\n * @constant\r\n */\r\nexport const CHANGE_EVENTS = {\r\n  /**\r\n   * @event get-animate-position\r\n   * @memberof PSV\r\n   * @param {Position} position\r\n   * @returns {Position}\r\n   * @summary Called to alter the target position of an animation\r\n   */\r\n  GET_ANIMATE_POSITION: 'get-animate-position',\r\n  /**\r\n   * @event get-rotate-position\r\n   * @memberof PSV\r\n   * @param {Position} position\r\n   * @returns {Position}\r\n   * @summary Called to alter the target position of a rotation\r\n   */\r\n  GET_ROTATE_POSITION : 'get-rotate-position',\r\n};\r\n\r\n/**\r\n * @summary Special events emitted to listener using {@link Viewer#observeObjects}\r\n * @memberOf PSV.constants\r\n * @constant\r\n * @package\r\n */\r\nexport const OBJECT_EVENTS = {\r\n  ENTER_OBJECT: 'enter-object',\r\n  HOVER_OBJECT: 'hover-object',\r\n  LEAVE_OBJECT: 'leave-object',\r\n};\r\n\r\n/**\r\n * @summary Internal identifiers for various stuff\r\n * @memberOf PSV.constants\r\n * @enum {string}\r\n * @constant\r\n */\r\nexport const IDS = {\r\n  MENU       : 'menu',\r\n  TWO_FINGERS: 'twoFingers',\r\n  CTRL_ZOOM  : 'ctrlZoom',\r\n  ERROR      : 'error',\r\n  DESCRIPTION: 'description',\r\n};\r\n\r\n/* eslint-disable */\r\n// @formatter:off\r\n/**\r\n * @summary Collection of easing functions\r\n * @memberOf PSV.constants\r\n * @see {@link https://gist.github.com/frederickk/6165768}\r\n * @type {Object<string, Function>}\r\n * @constant\r\n */\r\nexport const EASINGS = {\r\n  linear    : (t) => t,\r\n\r\n  inQuad    : (t) => t*t,\r\n  outQuad   : (t) => t*(2-t),\r\n  inOutQuad : (t) => t<.5 ? 2*t*t : -1+(4-2*t)*t,\r\n\r\n  inCubic   : (t) => t*t*t,\r\n  outCubic  : (t) => (--t)*t*t+1,\r\n  inOutCubic: (t) => t<.5 ? 4*t*t*t : (t-1)*(2*t-2)*(2*t-2)+1,\r\n\r\n  inQuart   : (t) => t*t*t*t,\r\n  outQuart  : (t) => 1-(--t)*t*t*t,\r\n  inOutQuart: (t) => t<.5 ? 8*t*t*t*t : 1-8*(--t)*t*t*t,\r\n\r\n  inQuint   : (t) => t*t*t*t*t,\r\n  outQuint  : (t) => 1+(--t)*t*t*t*t,\r\n  inOutQuint: (t) => t<.5 ? 16*t*t*t*t*t : 1+16*(--t)*t*t*t*t,\r\n\r\n  inSine    : (t) => 1-Math.cos(t*(Math.PI/2)),\r\n  outSine   : (t) => Math.sin(t*(Math.PI/2)),\r\n  inOutSine : (t) => .5-.5*Math.cos(Math.PI*t),\r\n\r\n  inExpo    : (t) => Math.pow(2, 10*(t-1)),\r\n  outExpo   : (t) => 1-Math.pow(2, -10*t),\r\n  inOutExpo : (t) => (t=t*2-1)<0 ? .5*Math.pow(2, 10*t) : 1-.5*Math.pow(2, -10*t),\r\n\r\n  inCirc    : (t) => 1-Math.sqrt(1-t*t),\r\n  outCirc   : (t) => Math.sqrt(1-(t-1)*(t-1)),\r\n  inOutCirc : (t) => (t*=2)<1 ? .5-.5*Math.sqrt(1-t*t) : .5+.5*Math.sqrt(1-(t-=2)*t)\r\n};\r\n// @formatter:on\r\n/* eslint-enable */\r\n\r\n/**\r\n * @summary Subset of key codes\r\n * @memberOf PSV.constants\r\n * @type {Object<string, string>}\r\n * @constant\r\n */\r\nexport const KEY_CODES = {\r\n  Enter     : 'Enter',\r\n  Control   : 'Control',\r\n  Escape    : 'Escape',\r\n  Space     : ' ',\r\n  PageUp    : 'PageUp',\r\n  PageDown  : 'PageDown',\r\n  ArrowLeft : 'ArrowLeft',\r\n  ArrowUp   : 'ArrowUp',\r\n  ArrowRight: 'ArrowRight',\r\n  ArrowDown : 'ArrowDown',\r\n  Delete    : 'Delete',\r\n  Plus      : '+',\r\n  Minus     : '-',\r\n};\r\n","import { PSVError } from '../PSVError';\r\nimport { VIEWER_DATA } from './constants';\r\n\r\nconst LOCALSTORAGE_TOUCH_SUPPORT = `${VIEWER_DATA}_touchSupport`;\r\n\r\n/**\r\n * @summary General information about the system\r\n * @constant\r\n * @memberOf PSV\r\n * @property {boolean} loaded - Indicates if the system data has been loaded\r\n * @property {Function} load - Loads the system if not already loaded\r\n * @property {number} pixelRatio\r\n * @property {boolean} isWebGLSupported\r\n * @property {number} maxCanvasWidth\r\n * @property {string} mouseWheelEvent\r\n * @property {string} fullscreenEvent\r\n * @property {Function} getMaxCanvasWidth - Returns the max width of a canvas allowed by the browser\r\n * @property {{initial: boolean, promise: Promise<boolean>}} isTouchEnabled\r\n */\r\nexport const SYSTEM = {\r\n  loaded          : false,\r\n  pixelRatio      : 1,\r\n  isWebGLSupported: false,\r\n  isTouchEnabled  : null,\r\n  maxTextureWidth : 0,\r\n  mouseWheelEvent : null,\r\n  fullscreenEvent : null,\r\n};\r\n\r\n/**\r\n * @summary Loads the system if not already loaded\r\n */\r\nSYSTEM.load = () => {\r\n  if (!SYSTEM.loaded) {\r\n    const ctx = getWebGLCtx();\r\n\r\n    SYSTEM.loaded = true;\r\n    SYSTEM.pixelRatio = window.devicePixelRatio || 1;\r\n    SYSTEM.isWebGLSupported = ctx != null;\r\n    SYSTEM.isTouchEnabled = isTouchEnabled();\r\n    SYSTEM.maxTextureWidth = getMaxTextureWidth(ctx);\r\n    SYSTEM.mouseWheelEvent = getMouseWheelEvent();\r\n    SYSTEM.fullscreenEvent = getFullscreenEvent();\r\n  }\r\n};\r\n\r\nlet maxCanvasWidth = null;\r\nSYSTEM.getMaxCanvasWidth = () => {\r\n  if (maxCanvasWidth === null) {\r\n    maxCanvasWidth = getMaxCanvasWidth(SYSTEM.maxTextureWidth);\r\n  }\r\n  return maxCanvasWidth;\r\n};\r\n\r\n/**\r\n * @summary Tries to return a canvas webgl context\r\n * @returns {WebGLRenderingContext}\r\n * @private\r\n */\r\nfunction getWebGLCtx() {\r\n  const canvas = document.createElement('canvas');\r\n  const names = ['webgl', 'experimental-webgl', 'moz-webgl', 'webkit-3d'];\r\n  let context = null;\r\n\r\n  if (!canvas.getContext) {\r\n    return null;\r\n  }\r\n\r\n  if (names.some((name) => {\r\n    try {\r\n      context = canvas.getContext(name);\r\n      return context !== null;\r\n    }\r\n    catch (e) {\r\n      return false;\r\n    }\r\n  })) {\r\n    return context;\r\n  }\r\n  else {\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * @summary Detects if the user is using a touch screen\r\n * @returns {{initial: boolean, promise: Promise<boolean>}}\r\n * @private\r\n */\r\nfunction isTouchEnabled() {\r\n  let initial = ('ontouchstart' in window) || (navigator.maxTouchPoints > 0);\r\n  if (LOCALSTORAGE_TOUCH_SUPPORT in localStorage) {\r\n    initial = localStorage[LOCALSTORAGE_TOUCH_SUPPORT] === 'true';\r\n  }\r\n\r\n  const promise = new Promise((resolve) => {\r\n    let clear;\r\n\r\n    const listenerMouse = () => {\r\n      clear();\r\n      localStorage[LOCALSTORAGE_TOUCH_SUPPORT] = false;\r\n      resolve(false);\r\n    };\r\n\r\n    const listenerTouch = () => {\r\n      clear();\r\n      localStorage[LOCALSTORAGE_TOUCH_SUPPORT] = true;\r\n      resolve(true);\r\n    };\r\n\r\n    const listenerTimeout = () => {\r\n      clear();\r\n      localStorage[LOCALSTORAGE_TOUCH_SUPPORT] = initial;\r\n      resolve(initial);\r\n    };\r\n\r\n    window.addEventListener('mousedown', listenerMouse, false);\r\n    window.addEventListener('touchstart', listenerTouch, false);\r\n    const listenerTimeoutId = setTimeout(listenerTimeout, 10000);\r\n\r\n    clear = () => {\r\n      window.removeEventListener('mousedown', listenerMouse);\r\n      window.removeEventListener('touchstart', listenerTouch);\r\n      clearTimeout(listenerTimeoutId);\r\n    };\r\n  });\r\n\r\n  return { initial, promise };\r\n}\r\n\r\n/**\r\n * @summary Gets max texture width in WebGL context\r\n * @returns {number}\r\n * @private\r\n */\r\nfunction getMaxTextureWidth(ctx) {\r\n  if (ctx !== null) {\r\n    return ctx.getParameter(ctx.MAX_TEXTURE_SIZE);\r\n  }\r\n  else {\r\n    return 0;\r\n  }\r\n}\r\n\r\n/**\r\n * @summary Gets max canvas width supported by the browser.\r\n * We only test powers of 2 and height = width / 2 because that's what we need to generate WebGL textures\r\n * @param maxWidth\r\n * @return {number}\r\n * @private\r\n */\r\nfunction getMaxCanvasWidth(maxWidth) {\r\n  const canvas = document.createElement('canvas');\r\n  const ctx = canvas.getContext('2d');\r\n  canvas.width = maxWidth;\r\n  canvas.height = maxWidth / 2;\r\n\r\n  while (canvas.width > 1024) {\r\n    ctx.fillStyle = 'white';\r\n    ctx.fillRect(0, 0, 1, 1);\r\n\r\n    try {\r\n      if (ctx.getImageData(0, 0, 1, 1).data[0] > 0) {\r\n        return canvas.width;\r\n      }\r\n    }\r\n    catch (e) {\r\n      // continue\r\n    }\r\n\r\n    canvas.width /= 2;\r\n    canvas.height /= 2;\r\n  }\r\n\r\n  throw new PSVError('Unable to detect system capabilities');\r\n}\r\n\r\n/**\r\n * @summary Gets the event name for mouse wheel\r\n * @returns {string}\r\n * @private\r\n */\r\nfunction getMouseWheelEvent() {\r\n  if ('onwheel' in document.createElement('div')) { // Modern browsers support \"wheel\"\r\n    return 'wheel';\r\n  }\r\n  else if (document.onmousewheel !== undefined) { // Webkit and IE support at least \"mousewheel\"\r\n    return 'mousewheel';\r\n  }\r\n  else { // let's assume that remaining browsers are older Firefox\r\n    return 'DOMMouseScroll';\r\n  }\r\n}\r\n\r\n/**\r\n * @summary Map between fullsceen method and fullscreen event name\r\n * @type {Object<string, string>}\r\n * @readonly\r\n * @private\r\n */\r\nconst FULLSCREEN_EVT_MAP = {\r\n  exitFullscreen      : 'fullscreenchange',\r\n  webkitExitFullscreen: 'webkitfullscreenchange',\r\n  mozCancelFullScreen : 'mozfullscreenchange',\r\n  msExitFullscreen    : 'MSFullscreenChange',\r\n};\r\n\r\n\r\n/**\r\n * @summary  Gets the event name for fullscreen\r\n * @returns {string}\r\n * @private\r\n */\r\nfunction getFullscreenEvent() {\r\n  const validExits = Object.keys(FULLSCREEN_EVT_MAP).filter(exit => exit in document);\r\n\r\n  if (validExits.length) {\r\n    return FULLSCREEN_EVT_MAP[validExits[0]];\r\n  }\r\n  else {\r\n    return null;\r\n  }\r\n}\r\n","/**\r\n * @summary Toggles a CSS class\r\n * @memberOf PSV.utils\r\n * @param {HTMLElement|SVGElement} element\r\n * @param {string} className\r\n * @param {boolean} [active] - forced state\r\n */\r\nexport function toggleClass(element, className, active) {\r\n  if (active === undefined) {\r\n    element.classList.toggle(className);\r\n  }\r\n  else if (active && !element.classList.contains(className)) {\r\n    element.classList.add(className);\r\n  }\r\n  else if (!active) {\r\n    element.classList.remove(className);\r\n  }\r\n}\r\n\r\n/**\r\n * @summary Adds one or several CSS classes to an element\r\n * @memberOf PSV.utils\r\n * @param {HTMLElement} element\r\n * @param {string} className\r\n */\r\nexport function addClasses(element, className) {\r\n  if (className) {\r\n    className.split(' ').forEach((name) => {\r\n      toggleClass(element, name, true);\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * @summary Removes one or several CSS classes to an element\r\n * @memberOf PSV.utils\r\n * @param {HTMLElement} element\r\n * @param {string} className\r\n */\r\nexport function removeClasses(element, className) {\r\n  if (className) {\r\n    className.split(' ').forEach((name) => {\r\n      toggleClass(element, name, false);\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * @summary Searches if an element has a particular parent at any level including itself\r\n * @memberOf PSV.utils\r\n * @param {HTMLElement} el\r\n * @param {HTMLElement} parent\r\n * @returns {boolean}\r\n */\r\nexport function hasParent(el, parent) {\r\n  let test = el;\r\n\r\n  do {\r\n    if (test === parent) {\r\n      return true;\r\n    }\r\n    test = test.parentNode;\r\n  } while (test);\r\n\r\n  return false;\r\n}\r\n\r\n/**\r\n * @summary Gets the closest parent (can by itself)\r\n * @memberOf PSV.utils\r\n * @param {HTMLElement|SVGElement} el\r\n * @param {string} selector\r\n * @returns {HTMLElement}\r\n */\r\nexport function getClosest(el, selector) {\r\n  // When el is document or window, the matches does not exist\r\n  if (!el.matches) {\r\n    return null;\r\n  }\r\n\r\n  let test = el;\r\n\r\n  do {\r\n    if (test.matches(selector)) {\r\n      return test;\r\n    }\r\n    test = test instanceof SVGElement ? test.parentNode : test.parentElement;\r\n  } while (test);\r\n\r\n  return null;\r\n}\r\n\r\n/**\r\n * @summary Gets the position of an element in the viewer without reflow\r\n * @description Will gives the same result as getBoundingClientRect() as soon as there are no CSS transforms\r\n * @memberOf PSV.utils\r\n * @param {HTMLElement} el\r\n * @return {{left: number, top: number}}\r\n */\r\nexport function getPosition(el) {\r\n  let left = 0;\r\n  let top = 0;\r\n  let test = el;\r\n\r\n  while (test) {\r\n    left += (test.offsetLeft - test.scrollLeft + test.clientLeft);\r\n    top += (test.offsetTop - test.scrollTop + test.clientTop);\r\n    test = test.offsetParent;\r\n  }\r\n\r\n  return { left, top };\r\n}\r\n\r\n/**\r\n * @summary Detects if fullscreen is enabled\r\n * @memberOf PSV.utils\r\n * @param {HTMLElement} elt\r\n * @returns {boolean}\r\n */\r\nexport function isFullscreenEnabled(elt) {\r\n  return (document.fullscreenElement || document.webkitFullscreenElement) === elt;\r\n}\r\n\r\n/**\r\n * @summary Enters fullscreen mode\r\n * @memberOf PSV.utils\r\n * @param {HTMLElement} elt\r\n */\r\nexport function requestFullscreen(elt) {\r\n  (elt.requestFullscreen || elt.webkitRequestFullscreen).call(elt);\r\n}\r\n\r\n/**\r\n * @summary Exits fullscreen mode\r\n * @memberOf PSV.utils\r\n */\r\nexport function exitFullscreen() {\r\n  (document.exitFullscreen || document.webkitExitFullscreen).call(document);\r\n}\r\n\r\n/**\r\n * @summary Gets an element style\r\n * @memberOf PSV.utils\r\n * @param {HTMLElement} elt\r\n * @param {string} prop\r\n * @returns {*}\r\n */\r\nexport function getStyle(elt, prop) {\r\n  return window.getComputedStyle(elt, null)[prop];\r\n}\r\n\r\n/**\r\n * @summary Normalize mousewheel values accross browsers\r\n * @memberOf PSV.utils\r\n * @description From Facebook's Fixed Data Table\r\n * {@link https://github.com/facebookarchive/fixed-data-table/blob/master/src/vendor_upstream/dom/normalizeWheel.js}\r\n * @copyright Facebook\r\n * @param {WheelEvent} event\r\n * @returns {{spinX: number, spinY: number, pixelX: number, pixelY: number}}\r\n */\r\nexport function normalizeWheel(event) {\r\n  const PIXEL_STEP = 10;\r\n  const LINE_HEIGHT = 40;\r\n  const PAGE_HEIGHT = 800;\r\n\r\n  let spinX = 0;\r\n  let spinY = 0;\r\n  let pixelX = 0;\r\n  let pixelY = 0;\r\n\r\n  // Legacy\r\n  if ('detail' in event) {\r\n    spinY = event.detail;\r\n  }\r\n  if ('wheelDelta' in event) {\r\n    spinY = -event.wheelDelta / 120;\r\n  }\r\n  if ('wheelDeltaY' in event) {\r\n    spinY = -event.wheelDeltaY / 120;\r\n  }\r\n  if ('wheelDeltaX' in event) {\r\n    spinX = -event.wheelDeltaX / 120;\r\n  }\r\n\r\n  // side scrolling on FF with DOMMouseScroll\r\n  if ('axis' in event && event.axis === event.HORIZONTAL_AXIS) {\r\n    spinX = spinY;\r\n    spinY = 0;\r\n  }\r\n\r\n  pixelX = spinX * PIXEL_STEP;\r\n  pixelY = spinY * PIXEL_STEP;\r\n\r\n  if ('deltaY' in event) {\r\n    pixelY = event.deltaY;\r\n  }\r\n  if ('deltaX' in event) {\r\n    pixelX = event.deltaX;\r\n  }\r\n\r\n  if ((pixelX || pixelY) && event.deltaMode) {\r\n    // delta in LINE units\r\n    if (event.deltaMode === 1) {\r\n      pixelX *= LINE_HEIGHT;\r\n      pixelY *= LINE_HEIGHT;\r\n    }\r\n    // delta in PAGE units\r\n    else {\r\n      pixelX *= PAGE_HEIGHT;\r\n      pixelY *= PAGE_HEIGHT;\r\n    }\r\n  }\r\n\r\n  // Fall-back if spin cannot be determined\r\n  if (pixelX && !spinX) {\r\n    spinX = (pixelX < 1) ? -1 : 1;\r\n  }\r\n  if (pixelY && !spinY) {\r\n    spinY = (pixelY < 1) ? -1 : 1;\r\n  }\r\n\r\n  return { spinX, spinY, pixelX, pixelY };\r\n}\r\n","/**\r\n * @summary Ensures that a number is in a given interval\r\n * @memberOf PSV.utils\r\n * @param {number} x\r\n * @param {number} min\r\n * @param {number} max\r\n * @returns {number}\r\n */\r\nexport function bound(x, min, max) {\r\n  return Math.max(min, Math.min(max, x));\r\n}\r\n\r\n/**\r\n * @summary Ensure a value is within 0 and `max`\r\n * @param {number} value\r\n * @param {number} max\r\n * @return {number}\r\n */\r\nexport function loop(value, max) {\r\n  let result = value % max;\r\n\r\n  if (result < 0) {\r\n    result += max;\r\n  }\r\n\r\n  return result;\r\n}\r\n\r\n/**\r\n * @summary Checks if a value is an integer\r\n * @memberOf PSV.utils\r\n * @param {*} value\r\n * @returns {boolean}\r\n */\r\nexport function isInteger(value) {\r\n  if (Number.isInteger) {\r\n    return Number.isInteger(value);\r\n  }\r\n  return typeof value === 'number' && Number.isFinite(value) && Math.floor(value) === value;\r\n}\r\n\r\n/**\r\n * @summary Tests if a number is power of two\r\n * @memberOf PSV.utils\r\n * @param {number} x\r\n * @return {boolean}\r\n */\r\nexport function isPowerOfTwo(x) {\r\n  return (Math.log(x) / Math.log(2)) % 1 === 0;\r\n}\r\n\r\n/**\r\n * @summary Computes the sum of an array\r\n * @memberOf PSV.utils\r\n * @param {number[]} array\r\n * @returns {number}\r\n */\r\nexport function sum(array) {\r\n  return array.reduce((a, b) => a + b, 0);\r\n}\r\n\r\n/**\r\n * @summary Computes the distance between two points\r\n * @memberOf PSV.utils\r\n * @param {PSV.Point} p1\r\n * @param {PSV.Point} p2\r\n * @returns {number}\r\n */\r\nexport function distance(p1, p2) {\r\n  return Math.sqrt(Math.pow(p1.x - p2.x, 2) + Math.pow(p1.y - p2.y, 2));\r\n}\r\n\r\n/**\r\n * @summary Compute the shortest offset between two longitudes\r\n * @memberOf PSV.utils\r\n * @param {number} from\r\n * @param {number} to\r\n * @returns {number}\r\n */\r\nexport function getShortestArc(from, to) {\r\n  const tCandidates = [\r\n    0, // direct\r\n    Math.PI * 2, // clock-wise cross zero\r\n    -Math.PI * 2, // counter-clock-wise cross zero\r\n  ];\r\n\r\n  return tCandidates.reduce((value, candidate) => {\r\n    const newCandidate = to - from + candidate;\r\n    return Math.abs(newCandidate) < Math.abs(value) ? newCandidate : value;\r\n  }, Infinity);\r\n}\r\n\r\n/**\r\n * @summary Computes the angle between the current position and a target position\r\n * @memberOf PSV.utils\r\n * @param {PSV.Position} position1\r\n * @param {PSV.Position} position2\r\n * @returns {number}\r\n */\r\nexport function getAngle(position1, position2) {\r\n  return Math.acos(\r\n    Math.cos(position1.latitude)\r\n    * Math.cos(position2.latitude)\r\n    * Math.cos(position1.longitude - position2.longitude)\r\n    + Math.sin(position1.latitude)\r\n    * Math.sin(position2.latitude)\r\n  );\r\n}\r\n\r\n/**\r\n * @summary Returns the distance between two points on a sphere of radius one\r\n * {@link http://www.movable-type.co.uk/scripts/latlong.html}\r\n * @memberOf PSV.utils\r\n * @param {number[]} p1\r\n * @param {number[]} p2\r\n * @returns {number}\r\n */\r\nexport function greatArcDistance(p1, p2) {\r\n  const [λ1, φ1] = p1;\r\n  const [λ2, φ2] = p2;\r\n\r\n  const x = (λ2 - λ1) * Math.cos((φ1 + φ2) / 2);\r\n  const y = (φ2 - φ1);\r\n  return Math.sqrt(x * x + y * y);\r\n}\r\n","/**\r\n * @summary Transforms a string to dash-case {@link https://github.com/shahata/dasherize}\r\n * @memberOf PSV.utils\r\n * @param {string} str\r\n * @returns {string}\r\n */\r\nexport function dasherize(str) {\r\n  return str.replace(/[A-Z](?:(?=[^A-Z])|[A-Z]*(?=[A-Z][^A-Z]|$))/g, (s, i) => {\r\n    return (i > 0 ? '-' : '') + s.toLowerCase();\r\n  });\r\n}\r\n\r\n/**\r\n * @summary Returns a function, that, when invoked, will only be triggered at most once during a given window of time.\r\n * @memberOf PSV.utils\r\n * @copyright underscore.js - modified by Clément Prévost {@link http://stackoverflow.com/a/27078401}\r\n * @param {Function} func\r\n * @param {number} wait\r\n * @returns {Function}\r\n */\r\nexport function throttle(func, wait) {\r\n  /* eslint-disable */\r\n  let self, args, result;\r\n  let timeout;\r\n  let previous = 0;\r\n  const later = function() {\r\n    previous = Date.now();\r\n    timeout = undefined;\r\n    result = func.apply(self, args);\r\n    if (!timeout) {\r\n      self = args = null;\r\n    }\r\n  };\r\n  return function() {\r\n    const now = Date.now();\r\n    if (!previous) {\r\n      previous = now;\r\n    }\r\n    const remaining = wait - (now - previous);\r\n    self = this;\r\n    args = arguments;\r\n    if (remaining <= 0 || remaining > wait) {\r\n      if (timeout) {\r\n        clearTimeout(timeout);\r\n        timeout = undefined;\r\n      }\r\n      previous = now;\r\n      result = func.apply(self, args);\r\n      if (!timeout) {\r\n        self = args = null;\r\n      }\r\n    }\r\n    else if (!timeout) {\r\n      timeout = setTimeout(later, remaining);\r\n    }\r\n    return result;\r\n  };\r\n  /* eslint-enable */\r\n}\r\n\r\n/**\r\n * @summary Test if an object is a plain object\r\n * @memberOf PSV.utils\r\n * @description Test if an object is a plain object, i.e. is constructed\r\n * by the built-in Object constructor and inherits directly from Object.prototype\r\n * or null. Some built-in objects pass the test, e.g. Math which is a plain object\r\n * and some host or exotic objects may pass also.\r\n * {@link http://stackoverflow.com/a/5878101/1207670}\r\n * @param {*} obj\r\n * @returns {boolean}\r\n */\r\nexport function isPlainObject(obj) {\r\n  // Basic check for Type object that's not null\r\n  if (typeof obj === 'object' && obj !== null) {\r\n    // If Object.getPrototypeOf supported, use it\r\n    if (typeof Object.getPrototypeOf === 'function') {\r\n      const proto = Object.getPrototypeOf(obj);\r\n      return proto === Object.prototype || proto === null;\r\n    }\r\n\r\n    // Otherwise, use internal class\r\n    // This should be reliable as if getPrototypeOf not supported, is pre-ES5\r\n    return Object.prototype.toString.call(obj) === '[object Object]';\r\n  }\r\n\r\n  // Not an object\r\n  return false;\r\n}\r\n\r\n/**\r\n * @summary Merges the enumerable attributes of two objects\r\n * @memberOf PSV.utils\r\n * @description Replaces arrays and alters the target object.\r\n * @copyright Nicholas Fisher <nfisher110@gmail.com>\r\n * @param {Object} target\r\n * @param {Object} src\r\n * @returns {Object} target\r\n */\r\nexport function deepmerge(target, src) {\r\n  /* eslint-disable */\r\n  let first = src;\r\n\r\n  return (function merge(target, src) {\r\n    if (Array.isArray(src)) {\r\n      if (!target || !Array.isArray(target)) {\r\n        target = [];\r\n      }\r\n      else {\r\n        target.length = 0;\r\n      }\r\n      src.forEach(function(e, i) {\r\n        target[i] = merge(null, e);\r\n      });\r\n    }\r\n    else if (typeof src === 'object') {\r\n      if (!target || Array.isArray(target)) {\r\n        target = {};\r\n      }\r\n      Object.keys(src).forEach(function(key) {\r\n        if (typeof src[key] !== 'object' || !src[key] || !isPlainObject(src[key])) {\r\n          target[key] = src[key];\r\n        }\r\n        else if (src[key] != first) {\r\n          if (!target[key]) {\r\n            target[key] = merge(null, src[key]);\r\n          }\r\n          else {\r\n            merge(target[key], src[key]);\r\n          }\r\n        }\r\n      });\r\n    }\r\n    else {\r\n      target = src;\r\n    }\r\n\r\n    return target;\r\n  }(target, src));\r\n  /* eslint-enable */\r\n}\r\n\r\n/**\r\n * @summary Deeply clones an object\r\n * @memberOf PSV.utils\r\n * @param {Object} src\r\n * @returns {Object}\r\n */\r\nexport function clone(src) {\r\n  return deepmerge(null, src);\r\n}\r\n\r\n/**\r\n * @summery Test of an object is empty\r\n * @memberOf PSV.utils\r\n * @param {object} obj\r\n * @returns {boolean}\r\n */\r\nexport function isEmpty(obj) {\r\n  return !obj || (Object.keys(obj).length === 0 && obj.constructor === Object);\r\n}\r\n\r\n/**\r\n * @summary Loops over enumerable properties of an object\r\n * @memberOf PSV.utils\r\n * @param {Object} object\r\n * @param {Function} callback\r\n */\r\nexport function each(object, callback) {\r\n  Object.keys(object).forEach((key) => {\r\n    callback(object[key], key);\r\n  });\r\n}\r\n\r\n/**\r\n * @summary Returns if a valu is null or undefined\r\n * @memberOf PSV.utils\r\n * @param {*} val\r\n * @return {boolean}\r\n */\r\nexport function isNil(val) {\r\n  return val === null || val === undefined;\r\n}\r\n\r\n/**\r\n * @summary Returns the first non null non undefined parameter\r\n * @memberOf PSV.utils\r\n * @param {*} values\r\n * @return {*}\r\n */\r\nexport function firstNonNull(...values) {\r\n  for (const val of values) {\r\n    if (!isNil(val)) {\r\n      return val;\r\n    }\r\n  }\r\n\r\n  return undefined;\r\n}\r\n\r\n/**\r\n * @summary Returns deep equality between objects\r\n * {@link https://gist.github.com/egardner/efd34f270cc33db67c0246e837689cb9}\r\n * @param obj1\r\n * @param obj2\r\n * @return {boolean}\r\n * @private\r\n */\r\nexport function deepEqual(obj1, obj2) {\r\n  if (obj1 === obj2) {\r\n    return true;\r\n  }\r\n  else if (isObject(obj1) && isObject(obj2)) {\r\n    if (Object.keys(obj1).length !== Object.keys(obj2).length) {\r\n      return false;\r\n    }\r\n    for (const prop of Object.keys(obj1)) {\r\n      if (!deepEqual(obj1[prop], obj2[prop])) {\r\n        return false;\r\n      }\r\n    }\r\n    return true;\r\n  }\r\n  else {\r\n    return false;\r\n  }\r\n}\r\n\r\nfunction isObject(obj) {\r\n  return typeof obj === 'object' && obj != null;\r\n}\r\n\r\n","import * as THREE from 'three';\r\nimport { PSVError } from '../PSVError';\r\nimport { bound, loop } from './math';\r\n\r\n/**\r\n * @summary Returns the plugin constructor from the imported object\r\n * For retrocompatibility with previous default exports\r\n * @memberOf PSV.utils\r\n * @package\r\n */\r\nexport function pluginInterop(plugin, target) {\r\n  if (plugin) {\r\n    for (const [, p] of [['_', plugin], ...Object.entries(plugin)]) {\r\n      if (p.prototype instanceof target) {\r\n        return p;\r\n      }\r\n    }\r\n  }\r\n  return null;\r\n}\r\n\r\n/**\r\n * @summary Builds an Error with name 'AbortError'\r\n * @memberOf PSV.utils\r\n * @return {Error}\r\n */\r\nexport function getAbortError() {\r\n  const error = new Error('Loading was aborted.');\r\n  error.name = 'AbortError';\r\n  return error;\r\n}\r\n\r\n/**\r\n * @summary Tests if an Error has name 'AbortError'\r\n * @memberOf PSV.utils\r\n * @param {Error} err\r\n * @return {boolean}\r\n */\r\nexport function isAbortError(err) {\r\n  return err?.name === 'AbortError';\r\n}\r\n\r\n/**\r\n * @summary Displays a warning in the console\r\n * @memberOf PSV.utils\r\n * @param {string} message\r\n */\r\nexport function logWarn(message) {\r\n  console.warn(`PhotoSphereViewer: ${message}`);\r\n}\r\n\r\n/**\r\n * @summary Checks if an object is a {PSV.ExtendedPosition}, ie has x/y or longitude/latitude\r\n * @memberOf PSV.utils\r\n * @param {object} object\r\n * @returns {boolean}\r\n */\r\nexport function isExtendedPosition(object) {\r\n  return [['x', 'y'], ['longitude', 'latitude']].some(([key1, key2]) => {\r\n    return object[key1] !== undefined && object[key2] !== undefined;\r\n  });\r\n}\r\n\r\n/**\r\n * @summary Returns the value of a given attribute in the panorama metadata\r\n * @memberOf PSV.utils\r\n * @param {string} data\r\n * @param {string} attr\r\n * @returns (number)\r\n */\r\nexport function getXMPValue(data, attr) {\r\n  // XMP data are stored in children\r\n  let result = data.match('<GPano:' + attr + '>(.*)</GPano:' + attr + '>');\r\n  if (result !== null) {\r\n    const val = parseInt(result[1], 10);\r\n    return isNaN(val) ? null : val;\r\n  }\r\n\r\n  // XMP data are stored in attributes\r\n  result = data.match('GPano:' + attr + '=\"(.*?)\"');\r\n  if (result !== null) {\r\n    const val = parseInt(result[1], 10);\r\n    return isNaN(val) ? null : val;\r\n  }\r\n\r\n  return null;\r\n}\r\n\r\n/**\r\n * @readonly\r\n * @private\r\n * @type {{top: string, left: string, bottom: string, center: string, right: string}}\r\n */\r\nconst CSS_POSITIONS = {\r\n  top   : '0%',\r\n  bottom: '100%',\r\n  left  : '0%',\r\n  right : '100%',\r\n  center: '50%',\r\n};\r\n\r\n/**\r\n * @summary Translate CSS values like \"top center\" or \"10% 50%\" as top and left positions\r\n * @memberOf PSV.utils\r\n * @description The implementation is as close as possible to the \"background-position\" specification\r\n * {@link https://developer.mozilla.org/en-US/docs/Web/CSS/background-position}\r\n * @param {string|PSV.Point} value\r\n * @returns {PSV.Point}\r\n */\r\nexport function parsePosition(value) {\r\n  if (!value) {\r\n    return { x: 0.5, y: 0.5 };\r\n  }\r\n\r\n  if (typeof value === 'object') {\r\n    return value;\r\n  }\r\n\r\n  let tokens = value.toLocaleLowerCase().split(' ').slice(0, 2);\r\n\r\n  if (tokens.length === 1) {\r\n    if (CSS_POSITIONS[tokens[0]] !== undefined) {\r\n      tokens = [tokens[0], 'center'];\r\n    }\r\n    else {\r\n      tokens = [tokens[0], tokens[0]];\r\n    }\r\n  }\r\n\r\n  const xFirst = tokens[1] !== 'left' && tokens[1] !== 'right' && tokens[0] !== 'top' && tokens[0] !== 'bottom';\r\n\r\n  tokens = tokens.map(token => CSS_POSITIONS[token] || token);\r\n\r\n  if (!xFirst) {\r\n    tokens.reverse();\r\n  }\r\n\r\n  const parsed = tokens.join(' ').match(/^([0-9.]+)% ([0-9.]+)%$/);\r\n\r\n  if (parsed) {\r\n    return {\r\n      x: parseFloat(parsed[1]) / 100,\r\n      y: parseFloat(parsed[2]) / 100,\r\n    };\r\n  }\r\n  else {\r\n    return { x: 0.5, y: 0.5 };\r\n  }\r\n}\r\n\r\n/**\r\n * @readonly\r\n * @private\r\n */\r\nconst LEFT_MAP = { 0: 'left', 0.5: 'center', 1: 'right' };\r\n/**\r\n * @readonly\r\n * @private\r\n */\r\nconst TOP_MAP = { 0: 'top', 0.5: 'center', 1: 'bottom' };\r\n\r\n/**\r\n * @summary Parse a CSS-like position into an array of position keywords among top, bottom, left, right and center\r\n * @memberOf PSV.utils\r\n * @param {string | string[]} value\r\n * @param {string} defaultValue\r\n * @param {boolean} [allowCenter=true]\r\n * @return {string[]}\r\n */\r\nexport function cleanPosition(value, defaultValue, allowCenter = true) {\r\n  if (!value) {\r\n    return defaultValue.split(' ');\r\n  }\r\n\r\n  if (typeof value === 'string') {\r\n    const tempPos = parsePosition(value);\r\n\r\n    if (!(tempPos.x in LEFT_MAP) || !(tempPos.y in TOP_MAP)) {\r\n      throw new PSVError(`Unable to parse position \"${value}\"`);\r\n    }\r\n\r\n    value = [TOP_MAP[tempPos.y], LEFT_MAP[tempPos.x]];\r\n  }\r\n\r\n  if (!allowCenter && value[0] === 'center' && value[1] === 'center') {\r\n    throw new PSVError('Unable to parse position \"center center\"');\r\n  }\r\n\r\n  return value;\r\n}\r\n\r\n/**\r\n * @summary Parses an speed\r\n * @memberOf PSV.utils\r\n * @param {string|number} speed - The speed, in radians/degrees/revolutions per second/minute\r\n * @returns {number} radians per second\r\n * @throws {PSV.PSVError} when the speed cannot be parsed\r\n */\r\nexport function parseSpeed(speed) {\r\n  let parsed;\r\n\r\n  if (typeof speed === 'string') {\r\n    const speedStr = speed.toString().trim();\r\n\r\n    // Speed extraction\r\n    let speedValue = parseFloat(speedStr.replace(/^(-?[0-9]+(?:\\.[0-9]*)?).*$/, '$1'));\r\n    const speedUnit = speedStr.replace(/^-?[0-9]+(?:\\.[0-9]*)?(.*)$/, '$1').trim();\r\n\r\n    // \"per minute\" -> \"per second\"\r\n    if (speedUnit.match(/(pm|per minute)$/)) {\r\n      speedValue /= 60;\r\n    }\r\n\r\n    // Which unit?\r\n    switch (speedUnit) {\r\n      // Degrees per minute / second\r\n      case 'dpm':\r\n      case 'degrees per minute':\r\n      case 'dps':\r\n      case 'degrees per second':\r\n        parsed = THREE.MathUtils.degToRad(speedValue);\r\n        break;\r\n\r\n      // Radians per minute / second\r\n      case 'rdpm':\r\n      case 'radians per minute':\r\n      case 'rdps':\r\n      case 'radians per second':\r\n        parsed = speedValue;\r\n        break;\r\n\r\n      // Revolutions per minute / second\r\n      case 'rpm':\r\n      case 'revolutions per minute':\r\n      case 'rps':\r\n      case 'revolutions per second':\r\n        parsed = speedValue * Math.PI * 2;\r\n        break;\r\n\r\n      // Unknown unit\r\n      default:\r\n        throw new PSVError('Unknown speed unit \"' + speedUnit + '\"');\r\n    }\r\n  }\r\n  else {\r\n    parsed = speed;\r\n  }\r\n\r\n  return parsed;\r\n}\r\n\r\n/**\r\n * @summary Parses an angle value in radians or degrees and returns a normalized value in radians\r\n * @memberOf PSV.utils\r\n * @param {string|number} angle - eg: 3.14, 3.14rad, 180deg\r\n * @param {boolean} [zeroCenter=false] - normalize between -Pi - Pi instead of 0 - 2*Pi\r\n * @param {boolean} [halfCircle=zeroCenter] - normalize between -Pi/2 - Pi/2 instead of -Pi - Pi\r\n * @returns {number}\r\n * @throws {PSV.PSVError} when the angle cannot be parsed\r\n */\r\nexport function parseAngle(angle, zeroCenter = false, halfCircle = zeroCenter) {\r\n  let parsed;\r\n\r\n  if (typeof angle === 'string') {\r\n    const match = angle.toLowerCase().trim().match(/^(-?[0-9]+(?:\\.[0-9]*)?)(.*)$/);\r\n\r\n    if (!match) {\r\n      throw new PSVError('Unknown angle \"' + angle + '\"');\r\n    }\r\n\r\n    const value = parseFloat(match[1]);\r\n    const unit = match[2];\r\n\r\n    if (unit) {\r\n      switch (unit) {\r\n        case 'deg':\r\n        case 'degs':\r\n          parsed = THREE.MathUtils.degToRad(value);\r\n          break;\r\n        case 'rad':\r\n        case 'rads':\r\n          parsed = value;\r\n          break;\r\n        default:\r\n          throw new PSVError('Unknown angle unit \"' + unit + '\"');\r\n      }\r\n    }\r\n    else {\r\n      parsed = value;\r\n    }\r\n  }\r\n  else if (typeof angle === 'number' && !isNaN(angle)) {\r\n    parsed = angle;\r\n  }\r\n  else {\r\n    throw new PSVError('Unknown angle \"' + angle + '\"');\r\n  }\r\n\r\n  parsed = loop(zeroCenter ? parsed + Math.PI : parsed, Math.PI * 2);\r\n\r\n  return zeroCenter ? bound(parsed - Math.PI, -Math.PI / (halfCircle ? 2 : 1), Math.PI / (halfCircle ? 2 : 1)) : parsed;\r\n}\r\n\r\n/**\r\n * @summary Creates a THREE texture from an image\r\n * @memberOf PSV.utils\r\n * @param {HTMLImageElement | HTMLCanvasElement} img\r\n * @return {external:THREE.Texture}\r\n */\r\nexport function createTexture(img) {\r\n  const texture = new THREE.Texture(img);\r\n  texture.needsUpdate = true;\r\n  texture.minFilter = THREE.LinearFilter;\r\n  texture.generateMipmaps = false;\r\n  return texture;\r\n}\r\n\r\nconst quaternion = new THREE.Quaternion();\r\n\r\n/**\r\n * @summary Applies the inverse of Euler angles to a vector\r\n * @memberOf PSV.utils\r\n * @param {external:THREE.Vector3} vector\r\n * @param {external:THREE.Euler} euler\r\n */\r\nexport function applyEulerInverse(vector, euler) {\r\n  quaternion.setFromEuler(euler).invert();\r\n  vector.applyQuaternion(quaternion);\r\n}\r\n","import { EASINGS } from '../data/constants';\r\nimport { each } from './misc';\r\nimport { logWarn } from './psv';\r\n\r\n/**\r\n * @callback OnTick\r\n * @summary Function called for each animation frame with computed properties\r\n * @memberOf PSV.utils.Animation\r\n * @param {Object.<string, number>} properties - current values\r\n * @param {float} progress - 0 to 1\r\n */\r\n\r\n/**\r\n * @summary Interpolation helper for animations\r\n * @memberOf PSV.utils\r\n * @description\r\n * Implements the Promise API with an additional \"cancel\" method.\r\n * The promise is resolved with `true` when the animation is completed and `false` if the animation is cancelled.\r\n * @example\r\n * const anim = new Animation({\r\n *     properties: {\r\n *         width: {start: 100, end: 200}\r\n *     },\r\n *     duration: 5000,\r\n *     onTick: (properties) => element.style.width = `${properties.width}px`;\r\n * });\r\n *\r\n * anim.then((completed) => ...);\r\n *\r\n * anim.cancel()\r\n */\r\nexport class Animation {\r\n\r\n  /**\r\n   * @param {Object} options\r\n   * @param {Object.<string, Object>} options.properties\r\n   * @param {number} options.properties[].start\r\n   * @param {number} options.properties[].end\r\n   * @param {number} options.duration\r\n   * @param {number} [options.delay=0]\r\n   * @param {string} [options.easing='linear']\r\n   * @param {PSV.utils.Animation.OnTick} options.onTick - called on each frame\r\n   */\r\n  constructor(options) {\r\n    this.__callbacks = [];\r\n\r\n    if (options) {\r\n      if (!options.easing || typeof options.easing === 'string') {\r\n        options.easing = EASINGS[options.easing || 'linear'];\r\n      }\r\n\r\n      this.__start = null;\r\n      this.options = options;\r\n\r\n      if (options.delay) {\r\n        this.__delayTimeout = setTimeout(() => {\r\n          this.__delayTimeout = null;\r\n          this.__animationFrame = window.requestAnimationFrame(t => this.__run(t));\r\n        }, options.delay);\r\n      }\r\n      else {\r\n        this.__animationFrame = window.requestAnimationFrame(t => this.__run(t));\r\n      }\r\n    }\r\n    else {\r\n      this.__resolved = true;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @summary Main loop for the animation\r\n   * @param {number} timestamp\r\n   * @private\r\n   */\r\n  __run(timestamp) {\r\n    // first iteration\r\n    if (this.__start === null) {\r\n      this.__start = timestamp;\r\n    }\r\n\r\n    // compute progress\r\n    const progress = (timestamp - this.__start) / this.options.duration;\r\n    const current = {};\r\n\r\n    if (progress < 1.0) {\r\n      // interpolate properties\r\n      each(this.options.properties, (prop, name) => {\r\n        if (prop) {\r\n          current[name] = prop.start + (prop.end - prop.start) * this.options.easing(progress);\r\n        }\r\n      });\r\n      this.options.onTick(current, progress);\r\n\r\n      this.__animationFrame = window.requestAnimationFrame(t => this.__run(t));\r\n    }\r\n    else {\r\n      // call onTick one last time with final values\r\n      each(this.options.properties, (prop, name) => {\r\n        if (prop) {\r\n          current[name] = prop.end;\r\n        }\r\n      });\r\n      this.options.onTick(current, 1.0);\r\n\r\n      this.__animationFrame = window.requestAnimationFrame(() => {\r\n        this.__resolved = true;\r\n        this.__resolve(true);\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @private\r\n   */\r\n  __resolve(value) {\r\n    this.__callbacks.forEach(cb => cb(value));\r\n    this.__callbacks.length = 0;\r\n  }\r\n\r\n  /**\r\n   * @summary Promise chaining\r\n   * @param {Function} [onFulfilled] - Called when the animation is complete (true) or cancelled (false)\r\n   * @param {Function} [onRejected] - deprecated\r\n   * @returns {Promise}\r\n   */\r\n  then(onFulfilled = null, onRejected = null) {\r\n    if (onRejected) {\r\n      logWarn('Animation#then does not accept a rejection handler anymore');\r\n    }\r\n\r\n    if (this.__resolved || this.__cancelled) {\r\n      return Promise.resolve(this.__resolved)\r\n        .then(onFulfilled);\r\n    }\r\n\r\n    return new Promise((resolve) => {\r\n      this.__callbacks.push(resolve);\r\n    })\r\n      .then(onFulfilled);\r\n  }\r\n\r\n  /**\r\n   * @summary Cancels the animation\r\n   */\r\n  cancel() {\r\n    if (!this.__cancelled && !this.__resolved) {\r\n      this.__cancelled = true;\r\n      this.__resolve(false);\r\n\r\n      if (this.__delayTimeout) {\r\n        window.clearTimeout(this.__delayTimeout);\r\n        this.__delayTimeout = null;\r\n      }\r\n      if (this.__animationFrame) {\r\n        window.cancelAnimationFrame(this.__animationFrame);\r\n        this.__animationFrame = null;\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @deprecated not supported anymore\r\n   */\r\n  catch() {\r\n    logWarn('Animation#catch is not supported anymore');\r\n    return this.then();\r\n  }\r\n\r\n  /**\r\n   * @deprecated not supported anymore\r\n   */\r\n  finally(onFinally) {\r\n    logWarn('Animation#finally is not supported anymore');\r\n    return this.then(onFinally);\r\n  }\r\n\r\n  /**\r\n   * @deprecated not supported anymore\r\n   */\r\n  static resolve() {\r\n    logWarn('Animation.resolve is not supported anymore');\r\n  }\r\n\r\n}\r\n","import { PSVError } from '../PSVError';\r\nimport { bound, loop } from './math';\r\n\r\n/**\r\n * @summary Represents a variable that can dynamically change with time (using requestAnimationFrame)\r\n * @memberOf PSV.utils\r\n */\r\nexport class Dynamic {\r\n\r\n  static STOP = 0;\r\n  static INFINITE = 1;\r\n  static POSITION = 2;\r\n\r\n  /**\r\n   * @param {Function} [fn] Callback function\r\n   * @param {number} [defaultValue] Default position\r\n   * @param {number} [min] Minimum position\r\n   * @param {number} [max] Maximum position\r\n   * @param {boolean} [loopValue] Loop value between min and max\r\n   */\r\n  constructor(fn, defaultValue = 0, min = -Infinity, max = Infinity, loopValue = false) {\r\n    /**\r\n     * @type {Function}\r\n     * @private\r\n     * @readonly\r\n     */\r\n    this.fn = fn;\r\n\r\n    /**\r\n     * @type {number}\r\n     * @private\r\n     */\r\n    this.mode = Dynamic.STOP;\r\n\r\n    /**\r\n     * @type {number}\r\n     * @private\r\n     */\r\n    this.speed = 0;\r\n\r\n    /**\r\n     * @type {number}\r\n     * @private\r\n     */\r\n    this.speedMult = 1;\r\n\r\n    /**\r\n     * @type {number}\r\n     * @private\r\n     */\r\n    this.currentSpeed = 0;\r\n\r\n    /**\r\n     * @type {number}\r\n     * @private\r\n     */\r\n    this.target = 0;\r\n\r\n    /**\r\n     * @type {number}\r\n     * @readonly\r\n     */\r\n    this.current = defaultValue;\r\n\r\n    /**\r\n     * @type {number}\r\n     * @private\r\n     */\r\n    this.min = min;\r\n\r\n    /**\r\n     * @type {number}\r\n     * @private\r\n     */\r\n    this.max = max;\r\n\r\n    /**\r\n     * @type {boolean}\r\n     * @private\r\n     */\r\n    this.loopValue = loopValue;\r\n\r\n    if (loopValue && min !== 0) {\r\n      throw new PSVError('invalid config');\r\n    }\r\n\r\n    if (this.fn) {\r\n      this.fn(defaultValue);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Changes base speed\r\n   * @param {number} speed\r\n   */\r\n  setSpeed(speed) {\r\n    this.speed = speed;\r\n  }\r\n\r\n  /**\r\n   * Defines the target position\r\n   * @param {number} position\r\n   * @param {number} [speedMult=1]\r\n   */\r\n  goto(position, speedMult = 1) {\r\n    this.mode = Dynamic.POSITION;\r\n    this.target = this.loopValue ? loop(position, this.max) : bound(position, this.min, this.max);\r\n    this.speedMult = speedMult;\r\n  }\r\n\r\n  /**\r\n   * Increase/decrease the target position\r\n   * @param {number} step\r\n   * @param {number} [speedMult=1]\r\n   */\r\n  step(step, speedMult = 1) {\r\n    if (this.mode !== Dynamic.POSITION) {\r\n      this.target = this.current;\r\n    }\r\n    this.goto(this.target + step, speedMult);\r\n  }\r\n\r\n  /**\r\n   * Starts infinite movement\r\n   * @param {boolean} [invert=false]\r\n   * @param {number} [speedMult=1]\r\n   */\r\n  roll(invert = false, speedMult = 1) {\r\n    this.mode = Dynamic.INFINITE;\r\n    this.target = invert ? -Infinity : Infinity;\r\n    this.speedMult = speedMult;\r\n  }\r\n\r\n  /**\r\n   * Stops movement\r\n   */\r\n  stop() {\r\n    this.mode = Dynamic.STOP;\r\n  }\r\n\r\n  /**\r\n   * Defines the current position and immediately stops movement\r\n   * @param {number} value\r\n   */\r\n  setValue(value) {\r\n    this.target = this.loopValue ? loop(value, this.max) : bound(value, this.min, this.max);\r\n    this.mode = Dynamic.STOP;\r\n    if (this.target !== this.current) {\r\n      this.current = this.target;\r\n      if (this.fn) {\r\n        this.fn(this.current);\r\n      }\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * @package\r\n   */\r\n  update(elapsed) {\r\n    // in position mode switch to stop mode when in the decceleration window\r\n    if (this.mode === Dynamic.POSITION) {\r\n      // in loop mode, alter \"current\" to avoid crossing the origin\r\n      if (this.loopValue && Math.abs(this.target - this.current) > this.max / 2) {\r\n        this.current = this.current < this.target ? this.current + this.max : this.current - this.max;\r\n      }\r\n\r\n      const dstStop = this.currentSpeed * this.currentSpeed / (this.speed * this.speedMult * 4);\r\n      if (Math.abs(this.target - this.current) <= dstStop) {\r\n        this.mode = Dynamic.STOP;\r\n      }\r\n    }\r\n\r\n    // compute speed\r\n    let targetSpeed = this.mode === Dynamic.STOP ? 0 : this.speed * this.speedMult;\r\n    if (this.target < this.current) {\r\n      targetSpeed = -targetSpeed;\r\n    }\r\n    if (this.currentSpeed < targetSpeed) {\r\n      this.currentSpeed = Math.min(targetSpeed, this.currentSpeed + elapsed / 1000 * this.speed * this.speedMult * 2);\r\n    }\r\n    else if (this.currentSpeed > targetSpeed) {\r\n      this.currentSpeed = Math.max(targetSpeed, this.currentSpeed - elapsed / 1000 * this.speed * this.speedMult * 2);\r\n    }\r\n\r\n    // compute new position\r\n    let next = null;\r\n    if (this.current > this.target && this.currentSpeed) {\r\n      next = Math.max(this.target, this.current + this.currentSpeed * elapsed / 1000);\r\n    }\r\n    else if (this.current < this.target && this.currentSpeed) {\r\n      next = Math.min(this.target, this.current + this.currentSpeed * elapsed / 1000);\r\n    }\r\n\r\n    // apply value\r\n    if (next !== null) {\r\n      next = this.loopValue ? loop(next, this.max) : bound(next, this.min, this.max);\r\n      if (next !== this.current) {\r\n        this.current = next;\r\n        if (this.fn) {\r\n          this.fn(this.current);\r\n        }\r\n        return true;\r\n      }\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n}\r\n","import { each } from './misc';\r\n\r\n/**\r\n * @summary Wrapper for multiple {@link PSV.utils.Dynamic} evolving together\r\n * @memberOf PSV.utils\r\n */\r\nexport class MultiDynamic {\r\n\r\n  /**\r\n   * @type {Object<string, number>}\r\n   * @readonly\r\n   */\r\n  get current() {\r\n    const values = {};\r\n    each(this.dynamics, (dynamic, name) => {\r\n      values[name] = dynamic.current;\r\n    });\r\n    return values;\r\n  }\r\n\r\n  /**\r\n   * @param {Record<string, PSV.utils.Dynamic>} dynamics\r\n   * @param {Function} [fn] Callback function\r\n   */\r\n  constructor(dynamics, fn) {\r\n    /**\r\n     * @type {Function}\r\n     * @private\r\n     * @readonly\r\n     */\r\n    this.fn = fn;\r\n\r\n    /**\r\n     * @type {Record<string, PSV.utils.Dynamic>}\r\n     * @private\r\n     * @readonly\r\n     */\r\n    this.dynamics = dynamics;\r\n\r\n    if (this.fn) {\r\n      this.fn(this.current);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Changes base speed\r\n   * @param {number} speed\r\n   */\r\n  setSpeed(speed) {\r\n    each(this.dynamics, (d) => {\r\n      d.setSpeed(speed);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Defines the target positions\r\n   * @param {Record<string, number>} positions\r\n   * @param {number} [speedMult=1]\r\n   */\r\n  goto(positions, speedMult = 1) {\r\n    each(positions, (position, name) => {\r\n      this.dynamics[name].goto(position, speedMult);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Increase/decrease the target positions\r\n   * @param {Record<string, number>} steps\r\n   * @param {number} [speedMult=1]\r\n   */\r\n  step(steps, speedMult = 1) {\r\n    each(steps, (step, name) => {\r\n      this.dynamics[name].step(step, speedMult);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Starts infinite movements\r\n   * @param {Record<string, boolean>} rolls\r\n   * @param {number} [speedMult=1]\r\n   */\r\n  roll(rolls, speedMult = 1) {\r\n    each(rolls, (roll, name) => {\r\n      this.dynamics[name].roll(roll, speedMult);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Stops movements\r\n   */\r\n  stop() {\r\n    each(this.dynamics, d => d.stop());\r\n  }\r\n\r\n  /**\r\n   * Defines the current positions and immediately stops movements\r\n   * @param {Record<string, number>} values\r\n   */\r\n  setValue(values) {\r\n    let hasUpdates = false;\r\n    each(values, (value, name) => {\r\n      hasUpdates |= this.dynamics[name].setValue(value);\r\n    });\r\n\r\n    if (hasUpdates && this.fn) {\r\n      this.fn(this.current);\r\n    }\r\n\r\n    return hasUpdates;\r\n  }\r\n\r\n  /**\r\n   * @package\r\n   */\r\n  update(elapsed) {\r\n    let hasUpdates = false;\r\n    each(this.dynamics, (dynamic) => {\r\n      hasUpdates |= dynamic.update(elapsed);\r\n    });\r\n\r\n    if (hasUpdates && this.fn) {\r\n      this.fn(this.current);\r\n    }\r\n\r\n    return hasUpdates;\r\n  }\r\n\r\n}\r\n","import { EventEmitter } from 'uevent';\r\n\r\n/**\r\n * @summary Helper to make sliders elements\r\n * @memberOf PSV.utils\r\n */\r\nexport class Slider extends EventEmitter {\r\n\r\n  static VERTICAL = 1;\r\n  static HORIZONTAL = 2;\r\n\r\n  /**\r\n   * @type {boolean}\r\n   * @readonly\r\n   */\r\n  get vertical() {\r\n    return this.prop.direction === Slider.VERTICAL;\r\n  }\r\n\r\n  constructor({ psv, container, direction, onUpdate }) {\r\n    super();\r\n\r\n    /**\r\n     * @summary Reference to main controller\r\n     * @type {PSV.Viewer}\r\n     * @readonly\r\n     */\r\n    this.psv = psv;\r\n\r\n    /**\r\n     * @member {HTMLElement}\r\n     * @readonly\r\n     */\r\n    this.container = container;\r\n\r\n    /**\r\n     * @summary Internal properties\r\n     * @member {Object}\r\n     * @protected\r\n     * @property {boolean} mousedown\r\n     * @property {number} mediaMinWidth\r\n     */\r\n    this.prop = {\r\n      onUpdate : onUpdate,\r\n      direction: direction,\r\n      mousedown: false,\r\n      mouseover: false,\r\n    };\r\n\r\n    this.container.addEventListener('click', this);\r\n    this.container.addEventListener('mousedown', this);\r\n    this.container.addEventListener('mouseenter', this);\r\n    this.container.addEventListener('mouseleave', this);\r\n    this.container.addEventListener('touchstart', this);\r\n    this.container.addEventListener('mousemove', this, true);\r\n    this.container.addEventListener('touchmove', this, true);\r\n    window.addEventListener('mouseup', this);\r\n    window.addEventListener('touchend', this);\r\n  }\r\n\r\n  /**\r\n   * @protected\r\n   */\r\n  destroy() {\r\n    window.removeEventListener('mouseup', this);\r\n    window.removeEventListener('touchend', this);\r\n  }\r\n\r\n  /**\r\n   * @summary Handles events\r\n   * @param {Event} e\r\n   * @private\r\n   */\r\n  handleEvent(e) {\r\n    /* eslint-disable */\r\n    switch (e.type) {\r\n      // @formatter:off\r\n      case 'click':      e.stopPropagation();    break;\r\n      case 'mousedown':  this.__onMouseDown(e);  break;\r\n      case 'mouseenter': this.__onMouseEnter(e); break;\r\n      case 'mouseleave': this.__onMouseLeave(e); break;\r\n      case 'touchstart': this.__onTouchStart(e); break;\r\n      case 'mousemove':  this.__onMouseMove(e);  break;\r\n      case 'touchmove':  this.__onTouchMove(e);  break;\r\n      case 'mouseup':    this.__onMouseUp(e);    break;\r\n      case 'touchend':   this.__onTouchEnd(e);   break;\r\n      // @formatter:on\r\n    }\r\n    /* eslint-enable */\r\n  }\r\n\r\n  /**\r\n   * @private\r\n   */\r\n  __onMouseDown(evt) {\r\n    this.prop.mousedown = true;\r\n    this.__update(evt, true);\r\n  }\r\n\r\n  /**\r\n   * @private\r\n   */\r\n  __onMouseEnter(evt) {\r\n    this.prop.mouseover = true;\r\n    this.__update(evt, true);\r\n  }\r\n\r\n  /**\r\n   * @private\r\n   */\r\n  __onTouchStart(evt) {\r\n    this.prop.mouseover = true;\r\n    this.prop.mousedown = true;\r\n    this.__update(evt.changedTouches[0], true);\r\n  }\r\n\r\n  /**\r\n   * @private\r\n   */\r\n  __onMouseMove(evt) {\r\n    if (this.prop.mousedown || this.prop.mouseover) {\r\n      evt.stopPropagation();\r\n      this.__update(evt, true);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @private\r\n   */\r\n  __onTouchMove(evt) {\r\n    if (this.prop.mousedown || this.prop.mouseover) {\r\n      evt.stopPropagation();\r\n      this.__update(evt.changedTouches[0], true);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @private\r\n   */\r\n  __onMouseUp(evt) {\r\n    if (this.prop.mousedown) {\r\n      this.prop.mousedown = false;\r\n      this.__update(evt, false);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @private\r\n   */\r\n  __onMouseLeave(evt) {\r\n    if (this.prop.mouseover) {\r\n      this.prop.mouseover = false;\r\n      this.__update(evt, true);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @private\r\n   */\r\n  __onTouchEnd(evt) {\r\n    if (this.prop.mousedown) {\r\n      this.prop.mouseover = false;\r\n      this.prop.mousedown = false;\r\n      this.__update(evt.changedTouches[0], false);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @private\r\n   */\r\n  __update(evt, moving) {\r\n    const boundingClientRect = this.container.getBoundingClientRect();\r\n    const cursor = evt[this.vertical ? 'clientY' : 'clientX'];\r\n    const pos = boundingClientRect[this.vertical ? 'bottom' : 'left'];\r\n    const size = boundingClientRect[this.vertical ? 'height' : 'width'];\r\n    const val = Math.abs((pos - cursor) / size);\r\n\r\n    this.prop.onUpdate({\r\n      value    : val,\r\n      click    : !moving,\r\n      mousedown: this.prop.mousedown,\r\n      mouseover: this.prop.mouseover,\r\n      cursor   : evt,\r\n    });\r\n  }\r\n\r\n}\r\n","/**\r\n * @namespace PSV.utils\r\n */\r\n\r\nexport * from './browser';\r\nexport * from './math';\r\nexport * from './misc';\r\nexport * from './psv';\r\n\r\nexport * from './Animation';\r\nexport * from './Dynamic';\r\nexport * from './MultiDynamic';\r\nexport * from './Slider';\r\n","import * as THREE from 'three';\r\nimport { SPHERE_RADIUS } from '../../data/constants';\r\nimport { SYSTEM } from '../../data/system';\r\nimport { PSVError } from '../../PSVError';\r\nimport { createTexture, firstNonNull, getXMPValue, isPowerOfTwo, logWarn } from '../../utils';\r\nimport { AbstractAdapter } from '../AbstractAdapter';\r\n\r\n\r\n/**\r\n * @typedef {Object} PSV.adapters.EquirectangularAdapter.Options\r\n * @property {number} [resolution=64] - number of faces of the sphere geometry, higher values may decrease performances\r\n */\r\n\r\n\r\n/**\r\n * @summary Adapter for equirectangular panoramas\r\n * @memberof PSV.adapters\r\n * @extends PSV.adapters.AbstractAdapter\r\n */\r\nexport class EquirectangularAdapter extends AbstractAdapter {\r\n\r\n  static id = 'equirectangular';\r\n  static supportsDownload = true;\r\n\r\n  /**\r\n   * @param {PSV.Viewer} psv\r\n   * @param {PSV.adapters.EquirectangularAdapter.Options} options\r\n   */\r\n  constructor(psv, options) {\r\n    super(psv);\r\n\r\n    /**\r\n     * @member {PSV.adapters.EquirectangularAdapter.Options}\r\n     * @private\r\n     */\r\n    this.config = {\r\n      resolution: 64,\r\n      ...options,\r\n    };\r\n\r\n    if (!isPowerOfTwo(this.config.resolution)) {\r\n      throw new PSVError('EquirectangularAdapter resolution must be power of two');\r\n    }\r\n\r\n    this.SPHERE_SEGMENTS = this.config.resolution;\r\n    this.SPHERE_HORIZONTAL_SEGMENTS = this.SPHERE_SEGMENTS / 2;\r\n  }\r\n\r\n  /**\r\n   * @override\r\n   */\r\n  supportsTransition() {\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * @override\r\n   */\r\n  supportsPreload() {\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * @override\r\n   * @param {string} panorama\r\n   * @param {PSV.PanoData | PSV.PanoDataProvider} [newPanoData]\r\n   * @returns {Promise.<PSV.TextureData>}\r\n   */\r\n  loadTexture(panorama, newPanoData) {\r\n    if (typeof panorama !== 'string') {\r\n      if (Array.isArray(panorama) || typeof panorama === 'object' && !!panorama.left) {\r\n        logWarn('Cubemap support now requires an additional adapter, see https://photo-sphere-viewer.js.org/guide/adapters');\r\n      }\r\n      return Promise.reject(new PSVError('Invalid panorama url, are you using the right adapter?'));\r\n    }\r\n\r\n    return (\r\n      !this.psv.config.useXmpData\r\n        ? this.psv.textureLoader.loadImage(panorama, p => this.psv.loader.setProgress(p))\r\n          .then(img => ({ img: img, xmpPanoData: null }))\r\n        : this.__loadXMP(panorama, p => this.psv.loader.setProgress(p))\r\n          .then(xmpPanoData => this.psv.textureLoader.loadImage(panorama).then(img => ({ img, xmpPanoData })))\r\n    )\r\n      .then(({ img, xmpPanoData }) => {\r\n        if (typeof newPanoData === 'function') {\r\n          newPanoData = newPanoData(img);\r\n        }\r\n\r\n        const panoData = {\r\n          fullWidth    : firstNonNull(newPanoData?.fullWidth, xmpPanoData?.fullWidth, img.width),\r\n          fullHeight   : firstNonNull(newPanoData?.fullHeight, xmpPanoData?.fullHeight, img.height),\r\n          croppedWidth : firstNonNull(newPanoData?.croppedWidth, xmpPanoData?.croppedWidth, img.width),\r\n          croppedHeight: firstNonNull(newPanoData?.croppedHeight, xmpPanoData?.croppedHeight, img.height),\r\n          croppedX     : firstNonNull(newPanoData?.croppedX, xmpPanoData?.croppedX, 0),\r\n          croppedY     : firstNonNull(newPanoData?.croppedY, xmpPanoData?.croppedY, 0),\r\n          poseHeading  : firstNonNull(newPanoData?.poseHeading, xmpPanoData?.poseHeading, 0),\r\n          posePitch    : firstNonNull(newPanoData?.posePitch, xmpPanoData?.posePitch, 0),\r\n          poseRoll     : firstNonNull(newPanoData?.poseRoll, xmpPanoData?.poseRoll, 0),\r\n        };\r\n\r\n        if (panoData.croppedWidth !== img.width || panoData.croppedHeight !== img.height) {\r\n          logWarn(`Invalid panoData, croppedWidth and/or croppedHeight is not coherent with loaded image.\r\n    panoData: ${panoData.croppedWidth}x${panoData.croppedHeight}, image: ${img.width}x${img.height}`);\r\n        }\r\n        if ((newPanoData || xmpPanoData) && panoData.fullWidth !== panoData.fullHeight * 2) {\r\n          logWarn('Invalid panoData, fullWidth should be twice fullHeight');\r\n        }\r\n\r\n        const texture = this.__createEquirectangularTexture(img, panoData);\r\n\r\n        return { panorama, texture, panoData };\r\n      });\r\n  }\r\n\r\n  /**\r\n   * @summary Loads the XMP data of an image\r\n   * @param {string} panorama\r\n   * @param {function(number)} [onProgress]\r\n   * @returns {Promise<PSV.PanoData>}\r\n   * @throws {PSV.PSVError} when the image cannot be loaded\r\n   * @private\r\n   */\r\n  __loadXMP(panorama, onProgress) {\r\n    return this.psv.textureLoader.loadFile(panorama, onProgress)\r\n      .then(blob => this.__loadBlobAsString(blob))\r\n      .then((binary) => {\r\n        const a = binary.indexOf('<x:xmpmeta');\r\n        const b = binary.indexOf('</x:xmpmeta>');\r\n        const data = binary.substring(a, b);\r\n\r\n        if (a !== -1 && b !== -1 && data.includes('GPano:')) {\r\n          return {\r\n            fullWidth    : getXMPValue(data, 'FullPanoWidthPixels'),\r\n            fullHeight   : getXMPValue(data, 'FullPanoHeightPixels'),\r\n            croppedWidth : getXMPValue(data, 'CroppedAreaImageWidthPixels'),\r\n            croppedHeight: getXMPValue(data, 'CroppedAreaImageHeightPixels'),\r\n            croppedX     : getXMPValue(data, 'CroppedAreaLeftPixels'),\r\n            croppedY     : getXMPValue(data, 'CroppedAreaTopPixels'),\r\n            poseHeading  : getXMPValue(data, 'PoseHeadingDegrees'),\r\n            posePitch    : getXMPValue(data, 'PosePitchDegrees'),\r\n            poseRoll     : getXMPValue(data, 'PoseRollDegrees'),\r\n          };\r\n        }\r\n\r\n        return null;\r\n      });\r\n  }\r\n\r\n  /**\r\n   * @summmary read a Blob as string\r\n   * @param {Blob} blob\r\n   * @returns {Promise<string>}\r\n   * @private\r\n   */\r\n  __loadBlobAsString(blob) {\r\n    return new Promise((resolve, reject) => {\r\n      const reader = new FileReader();\r\n      reader.onload = () => resolve(reader.result);\r\n      reader.onerror = reject;\r\n      reader.readAsText(blob);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * @summary Creates the final texture from image and panorama data\r\n   * @param {Image} img\r\n   * @param {PSV.PanoData} panoData\r\n   * @returns {external:THREE.Texture}\r\n   * @private\r\n   */\r\n  __createEquirectangularTexture(img, panoData) {\r\n    // resize image / fill cropped parts with black\r\n    if (panoData.fullWidth > SYSTEM.maxTextureWidth\r\n      || panoData.croppedWidth !== panoData.fullWidth\r\n      || panoData.croppedHeight !== panoData.fullHeight\r\n    ) {\r\n      const ratio = SYSTEM.getMaxCanvasWidth() / panoData.fullWidth;\r\n\r\n      const resizedPanoData = { ...panoData };\r\n      if (ratio < 1) {\r\n        resizedPanoData.fullWidth *= ratio;\r\n        resizedPanoData.fullHeight *= ratio;\r\n        resizedPanoData.croppedWidth *= ratio;\r\n        resizedPanoData.croppedHeight *= ratio;\r\n        resizedPanoData.croppedX *= ratio;\r\n        resizedPanoData.croppedY *= ratio;\r\n      }\r\n\r\n      const buffer = document.createElement('canvas');\r\n      buffer.width = resizedPanoData.fullWidth;\r\n      buffer.height = resizedPanoData.fullHeight;\r\n\r\n      const ctx = buffer.getContext('2d');\r\n      ctx.drawImage(img,\r\n        resizedPanoData.croppedX, resizedPanoData.croppedY,\r\n        resizedPanoData.croppedWidth, resizedPanoData.croppedHeight);\r\n\r\n      return createTexture(buffer);\r\n    }\r\n\r\n    return createTexture(img);\r\n  }\r\n\r\n  /**\r\n   * @override\r\n   */\r\n  createMesh(scale = 1) {\r\n    // The middle of the panorama is placed at longitude=0\r\n    const geometry = new THREE.SphereGeometry(\r\n      SPHERE_RADIUS * scale,\r\n      this.SPHERE_SEGMENTS,\r\n      this.SPHERE_HORIZONTAL_SEGMENTS,\r\n      -Math.PI / 2\r\n    )\r\n      .scale(-1, 1, 1);\r\n\r\n    const material = new THREE.MeshBasicMaterial();\r\n\r\n    return new THREE.Mesh(geometry, material);\r\n  }\r\n\r\n  /**\r\n   * @override\r\n   */\r\n  setTexture(mesh, textureData) {\r\n    mesh.material.map?.dispose();\r\n    mesh.material.map = textureData.texture;\r\n  }\r\n\r\n  /**\r\n   * @override\r\n   */\r\n  setTextureOpacity(mesh, opacity) {\r\n    mesh.material.opacity = opacity;\r\n    mesh.material.transparent = opacity < 1;\r\n  }\r\n\r\n  /**\r\n   * @override\r\n   */\r\n  disposeTexture(textureData) {\r\n    textureData.texture?.dispose();\r\n  }\r\n\r\n}\r\n","/**\r\n * @namespace PSV.components\r\n */\r\n\r\n/**\r\n * @summary Base component class\r\n * @memberof PSV.components\r\n * @abstract\r\n */\r\nexport class AbstractComponent {\r\n\r\n  /**\r\n   * @param {PSV.Viewer | PSV.components.AbstractComponent} parent\r\n   * @param {string} className - CSS class added to the component's container\r\n   */\r\n  constructor(parent, className) {\r\n    /**\r\n     * @summary Reference to main controller\r\n     * @type {PSV.Viewer}\r\n     * @readonly\r\n     */\r\n    this.psv = parent.psv || parent;\r\n\r\n    /**\r\n     * @member {PSV.Viewer|PSV.components.AbstractComponent}\r\n     * @readonly\r\n     */\r\n    this.parent = parent;\r\n    this.parent.children.push(this);\r\n\r\n    /**\r\n     * @summary All child components\r\n     * @type {PSV.components.AbstractComponent[]}\r\n     * @readonly\r\n     * @package\r\n     */\r\n    this.children = [];\r\n\r\n    /**\r\n     * @summary Internal properties\r\n     * @member {Object}\r\n     * @protected\r\n     * @property {boolean} visible - Visibility of the component\r\n     */\r\n    this.prop = {\r\n      visible: true,\r\n    };\r\n\r\n    /**\r\n     * @member {HTMLElement}\r\n     * @readonly\r\n     */\r\n    this.container = document.createElement('div');\r\n    this.container.className = className;\r\n    this.parent.container.appendChild(this.container);\r\n  }\r\n\r\n  /**\r\n   * @summary Destroys the component\r\n   * @protected\r\n   */\r\n  destroy() {\r\n    this.parent.container.removeChild(this.container);\r\n\r\n    const childIdx = this.parent.children.indexOf(this);\r\n    if (childIdx !== -1) {\r\n      this.parent.children.splice(childIdx, 1);\r\n    }\r\n\r\n    this.children.slice().forEach(child => child.destroy());\r\n    this.children.length = 0;\r\n\r\n    delete this.container;\r\n    delete this.parent;\r\n    delete this.psv;\r\n    delete this.prop;\r\n  }\r\n\r\n  /**\r\n   * @summary Refresh UI\r\n   * @description Must be be a very lightweight operation\r\n   * @package\r\n   */\r\n  refreshUi() {\r\n    this.children.every((child) => {\r\n      child.refreshUi();\r\n      return this.psv.prop.uiRefresh === true;\r\n    });\r\n  }\r\n\r\n  /**\r\n   * @summary Displays or hides the component\r\n   */\r\n  toggle() {\r\n    if (this.isVisible()) {\r\n      this.hide();\r\n    }\r\n    else {\r\n      this.show();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @summary Hides the component\r\n   */\r\n  hide() {\r\n    this.container.style.display = 'none';\r\n    this.prop.visible = false;\r\n  }\r\n\r\n  /**\r\n   * @summary Displays the component\r\n   */\r\n  show() {\r\n    this.container.style.display = '';\r\n    this.prop.visible = true;\r\n  }\r\n\r\n  /**\r\n   * @summary Checks if the component is visible\r\n   * @returns {boolean}\r\n   */\r\n  isVisible() {\r\n    return this.prop.visible;\r\n  }\r\n\r\n}\r\n","import { AbstractComponent } from '../components/AbstractComponent';\r\nimport { KEY_CODES } from '../data/constants';\r\nimport { PSVError } from '../PSVError';\r\nimport { isPlainObject, toggleClass } from '../utils';\r\n\r\n/**\r\n * @namespace PSV.buttons\r\n */\r\n\r\n/**\r\n * @summary Base navbar button class\r\n * @extends PSV.components.AbstractComponent\r\n * @memberof PSV.buttons\r\n * @abstract\r\n */\r\nexport class AbstractButton extends AbstractComponent {\r\n\r\n  /**\r\n   * @summary Unique identifier of the button\r\n   * @member {string}\r\n   * @readonly\r\n   * @static\r\n   */\r\n  static id = null;\r\n\r\n  /**\r\n   * @summary Identifier to declare a group of buttons\r\n   * @member {string}\r\n   * @readonly\r\n   * @static\r\n   */\r\n  static groupId = null;\r\n\r\n  /**\r\n   * @summary SVG icon name injected in the button\r\n   * @member {string}\r\n   * @readonly\r\n   * @static\r\n   */\r\n  static icon = null;\r\n\r\n  /**\r\n   * @summary SVG icon name injected in the button when it is active\r\n   * @member {string}\r\n   * @readonly\r\n   * @static\r\n   */\r\n  static iconActive = null;\r\n\r\n  /**\r\n   * @param {PSV.components.Navbar} navbar\r\n   * @param {string} [className] - Additional CSS classes\r\n   * @param {boolean} [collapsable=false] - `true` if the button can be moved to menu when the navbar is too small\r\n   * @param {boolean} [tabbable=true] - `true` if the button is accessible with the keyboard\r\n   */\r\n  constructor(navbar, className = '', collapsable = false, tabbable = true) {\r\n    super(navbar, 'psv-button ' + className);\r\n\r\n    /**\r\n     * @override\r\n     * @property {string} id - Unique identifier of the button\r\n     * @property {boolean} enabled\r\n     * @property {boolean} supported\r\n     * @property {boolean} collapsed\r\n     * @property {boolean} active\r\n     * @property {number} width\r\n     */\r\n    this.prop = {\r\n      ...this.prop,\r\n      id         : this.constructor.id,\r\n      collapsable: collapsable,\r\n      enabled    : true,\r\n      supported  : true,\r\n      collapsed  : false,\r\n      active     : false,\r\n      width      : this.container.offsetWidth,\r\n    };\r\n\r\n    if (this.constructor.icon) {\r\n      this.__setIcon(this.constructor.icon);\r\n    }\r\n\r\n    if (this.prop.id && this.psv.config.lang[this.prop.id]) {\r\n      this.container.title = this.psv.config.lang[this.prop.id];\r\n    }\r\n\r\n    if (tabbable) {\r\n      this.container.tabIndex = 0;\r\n    }\r\n\r\n    this.container.addEventListener('click', (e) => {\r\n      if (this.prop.enabled) {\r\n        this.onClick();\r\n      }\r\n      e.stopPropagation();\r\n    });\r\n\r\n    this.container.addEventListener('keydown', (e) => {\r\n      if (e.key === KEY_CODES.Enter && this.prop.enabled) {\r\n        this.onClick();\r\n        e.stopPropagation();\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * @package\r\n   */\r\n  checkSupported() {\r\n    const supportedOrObject = this.isSupported();\r\n    if (isPlainObject(supportedOrObject)) {\r\n      if (supportedOrObject.initial === false) {\r\n        this.hide();\r\n        this.prop.supported = false;\r\n      }\r\n\r\n      supportedOrObject.promise.then((supported) => {\r\n        if (!this.prop) {\r\n          return; // the component has been destroyed\r\n        }\r\n        this.prop.supported = supported;\r\n        if (!supported) {\r\n          this.hide();\r\n        }\r\n        else {\r\n          this.show();\r\n        }\r\n      });\r\n    }\r\n    else {\r\n      this.prop.supported = supportedOrObject;\r\n      if (!supportedOrObject) {\r\n        this.hide();\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @summary Checks if the button can be displayed\r\n   * @returns {boolean|{initial: boolean, promise: Promise<boolean>}}\r\n   */\r\n  isSupported() {\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * @summary Changes the active state of the button\r\n   * @param {boolean} [active] - forced state\r\n   */\r\n  toggleActive(active) {\r\n    this.prop.active = active !== undefined ? active : !this.prop.active;\r\n    toggleClass(this.container, 'psv-button--active', this.prop.active);\r\n\r\n    if (this.constructor.iconActive) {\r\n      this.__setIcon(this.prop.active ? this.constructor.iconActive : this.constructor.icon);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @override\r\n   */\r\n  show(refresh = true) {\r\n    if (!this.isVisible()) {\r\n      this.prop.visible = true;\r\n      if (!this.prop.collapsed) {\r\n        this.container.style.display = '';\r\n      }\r\n      if (refresh) {\r\n        this.psv.refreshUi(`show button ${this.prop.id}`);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @override\r\n   */\r\n  hide(refresh = true) {\r\n    if (this.isVisible()) {\r\n      this.prop.visible = false;\r\n      this.container.style.display = 'none';\r\n      if (refresh) {\r\n        this.psv.refreshUi(`hide button ${this.prop.id}`);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @summary Disables the button\r\n   */\r\n  disable() {\r\n    this.container.classList.add('psv-button--disabled');\r\n    this.prop.enabled = false;\r\n  }\r\n\r\n  /**\r\n   * @summary Enables the button\r\n   */\r\n  enable() {\r\n    this.container.classList.remove('psv-button--disabled');\r\n    this.prop.enabled = true;\r\n  }\r\n\r\n  /**\r\n   * @summary Collapses the button in the navbar menu\r\n   */\r\n  collapse() {\r\n    this.prop.collapsed = true;\r\n    this.container.style.display = 'none';\r\n  }\r\n\r\n  /**\r\n   * @summary Uncollapses the button from the navbar menu\r\n   */\r\n  uncollapse() {\r\n    this.prop.collapsed = false;\r\n    if (this.prop.visible) {\r\n      this.container.style.display = '';\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @summary Set the button icon\r\n   * @param {string} icon SVG\r\n   * @param {HTMLElement} [container] - default is the main button container\r\n   * @private\r\n   */\r\n  __setIcon(icon, container = this.container) {\r\n    if (icon) {\r\n      container.innerHTML = icon;\r\n      // className is read-only on SVGElement\r\n      container.querySelector('svg').classList.add('psv-button-svg');\r\n    }\r\n    else {\r\n      container.innerHTML = '';\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @summary Action when the button is clicked\r\n   * @private\r\n   * @abstract\r\n   */\r\n  onClick() {\r\n    throw new PSVError(`onClick not implemented for button \"${this.prop.id}\".`);\r\n  }\r\n\r\n}\r\n","import { EVENTS } from '../data/constants';\r\nimport playActive from '../icons/play-active.svg';\r\nimport play from '../icons/play.svg';\r\nimport { AbstractButton } from './AbstractButton';\r\n\r\n/**\r\n * @summary Navigation bar autorotate button class\r\n * @extends PSV.buttons.AbstractButton\r\n * @memberof PSV.buttons\r\n */\r\nexport class AutorotateButton extends AbstractButton {\r\n\r\n  static id = 'autorotate';\r\n  static icon = play;\r\n  static iconActive = playActive;\r\n\r\n  /**\r\n   * @param {PSV.components.Navbar} navbar\r\n   */\r\n  constructor(navbar) {\r\n    super(navbar, 'psv-button--hover-scale psv-autorotate-button', true);\r\n\r\n    this.psv.on(EVENTS.AUTOROTATE, this);\r\n  }\r\n\r\n  /**\r\n   * @override\r\n   */\r\n  destroy() {\r\n    this.psv.off(EVENTS.AUTOROTATE, this);\r\n\r\n    super.destroy();\r\n  }\r\n\r\n  /**\r\n   * @summary Handles events\r\n   * @param {Event} e\r\n   * @private\r\n   */\r\n  handleEvent(e) {\r\n    /* eslint-disable */\r\n    switch (e.type) {\r\n      // @formatter:off\r\n      case EVENTS.AUTOROTATE: this.toggleActive(e.args[0]); break;\r\n      // @formatter:on\r\n    }\r\n    /* eslint-enable */\r\n  }\r\n\r\n  /**\r\n   * @override\r\n   * @description Toggles autorotate\r\n   */\r\n  onClick() {\r\n    if (this.psv.isAutorotateEnabled()) {\r\n      this.psv.config.autorotateIdle = false;\r\n      this.psv.resetIdleTimer();\r\n    }\r\n    this.psv.toggleAutorotate();\r\n  }\r\n\r\n}\r\n","import { addClasses } from '../utils';\r\nimport { AbstractButton } from './AbstractButton';\r\n\r\n/**\r\n * @summary Navigation bar custom button class\r\n * @extends PSV.buttons.AbstractButton\r\n * @memberof PSV.buttons\r\n */\r\nexport class CustomButton extends AbstractButton {\r\n\r\n  /**\r\n   * @param {PSV.components.Navbar} navbar\r\n   * @param {PSV.NavbarCustomButton} config\r\n   */\r\n  constructor(navbar, config) {\r\n    super(navbar, 'psv-custom-button', config.collapsable !== false, config.tabbable !== false);\r\n\r\n    /**\r\n     * @member {Object}\r\n     * @readonly\r\n     * @private\r\n     */\r\n    this.config = config;\r\n\r\n    if (this.config.id) {\r\n      this.prop.id = this.config.id;\r\n    }\r\n    else {\r\n      this.prop.id = 'psvButton-' + Math.random().toString(36).substr(2, 9);\r\n    }\r\n\r\n    if (this.config.className) {\r\n      addClasses(this.container, this.config.className);\r\n    }\r\n\r\n    if (this.config.title) {\r\n      this.container.title = this.config.title;\r\n    }\r\n\r\n    if (this.config.content) {\r\n      this.container.innerHTML = this.config.content;\r\n    }\r\n\r\n    this.prop.width = this.container.offsetWidth;\r\n\r\n    if (this.config.enabled === false) {\r\n      this.disable();\r\n    }\r\n\r\n    if (this.config.visible === false) {\r\n      this.hide();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @override\r\n   */\r\n  destroy() {\r\n    delete this.config;\r\n\r\n    super.destroy();\r\n  }\r\n\r\n  /**\r\n   * @override\r\n   * @description Calls user method\r\n   */\r\n  onClick() {\r\n    if (this.config.onClick) {\r\n      this.config.onClick.apply(this.psv);\r\n    }\r\n  }\r\n\r\n}\r\n","import { EVENTS, IDS } from '../data/constants';\r\nimport info from '../icons/info.svg';\r\nimport { AbstractButton } from './AbstractButton';\r\n\r\nconst MODE_NOTIF = 1;\r\nconst MODE_PANEL = 2;\r\n\r\n/**\r\n * @summary Navigation bar description button class\r\n * @extends PSV.buttons.AbstractButton\r\n * @memberof PSV.buttons\r\n */\r\nexport class DescriptionButton extends AbstractButton {\r\n\r\n  static id = 'description';\r\n  static icon = info;\r\n\r\n  /**\r\n   * @param {PSV.components.Navbar} navbar\r\n   */\r\n  constructor(navbar) {\r\n    super(navbar, 'psv-button--hover-scale psv-description-button');\r\n\r\n    /**\r\n     * @override\r\n     * @property {string} mode - notification or panel\r\n     */\r\n    this.prop = {\r\n      ...this.prop,\r\n      mode: null,\r\n    };\r\n\r\n    this.psv.on(EVENTS.HIDE_NOTIFICATION, this);\r\n    this.psv.on(EVENTS.SHOW_NOTIFICATION, this);\r\n    this.psv.on(EVENTS.CLOSE_PANEL, this);\r\n    this.psv.on(EVENTS.OPEN_PANEL, this);\r\n  }\r\n\r\n  /**\r\n   * @override\r\n   */\r\n  destroy() {\r\n    this.psv.off(EVENTS.HIDE_NOTIFICATION, this);\r\n    this.psv.off(EVENTS.SHOW_NOTIFICATION, this);\r\n    this.psv.off(EVENTS.CLOSE_PANEL, this);\r\n    this.psv.off(EVENTS.OPEN_PANEL, this);\r\n\r\n    super.destroy();\r\n  }\r\n\r\n  /**\r\n   * @summary Handles events\r\n   * @param {Event} e\r\n   * @private\r\n   */\r\n  handleEvent(e) {\r\n    if (!this.prop.mode) {\r\n      return;\r\n    }\r\n\r\n    let closed = false;\r\n    switch (e.type) {\r\n      case EVENTS.HIDE_NOTIFICATION:\r\n        closed = this.prop.mode === MODE_NOTIF;\r\n        break;\r\n\r\n      case EVENTS.SHOW_NOTIFICATION:\r\n        closed = this.prop.mode === MODE_NOTIF && e.args[0] !== IDS.DESCRIPTION;\r\n        break;\r\n\r\n      case EVENTS.CLOSE_PANEL:\r\n        closed = this.prop.mode === MODE_PANEL;\r\n        break;\r\n\r\n      case EVENTS.OPEN_PANEL:\r\n        closed = this.prop.mode === MODE_PANEL && e.args[0] !== IDS.DESCRIPTION;\r\n        break;\r\n\r\n      default:\r\n    }\r\n\r\n    if (closed) {\r\n      this.toggleActive(false);\r\n      this.prop.mode = null;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @override\r\n   */\r\n  hide(refresh) {\r\n    super.hide(refresh);\r\n\r\n    if (this.prop.mode) {\r\n      this.__close();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * This button can only be refresh from NavbarCaption\r\n   * @override\r\n   */\r\n  refreshUi(refresh = false) {\r\n    if (refresh) {\r\n      const caption = this.psv.navbar.getButton('caption', false);\r\n      const captionHidden = caption && !caption.isVisible();\r\n      const hasDescription = !!this.psv.config.description;\r\n\r\n      if (captionHidden || hasDescription) {\r\n        this.show(false);\r\n      }\r\n      else {\r\n        this.hide(false);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @override\r\n   * @description Toggles caption\r\n   */\r\n  onClick() {\r\n    if (this.prop.mode) {\r\n      this.__close();\r\n    }\r\n    else {\r\n      this.__open();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @private\r\n   */\r\n  __close() {\r\n    switch (this.prop.mode) {\r\n      case MODE_NOTIF:\r\n        this.psv.notification.hide(IDS.DESCRIPTION);\r\n        break;\r\n      case MODE_PANEL:\r\n        this.psv.panel.hide(IDS.DESCRIPTION);\r\n        break;\r\n      default:\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @private\r\n   */\r\n  __open() {\r\n    this.toggleActive(true);\r\n\r\n    if (this.psv.config.description) {\r\n      this.prop.mode = MODE_PANEL;\r\n      this.psv.panel.show({\r\n        id     : IDS.DESCRIPTION,\r\n        content: `${this.psv.config.caption ? `<p>${this.psv.config.caption}</p>` : ''}${this.psv.config.description}`,\r\n      });\r\n    }\r\n    else {\r\n      this.prop.mode = MODE_NOTIF;\r\n      this.psv.notification.show({\r\n        id     : IDS.DESCRIPTION,\r\n        content: this.psv.config.caption,\r\n      });\r\n    }\r\n  }\r\n\r\n}\r\n","import download from '../icons/download.svg';\r\nimport { AbstractButton } from './AbstractButton';\r\n\r\n/**\r\n * @summary Navigation bar download button class\r\n * @extends PSV.buttons.AbstractButton\r\n * @memberof PSV.buttons\r\n */\r\nexport class DownloadButton extends AbstractButton {\r\n\r\n  static id = 'download';\r\n  static icon = download;\r\n\r\n  /**\r\n   * @param {PSV.components.Navbar} navbar\r\n   */\r\n  constructor(navbar) {\r\n    super(navbar, 'psv-button--hover-scale psv-download-button', true);\r\n  }\r\n\r\n  /**\r\n   * @override\r\n   * @description Asks the browser to download the panorama source file\r\n   */\r\n  onClick() {\r\n    const link = document.createElement('a');\r\n    link.href = this.psv.config.downloadUrl || this.psv.config.panorama;\r\n    link.download = link.href.split('/').pop();\r\n    this.psv.container.appendChild(link);\r\n    link.click();\r\n\r\n    setTimeout(() => {\r\n      this.psv.container.removeChild(link);\r\n    }, 100);\r\n  }\r\n\r\n  /**\r\n   * @override\r\n   */\r\n  refreshUi() {\r\n    const supported = this.psv.adapter.constructor.supportsDownload || this.psv.config.downloadUrl;\r\n    if (supported && !this.prop.visible) {\r\n      this.show();\r\n    }\r\n    else if (!supported && this.prop.visible) {\r\n      this.hide();\r\n    }\r\n  }\r\n\r\n}\r\n","import { EVENTS } from '../data/constants';\r\nimport fullscreenIn from '../icons/fullscreen-in.svg';\r\nimport fullscreenOut from '../icons/fullscreen-out.svg';\r\nimport { AbstractButton } from './AbstractButton';\r\n\r\n/**\r\n * @summary Navigation bar fullscreen button class\r\n * @extends PSV.buttons.AbstractButton\r\n * @memberof PSV.buttons\r\n */\r\nexport class FullscreenButton extends AbstractButton {\r\n\r\n  static id = 'fullscreen';\r\n  static icon = fullscreenIn;\r\n  static iconActive = fullscreenOut;\r\n\r\n  /**\r\n   * @param {PSV.components.Navbar} navbar\r\n   */\r\n  constructor(navbar) {\r\n    super(navbar, 'psv-button--hover-scale psv-fullscreen-button');\r\n\r\n    this.psv.on(EVENTS.FULLSCREEN_UPDATED, this);\r\n  }\r\n\r\n  /**\r\n   * @override\r\n   */\r\n  destroy() {\r\n    this.psv.off(EVENTS.FULLSCREEN_UPDATED, this);\r\n\r\n    super.destroy();\r\n  }\r\n\r\n  /**\r\n   * Handle events\r\n   * @param {Event} e\r\n   * @private\r\n   */\r\n  handleEvent(e) {\r\n    /* eslint-disable */\r\n    switch (e.type) {\r\n      // @formatter:off\r\n      case EVENTS.FULLSCREEN_UPDATED: this.toggleActive(e.args[0]); break;\r\n      // @formatter:on\r\n    }\r\n    /* eslint-enable */\r\n  }\r\n\r\n  /**\r\n   * @override\r\n   * @description Toggles fullscreen\r\n   */\r\n  onClick() {\r\n    this.psv.toggleFullscreen();\r\n  }\r\n\r\n}\r\n","import { EVENTS, IDS } from '../data/constants';\r\nimport menuIcon from '../icons/menu.svg';\r\nimport { dasherize, getClosest } from '../utils';\r\nimport { AbstractButton } from './AbstractButton';\r\n\r\n/**\r\n * @summary Navigation bar menu button class\r\n * @extends PSV.buttons.AbstractButton\r\n * @memberof PSV.buttons\r\n */\r\nexport class MenuButton extends AbstractButton {\r\n\r\n  static id = 'menu';\r\n  static icon = menuIcon;\r\n\r\n  /**\r\n   * @summary Property name added to buttons list\r\n   * @type {string}\r\n   * @constant\r\n   */\r\n  static BUTTON_DATA = 'psvButton';\r\n\r\n  /**\r\n   * @summary Menu template\r\n   * @param {AbstractButton[]} buttons\r\n   * @param {PSV.Viewer} psv\r\n   * @param {string} dataKey\r\n   * @returns {string}\r\n   */\r\n  static MENU_TEMPLATE = (buttons, psv, dataKey) => `\r\n<div class=\"psv-panel-menu psv-panel-menu--stripped\">\r\n  <h1 class=\"psv-panel-menu-title\">${menuIcon} ${psv.config.lang.menu}</h1>\r\n  <ul class=\"psv-panel-menu-list\">\r\n    ${buttons.map(button => `\r\n    <li data-${dataKey}=\"${button.prop.id}\" class=\"psv-panel-menu-item\" tabindex=\"0\">\r\n      <span class=\"psv-panel-menu-item-icon\">${button.container.innerHTML}</span>\r\n      <span class=\"psv-panel-menu-item-label\">${button.container.title}</span>\r\n    </li>\r\n    `).join('')}\r\n  </ul>\r\n</div>\r\n`;\r\n\r\n  /**\r\n   * @param {PSV.components.Navbar} navbar\r\n   */\r\n  constructor(navbar) {\r\n    super(navbar, 'psv-button--hover-scale psv-menu-button');\r\n\r\n    this.psv.on(EVENTS.OPEN_PANEL, this);\r\n    this.psv.on(EVENTS.CLOSE_PANEL, this);\r\n\r\n    super.hide();\r\n  }\r\n\r\n  /**\r\n   * @override\r\n   */\r\n  destroy() {\r\n    this.psv.off(EVENTS.OPEN_PANEL, this);\r\n    this.psv.off(EVENTS.CLOSE_PANEL, this);\r\n\r\n    super.destroy();\r\n  }\r\n\r\n  /**\r\n   * @summary Handles events\r\n   * @param {Event} e\r\n   * @private\r\n   */\r\n  handleEvent(e) {\r\n    /* eslint-disable */\r\n    switch (e.type) {\r\n      // @formatter:off\r\n      case EVENTS.OPEN_PANEL:  this.toggleActive(e.args[0] === IDS.MENU); break;\r\n      case EVENTS.CLOSE_PANEL: this.toggleActive(false); break;\r\n      // @formatter:on\r\n    }\r\n    /* eslint-enable */\r\n  }\r\n\r\n  /**\r\n   * @override\r\n   */\r\n  hide(refresh) {\r\n    super.hide(refresh);\r\n    this.__hideMenu();\r\n  }\r\n\r\n  /**\r\n   * @override\r\n   */\r\n  show(refresh) {\r\n    super.show(refresh);\r\n\r\n    if (this.prop.active) {\r\n      this.__showMenu();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @override\r\n   * @description Toggles menu\r\n   */\r\n  onClick() {\r\n    if (this.prop.active) {\r\n      this.__hideMenu();\r\n    }\r\n    else {\r\n      this.__showMenu();\r\n    }\r\n  }\r\n\r\n  __showMenu() {\r\n    this.psv.panel.show({\r\n      id          : IDS.MENU,\r\n      content     : MenuButton.MENU_TEMPLATE(this.parent.collapsed, this.psv, dasherize(MenuButton.BUTTON_DATA)),\r\n      noMargin    : true,\r\n      clickHandler: (e) => {\r\n        const li = e.target ? getClosest(e.target, 'li') : undefined;\r\n        const buttonId = li ? li.dataset[MenuButton.BUTTON_DATA] : undefined;\r\n\r\n        if (buttonId) {\r\n          this.parent.getButton(buttonId).onClick();\r\n          this.__hideMenu();\r\n        }\r\n      },\r\n    });\r\n  }\r\n\r\n  __hideMenu() {\r\n    this.psv.panel.hide(IDS.MENU);\r\n  }\r\n\r\n}\r\n","/**\r\n * @summary Helper for pressable things (buttons, keyboard)\r\n * @description When the pressed thing goes up and was not pressed long enough, wait a bit more before execution\r\n * @private\r\n */\r\nexport class PressHandler {\r\n\r\n  constructor(delay = 200) {\r\n    this.delay = delay;\r\n    this.time = 0;\r\n    this.timeout = null;\r\n  }\r\n\r\n  down() {\r\n    if (this.timeout) {\r\n      clearTimeout(this.timeout);\r\n      this.timeout = null;\r\n    }\r\n\r\n    this.time = new Date().getTime();\r\n  }\r\n\r\n  up(cb) {\r\n    if (!this.time) {\r\n      return;\r\n    }\r\n\r\n    const elapsed = new Date().getTime() - this.time;\r\n    if (elapsed < this.delay) {\r\n      this.timeout = setTimeout(() => {\r\n        cb();\r\n        this.timeout = null;\r\n        this.time = 0;\r\n      }, this.delay);\r\n    }\r\n    else {\r\n      cb();\r\n      this.time = 0;\r\n    }\r\n  }\r\n\r\n}\r\n","import { KEY_CODES } from '../data/constants';\r\nimport { SYSTEM } from '../data/system';\r\nimport arrow from '../icons/arrow.svg';\r\nimport { PressHandler } from '../utils/PressHandler';\r\nimport { AbstractButton } from './AbstractButton';\r\n\r\nexport function getOrientedArrow(direction) {\r\n  let angle = 0;\r\n  switch (direction) {\r\n    // @formatter:off\r\n    case 'up': angle = 90; break;\r\n    case 'right': angle = 180; break;\r\n    case 'down': angle = -90; break;\r\n    default: angle = 0; break;\r\n    // @formatter:on\r\n  }\r\n\r\n  return arrow.replace('rotate(0', `rotate(${angle}`);\r\n}\r\n\r\n/**\r\n * @summary Navigation bar move button class\r\n * @extends PSV.buttons.AbstractButton\r\n * @memberof PSV.buttons\r\n */\r\nexport class AbstractMoveButton extends AbstractButton {\r\n\r\n  static groupId = 'move';\r\n\r\n  /**\r\n   * @param {PSV.components.Navbar} navbar\r\n   * @param {number} value\r\n   */\r\n  constructor(navbar, value) {\r\n    super(navbar, 'psv-button--hover-scale psv-move-button');\r\n\r\n    this.container.title = this.psv.config.lang.move;\r\n\r\n    /**\r\n     * @override\r\n     * @property {{longitude: boolean, latitude: boolean}} value\r\n     * @property {PressHandler} handler\r\n     */\r\n    this.prop = {\r\n      ...this.prop,\r\n      value  : value,\r\n      handler: new PressHandler(),\r\n    };\r\n\r\n    this.container.addEventListener('mousedown', this);\r\n    this.container.addEventListener('keydown', this);\r\n    this.container.addEventListener('keyup', this);\r\n    this.psv.container.addEventListener('mouseup', this);\r\n    this.psv.container.addEventListener('touchend', this);\r\n  }\r\n\r\n  /**\r\n   * @override\r\n   */\r\n  destroy() {\r\n    this.__onMouseUp();\r\n\r\n    this.psv.container.removeEventListener('mouseup', this);\r\n    this.psv.container.removeEventListener('touchend', this);\r\n\r\n    super.destroy();\r\n  }\r\n\r\n  /**\r\n   * @summary Handles events\r\n   * @param {Event} e\r\n   * @private\r\n   */\r\n  handleEvent(e) {\r\n    /* eslint-disable */\r\n    switch (e.type) {\r\n      // @formatter:off\r\n      case 'mousedown': this.__onMouseDown(); break;\r\n      case 'mouseup':   this.__onMouseUp(); break;\r\n      case 'touchend':  this.__onMouseUp(); break;\r\n      case 'keydown':   e.key === KEY_CODES.Enter && this.__onMouseDown(); break;\r\n      case 'keyup':     e.key === KEY_CODES.Enter && this.__onMouseUp(); break;\r\n      // @formatter:on\r\n    }\r\n    /* eslint-enable */\r\n  }\r\n\r\n  /**\r\n   * @override\r\n   */\r\n  isSupported() {\r\n    return {\r\n      initial: !SYSTEM.isTouchEnabled.initial,\r\n      promise: SYSTEM.isTouchEnabled.promise.then(enabled => !enabled),\r\n    };\r\n  }\r\n\r\n  /**\r\n   * @override\r\n   */\r\n  onClick() {\r\n    // nothing\r\n  }\r\n\r\n  /**\r\n   * @private\r\n   */\r\n  __onMouseDown() {\r\n    if (!this.prop.enabled) {\r\n      return;\r\n    }\r\n\r\n    this.psv.__stopAll();\r\n    this.psv.dynamics.position.roll(this.prop.value);\r\n    this.prop.handler.down();\r\n  }\r\n\r\n  /**\r\n   * @private\r\n   */\r\n  __onMouseUp() {\r\n    if (!this.prop.enabled) {\r\n      return;\r\n    }\r\n\r\n    this.prop.handler.up(() => {\r\n      this.psv.dynamics.position.stop();\r\n      this.psv.resetIdleTimer();\r\n    });\r\n  }\r\n\r\n}\r\n","import { AbstractMoveButton, getOrientedArrow } from './AbstractMoveButton';\r\n\r\n/**\r\n * @summary Navigation bar move down button class\r\n * @extends PSV.buttons.AbstractMoveButton\r\n * @memberof PSV.buttons\r\n */\r\nexport class MoveDownButton extends AbstractMoveButton {\r\n\r\n  static id = 'moveDown';\r\n  static icon = getOrientedArrow('down');\r\n\r\n  /**\r\n   * @param {PSV.components.Navbar} navbar\r\n   */\r\n  constructor(navbar) {\r\n    super(navbar, { latitude: true });\r\n  }\r\n\r\n}\r\n","import { AbstractMoveButton, getOrientedArrow } from './AbstractMoveButton';\r\n\r\n/**\r\n * @summary Navigation bar move left button class\r\n * @extends PSV.buttons.AbstractMoveButton\r\n * @memberof PSV.buttons\r\n */\r\nexport class MoveLeftButton extends AbstractMoveButton {\r\n\r\n  static id = 'moveLeft';\r\n  static icon = getOrientedArrow('left');\r\n\r\n  /**\r\n   * @param {PSV.components.Navbar} navbar\r\n   */\r\n  constructor(navbar) {\r\n    super(navbar, { longitude: true });\r\n  }\r\n\r\n}\r\n","import { AbstractMoveButton, getOrientedArrow } from './AbstractMoveButton';\r\n\r\n/**\r\n * @summary Navigation bar move right button class\r\n * @extends PSV.buttons.AbstractMoveButton\r\n * @memberof PSV.buttons\r\n */\r\nexport class MoveRightButton extends AbstractMoveButton {\r\n\r\n  static id = 'moveRight';\r\n  static icon = getOrientedArrow('right');\r\n\r\n  /**\r\n   * @param {PSV.components.Navbar} navbar\r\n   */\r\n  constructor(navbar) {\r\n    super(navbar, { longitude: false });\r\n  }\r\n\r\n}\r\n","import { AbstractMoveButton, getOrientedArrow } from './AbstractMoveButton';\r\n\r\n/**\r\n * @summary Navigation bar move up button class\r\n * @extends PSV.buttons.AbstractMoveButton\r\n * @memberof PSV.buttons\r\n */\r\nexport class MoveUpButton extends AbstractMoveButton {\r\n\r\n  static id = 'moveUp';\r\n  static icon = getOrientedArrow('up');\r\n\r\n  /**\r\n   * @param {PSV.components.Navbar} navbar\r\n   */\r\n  constructor(navbar) {\r\n    super(navbar, { latitude: false });\r\n  }\r\n\r\n}\r\n","import { KEY_CODES } from '../data/constants';\r\nimport { SYSTEM } from '../data/system';\r\nimport { PressHandler } from '../utils/PressHandler';\r\nimport { AbstractButton } from './AbstractButton';\r\n\r\n/**\r\n * @summary Navigation bar zoom button class\r\n * @extends PSV.buttons.AbstractButton\r\n * @memberof PSV.buttons\r\n */\r\nexport class AbstractZoomButton extends AbstractButton {\r\n\r\n  static groupId = 'zoom';\r\n\r\n  /**\r\n   * @param {PSV.components.Navbar} navbar\r\n   * @param {number} value\r\n   */\r\n  constructor(navbar, value) {\r\n    super(navbar, 'psv-button--hover-scale psv-zoom-button');\r\n\r\n    /**\r\n     * @override\r\n     * @property {boolean} value\r\n     * @property {PressHandler} handler\r\n     */\r\n    this.prop = {\r\n      ...this.prop,\r\n      value  : value,\r\n      handler: new PressHandler(),\r\n    };\r\n\r\n    this.container.addEventListener('mousedown', this);\r\n    this.container.addEventListener('keydown', this);\r\n    this.container.addEventListener('keyup', this);\r\n    this.psv.container.addEventListener('mouseup', this);\r\n    this.psv.container.addEventListener('touchend', this);\r\n  }\r\n\r\n  /**\r\n   * @override\r\n   */\r\n  destroy() {\r\n    this.__onMouseUp();\r\n\r\n    this.psv.container.removeEventListener('mouseup', this);\r\n    this.psv.container.removeEventListener('touchend', this);\r\n\r\n    super.destroy();\r\n  }\r\n\r\n  /**\r\n   * @summary Handles events\r\n   * @param {Event} e\r\n   * @private\r\n   */\r\n  handleEvent(e) {\r\n    /* eslint-disable */\r\n    switch (e.type) {\r\n      // @formatter:off\r\n      case 'mousedown': this.__onMouseDown(); break;\r\n      case 'mouseup':   this.__onMouseUp(); break;\r\n      case 'touchend':  this.__onMouseUp(); break;\r\n      case 'keydown':   e.key === KEY_CODES.Enter && this.__onMouseDown(); break;\r\n      case 'keyup':     e.key === KEY_CODES.Enter && this.__onMouseUp(); break;\r\n      // @formatter:on\r\n    }\r\n    /* eslint-enable */\r\n  }\r\n\r\n  /**\r\n   * @override\r\n   */\r\n  isSupported() {\r\n    return {\r\n      initial: !SYSTEM.isTouchEnabled.initial,\r\n      promise: SYSTEM.isTouchEnabled.promise.then(enabled => !enabled),\r\n    };\r\n  }\r\n\r\n  /**\r\n   * @override\r\n   */\r\n  onClick() {\r\n    // nothing\r\n  }\r\n\r\n  /**\r\n   * @private\r\n   */\r\n  __onMouseDown() {\r\n    if (!this.prop.enabled) {\r\n      return;\r\n    }\r\n\r\n    this.psv.dynamics.zoom.roll(this.prop.value);\r\n    this.prop.handler.down();\r\n  }\r\n\r\n  /**\r\n   * @private\r\n   */\r\n  __onMouseUp() {\r\n    if (!this.prop.enabled) {\r\n      return;\r\n    }\r\n\r\n    this.prop.handler.up(() => this.psv.dynamics.zoom.stop());\r\n  }\r\n\r\n}\r\n","import { AbstractZoomButton } from './AbstractZoomButton';\r\nimport zoomIn from '../icons/zoom-in.svg';\r\n\r\n/**\r\n * @summary Navigation bar zoom-in button class\r\n * @extends PSV.buttons.AbstractZoomButton\r\n * @memberof PSV.buttons\r\n */\r\nexport class ZoomInButton extends AbstractZoomButton {\r\n\r\n  static id = 'zoomIn';\r\n  static icon = zoomIn;\r\n\r\n  /**\r\n   * @param {PSV.components.Navbar} navbar\r\n   */\r\n  constructor(navbar) {\r\n    super(navbar, false);\r\n  }\r\n\r\n}\r\n","import { AbstractZoomButton } from './AbstractZoomButton';\r\nimport zoomOut from '../icons/zoom-out.svg';\r\n\r\n/**\r\n * @summary Navigation bar zoom-out button class\r\n * @extends PSV.buttons.AbstractZoomButton\r\n * @memberof PSV.buttons\r\n */\r\nexport class ZoomOutButton extends AbstractZoomButton {\r\n\r\n  static id = 'zoomOut';\r\n  static icon = zoomOut;\r\n\r\n  /**\r\n   * @param {PSV.components.Navbar} navbar\r\n   */\r\n  constructor(navbar) {\r\n    super(navbar, true);\r\n  }\r\n\r\n}\r\n","import { EVENTS } from '../data/constants';\r\nimport { SYSTEM } from '../data/system';\r\nimport { getStyle, Slider } from '../utils';\r\nimport { AbstractButton } from './AbstractButton';\r\n\r\n/**\r\n * @summary Navigation bar zoom button class\r\n * @extends PSV.buttons.AbstractButton\r\n * @memberof PSV.buttons\r\n */\r\nexport class ZoomRangeButton extends AbstractButton {\r\n\r\n  static id = 'zoomRange';\r\n  static groupId = 'zoom';\r\n\r\n  /**\r\n   * @param {PSV.components.Navbar} navbar\r\n   */\r\n  constructor(navbar) {\r\n    super(navbar, 'psv-zoom-range', false, false);\r\n\r\n    /**\r\n     * @override\r\n     * @property {number} mediaMinWidth\r\n     */\r\n    this.prop = {\r\n      ...this.prop,\r\n      mediaMinWidth: 0,\r\n    };\r\n\r\n    /**\r\n     * @member {HTMLElement}\r\n     * @readonly\r\n     * @private\r\n     */\r\n    this.zoomRange = document.createElement('div');\r\n    this.zoomRange.className = 'psv-zoom-range-line';\r\n    this.container.appendChild(this.zoomRange);\r\n\r\n    /**\r\n     * @member {HTMLElement}\r\n     * @readonly\r\n     * @private\r\n     */\r\n    this.zoomValue = document.createElement('div');\r\n    this.zoomValue.className = 'psv-zoom-range-handle';\r\n    this.zoomRange.appendChild(this.zoomValue);\r\n\r\n    /**\r\n     * @member {PSV.Slider}\r\n     * @readonly\r\n     * @private\r\n     */\r\n    this.slider = new Slider({\r\n      container: this.container,\r\n      direction: Slider.HORIZONTAL,\r\n      onUpdate : e => this.__onSliderUpdate(e),\r\n    });\r\n\r\n    this.prop.mediaMinWidth = parseInt(getStyle(this.container, 'maxWidth'), 10);\r\n\r\n    this.psv.on(EVENTS.ZOOM_UPDATED, this);\r\n    if (this.psv.prop.ready) {\r\n      this.__moveZoomValue(this.psv.getZoomLevel());\r\n    }\r\n    else {\r\n      this.psv.once(EVENTS.READY, this);\r\n    }\r\n\r\n    this.refreshUi();\r\n  }\r\n\r\n  /**\r\n   * @override\r\n   */\r\n  destroy() {\r\n    this.slider.destroy();\r\n\r\n    delete this.zoomRange;\r\n    delete this.zoomValue;\r\n\r\n    this.psv.off(EVENTS.ZOOM_UPDATED, this);\r\n    this.psv.off(EVENTS.READY, this);\r\n\r\n    super.destroy();\r\n  }\r\n\r\n  /**\r\n   * @summary Handles events\r\n   * @param {Event} e\r\n   * @private\r\n   */\r\n  handleEvent(e) {\r\n    /* eslint-disable */\r\n    switch (e.type) {\r\n      // @formatter:off\r\n      case EVENTS.ZOOM_UPDATED: this.__moveZoomValue(e.args[0]); break;\r\n      case EVENTS.READY:        this.__moveZoomValue(this.psv.getZoomLevel()); break;\r\n      // @formatter:on\r\n    }\r\n    /* eslint-enable */\r\n  }\r\n\r\n  /**\r\n   * @override\r\n   */\r\n  isSupported() {\r\n    return {\r\n      initial: !SYSTEM.isTouchEnabled.initial,\r\n      promise: SYSTEM.isTouchEnabled.promise.then(enabled => !enabled),\r\n    };\r\n  }\r\n\r\n  /**\r\n   * @override\r\n   */\r\n  refreshUi() {\r\n    if (this.prop.supported) {\r\n      if (this.psv.prop.size.width <= this.prop.mediaMinWidth && this.prop.visible) {\r\n        this.hide();\r\n      }\r\n      else if (this.psv.prop.size.width > this.prop.mediaMinWidth && !this.prop.visible) {\r\n        this.show();\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @override\r\n   */\r\n  onClick() {\r\n    // nothing\r\n  }\r\n\r\n  /**\r\n   * @summary Moves the zoom cursor\r\n   * @param {number} level\r\n   * @private\r\n   */\r\n  __moveZoomValue(level) {\r\n    this.zoomValue.style.left = (level / 100 * this.zoomRange.offsetWidth - this.zoomValue.offsetWidth / 2) + 'px';\r\n  }\r\n\r\n\r\n  /**\r\n   * @summary Zoom change\r\n   * @private\r\n   */\r\n  __onSliderUpdate(e) {\r\n    if (e.mousedown) {\r\n      this.psv.zoom(e.value * 100);\r\n    }\r\n  }\r\n\r\n}\r\n","import { EventEmitter } from 'uevent';\r\n\r\n/**\r\n * @namespace PSV.plugins\r\n */\r\n\r\n/**\r\n * @summary Base plugins class\r\n * @memberof PSV.plugins\r\n * @abstract\r\n */\r\nexport class AbstractPlugin extends EventEmitter {\r\n\r\n  /**\r\n   * @summary Unique identifier of the plugin\r\n   * @member {string}\r\n   * @readonly\r\n   * @static\r\n   */\r\n  static id = null;\r\n\r\n  /**\r\n   * @param {PSV.Viewer} psv\r\n   */\r\n  constructor(psv) {\r\n    super();\r\n\r\n    /**\r\n     * @summary Reference to main controller\r\n     * @type {PSV.Viewer}\r\n     * @readonly\r\n     */\r\n    this.psv = psv;\r\n  }\r\n\r\n  /**\r\n   * @summary Initializes the plugin\r\n   * @package\r\n   */\r\n  init() {\r\n  }\r\n\r\n  /**\r\n   * @summary Destroys the plugin\r\n   * @package\r\n   */\r\n  destroy() {\r\n    delete this.psv;\r\n  }\r\n\r\n}\r\n","import { AbstractAdapter } from '../adapters/AbstractAdapter';\r\nimport { EquirectangularAdapter } from '../adapters/equirectangular';\r\nimport { AbstractPlugin } from '../plugins/AbstractPlugin';\r\nimport { PSVError } from '../PSVError';\r\nimport { bound, clone, deepmerge, each, isNil, logWarn, parseAngle, parseSpeed, pluginInterop } from '../utils';\r\nimport { ACTIONS, KEY_CODES } from './constants';\r\n\r\n/**\r\n * @summary Default options\r\n * @type {PSV.Options}\r\n * @memberOf PSV\r\n * @constant\r\n */\r\nexport const DEFAULTS = {\r\n  panorama           : null,\r\n  container          : null,\r\n  adapter            : null,\r\n  plugins            : [],\r\n  caption            : null,\r\n  description        : null,\r\n  downloadUrl        : null,\r\n  loadingImg         : null,\r\n  loadingTxt         : 'Loading...',\r\n  size               : null,\r\n  fisheye            : false,\r\n  minFov             : 30,\r\n  maxFov             : 90,\r\n  defaultZoomLvl     : 50,\r\n  defaultLong        : 0,\r\n  defaultLat         : 0,\r\n  sphereCorrection   : null,\r\n  moveSpeed          : 1,\r\n  zoomSpeed          : 1,\r\n  autorotateDelay    : null,\r\n  autorotateIdle     : false,\r\n  autorotateSpeed    : '2rpm',\r\n  autorotateLat      : null,\r\n  moveInertia        : true,\r\n  mousewheel         : true,\r\n  mousemove          : true,\r\n  captureCursor      : false,\r\n  mousewheelCtrlKey  : false,\r\n  touchmoveTwoFingers: false,\r\n  useXmpData         : true,\r\n  panoData           : null,\r\n  requestHeaders     : null,\r\n  canvasBackground   : '#000',\r\n  withCredentials    : false,\r\n  navbar             : [\r\n    'autorotate',\r\n    'zoom',\r\n    'move',\r\n    'download',\r\n    'description',\r\n    'caption',\r\n    'fullscreen',\r\n  ],\r\n  lang               : {\r\n    autorotate: 'Automatic rotation',\r\n    zoom      : 'Zoom',\r\n    zoomOut   : 'Zoom out',\r\n    zoomIn    : 'Zoom in',\r\n    move      : 'Move',\r\n    download  : 'Download',\r\n    fullscreen: 'Fullscreen',\r\n    menu      : 'Menu',\r\n    twoFingers: 'Use two fingers to navigate',\r\n    ctrlZoom  : 'Use ctrl + scroll to zoom the image',\r\n    loadError : 'The panorama can\\'t be loaded',\r\n  },\r\n  keyboard           : {\r\n    [KEY_CODES.ArrowUp]   : ACTIONS.ROTATE_LAT_UP,\r\n    [KEY_CODES.ArrowDown] : ACTIONS.ROTATE_LAT_DOWN,\r\n    [KEY_CODES.ArrowRight]: ACTIONS.ROTATE_LONG_RIGHT,\r\n    [KEY_CODES.ArrowLeft] : ACTIONS.ROTATE_LONG_LEFT,\r\n    [KEY_CODES.PageUp]    : ACTIONS.ZOOM_IN,\r\n    [KEY_CODES.PageDown]  : ACTIONS.ZOOM_OUT,\r\n    [KEY_CODES.Plus]      : ACTIONS.ZOOM_IN,\r\n    [KEY_CODES.Minus]     : ACTIONS.ZOOM_OUT,\r\n    [KEY_CODES.Space]     : ACTIONS.TOGGLE_AUTOROTATE,\r\n  },\r\n};\r\n\r\n/**\r\n * @summary List of unmodifiable options and their error messages\r\n * @private\r\n */\r\nexport const READONLY_OPTIONS = {\r\n  panorama : 'Use setPanorama method to change the panorama',\r\n  panoData : 'Use setPanorama method to change the panorama',\r\n  container: 'Cannot change viewer container',\r\n  adapter  : 'Cannot change adapter',\r\n  plugins  : 'Cannot change plugins',\r\n};\r\n\r\n/**\r\n * @summary List of deprecated options and their warning messages\r\n * @private\r\n */\r\nexport const DEPRECATED_OPTIONS = {\r\n  zoomButtonIncrement    : 'zoomButtonIncrement is deprecated, use zoomSpeed',\r\n  mousewheelSpeed        : 'mousewheelSpeed is deprecated, use zoomSpeed',\r\n  sphereCorrectionReorder: 'sphereCorrectionReorder is deprecated',\r\n};\r\n\r\n/**\r\n * @summary Parsers/validators for each option\r\n * @private\r\n */\r\nexport const CONFIG_PARSERS = {\r\n  container      : (container) => {\r\n    if (!container) {\r\n      throw new PSVError('No value given for container.');\r\n    }\r\n    return container;\r\n  },\r\n  adapter        : (adapter) => {\r\n    if (!adapter) {\r\n      adapter = [EquirectangularAdapter];\r\n    }\r\n    else if (Array.isArray(adapter)) {\r\n      adapter = [pluginInterop(adapter[0], AbstractAdapter), adapter[1]];\r\n    }\r\n    else {\r\n      adapter = [pluginInterop(adapter, AbstractAdapter)];\r\n    }\r\n    if (!adapter[0]) {\r\n      throw new PSVError('Un undefined value with given for adapter.');\r\n    }\r\n    return adapter;\r\n  },\r\n  defaultLong    : (defaultLong) => {\r\n    // defaultLat is between 0 and PI\r\n    return parseAngle(defaultLong);\r\n  },\r\n  defaultLat     : (defaultLat) => {\r\n    // defaultLat is between -PI/2 and PI/2\r\n    return parseAngle(defaultLat, true);\r\n  },\r\n  minFov         : (minFov, config) => {\r\n    // minFov and maxFov must be ordered\r\n    if (config.maxFov < minFov) {\r\n      logWarn('maxFov cannot be lower than minFov');\r\n      minFov = config.maxFov;\r\n    }\r\n    // minFov between 1 and 179\r\n    return bound(minFov, 1, 179);\r\n  },\r\n  maxFov         : (maxFov, config) => {\r\n    // minFov and maxFov must be ordered\r\n    if (maxFov < config.minFov) {\r\n      maxFov = config.minFov;\r\n    }\r\n    // maxFov between 1 and 179\r\n    return bound(maxFov, 1, 179);\r\n  },\r\n  lang           : (lang) => {\r\n    if (Array.isArray(lang.twoFingers)) {\r\n      logWarn('lang.twoFingers must not be an array');\r\n      lang.twoFingers = lang.twoFingers[0];\r\n    }\r\n    return {\r\n      ...DEFAULTS.lang,\r\n      ...lang,\r\n    };\r\n  },\r\n  keyboard       : (keyboard) => {\r\n    // keyboard=true becomes the default map\r\n    if (keyboard === true) {\r\n      return clone(DEFAULTS.keyboard);\r\n    }\r\n    return keyboard;\r\n  },\r\n  autorotateLat  : (autorotateLat, config) => {\r\n    // default autorotateLat is defaultLat\r\n    if (autorotateLat === null) {\r\n      return parseAngle(config.defaultLat, true);\r\n    }\r\n    // autorotateLat is between -PI/2 and PI/2\r\n    else {\r\n      return parseAngle(autorotateLat, true);\r\n    }\r\n  },\r\n  autorotateSpeed: (autorotateSpeed) => {\r\n    return parseSpeed(autorotateSpeed);\r\n  },\r\n  autorotateIdle : (autorotateIdle, config) => {\r\n    if (autorotateIdle && isNil(config.autorotateDelay)) {\r\n      logWarn('autorotateIdle requires a non null autorotateDelay');\r\n      return false;\r\n    }\r\n    return autorotateIdle;\r\n  },\r\n  fisheye        : (fisheye) => {\r\n    // translate boolean fisheye to amount\r\n    if (fisheye === true) {\r\n      return 1;\r\n    }\r\n    else if (fisheye === false) {\r\n      return 0;\r\n    }\r\n    return fisheye;\r\n  },\r\n  plugins        : (plugins) => {\r\n    return plugins\r\n      .map((plugin) => {\r\n        if (Array.isArray(plugin)) {\r\n          plugin = [pluginInterop(plugin[0], AbstractPlugin), plugin[1]];\r\n        }\r\n        else {\r\n          plugin = [pluginInterop(plugin, AbstractPlugin)];\r\n        }\r\n        if (!plugin[0]) {\r\n          throw new PSVError('Un undefined value was given for plugins.');\r\n        }\r\n        return plugin;\r\n      });\r\n  },\r\n};\r\n\r\n/**\r\n * @summary Merge user config with default config and performs validation\r\n * @param {PSV.Options} options\r\n * @returns {PSV.Options}\r\n * @memberOf PSV\r\n * @private\r\n */\r\nexport function getConfig(options) {\r\n  const tempConfig = clone(DEFAULTS);\r\n  deepmerge(tempConfig, options);\r\n\r\n  const config = {};\r\n\r\n  each(tempConfig, (value, key) => {\r\n    if (DEPRECATED_OPTIONS[key]) {\r\n      logWarn(DEPRECATED_OPTIONS[key]);\r\n      return;\r\n    }\r\n\r\n    if (!Object.prototype.hasOwnProperty.call(DEFAULTS, key)) {\r\n      throw new PSVError(`Unknown option ${key}`);\r\n    }\r\n\r\n    if (CONFIG_PARSERS[key]) {\r\n      config[key] = CONFIG_PARSERS[key](value, tempConfig);\r\n    }\r\n    else {\r\n      config[key] = value;\r\n    }\r\n  });\r\n\r\n  return config;\r\n}\r\n","import { DescriptionButton } from '../buttons/DescriptionButton';\r\nimport { AbstractComponent } from './AbstractComponent';\r\n\r\n/**\r\n * @summary Navbar caption class\r\n * @extends PSV.components.AbstractComponent\r\n * @memberof PSV.components\r\n */\r\nexport class NavbarCaption extends AbstractComponent {\r\n\r\n  static id = 'caption';\r\n\r\n  /**\r\n   * @param {PSV.components.Navbar} navbar\r\n   * @param {string} caption\r\n   */\r\n  constructor(navbar, caption) {\r\n    super(navbar, 'psv-caption');\r\n\r\n    /**\r\n     * @override\r\n     * @property {string} id\r\n     * @property {boolean} collapsable\r\n     * @property {number} width\r\n     * @property {number} contentWidth - width of the caption content\r\n     */\r\n    this.prop = {\r\n      ...this.prop,\r\n      id          : this.constructor.id,\r\n      collapsable : false,\r\n      width       : 0,\r\n      contentWidth: 0,\r\n    };\r\n\r\n    /**\r\n     * @member {HTMLElement}\r\n     * @readonly\r\n     * @private\r\n     */\r\n    this.content = document.createElement('div');\r\n    this.content.className = 'psv-caption-content';\r\n    this.container.appendChild(this.content);\r\n\r\n    this.setCaption(caption);\r\n  }\r\n\r\n  /**\r\n   * @override\r\n   */\r\n  destroy() {\r\n    delete this.content;\r\n\r\n    super.destroy();\r\n  }\r\n\r\n  /**\r\n   * @summary Sets the bar caption\r\n   * @param {string} html\r\n   */\r\n  setCaption(html) {\r\n    this.show();\r\n    this.content.innerHTML = html;\r\n    this.prop.contentWidth = html ? this.content.offsetWidth : 0;\r\n    this.refreshUi();\r\n  }\r\n\r\n  /**\r\n   * @summary Toggles content and icon depending on available space\r\n   * @private\r\n   */\r\n  refreshUi() {\r\n    const availableWidth = this.container.offsetWidth;\r\n    if (availableWidth >= this.prop.contentWidth) {\r\n      this.show();\r\n    }\r\n    else if (availableWidth < this.prop.contentWidth) {\r\n      this.hide();\r\n    }\r\n    this.__refreshButton();\r\n  }\r\n\r\n  /**\r\n   * @override\r\n   */\r\n  hide() {\r\n    this.content.style.display = 'none';\r\n    this.prop.visible = false;\r\n  }\r\n\r\n  /**\r\n   * @override\r\n   */\r\n  show() {\r\n    this.content.style.display = '';\r\n    this.prop.visible = true;\r\n  }\r\n\r\n  /**\r\n   * @private\r\n   */\r\n  __refreshButton() {\r\n    this.psv.navbar.getButton(DescriptionButton.id, false)?.refreshUi(true);\r\n  }\r\n\r\n}\r\n","import { AutorotateButton } from '../buttons/AutorotateButton';\r\nimport { CustomButton } from '../buttons/CustomButton';\r\nimport { DescriptionButton } from '../buttons/DescriptionButton';\r\nimport { DownloadButton } from '../buttons/DownloadButton';\r\nimport { FullscreenButton } from '../buttons/FullscreenButton';\r\nimport { MenuButton } from '../buttons/MenuButton';\r\nimport { MoveDownButton } from '../buttons/MoveDownButton';\r\nimport { MoveLeftButton } from '../buttons/MoveLeftButton';\r\nimport { MoveRightButton } from '../buttons/MoveRightButton';\r\nimport { MoveUpButton } from '../buttons/MoveUpButton';\r\nimport { ZoomInButton } from '../buttons/ZoomInButton';\r\nimport { ZoomOutButton } from '../buttons/ZoomOutButton';\r\nimport { ZoomRangeButton } from '../buttons/ZoomRangeButton';\r\nimport { DEFAULTS } from '../data/config';\r\nimport { PSVError } from '../PSVError';\r\nimport { clone, logWarn } from '../utils';\r\nimport { AbstractComponent } from './AbstractComponent';\r\nimport { NavbarCaption } from './NavbarCaption';\r\n\r\n/**\r\n * @summary List of available buttons\r\n * @type {Object<string, Class<PSV.buttons.AbstractButton>>}\r\n * @private\r\n */\r\nconst AVAILABLE_BUTTONS = {};\r\n\r\n/**\r\n * @summary List of available buttons\r\n * @type {Object<string, Array<Class<PSV.buttons.AbstractButton>>>}\r\n * @private\r\n */\r\nconst AVAILABLE_GROUPS = {};\r\n\r\n/**\r\n * @summary Register a new button available for all viewers\r\n * @param {Class<PSV.buttons.AbstractButton>} button\r\n * @param {'start' | 'end' | '[id]:left' | '[id]:right'} [defaultPosition]\r\n *    If provided the default configuration of the navbar will be modified.\r\n * @memberOf PSV\r\n */\r\nexport function registerButton(button, defaultPosition) {\r\n  if (!button.id) {\r\n    throw new PSVError('Button ID is required');\r\n  }\r\n\r\n  AVAILABLE_BUTTONS[button.id] = button;\r\n\r\n  if (button.groupId) {\r\n    AVAILABLE_GROUPS[button.groupId] = AVAILABLE_GROUPS[button.groupId] || [];\r\n    AVAILABLE_GROUPS[button.groupId].push(button);\r\n  }\r\n\r\n  if (typeof defaultPosition === 'string') {\r\n    switch (defaultPosition) {\r\n      case 'start':\r\n        DEFAULTS.navbar.unshift(button.id);\r\n        break;\r\n      case 'end':\r\n        DEFAULTS.navbar.push(button.id);\r\n        break;\r\n      default:\r\n        const [id, pos] = defaultPosition.split(':');\r\n        DEFAULTS.navbar.splice(DEFAULTS.navbar.indexOf(id) + (pos === 'right' ? 1 : 0), 0, button.id);\r\n    }\r\n  }\r\n}\r\n\r\n[\r\n  AutorotateButton,\r\n  ZoomOutButton,\r\n  ZoomRangeButton,\r\n  ZoomInButton,\r\n  DescriptionButton,\r\n  DownloadButton,\r\n  FullscreenButton,\r\n  MoveLeftButton,\r\n  MoveRightButton,\r\n  MoveUpButton,\r\n  MoveDownButton,\r\n].forEach(registerButton);\r\n\r\n/**\r\n * @summary Navigation bar component\r\n * @extends PSV.components.AbstractComponent\r\n * @memberof PSV.components\r\n */\r\nexport class Navbar extends AbstractComponent {\r\n\r\n  /**\r\n   * @param {PSV.Viewer} psv\r\n   */\r\n  constructor(psv) {\r\n    super(psv, 'psv-navbar psv--capture-event');\r\n\r\n    /**\r\n     * @summary List of buttons of the navbar\r\n     * @member {PSV.buttons.AbstractButton[]}\r\n     * @override\r\n     */\r\n    this.children = [];\r\n\r\n    /**\r\n     * @summary List of collapsed buttons\r\n     * @member {PSV.buttons.AbstractButton[]}\r\n     * @private\r\n     */\r\n    this.collapsed = [];\r\n  }\r\n\r\n  /**\r\n   * @summary Change the buttons visible on the navbar\r\n   * @param {string|Array<string|PSV.NavbarCustomButton>} buttons\r\n   * @throws {PSV.PSVError} when a button is unknown\r\n   */\r\n  setButtons(buttons) {\r\n    this.children.slice().forEach(item => item.destroy());\r\n    this.children.length = 0;\r\n\r\n    const cleanedButtons = this.__cleanButtons(buttons);\r\n\r\n    // force description button if caption is present (used on narrow screens)\r\n    if (cleanedButtons.indexOf(NavbarCaption.id) !== -1 && cleanedButtons.indexOf(DescriptionButton.id) === -1) {\r\n      cleanedButtons.splice(cleanedButtons.indexOf(NavbarCaption.id), 0, DescriptionButton.id);\r\n    }\r\n\r\n    /* eslint-disable no-new */\r\n    cleanedButtons.forEach((button) => {\r\n      if (typeof button === 'object') {\r\n        new CustomButton(this, button);\r\n      }\r\n      else if (AVAILABLE_BUTTONS[button]) {\r\n        new AVAILABLE_BUTTONS[button](this);\r\n      }\r\n      else if (AVAILABLE_GROUPS[button]) {\r\n        AVAILABLE_GROUPS[button].forEach(buttonCtor => new buttonCtor(this)); // eslint-disable-line new-cap\r\n      }\r\n      else if (button === NavbarCaption.id) {\r\n        new NavbarCaption(this, this.psv.config.caption);\r\n      }\r\n      else {\r\n        throw new PSVError('Unknown button ' + button);\r\n      }\r\n    });\r\n\r\n    new MenuButton(this);\r\n    /* eslint-enable no-new */\r\n\r\n    this.children.forEach((item) => {\r\n      if (typeof item.checkSupported === 'function') {\r\n        item.checkSupported();\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * @summary Sets the bar caption\r\n   * @param {string} html\r\n   */\r\n  setCaption(html) {\r\n    const caption = this.getButton(NavbarCaption.id, false);\r\n    caption?.setCaption(html);\r\n  }\r\n\r\n  /**\r\n   * @summary Returns a button by its identifier\r\n   * @param {string} id\r\n   * @param {boolean} [warnNotFound=true]\r\n   * @returns {PSV.buttons.AbstractButton}\r\n   */\r\n  getButton(id, warnNotFound = true) {\r\n    let button = null;\r\n\r\n    this.children.some((item) => {\r\n      if (item.prop.id === id) {\r\n        button = item;\r\n        return true;\r\n      }\r\n      else {\r\n        return false;\r\n      }\r\n    });\r\n\r\n    if (!button && warnNotFound) {\r\n      logWarn(`button \"${id}\" not found in the navbar`);\r\n    }\r\n\r\n    return button;\r\n  }\r\n\r\n  /**\r\n   * @summary Shows the navbar\r\n   */\r\n  show() {\r\n    this.container.classList.add('psv-navbar--open');\r\n    this.prop.visible = true;\r\n  }\r\n\r\n  /**\r\n   * @summary Hides the navbar\r\n   */\r\n  hide() {\r\n    this.container.classList.remove('psv-navbar--open');\r\n    this.prop.visible = false;\r\n  }\r\n\r\n  /**\r\n   * @override\r\n   */\r\n  refreshUi() {\r\n    super.refreshUi();\r\n\r\n    if (this.psv.prop.uiRefresh === true) {\r\n      const availableWidth = this.container.offsetWidth;\r\n\r\n      let totalWidth = 0;\r\n      const visibleButtons = [];\r\n      const collapsableButtons = [];\r\n\r\n      this.children.forEach((item) => {\r\n        if (item.prop.visible) {\r\n          totalWidth += item.prop.width;\r\n          visibleButtons.push(item);\r\n          if (item.prop.collapsable) {\r\n            collapsableButtons.push(item);\r\n          }\r\n        }\r\n      });\r\n\r\n      if (!visibleButtons.length) {\r\n        return;\r\n      }\r\n\r\n      if (availableWidth < totalWidth && collapsableButtons.length > 0) {\r\n        collapsableButtons.forEach(item => item.collapse());\r\n        this.collapsed = collapsableButtons;\r\n\r\n        this.getButton(MenuButton.id).show(false);\r\n      }\r\n      else if (availableWidth >= totalWidth && this.collapsed.length > 0) {\r\n        this.collapsed.forEach(item => item.uncollapse());\r\n        this.collapsed = [];\r\n\r\n        this.getButton(MenuButton.id).hide(false);\r\n      }\r\n\r\n      const caption = this.getButton(NavbarCaption.id, false);\r\n      if (caption) {\r\n        caption.refreshUi();\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @summary Ensure the buttons configuration is correct\r\n   * @private\r\n   */\r\n  __cleanButtons(buttons) {\r\n    // true becomes the default array\r\n    if (buttons === true) {\r\n      return clone(DEFAULTS.navbar);\r\n    }\r\n    // can be a space or coma separated list\r\n    else if (typeof buttons === 'string') {\r\n      return buttons.split(/[ ,]/);\r\n    }\r\n    else {\r\n      return buttons || [];\r\n    }\r\n  }\r\n\r\n}\r\n","import { EVENTS } from '../data/constants';\r\nimport { SYSTEM } from '../data/system';\r\nimport { bound, getStyle } from '../utils';\r\nimport { AbstractComponent } from './AbstractComponent';\r\n\r\n/**\r\n * @summary Loader component\r\n * @extends PSV.components.AbstractComponent\r\n * @memberof PSV.components\r\n */\r\nexport class Loader extends AbstractComponent {\r\n\r\n  /**\r\n   * @param {PSV.Viewer} psv\r\n   */\r\n  constructor(psv) {\r\n    super(psv, 'psv-loader-container');\r\n\r\n    /**\r\n     * @summary Inner container for vertical center\r\n     * @member {HTMLElement}\r\n     * @readonly\r\n     * @private\r\n     */\r\n    this.loader = document.createElement('div');\r\n    this.loader.className = 'psv-loader';\r\n    this.container.appendChild(this.loader);\r\n\r\n    /**\r\n     * @summary Animation canvas\r\n     * @member {HTMLCanvasElement}\r\n     * @readonly\r\n     * @private\r\n     */\r\n    this.canvas = document.createElement('canvas');\r\n    this.canvas.className = 'psv-loader-canvas';\r\n\r\n    this.canvas.width = this.loader.clientWidth * SYSTEM.pixelRatio;\r\n    this.canvas.height = this.loader.clientWidth * SYSTEM.pixelRatio;\r\n    this.loader.appendChild(this.canvas);\r\n\r\n    /**\r\n     * @override\r\n     * @property {number} thickness\r\n     * @property {string} current\r\n     */\r\n    this.prop = {\r\n      ...this.prop,\r\n      tickness: (this.loader.offsetWidth - this.loader.clientWidth) / 2 * SYSTEM.pixelRatio,\r\n      current : null,\r\n    };\r\n\r\n    this.refreshUi();\r\n    this.hide();\r\n  }\r\n\r\n  /**\r\n   * @override\r\n   */\r\n  destroy() {\r\n    delete this.loader;\r\n    delete this.canvas;\r\n\r\n    super.destroy();\r\n  }\r\n\r\n  /**\r\n   * @override\r\n   */\r\n  refreshUi() {\r\n    if (this.prop.current !== (this.psv.config.loadingImg || this.psv.config.loadingTxt)) {\r\n      if (this.prop.current) {\r\n        this.loader.removeChild(this.loader.lastChild);\r\n      }\r\n\r\n      let inner;\r\n      if (this.psv.config.loadingImg) {\r\n        inner = document.createElement('img');\r\n        inner.className = 'psv-loader-image';\r\n        inner.src = this.psv.config.loadingImg;\r\n      }\r\n      else if (this.psv.config.loadingTxt) {\r\n        inner = document.createElement('div');\r\n        inner.className = 'psv-loader-text';\r\n        inner.innerHTML = this.psv.config.loadingTxt;\r\n      }\r\n      if (inner) {\r\n        const size = Math.round(Math.sqrt(2 * Math.pow((this.canvas.width / 2 - this.prop.tickness / 2) / SYSTEM.pixelRatio, 2)));\r\n        inner.style.maxWidth = size + 'px';\r\n        inner.style.maxHeight = size + 'px';\r\n        this.loader.appendChild(inner);\r\n      }\r\n\r\n      this.prop.current = this.psv.config.loadingImg || this.psv.config.loadingTxt;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @summary Sets the loader progression\r\n   * @param {number} value - from 0 to 100\r\n   */\r\n  setProgress(value) {\r\n    const context = this.canvas.getContext('2d');\r\n\r\n    context.clearRect(0, 0, this.canvas.width, this.canvas.height);\r\n\r\n    context.lineWidth = this.prop.tickness;\r\n    context.strokeStyle = getStyle(this.loader, 'color');\r\n\r\n    context.beginPath();\r\n    context.arc(\r\n      this.canvas.width / 2, this.canvas.height / 2,\r\n      this.canvas.width / 2 - this.prop.tickness / 2,\r\n      -Math.PI / 2, bound(value, 0, 100) / 100 * 2 * Math.PI - Math.PI / 2\r\n    );\r\n    context.stroke();\r\n\r\n    this.psv.trigger(EVENTS.LOAD_PROGRESS, Math.round(value));\r\n  }\r\n\r\n}\r\n","import { EVENTS } from '../data/constants';\r\nimport { PSVError } from '../PSVError';\r\nimport { AbstractComponent } from './AbstractComponent';\r\n\r\n/**\r\n * @summary Notification component\r\n * @extends PSV.components.AbstractComponent\r\n * @memberof PSV.components\r\n */\r\nexport class Notification extends AbstractComponent {\r\n\r\n  /**\r\n   * @param {PSV.Viewer} psv\r\n   */\r\n  constructor(psv) {\r\n    super(psv, 'psv-notification');\r\n\r\n    /**\r\n     * @override\r\n     * @property {*} timeout\r\n     */\r\n    this.prop = {\r\n      ...this.prop,\r\n      visible  : false,\r\n      contentId: undefined,\r\n      timeout  : null,\r\n    };\r\n\r\n    /**\r\n     * Notification content\r\n     * @member {HTMLElement}\r\n     * @readonly\r\n     * @private\r\n     */\r\n    this.content = document.createElement('div');\r\n    this.content.className = 'psv-notification-content';\r\n    this.container.appendChild(this.content);\r\n\r\n    this.content.addEventListener('click', () => this.hide());\r\n  }\r\n\r\n  /**\r\n   * @override\r\n   */\r\n  destroy() {\r\n    delete this.content;\r\n\r\n    super.destroy();\r\n  }\r\n\r\n  /**\r\n   * @override\r\n   * @param {string} [id]\r\n   */\r\n  isVisible(id) {\r\n    return this.prop.visible && (!id || !this.prop.contentId || this.prop.contentId === id);\r\n  }\r\n\r\n  /**\r\n   * @override\r\n   * @summary This method is not supported\r\n   * @throws {PSV.PSVError} always\r\n   */\r\n  toggle() {\r\n    throw new PSVError('Notification cannot be toggled');\r\n  }\r\n\r\n  /**\r\n   * @summary Displays a notification on the viewer\r\n   * @param {Object|string} config\r\n   * @param {string} [config.id] - unique identifier to use with \"hide\"\r\n   * @param {string} config.content\r\n   * @param {number} [config.timeout]\r\n   * @fires PSV.show-notification\r\n   *\r\n   * @example\r\n   * viewer.showNotification({ content: 'Hello world', timeout: 5000 })\r\n   * @example\r\n   * viewer.showNotification('Hello world')\r\n   */\r\n  show(config) {\r\n    if (this.prop.timeout) {\r\n      clearTimeout(this.prop.timeout);\r\n      this.prop.timeout = null;\r\n    }\r\n\r\n    if (typeof config === 'string') {\r\n      config = { content: config };\r\n    }\r\n\r\n    this.prop.contentId = config.id;\r\n    this.content.innerHTML = config.content;\r\n\r\n    this.container.classList.add('psv-notification--visible');\r\n    this.prop.visible = true;\r\n\r\n    this.psv.trigger(EVENTS.SHOW_NOTIFICATION, config.id);\r\n\r\n    if (config.timeout) {\r\n      this.prop.timeout = setTimeout(() => this.hide(config.id), config.timeout);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @summary Hides the notification\r\n   * @param {string} [id]\r\n   * @fires PSV.hide-notification\r\n   */\r\n  hide(id) {\r\n    if (this.isVisible(id)) {\r\n      const contentId = this.prop.contentId;\r\n\r\n      this.container.classList.remove('psv-notification--visible');\r\n      this.prop.visible = false;\r\n\r\n      this.prop.contentId = undefined;\r\n\r\n      this.psv.trigger(EVENTS.HIDE_NOTIFICATION, contentId);\r\n    }\r\n  }\r\n\r\n}\r\n","import { EVENTS, KEY_CODES } from '../data/constants';\r\nimport { PSVError } from '../PSVError';\r\nimport { AbstractComponent } from './AbstractComponent';\r\n\r\n/**\r\n * @summary Overlay component\r\n * @extends PSV.components.AbstractComponent\r\n * @memberof PSV.components\r\n */\r\nexport class Overlay extends AbstractComponent {\r\n\r\n  /**\r\n   * @param {PSV.Viewer} psv\r\n   */\r\n  constructor(psv) {\r\n    super(psv, 'psv-overlay');\r\n\r\n    /**\r\n     * @override\r\n     * @property {string} contentId\r\n     * @property {boolean} dissmisable\r\n     */\r\n    this.prop = {\r\n      ...this.prop,\r\n      contentId  : undefined,\r\n      dissmisable: true,\r\n    };\r\n\r\n    /**\r\n     * Image container\r\n     * @member {HTMLElement}\r\n     * @readonly\r\n     * @private\r\n     */\r\n    this.image = document.createElement('div');\r\n    this.image.className = 'psv-overlay-image';\r\n    this.container.appendChild(this.image);\r\n\r\n    /**\r\n     * Text container\r\n     * @member {HTMLElement}\r\n     * @readonly\r\n     * @private\r\n     */\r\n    this.text = document.createElement('div');\r\n    this.text.className = 'psv-overlay-text';\r\n    this.container.appendChild(this.text);\r\n\r\n    /**\r\n     * Subtext container\r\n     * @member {HTMLElement}\r\n     * @readonly\r\n     * @private\r\n     */\r\n    this.subtext = document.createElement('div');\r\n    this.subtext.className = 'psv-overlay-subtext';\r\n    this.container.appendChild(this.subtext);\r\n\r\n    this.psv.on(EVENTS.CLICK, this);\r\n    this.psv.on(EVENTS.KEY_PRESS, this);\r\n\r\n    super.hide();\r\n  }\r\n\r\n  /**\r\n   * @override\r\n   */\r\n  destroy() {\r\n    this.psv.off(EVENTS.CLICK, this);\r\n    this.psv.off(EVENTS.KEY_PRESS, this);\r\n\r\n    delete this.image;\r\n    delete this.text;\r\n    delete this.subtext;\r\n\r\n    super.destroy();\r\n  }\r\n\r\n  /**\r\n   * @summary Handles events\r\n   * @param {Event} e\r\n   * @private\r\n   */\r\n  handleEvent(e) {\r\n    /* eslint-disable */\r\n    switch (e.type) {\r\n      case EVENTS.CLICK:\r\n        if (this.isVisible() && this.prop.dissmisable) {\r\n          this.hide();\r\n          e.stopPropagation();\r\n        }\r\n        break;\r\n      case EVENTS.KEY_PRESS:\r\n        if (this.isVisible() && this.prop.dissmisable && e.args[0] === KEY_CODES.Escape) {\r\n          this.hide();\r\n          e.preventDefault();\r\n        }\r\n        break;\r\n    }\r\n    /* eslint-enable */\r\n  }\r\n\r\n  /**\r\n   * @override\r\n   * @param {string} [id]\r\n   */\r\n  isVisible(id) {\r\n    return this.prop.visible && (!id || !this.prop.contentId || this.prop.contentId === id);\r\n  }\r\n\r\n  /**\r\n   * @override\r\n   * @summary This method is not supported\r\n   * @throws {PSV.PSVError} always\r\n   */\r\n  toggle() {\r\n    throw new PSVError('Overlay cannot be toggled');\r\n  }\r\n\r\n  /**\r\n   * @summary Displays an overlay on the viewer\r\n   * @param {Object|string} config\r\n   * @param {string} [config.id] - unique identifier to use with \"hide\"\r\n   * @param {string} config.image - SVG image/icon displayed above the text\r\n   * @param {string} config.text - main message\r\n   * @param {string} [config.subtext] - secondary message\r\n   * @param {boolean} [config.dissmisable=true] - if the user can hide the overlay by clicking\r\n   * @fires PSV.show-overlay\r\n   */\r\n  show(config) {\r\n    if (typeof config === 'string') {\r\n      config = { text: config };\r\n    }\r\n\r\n    this.prop.contentId = config.id;\r\n    this.prop.dissmisable = config.dissmisable !== false;\r\n    this.image.innerHTML = config.image || '';\r\n    this.text.innerHTML = config.text || '';\r\n    this.subtext.innerHTML = config.subtext || '';\r\n\r\n    super.show();\r\n\r\n    this.psv.trigger(EVENTS.SHOW_OVERLAY, config.id);\r\n  }\r\n\r\n  /**\r\n   * @summary Hides the overlay\r\n   * @param {string} [id]\r\n   * @fires PSV.hide-overlay\r\n   */\r\n  hide(id) {\r\n    if (this.isVisible(id)) {\r\n      const contentId = this.prop.contentId;\r\n\r\n      super.hide();\r\n\r\n      this.prop.contentId = undefined;\r\n\r\n      this.psv.trigger(EVENTS.HIDE_OVERLAY, contentId);\r\n    }\r\n  }\r\n\r\n}\r\n","import { EVENTS, KEY_CODES } from '../data/constants';\r\nimport { SYSTEM } from '../data/system';\r\nimport { PSVError } from '../PSVError';\r\nimport { toggleClass } from '../utils';\r\nimport { AbstractComponent } from './AbstractComponent';\r\n\r\n/**\r\n * @summary Minimum width of the panel\r\n * @type {number}\r\n * @constant\r\n * @private\r\n */\r\nconst PANEL_MIN_WIDTH = 200;\r\n\r\n/**\r\n * @summary Panel component\r\n * @extends PSV.components.AbstractComponent\r\n * @memberof PSV.components\r\n */\r\nexport class Panel extends AbstractComponent {\r\n\r\n  /**\r\n   * @param {PSV.Viewer} psv\r\n   */\r\n  constructor(psv) {\r\n    super(psv, 'psv-panel psv--capture-event');\r\n\r\n    /**\r\n     * @override\r\n     * @property {string} contentId\r\n     * @property {number} mouseX\r\n     * @property {number} mouseY\r\n     * @property {boolean} mousedown\r\n     * @property {function} clickHandler\r\n     * @property {function} keyHandler\r\n     */\r\n    this.prop = {\r\n      ...this.prop,\r\n      visible     : false,\r\n      contentId   : undefined,\r\n      mouseX      : 0,\r\n      mouseY      : 0,\r\n      mousedown   : false,\r\n      clickHandler: null,\r\n      keyHandler  : null,\r\n      width       : {},\r\n    };\r\n\r\n    const resizer = document.createElement('div');\r\n    resizer.className = 'psv-panel-resizer';\r\n    this.container.appendChild(resizer);\r\n\r\n    const closeBtn = document.createElement('div');\r\n    closeBtn.className = 'psv-panel-close-button';\r\n    this.container.appendChild(closeBtn);\r\n\r\n    /**\r\n     * @summary Content container\r\n     * @member {HTMLElement}\r\n     * @readonly\r\n     * @private\r\n     */\r\n    this.content = document.createElement('div');\r\n    this.content.className = 'psv-panel-content';\r\n    this.container.appendChild(this.content);\r\n\r\n    // Stop wheel event bubbling from panel\r\n    this.container.addEventListener(SYSTEM.mouseWheelEvent, e => e.stopPropagation());\r\n\r\n    closeBtn.addEventListener('click', () => this.hide());\r\n\r\n    // Event for panel resizing + stop bubling\r\n    resizer.addEventListener('mousedown', this);\r\n    resizer.addEventListener('touchstart', this);\r\n    this.psv.container.addEventListener('mouseup', this);\r\n    this.psv.container.addEventListener('touchend', this);\r\n    this.psv.container.addEventListener('mousemove', this);\r\n    this.psv.container.addEventListener('touchmove', this);\r\n\r\n    this.psv.on(EVENTS.KEY_PRESS, this);\r\n  }\r\n\r\n  /**\r\n   * @override\r\n   */\r\n  destroy() {\r\n    this.psv.off(EVENTS.KEY_PRESS, this);\r\n\r\n    this.psv.container.removeEventListener('mousemove', this);\r\n    this.psv.container.removeEventListener('touchmove', this);\r\n    this.psv.container.removeEventListener('mouseup', this);\r\n    this.psv.container.removeEventListener('touchend', this);\r\n\r\n    delete this.prop;\r\n    delete this.content;\r\n\r\n    super.destroy();\r\n  }\r\n\r\n  /**\r\n   * @summary Handles events\r\n   * @param {Event} e\r\n   * @private\r\n   */\r\n  handleEvent(e) {\r\n    /* eslint-disable */\r\n    switch (e.type) {\r\n      // @formatter:off\r\n      case 'mousedown':  this.__onMouseDown(e);  break;\r\n      case 'touchstart': this.__onTouchStart(e); break;\r\n      case 'mousemove':  this.__onMouseMove(e);  break;\r\n      case 'touchmove':  this.__onTouchMove(e);  break;\r\n      case 'mouseup':    this.__onMouseUp(e);    break;\r\n      case 'touchend':   this.__onMouseUp(e);    break;\r\n      case EVENTS.KEY_PRESS:\r\n        if (this.isVisible() && e.args[0] === KEY_CODES.Escape) {\r\n          this.hide();\r\n          e.preventDefault();\r\n        }\r\n        break;\r\n      // @formatter:on\r\n    }\r\n    /* eslint-enable */\r\n  }\r\n\r\n  /**\r\n   * @override\r\n   * @param {string} [id]\r\n   */\r\n  isVisible(id) {\r\n    return this.prop.visible && (!id || !this.prop.contentId || this.prop.contentId === id);\r\n  }\r\n\r\n  /**\r\n   * @override\r\n   * @summary This method is not supported\r\n   * @throws {PSV.PSVError} always\r\n   */\r\n  toggle() {\r\n    throw new PSVError('Panel cannot be toggled');\r\n  }\r\n\r\n  /**\r\n   * @summary Shows the panel\r\n   * @param {string|Object} config\r\n   * @param {string} [config.id] - unique identifier to use with \"hide\" and to store the user desired width\r\n   * @param {string} config.content - HTML content of the panel\r\n   * @param {boolean} [config.noMargin=false] - remove the default margins\r\n   * @param {string} [config.width] - initial width\r\n   * @param {Function} [config.clickHandler] - called when the user clicks inside the panel or presses the Enter key while an element focused\r\n   * @fires PSV.open-panel\r\n   */\r\n  show(config) {\r\n    const wasVisible = this.isVisible(config.id);\r\n\r\n    if (typeof config === 'string') {\r\n      config = { content: config };\r\n    }\r\n\r\n    this.prop.contentId = config.id;\r\n    this.prop.visible = true;\r\n\r\n    if (this.prop.clickHandler) {\r\n      this.content.removeEventListener('click', this.prop.clickHandler);\r\n      this.content.removeEventListener('keydown', this.prop.keyHandler);\r\n      this.prop.clickHandler = null;\r\n      this.prop.keyHandler = null;\r\n    }\r\n\r\n    if (config.id && this.prop.width[config.id]) {\r\n      this.container.style.width = this.prop.width[config.id];\r\n    }\r\n    else if (config.width) {\r\n      this.container.style.width = config.width;\r\n    }\r\n    else {\r\n      this.container.style.width = null;\r\n    }\r\n\r\n    this.content.innerHTML = config.content;\r\n    this.content.scrollTop = 0;\r\n    this.container.classList.add('psv-panel--open');\r\n\r\n    toggleClass(this.content, 'psv-panel-content--no-margin', config.noMargin === true);\r\n\r\n    if (config.clickHandler) {\r\n      this.prop.clickHandler = config.clickHandler;\r\n      this.prop.keyHandler = (e) => {\r\n        if (e.key === KEY_CODES.Enter) {\r\n          config.clickHandler(e);\r\n        }\r\n      };\r\n      this.content.addEventListener('click', this.prop.clickHandler);\r\n      this.content.addEventListener('keydown', this.prop.keyHandler);\r\n\r\n      // focus the first element if possible, after animation ends\r\n      if (!wasVisible) {\r\n        setTimeout(() => {\r\n          this.content.querySelector('a,button,[tabindex]')?.focus();\r\n        }, 300);\r\n      }\r\n    }\r\n\r\n    this.psv.trigger(EVENTS.OPEN_PANEL, config.id);\r\n  }\r\n\r\n  /**\r\n   * @summary Hides the panel\r\n   * @param {string} [id]\r\n   * @fires PSV.close-panel\r\n   */\r\n  hide(id) {\r\n    if (this.isVisible(id)) {\r\n      const contentId = this.prop.contentId;\r\n\r\n      this.prop.visible = false;\r\n      this.prop.contentId = undefined;\r\n\r\n      this.content.innerHTML = null;\r\n      this.container.classList.remove('psv-panel--open');\r\n\r\n      if (this.prop.clickHandler) {\r\n        this.content.removeEventListener('click', this.prop.clickHandler);\r\n        this.prop.clickHandler = null;\r\n      }\r\n\r\n      this.psv.trigger(EVENTS.CLOSE_PANEL, contentId);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @summary Handles mouse down events\r\n   * @param {MouseEvent} evt\r\n   * @private\r\n   */\r\n  __onMouseDown(evt) {\r\n    evt.stopPropagation();\r\n    this.__startResize(evt);\r\n  }\r\n\r\n  /**\r\n   * @summary Handles touch events\r\n   * @param {TouchEvent} evt\r\n   * @private\r\n   */\r\n  __onTouchStart(evt) {\r\n    evt.stopPropagation();\r\n    this.__startResize(evt.changedTouches[0]);\r\n  }\r\n\r\n  /**\r\n   * @summary Handles mouse up events\r\n   * @param {MouseEvent} evt\r\n   * @private\r\n   */\r\n  __onMouseUp(evt) {\r\n    if (this.prop.mousedown) {\r\n      evt.stopPropagation();\r\n      this.prop.mousedown = false;\r\n      this.content.classList.remove('psv-panel-content--no-interaction');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @summary Handles mouse move events\r\n   * @param {MouseEvent} evt\r\n   * @private\r\n   */\r\n  __onMouseMove(evt) {\r\n    if (this.prop.mousedown) {\r\n      evt.stopPropagation();\r\n      this.__resize(evt);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @summary Handles touch move events\r\n   * @param {TouchEvent} evt\r\n   * @private\r\n   */\r\n  __onTouchMove(evt) {\r\n    if (this.prop.mousedown) {\r\n      this.__resize(evt.touches[0]);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @summary Initializes the panel resize\r\n   * @param {MouseEvent|Touch} evt\r\n   * @private\r\n   */\r\n  __startResize(evt) {\r\n    this.prop.mouseX = evt.clientX;\r\n    this.prop.mouseY = evt.clientY;\r\n    this.prop.mousedown = true;\r\n    this.content.classList.add('psv-panel-content--no-interaction');\r\n  }\r\n\r\n  /**\r\n   * @summary Resizes the panel\r\n   * @param {MouseEvent|Touch} evt\r\n   * @private\r\n   */\r\n  __resize(evt) {\r\n    const x = evt.clientX;\r\n    const y = evt.clientY;\r\n    const width = Math.max(PANEL_MIN_WIDTH, this.container.offsetWidth - (x - this.prop.mouseX)) + 'px';\r\n\r\n    if (this.prop.contentId) {\r\n      this.prop.width[this.prop.contentId] = width;\r\n    }\r\n\r\n    this.container.style.width = width;\r\n\r\n    this.prop.mouseX = x;\r\n    this.prop.mouseY = y;\r\n  }\r\n\r\n}\r\n","/**\r\n * @namespace PSV.services\r\n */\r\n\r\n/**\r\n * @summary Base services class\r\n * @memberof PSV.services\r\n * @abstract\r\n */\r\nexport class AbstractService {\r\n\r\n  /**\r\n   * @param {PSV.Viewer} psv\r\n   */\r\n  constructor(psv) {\r\n    /**\r\n     * @summary Reference to main controller\r\n     * @type {PSV.Viewer}\r\n     * @readonly\r\n     */\r\n    this.psv = psv;\r\n\r\n    /**\r\n     * @summary Configuration holder\r\n     * @type {PSV.Options}\r\n     * @readonly\r\n     */\r\n    this.config = psv.config;\r\n\r\n    /**\r\n     * @summary Properties holder\r\n     * @type {Object}\r\n     * @readonly\r\n     */\r\n    this.prop = psv.prop;\r\n  }\r\n\r\n  /**\r\n   * @summary Destroys the service\r\n   */\r\n  destroy() {\r\n    delete this.psv;\r\n    delete this.config;\r\n    delete this.prop;\r\n  }\r\n\r\n}\r\n","import * as THREE from 'three';\r\nimport { MESH_USER_DATA, SPHERE_RADIUS } from '../data/constants';\r\nimport { PSVError } from '../PSVError';\r\nimport { applyEulerInverse, parseAngle, parseSpeed } from '../utils';\r\nimport { AbstractService } from './AbstractService';\r\n\r\nconst vector2 = new THREE.Vector2();\r\nconst vector3 = new THREE.Vector3();\r\nconst eulerZero = new THREE.Euler(0, 0, 0, 'ZXY');\r\n\r\n/**\r\n * @summary Collections of data converters for the current viewer\r\n * @extends PSV.services.AbstractService\r\n * @memberof PSV.services\r\n */\r\nexport class DataHelper extends AbstractService {\r\n\r\n  /**\r\n   * @param {PSV.Viewer} psv\r\n   */\r\n  constructor(psv) {\r\n    super(psv);\r\n  }\r\n\r\n  /**\r\n   * @summary Converts vertical FOV to zoom level\r\n   * @param {number} fov\r\n   * @returns {number}\r\n   */\r\n  fovToZoomLevel(fov) {\r\n    const temp = Math.round((fov - this.config.minFov) / (this.config.maxFov - this.config.minFov) * 100);\r\n    return temp - 2 * (temp - 50);\r\n  }\r\n\r\n  /**\r\n   * @summary Converts zoom level to vertical FOV\r\n   * @param {number} level\r\n   * @returns {number}\r\n   */\r\n  zoomLevelToFov(level) {\r\n    return this.config.maxFov + (level / 100) * (this.config.minFov - this.config.maxFov);\r\n  }\r\n\r\n  /**\r\n   * @summary Convert vertical FOV to horizontal FOV\r\n   * @param {number} vFov\r\n   * @returns {number}\r\n   */\r\n  vFovToHFov(vFov) {\r\n    return THREE.MathUtils.radToDeg(2 * Math.atan(Math.tan(THREE.MathUtils.degToRad(vFov) / 2) * this.prop.aspect));\r\n  }\r\n\r\n  /**\r\n   * @summary Converts a speed into a duration from current position to a new position\r\n   * @param {string|number} value\r\n   * @param {number} angle\r\n   * @returns {number}\r\n   */\r\n  speedToDuration(value, angle) {\r\n    if (!value || typeof value !== 'number') {\r\n      // desired radial speed\r\n      const speed = value ? parseSpeed(value) : this.config.autorotateSpeed;\r\n      // compute duration\r\n      return angle / Math.abs(speed) * 1000;\r\n    }\r\n    else {\r\n      return Math.abs(value);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @summary Converts pixel texture coordinates to spherical radians coordinates\r\n   * @param {PSV.Point} point\r\n   * @returns {PSV.Position}\r\n   * @throws {PSV.PSVError} when the current adapter does not support texture coordinates\r\n   */\r\n  textureCoordsToSphericalCoords(point) {\r\n    const panoData = this.prop.panoData;\r\n    if (!panoData) {\r\n      throw new PSVError('Current adapter does not support texture coordinates.');\r\n    }\r\n\r\n    const relativeX = (point.x + panoData.croppedX) / panoData.fullWidth * Math.PI * 2;\r\n    const relativeY = (point.y + panoData.croppedY) / panoData.fullHeight * Math.PI;\r\n\r\n    const result = {\r\n      longitude: relativeX >= Math.PI ? relativeX - Math.PI : relativeX + Math.PI,\r\n      latitude : Math.PI / 2 - relativeY,\r\n    };\r\n\r\n    // Apply panoData pose and sphereCorrection\r\n    if (!eulerZero.equals(this.psv.renderer.mesh.rotation) || !eulerZero.equals(this.psv.renderer.meshContainer.rotation)) {\r\n      this.sphericalCoordsToVector3(result, vector3);\r\n      vector3.applyEuler(this.psv.renderer.mesh.rotation);\r\n      vector3.applyEuler(this.psv.renderer.meshContainer.rotation);\r\n      return this.vector3ToSphericalCoords(vector3);\r\n    }\r\n    else {\r\n      return result;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @summary Converts spherical radians coordinates to pixel texture coordinates\r\n   * @param {PSV.Position} position\r\n   * @returns {PSV.Point}\r\n   * @throws {PSV.PSVError} when the current adapter does not support texture coordinates\r\n   */\r\n  sphericalCoordsToTextureCoords(position) {\r\n    const panoData = this.prop.panoData;\r\n    if (!panoData) {\r\n      throw new PSVError('Current adapter does not support texture coordinates.');\r\n    }\r\n\r\n    // Apply panoData pose and sphereCorrection\r\n    if (!eulerZero.equals(this.psv.renderer.mesh.rotation) || !eulerZero.equals(this.psv.renderer.meshContainer.rotation)) {\r\n      this.sphericalCoordsToVector3(position, vector3);\r\n      applyEulerInverse(vector3, this.psv.renderer.meshContainer.rotation);\r\n      applyEulerInverse(vector3, this.psv.renderer.mesh.rotation);\r\n      position = this.vector3ToSphericalCoords(vector3);\r\n    }\r\n\r\n    const relativeLong = position.longitude / Math.PI / 2 * panoData.fullWidth;\r\n    const relativeLat = position.latitude / Math.PI * panoData.fullHeight;\r\n\r\n    return {\r\n      x: Math.round(position.longitude < Math.PI ? relativeLong + panoData.fullWidth / 2 : relativeLong - panoData.fullWidth / 2) - panoData.croppedX,\r\n      y: Math.round(panoData.fullHeight / 2 - relativeLat) - panoData.croppedY,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * @summary Converts spherical radians coordinates to a THREE.Vector3\r\n   * @param {PSV.Position} position\r\n   * @param {external:THREE.Vector3} [vector]\r\n   * @returns {external:THREE.Vector3}\r\n   */\r\n  sphericalCoordsToVector3(position, vector) {\r\n    if (!vector) {\r\n      vector = new THREE.Vector3();\r\n    }\r\n    vector.x = SPHERE_RADIUS * -Math.cos(position.latitude) * Math.sin(position.longitude);\r\n    vector.y = SPHERE_RADIUS * Math.sin(position.latitude);\r\n    vector.z = SPHERE_RADIUS * Math.cos(position.latitude) * Math.cos(position.longitude);\r\n    return vector;\r\n  }\r\n\r\n  /**\r\n   * @summary Converts a THREE.Vector3 to spherical radians coordinates\r\n   * @param {external:THREE.Vector3} vector\r\n   * @returns {PSV.Position}\r\n   */\r\n  vector3ToSphericalCoords(vector) {\r\n    const phi = Math.acos(vector.y / Math.sqrt(vector.x * vector.x + vector.y * vector.y + vector.z * vector.z));\r\n    const theta = Math.atan2(vector.x, vector.z);\r\n\r\n    return {\r\n      longitude: theta < 0 ? -theta : Math.PI * 2 - theta,\r\n      latitude : Math.PI / 2 - phi,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * @summary Converts position on the viewer to a THREE.Vector3\r\n   * @param {PSV.Point} viewerPoint\r\n   * @returns {external:THREE.Vector3}\r\n   */\r\n  viewerCoordsToVector3(viewerPoint) {\r\n    const sphereIntersect = this.getIntersections(viewerPoint).filter(i => i.object.userData[MESH_USER_DATA]);\r\n\r\n    if (sphereIntersect.length) {\r\n      return sphereIntersect[0].point;\r\n    }\r\n    else {\r\n      return null;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @summary Converts a THREE.Vector3 to position on the viewer\r\n   * @param {external:THREE.Vector3} vector\r\n   * @returns {PSV.Point}\r\n   */\r\n  vector3ToViewerCoords(vector) {\r\n    const vectorClone = vector.clone();\r\n    vectorClone.project(this.psv.renderer.camera);\r\n\r\n    return {\r\n      x: Math.round((vectorClone.x + 1) / 2 * this.prop.size.width),\r\n      y: Math.round((1 - vectorClone.y) / 2 * this.prop.size.height),\r\n    };\r\n  }\r\n\r\n  /**\r\n   * @summary Converts spherical radians coordinates to position on the viewer\r\n   * @param {PSV.Position} position\r\n   * @returns {PSV.Point}\r\n   */\r\n  sphericalCoordsToViewerCoords(position) {\r\n    return this.vector3ToViewerCoords(this.sphericalCoordsToVector3(position, vector3));\r\n  }\r\n\r\n  /**\r\n   * @summary Returns intersections with objects in the scene\r\n   * @param {PSV.Point} viewerPoint\r\n   * @return {external:THREE.Intersection[]}\r\n   */\r\n  getIntersections(viewerPoint) {\r\n    vector2.x = 2 * viewerPoint.x / this.prop.size.width - 1;\r\n    vector2.y = -2 * viewerPoint.y / this.prop.size.height + 1;\r\n\r\n    this.psv.renderer.raycaster.setFromCamera(vector2, this.psv.renderer.camera);\r\n\r\n    return this.psv.renderer.raycaster.intersectObjects(this.psv.renderer.scene.children, true)\r\n      .filter(i => !!i.object.userData);\r\n  }\r\n\r\n  /**\r\n   * @summary Converts x/y to latitude/longitude if present and ensure boundaries\r\n   * @param {PSV.ExtendedPosition} position\r\n   * @returns {PSV.Position}\r\n   */\r\n  cleanPosition(position) {\r\n    if (position.x !== undefined && position.y !== undefined) {\r\n      return this.textureCoordsToSphericalCoords(position);\r\n    }\r\n    else {\r\n      return {\r\n        longitude: parseAngle(position.longitude),\r\n        latitude : parseAngle(position.latitude, true),\r\n      };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @summary Ensure a SphereCorrection object is valid\r\n   * @param {PSV.SphereCorrection} sphereCorrection\r\n   * @returns {PSV.SphereCorrection}\r\n   */\r\n  cleanSphereCorrection(sphereCorrection) {\r\n    return {\r\n      pan : parseAngle(sphereCorrection?.pan || 0),\r\n      tilt: parseAngle(sphereCorrection?.tilt || 0, true),\r\n      roll: parseAngle(sphereCorrection?.roll || 0, true, false),\r\n    };\r\n  }\r\n\r\n  /**\r\n   * @summary Parse the pose angles of the pano data\r\n   * @param {PSV.PanoData} panoData\r\n   * @returns {PSV.SphereCorrection}\r\n   */\r\n  cleanPanoramaPose(panoData) {\r\n    return {\r\n      pan : THREE.MathUtils.degToRad(panoData?.poseHeading || 0),\r\n      tilt: THREE.MathUtils.degToRad(panoData?.posePitch || 0),\r\n      roll: THREE.MathUtils.degToRad(panoData?.poseRoll || 0),\r\n    };\r\n  }\r\n\r\n}\r\n","import * as THREE from 'three';\r\nimport {\r\n  ACTIONS,\r\n  CTRLZOOM_TIMEOUT,\r\n  DBLCLICK_DELAY,\r\n  EVENTS,\r\n  IDS,\r\n  INERTIA_WINDOW,\r\n  KEY_CODES,\r\n  LONGTOUCH_DELAY,\r\n  MOVE_THRESHOLD,\r\n  OBJECT_EVENTS,\r\n  TWOFINGERSOVERLAY_DELAY\r\n} from '../data/constants';\r\nimport { SYSTEM } from '../data/system';\r\nimport gestureIcon from '../icons/gesture.svg';\r\nimport mousewheelIcon from '../icons/mousewheel.svg';\r\nimport { clone, distance, each, getClosest, getPosition, isEmpty, isFullscreenEnabled, normalizeWheel, throttle } from '../utils';\r\nimport { Animation } from '../utils/Animation';\r\nimport { PressHandler } from '../utils/PressHandler';\r\nimport { AbstractService } from './AbstractService';\r\n\r\n/**\r\n * @summary Events handler\r\n * @extends PSV.services.AbstractService\r\n * @memberof PSV.services\r\n */\r\nexport class EventsHandler extends AbstractService {\r\n\r\n  /**\r\n   * @param {PSV.Viewer} psv\r\n   */\r\n  constructor(psv) {\r\n    super(psv);\r\n\r\n    /**\r\n     * @summary Internal properties\r\n     * @member {Object}\r\n     * @property {number} moveThreshold - computed threshold based on device pixel ratio\r\n     * @property {boolean} moving - is the user moving\r\n     * @property {boolean} zooming - is the user zooming\r\n     * @property {number} startMouseX - start x position of the click/touch\r\n     * @property {number} startMouseY - start y position of the click/touch\r\n     * @property {number} mouseX - current x position of the cursor\r\n     * @property {number} mouseY - current y position of the cursor\r\n     * @property {number[][]} mouseHistory - list of latest positions of the cursor, [time, x, y]\r\n     * @property {number} pinchDist - distance between fingers when zooming\r\n     * @property {PressHandler} keyHandler\r\n     * @property {boolean} ctrlKeyDown - when the Ctrl key is pressed\r\n     * @property {PSV.ClickData} dblclickData - temporary storage of click data between two clicks\r\n     * @property {number} dblclickTimeout - timeout id for double click\r\n     * @property {number} twofingersTimeout - timeout id for \"two fingers\" overlay\r\n     * @property {number} ctrlZoomTimeout - timeout id for \"ctrol zoom\" overlay\r\n     * @protected\r\n     */\r\n    this.state = {\r\n      moveThreshold    : MOVE_THRESHOLD * SYSTEM.pixelRatio,\r\n      keyboardEnabled  : false,\r\n      moving           : false,\r\n      zooming          : false,\r\n      startMouseX      : 0,\r\n      startMouseY      : 0,\r\n      mouseX           : 0,\r\n      mouseY           : 0,\r\n      mouseHistory     : [],\r\n      pinchDist        : 0,\r\n      keyHandler       : new PressHandler(),\r\n      ctrlKeyDown      : false,\r\n      dblclickData     : null,\r\n      dblclickTimeout  : null,\r\n      longtouchTimeout : null,\r\n      twofingersTimeout: null,\r\n      ctrlZoomTimeout  : null,\r\n    };\r\n\r\n    /**\r\n     * @summary Throttled wrapper of {@link PSV.Viewer#autoSize}\r\n     * @type {Function}\r\n     * @private\r\n     */\r\n    this.__onResize = throttle(() => this.psv.autoSize(), 50);\r\n  }\r\n\r\n  /**\r\n   * @summary Initializes event handlers\r\n   * @protected\r\n   */\r\n  init() {\r\n    window.addEventListener('resize', this);\r\n    window.addEventListener('keydown', this);\r\n    window.addEventListener('keyup', this);\r\n    this.psv.container.addEventListener('mouseenter', this);\r\n    this.psv.container.addEventListener('mousedown', this);\r\n    this.psv.container.addEventListener('mouseleave', this);\r\n    this.psv.container.addEventListener('mousemove', this);\r\n    window.addEventListener('mouseup', this);\r\n    this.psv.container.addEventListener('touchstart', this);\r\n    this.psv.container.addEventListener('touchmove', this);\r\n    window.addEventListener('touchend', this);\r\n    this.psv.container.addEventListener(SYSTEM.mouseWheelEvent, this);\r\n\r\n    if (SYSTEM.fullscreenEvent) {\r\n      document.addEventListener(SYSTEM.fullscreenEvent, this);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @override\r\n   */\r\n  destroy() {\r\n    window.removeEventListener('resize', this);\r\n    window.removeEventListener('keydown', this);\r\n    window.removeEventListener('keyup', this);\r\n    this.psv.container.removeEventListener('mouseenter', this);\r\n    this.psv.container.removeEventListener('mousedown', this);\r\n    this.psv.container.removeEventListener('mouseleave', this);\r\n    this.psv.container.removeEventListener('mousemove', this);\r\n    window.removeEventListener('mouseup', this);\r\n    this.psv.container.removeEventListener('touchstart', this);\r\n    this.psv.container.removeEventListener('touchmove', this);\r\n    window.removeEventListener('touchend', this);\r\n    this.psv.container.removeEventListener(SYSTEM.mouseWheelEvent, this);\r\n\r\n    if (SYSTEM.fullscreenEvent) {\r\n      document.removeEventListener(SYSTEM.fullscreenEvent, this);\r\n    }\r\n\r\n    clearTimeout(this.state.dblclickTimeout);\r\n    clearTimeout(this.state.longtouchTimeout);\r\n    clearTimeout(this.state.twofingersTimeout);\r\n    clearTimeout(this.state.ctrlZoomTimeout);\r\n\r\n    delete this.state;\r\n\r\n    super.destroy();\r\n  }\r\n\r\n  /**\r\n   * @summary Handles events\r\n   * @param {Event} evt\r\n   * @private\r\n   */\r\n  handleEvent(evt) {\r\n    /* eslint-disable */\r\n    switch (evt.type) {\r\n      // @formatter:off\r\n      case 'resize':   this.__onResize(); break;\r\n      case 'keydown':  this.__onKeyDown(evt); break;\r\n      case 'keyup':    this.__onKeyUp(); break;\r\n      case 'mouseup':  this.__onMouseUp(evt); break;\r\n      case 'touchend': this.__onTouchEnd(evt); break;\r\n      case SYSTEM.fullscreenEvent: this.__fullscreenToggled(); break;\r\n      // @formatter:on\r\n    }\r\n    /* eslint-enable */\r\n\r\n    if (!getClosest(evt.target, '.psv--capture-event')) {\r\n      /* eslint-disable */\r\n      switch (evt.type) {\r\n        // @formatter:off\r\n        case 'mousedown':  this.__onMouseDown(evt); break;\r\n        case 'mouseenter': this.__onMouseEnter(evt); break;\r\n        case 'mouseleave': this.__onMouseLeave(evt); break;\r\n        case 'mousemove':  this.__onMouseMove(evt); break;\r\n        case 'touchstart': this.__onTouchStart(evt); break;\r\n        case 'touchmove':  this.__onTouchMove(evt); break;\r\n        case SYSTEM.mouseWheelEvent: this.__onMouseWheel(evt); break;\r\n        // @formatter:on\r\n      }\r\n      /* eslint-enable */\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @summary Enables the keyboard controls\r\n   * @protected\r\n   */\r\n  enableKeyboard() {\r\n    this.state.keyboardEnabled = true;\r\n  }\r\n\r\n  /**\r\n   * @summary Disables the keyboard controls\r\n   * @protected\r\n   */\r\n  disableKeyboard() {\r\n    this.state.keyboardEnabled = false;\r\n  }\r\n\r\n  /**\r\n   * @summary Handles keyboard events\r\n   * @param {KeyboardEvent} e\r\n   * @private\r\n   */\r\n  __onKeyDown(e) {\r\n    if (this.config.mousewheelCtrlKey) {\r\n      this.state.ctrlKeyDown = e.key === KEY_CODES.Control;\r\n\r\n      if (this.state.ctrlKeyDown) {\r\n        clearTimeout(this.state.ctrlZoomTimeout);\r\n        this.psv.overlay.hide(IDS.CTRL_ZOOM);\r\n      }\r\n    }\r\n\r\n    const e2 = this.psv.trigger(EVENTS.KEY_PRESS, e.key);\r\n    if (e2.isDefaultPrevented()) {\r\n      return;\r\n    }\r\n\r\n    if (!this.state.keyboardEnabled) {\r\n      return;\r\n    }\r\n\r\n    const action = this.config.keyboard[e.key];\r\n    if (action === ACTIONS.TOGGLE_AUTOROTATE) {\r\n      this.psv.toggleAutorotate();\r\n    }\r\n    else if (action && !this.state.keyHandler.time) {\r\n      if (action !== ACTIONS.ZOOM_IN && action !== ACTIONS.ZOOM_OUT) {\r\n        this.psv.__stopAll();\r\n      }\r\n\r\n      /* eslint-disable */\r\n      switch (action) {\r\n        // @formatter:off\r\n        case ACTIONS.ROTATE_LAT_UP: this.psv.dynamics.position.roll({latitude: false}); break;\r\n        case ACTIONS.ROTATE_LAT_DOWN: this.psv.dynamics.position.roll({latitude: true});  break;\r\n        case ACTIONS.ROTATE_LONG_RIGHT: this.psv.dynamics.position.roll({longitude: false}); break;\r\n        case ACTIONS.ROTATE_LONG_LEFT: this.psv.dynamics.position.roll({longitude: true}); break;\r\n        case ACTIONS.ZOOM_IN: this.psv.dynamics.zoom.roll(false); break;\r\n        case ACTIONS.ZOOM_OUT: this.psv.dynamics.zoom.roll(true); break;\r\n        // @formatter:on\r\n      }\r\n      /* eslint-enable */\r\n\r\n      this.state.keyHandler.down();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @summary Handles keyboard events\r\n   * @private\r\n   */\r\n  __onKeyUp() {\r\n    this.state.ctrlKeyDown = false;\r\n\r\n    if (!this.state.keyboardEnabled) {\r\n      return;\r\n    }\r\n\r\n    this.state.keyHandler.up(() => {\r\n      this.psv.dynamics.position.stop();\r\n      this.psv.dynamics.zoom.stop();\r\n      this.psv.resetIdleTimer();\r\n    });\r\n  }\r\n\r\n  /**\r\n   * @summary Handles mouse down events\r\n   * @param {MouseEvent} evt\r\n   * @private\r\n   */\r\n  __onMouseDown(evt) {\r\n    if (!this.config.mousemove || this.config.captureCursor) {\r\n      return;\r\n    }\r\n\r\n    this.__startMove(evt);\r\n  }\r\n\r\n  /**\r\n   * @summary Handles mouse enter events\r\n   * @param {MouseEvent} evt\r\n   * @private\r\n   */\r\n  __onMouseEnter(evt) {\r\n    if (!this.config.mousemove || !this.config.captureCursor) {\r\n      return;\r\n    }\r\n\r\n    this.__startMove(evt);\r\n  }\r\n\r\n  /**\r\n   * @summary Handles mouse up events\r\n   * @param {MouseEvent} evt\r\n   * @private\r\n   */\r\n  __onMouseUp(evt) {\r\n    if (!this.config.mousemove || this.config.captureCursor) {\r\n      return;\r\n    }\r\n\r\n    this.__stopMove(evt);\r\n  }\r\n\r\n  /**\r\n   * @summary Handles mouse leave events\r\n   * @param {MouseEvent} evt\r\n   * @private\r\n   */\r\n  __onMouseLeave(evt) {\r\n    if (!this.config.mousemove || !this.config.captureCursor) {\r\n      return;\r\n    }\r\n\r\n    this.__stopMove(evt);\r\n  }\r\n\r\n  /**\r\n   * @summary Handles mouse move events\r\n   * @param {MouseEvent} evt\r\n   * @private\r\n   */\r\n  __onMouseMove(evt) {\r\n    if (this.config.mousemove) {\r\n      if (evt.buttons !== 0) {\r\n        evt.preventDefault();\r\n        this.__move(evt);\r\n      }\r\n      else if (this.config.captureCursor) {\r\n        this.__moveAbsolute(evt);\r\n      }\r\n    }\r\n\r\n    if (!isEmpty(this.prop.objectsObservers)) {\r\n      const viewerPos = getPosition(this.psv.container);\r\n\r\n      const viewerPoint = {\r\n        x: evt.clientX - viewerPos.left,\r\n        y: evt.clientY - viewerPos.top,\r\n      };\r\n\r\n      const intersections = this.psv.dataHelper.getIntersections(viewerPoint);\r\n\r\n      const emit = (observer, key, type) => {\r\n        observer.listener.handleEvent(new CustomEvent(type, {\r\n          detail: {\r\n            originalEvent: evt,\r\n            object       : observer.object,\r\n            data         : observer.object.userData[key],\r\n            viewerPoint  : viewerPoint,\r\n          },\r\n        }));\r\n      };\r\n\r\n      each(this.prop.objectsObservers, (observer, key) => {\r\n        const intersection = intersections.find(i => i.object.userData[key]);\r\n\r\n        if (intersection) {\r\n          if (observer.object && intersection.object !== observer.object) {\r\n            emit(observer, key, OBJECT_EVENTS.LEAVE_OBJECT);\r\n            delete observer.object;\r\n          }\r\n\r\n          if (!observer.object) {\r\n            observer.object = intersection.object;\r\n            emit(observer, key, OBJECT_EVENTS.ENTER_OBJECT);\r\n          }\r\n          else {\r\n            emit(observer, key, OBJECT_EVENTS.HOVER_OBJECT);\r\n          }\r\n        }\r\n        else if (observer.object) {\r\n          emit(observer, key, OBJECT_EVENTS.LEAVE_OBJECT);\r\n          delete observer.object;\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @summary Handles touch events\r\n   * @param {TouchEvent} evt\r\n   * @private\r\n   */\r\n  __onTouchStart(evt) {\r\n    if (!this.config.mousemove) {\r\n      return;\r\n    }\r\n\r\n    if (evt.touches.length === 1) {\r\n      if (!this.config.touchmoveTwoFingers) {\r\n        this.__startMove(evt.touches[0]);\r\n        evt.preventDefault(); // prevent mouse events emulation\r\n      }\r\n\r\n      if (!this.prop.longtouchTimeout) {\r\n        this.prop.longtouchTimeout = setTimeout(() => {\r\n          this.__click(evt.touches[0], true);\r\n          this.prop.longtouchTimeout = null;\r\n        }, LONGTOUCH_DELAY);\r\n      }\r\n    }\r\n    else if (evt.touches.length === 2) {\r\n      this.__cancelLongTouch();\r\n      this.__cancelTwoFingersOverlay();\r\n      this.__startMoveZoom(evt);\r\n      evt.preventDefault();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @summary Handles touch events\r\n   * @param {TouchEvent} evt\r\n   * @private\r\n   */\r\n  __onTouchEnd(evt) {\r\n    if (!this.config.mousemove) {\r\n      return;\r\n    }\r\n\r\n    this.__cancelLongTouch();\r\n    this.__cancelTwoFingersOverlay();\r\n\r\n    if (evt.touches.length === 1) {\r\n      this.__stopMoveZoom();\r\n    }\r\n    else if (evt.touches.length === 0) {\r\n      this.__stopMove(evt.changedTouches[0]);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @summary Handles touch move events\r\n   * @param {TouchEvent} evt\r\n   * @private\r\n   */\r\n  __onTouchMove(evt) {\r\n    if (!this.config.mousemove) {\r\n      return;\r\n    }\r\n\r\n    this.__cancelLongTouch();\r\n\r\n    if (evt.touches.length === 1) {\r\n      if (this.config.touchmoveTwoFingers) {\r\n        if (!this.prop.twofingersTimeout) {\r\n          this.prop.twofingersTimeout = setTimeout(() => {\r\n            this.psv.overlay.show({\r\n              id   : IDS.TWO_FINGERS,\r\n              image: gestureIcon,\r\n              text : this.config.lang.twoFingers,\r\n            });\r\n          }, TWOFINGERSOVERLAY_DELAY);\r\n        }\r\n      }\r\n      else {\r\n        evt.preventDefault();\r\n        this.__move(evt.touches[0]);\r\n      }\r\n    }\r\n    else if (evt.touches.length === 2) {\r\n      evt.preventDefault();\r\n      this.__moveZoom(evt);\r\n      this.__cancelTwoFingersOverlay();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @summary Cancel the long touch timer if any\r\n   * @private\r\n   */\r\n  __cancelLongTouch() {\r\n    if (this.prop.longtouchTimeout) {\r\n      clearTimeout(this.prop.longtouchTimeout);\r\n      this.prop.longtouchTimeout = null;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @summary Cancel the two fingers overlay timer if any\r\n   * @private\r\n   */\r\n  __cancelTwoFingersOverlay() {\r\n    if (this.prop.twofingersTimeout) {\r\n      clearTimeout(this.prop.twofingersTimeout);\r\n      this.prop.twofingersTimeout = null;\r\n    }\r\n    this.psv.overlay.hide(IDS.TWO_FINGERS);\r\n  }\r\n\r\n  /**\r\n   * @summary Handles mouse wheel events\r\n   * @param {WheelEvent} evt\r\n   * @private\r\n   */\r\n  __onMouseWheel(evt) {\r\n    if (!this.config.mousewheel) {\r\n      return;\r\n    }\r\n\r\n    if (this.config.mousewheelCtrlKey && !this.state.ctrlKeyDown) {\r\n      this.psv.overlay.show({\r\n        id   : IDS.CTRL_ZOOM,\r\n        image: mousewheelIcon,\r\n        text : this.config.lang.ctrlZoom,\r\n      });\r\n\r\n      clearTimeout(this.state.ctrlZoomTimeout);\r\n      this.state.ctrlZoomTimeout = setTimeout(() => this.psv.overlay.hide(IDS.CTRL_ZOOM), CTRLZOOM_TIMEOUT);\r\n\r\n      return;\r\n    }\r\n\r\n    evt.preventDefault();\r\n    evt.stopPropagation();\r\n\r\n    const delta = normalizeWheel(evt).spinY * 5 * this.config.zoomSpeed;\r\n    if (delta !== 0) {\r\n      this.psv.dynamics.zoom.step(-delta, 5);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @summary Handles fullscreen events\r\n   * @param {boolean} [force] force state\r\n   * @fires PSV.fullscreen-updated\r\n   * @package\r\n   */\r\n  __fullscreenToggled(force) {\r\n    this.prop.fullscreen = force !== undefined ? force : isFullscreenEnabled(this.psv.container);\r\n\r\n    if (this.config.keyboard) {\r\n      if (this.prop.fullscreen) {\r\n        this.psv.startKeyboardControl();\r\n      }\r\n      else {\r\n        this.psv.stopKeyboardControl();\r\n      }\r\n    }\r\n\r\n    this.psv.trigger(EVENTS.FULLSCREEN_UPDATED, this.prop.fullscreen);\r\n  }\r\n\r\n  /**\r\n   * @summary Initializes the movement\r\n   * @param {MouseEvent|Touch} evt\r\n   * @private\r\n   */\r\n  __startMove(evt) {\r\n    this.psv.__stopAll()\r\n      .then(() => {\r\n        this.state.mouseX = evt.clientX;\r\n        this.state.mouseY = evt.clientY;\r\n        this.state.startMouseX = this.state.mouseX;\r\n        this.state.startMouseY = this.state.mouseY;\r\n        this.state.moving = true;\r\n        this.state.zooming = false;\r\n\r\n        this.state.mouseHistory.length = 0;\r\n        this.__logMouseMove(evt);\r\n      });\r\n  }\r\n\r\n  /**\r\n   * @summary Initializes the combines move and zoom\r\n   * @param {TouchEvent} evt\r\n   * @private\r\n   */\r\n  __startMoveZoom(evt) {\r\n    this.psv.__stopAll()\r\n      .then(() => {\r\n        const p1 = { x: evt.touches[0].clientX, y: evt.touches[0].clientY };\r\n        const p2 = { x: evt.touches[1].clientX, y: evt.touches[1].clientY };\r\n\r\n        this.state.pinchDist = distance(p1, p2);\r\n        this.state.mouseX = (p1.x + p2.x) / 2;\r\n        this.state.mouseY = (p1.y + p2.y) / 2;\r\n        this.state.startMouseX = this.state.mouseX;\r\n        this.state.startMouseY = this.state.mouseY;\r\n        this.state.moving = true;\r\n        this.state.zooming = true;\r\n      });\r\n  }\r\n\r\n  /**\r\n   * @summary Stops the movement\r\n   * @description If the move threshold was not reached a click event is triggered, otherwise an animation is launched to simulate inertia\r\n   * @param {MouseEvent|Touch} evt\r\n   * @private\r\n   */\r\n  __stopMove(evt) {\r\n    this.psv.resetIdleTimer();\r\n\r\n    if (!getClosest(evt.target, '.psv-container')) {\r\n      this.state.moving = false;\r\n      this.state.mouseHistory.length = 0;\r\n      return;\r\n    }\r\n\r\n    if (this.state.moving) {\r\n      // move threshold to trigger a click\r\n      if (Math.abs(evt.clientX - this.state.startMouseX) < this.state.moveThreshold\r\n        && Math.abs(evt.clientY - this.state.startMouseY) < this.state.moveThreshold) {\r\n        this.__click(evt);\r\n        this.state.moving = false;\r\n      }\r\n      // inertia animation\r\n      else if (this.config.moveInertia) {\r\n        this.__logMouseMove(evt);\r\n        this.__stopMoveInertia(evt);\r\n      }\r\n      else {\r\n        this.state.moving = false;\r\n      }\r\n\r\n      this.state.mouseHistory.length = 0;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @summary Stops the combined move and zoom\r\n   * @private\r\n   */\r\n  __stopMoveZoom() {\r\n    this.psv.resetIdleTimer();\r\n    this.state.mouseHistory.length = 0;\r\n    this.state.moving = false;\r\n    this.state.zooming = false;\r\n  }\r\n\r\n  /**\r\n   * @summary Performs an animation to simulate inertia when the movement stops\r\n   * @param {MouseEvent|Touch} evt\r\n   * @private\r\n   */\r\n  __stopMoveInertia(evt) {\r\n    const direction = {\r\n      x: evt.clientX - this.state.mouseHistory[0][1],\r\n      y: evt.clientY - this.state.mouseHistory[0][2],\r\n    };\r\n\r\n    const norm = Math.sqrt(direction.x * direction.x + direction.y * direction.y);\r\n\r\n    this.prop.animationPromise = new Animation({\r\n      properties: {\r\n        clientX: { start: evt.clientX, end: evt.clientX + direction.x },\r\n        clientY: { start: evt.clientY, end: evt.clientY + direction.y },\r\n      },\r\n      duration  : norm * INERTIA_WINDOW / 100,\r\n      easing    : 'outCirc',\r\n      onTick    : (properties) => {\r\n        this.__move(properties, false);\r\n      },\r\n    });\r\n\r\n    this.prop.animationPromise\r\n      .then(() => {\r\n        this.state.moving = false;\r\n      });\r\n  }\r\n\r\n  /**\r\n   * @summary Triggers an event with all coordinates when a simple click is performed\r\n   * @param {MouseEvent|Touch} evt\r\n   * @param {boolean} [longtouch=false]\r\n   * @fires PSV.click\r\n   * @fires PSV.dblclick\r\n   * @private\r\n   */\r\n  __click(evt, longtouch = false) {\r\n    const boundingRect = this.psv.container.getBoundingClientRect();\r\n\r\n    /**\r\n     * @type {PSV.ClickData}\r\n     */\r\n    const data = {\r\n      rightclick: longtouch || evt.button === 2,\r\n      target    : evt.target,\r\n      clientX   : evt.clientX,\r\n      clientY   : evt.clientY,\r\n      viewerX   : evt.clientX - boundingRect.left,\r\n      viewerY   : evt.clientY - boundingRect.top,\r\n    };\r\n\r\n    const intersections = this.psv.dataHelper.getIntersections({\r\n      x: data.viewerX,\r\n      y: data.viewerY,\r\n    });\r\n\r\n    const sphereIntersection = intersections.find(i => i.object.userData.psvSphere);\r\n\r\n    if (sphereIntersection) {\r\n      const sphericalCoords = this.psv.dataHelper.vector3ToSphericalCoords(sphereIntersection.point);\r\n      data.longitude = sphericalCoords.longitude;\r\n      data.latitude = sphericalCoords.latitude;\r\n\r\n      data.objects = intersections.map(i => i.object).filter(o => !o.userData.psvSphere);\r\n\r\n      try {\r\n        const textureCoords = this.psv.dataHelper.sphericalCoordsToTextureCoords(data);\r\n        data.textureX = textureCoords.x;\r\n        data.textureY = textureCoords.y;\r\n      }\r\n      catch (e) {\r\n        data.textureX = NaN;\r\n        data.textureY = NaN;\r\n      }\r\n\r\n      if (!this.state.dblclickTimeout) {\r\n        this.psv.trigger(EVENTS.CLICK, data);\r\n\r\n        this.state.dblclickData = clone(data);\r\n        this.state.dblclickTimeout = setTimeout(() => {\r\n          this.state.dblclickTimeout = null;\r\n          this.state.dblclickData = null;\r\n        }, DBLCLICK_DELAY);\r\n      }\r\n      else {\r\n        if (Math.abs(this.state.dblclickData.clientX - data.clientX) < this.state.moveThreshold\r\n          && Math.abs(this.state.dblclickData.clientY - data.clientY) < this.state.moveThreshold) {\r\n          this.psv.trigger(EVENTS.DOUBLE_CLICK, this.state.dblclickData);\r\n        }\r\n\r\n        clearTimeout(this.state.dblclickTimeout);\r\n        this.state.dblclickTimeout = null;\r\n        this.state.dblclickData = null;\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @summary Performs movement\r\n   * @param {MouseEvent|Touch} evt\r\n   * @param {boolean} [log=true]\r\n   * @private\r\n   */\r\n  __move(evt, log) {\r\n    if (this.state.moving) {\r\n      const x = evt.clientX;\r\n      const y = evt.clientY;\r\n\r\n      const rotation = {\r\n        longitude: (x - this.state.mouseX) / this.prop.size.width * this.config.moveSpeed * THREE.MathUtils.degToRad(this.prop.hFov),\r\n        latitude : (y - this.state.mouseY) / this.prop.size.height * this.config.moveSpeed * THREE.MathUtils.degToRad(this.prop.vFov),\r\n      };\r\n\r\n      const currentPosition = this.psv.getPosition();\r\n      this.psv.rotate({\r\n        longitude: currentPosition.longitude - rotation.longitude,\r\n        latitude : currentPosition.latitude + rotation.latitude,\r\n      });\r\n\r\n      this.state.mouseX = x;\r\n      this.state.mouseY = y;\r\n\r\n      if (log !== false) {\r\n        this.__logMouseMove(evt);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @summary Performs movement absolute to cursor position in viewer\r\n   * @param {MouseEvent} evt\r\n   * @private\r\n   */\r\n  __moveAbsolute(evt) {\r\n    if (this.state.moving) {\r\n      const containerRect = this.psv.container.getBoundingClientRect();\r\n      this.psv.dynamics.position.goto({\r\n        longitude: ((evt.clientX - containerRect.left) / containerRect.width - 0.5) * Math.PI * 2,\r\n        latitude : -((evt.clientY - containerRect.top) / containerRect.height - 0.5) * Math.PI,\r\n      }, 10);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @summary Perfoms combined move and zoom\r\n   * @param {TouchEvent} evt\r\n   * @private\r\n   */\r\n  __moveZoom(evt) {\r\n    if (this.state.zooming && this.state.moving) {\r\n      const p1 = { x: evt.touches[0].clientX, y: evt.touches[0].clientY };\r\n      const p2 = { x: evt.touches[1].clientX, y: evt.touches[1].clientY };\r\n\r\n      const p = distance(p1, p2);\r\n      const delta = 80 * (p - this.state.pinchDist) / this.prop.size.width * this.config.zoomSpeed;\r\n\r\n      this.psv.zoom(this.psv.getZoomLevel() + delta);\r\n\r\n      this.__move({\r\n        clientX: (p1.x + p2.x) / 2,\r\n        clientY: (p1.y + p2.y) / 2,\r\n      });\r\n\r\n      this.state.pinchDist = p;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @summary Stores each mouse position during a mouse move\r\n   * @description Positions older than \"INERTIA_WINDOW\" are removed<br>\r\n   *     Positions before a pause of \"INERTIA_WINDOW\" / 10 are removed\r\n   * @param {MouseEvent|Touch} evt\r\n   * @private\r\n   */\r\n  __logMouseMove(evt) {\r\n    const now = Date.now();\r\n    this.state.mouseHistory.push([now, evt.clientX, evt.clientY]);\r\n\r\n    let previous = null;\r\n\r\n    for (let i = 0; i < this.state.mouseHistory.length;) {\r\n      if (this.state.mouseHistory[0][i] < now - INERTIA_WINDOW) {\r\n        this.state.mouseHistory.splice(i, 1);\r\n      }\r\n      else if (previous && this.state.mouseHistory[0][i] - previous > INERTIA_WINDOW / 10) {\r\n        this.state.mouseHistory.splice(0, i);\r\n        i = 0;\r\n        previous = this.state.mouseHistory[0][i];\r\n      }\r\n      else {\r\n        i++;\r\n        previous = this.state.mouseHistory[0][i];\r\n      }\r\n    }\r\n  }\r\n\r\n}\r\n","import * as THREE from 'three';\r\nimport { Animation } from '../utils/Animation';\r\nimport { EVENTS, MESH_USER_DATA, SPHERE_RADIUS } from '../data/constants';\r\nimport { SYSTEM } from '../data/system';\r\nimport { each, isExtendedPosition } from '../utils';\r\nimport { AbstractService } from './AbstractService';\r\n\r\n/**\r\n * @summary Viewer and renderer\r\n * @extends PSV.services.AbstractService\r\n * @memberof PSV.services\r\n */\r\nexport class Renderer extends AbstractService {\r\n\r\n  /**\r\n   * @param {PSV.Viewer} psv\r\n   */\r\n  constructor(psv) {\r\n    super(psv);\r\n\r\n    /**\r\n     * @member {external:THREE.WebGLRenderer}\r\n     * @readonly\r\n     * @protected\r\n     */\r\n    this.renderer = new THREE.WebGLRenderer({ alpha: true, antialias: true });\r\n    this.renderer.setPixelRatio(SYSTEM.pixelRatio);\r\n    this.renderer.domElement.className = 'psv-canvas';\r\n\r\n    /**\r\n     * @member {external:THREE.Scene}\r\n     * @readonly\r\n     * @protected\r\n     */\r\n    this.scene = new THREE.Scene();\r\n\r\n    /**\r\n     * @member {external:THREE.PerspectiveCamera}\r\n     * @readonly\r\n     * @protected\r\n     */\r\n    this.camera = new THREE.PerspectiveCamera(50, 16 / 9, 1, 2 * SPHERE_RADIUS);\r\n\r\n    /**\r\n     * @member {external:THREE.Mesh}\r\n     * @readonly\r\n     * @protected\r\n     */\r\n    this.mesh = this.psv.adapter.createMesh();\r\n    this.mesh.userData = { [MESH_USER_DATA]: true };\r\n\r\n    /**\r\n     * @member {external:THREE.Group}\r\n     * @readonly\r\n     * @private\r\n     */\r\n    this.meshContainer = new THREE.Group();\r\n    this.meshContainer.add(this.mesh);\r\n    this.scene.add(this.meshContainer);\r\n\r\n    /**\r\n     * @member {external:THREE.Raycaster}\r\n     * @readonly\r\n     * @protected\r\n     */\r\n    this.raycaster = new THREE.Raycaster();\r\n\r\n    /**\r\n     * @member {number}\r\n     * @private\r\n     */\r\n    this.timestamp = null;\r\n\r\n    /**\r\n     * @member {boolean}\r\n     * @private\r\n     */\r\n    this.ready = false;\r\n\r\n    /**\r\n     * @member {HTMLElement}\r\n     * @readonly\r\n     * @package\r\n     */\r\n    this.canvasContainer = document.createElement('div');\r\n    this.canvasContainer.className = 'psv-canvas-container';\r\n    this.canvasContainer.style.background = this.psv.config.canvasBackground;\r\n    this.canvasContainer.style.cursor = this.psv.config.mousemove ? 'move' : 'default';\r\n    this.canvasContainer.appendChild(this.renderer.domElement);\r\n    this.psv.container.appendChild(this.canvasContainer);\r\n\r\n    psv.on(EVENTS.SIZE_UPDATED, this);\r\n    psv.on(EVENTS.ZOOM_UPDATED, this);\r\n    psv.on(EVENTS.POSITION_UPDATED, this);\r\n    psv.on(EVENTS.CONFIG_CHANGED, this);\r\n\r\n    this.hide();\r\n  }\r\n\r\n  /**\r\n   * @override\r\n   */\r\n  destroy() {\r\n    // cancel render loop\r\n    this.renderer.setAnimationLoop(null);\r\n\r\n    // destroy ThreeJS view\r\n    this.__cleanTHREEScene(this.scene);\r\n\r\n    // remove container\r\n    this.psv.container.removeChild(this.canvasContainer);\r\n\r\n    delete this.canvasContainer;\r\n    delete this.renderer;\r\n    delete this.scene;\r\n    delete this.camera;\r\n    delete this.mesh;\r\n    delete this.meshContainer;\r\n    delete this.raycaster;\r\n\r\n    super.destroy();\r\n  }\r\n\r\n  /**\r\n   * @summary Handles events\r\n   * @param {Event} evt\r\n   * @private\r\n   */\r\n  handleEvent(evt) {\r\n    /* eslint-disable */\r\n    switch (evt.type) {\r\n      // @formatter:off\r\n      case EVENTS.SIZE_UPDATED:     this.__onSizeUpdated(); break;\r\n      case EVENTS.ZOOM_UPDATED:     this.__onZoomUpdated(); break;\r\n      case EVENTS.POSITION_UPDATED: this.__onPositionUpdated(); break;\r\n      case EVENTS.CONFIG_CHANGED:\r\n        if (evt.args[0].includes('fisheye')) {\r\n          this.__onPositionUpdated();\r\n        }\r\n        if (evt.args[0].includes('mousemove')) {\r\n          this.canvasContainer.style.cursor = this.psv.config.mousemove ? 'move' : 'default';\r\n        }\r\n        break;\r\n      // @formatter:on\r\n    }\r\n    /* eslint-enable */\r\n  }\r\n\r\n  /**\r\n   * @summary Hides the viewer\r\n   */\r\n  hide() {\r\n    this.canvasContainer.style.opacity = 0;\r\n  }\r\n\r\n  /**\r\n   * @summary Shows the viewer\r\n   */\r\n  show() {\r\n    this.canvasContainer.style.opacity = 1;\r\n  }\r\n\r\n  /**\r\n   * @summary Updates the size of the renderer and the aspect of the camera\r\n   * @private\r\n   */\r\n  __onSizeUpdated() {\r\n    this.renderer.setSize(this.prop.size.width, this.prop.size.height);\r\n    this.camera.aspect = this.prop.aspect;\r\n    this.camera.updateProjectionMatrix();\r\n    this.prop.needsUpdate = true;\r\n  }\r\n\r\n  /**\r\n   * @summary Updates the fov of the camera\r\n   * @private\r\n   */\r\n  __onZoomUpdated() {\r\n    this.camera.fov = this.prop.vFov;\r\n    this.camera.updateProjectionMatrix();\r\n    this.prop.needsUpdate = true;\r\n  }\r\n\r\n  /**\r\n   * @summary Updates the position of the camera\r\n   * @private\r\n   */\r\n  __onPositionUpdated() {\r\n    this.camera.position.set(0, 0, 0);\r\n    this.camera.lookAt(this.prop.direction);\r\n    if (this.config.fisheye) {\r\n      this.camera.position.copy(this.prop.direction).multiplyScalar(this.config.fisheye / 2).negate();\r\n    }\r\n    this.prop.needsUpdate = true;\r\n  }\r\n\r\n  /**\r\n   * @summary Main event loop, calls {@link render} if `prop.needsUpdate` is true\r\n   * @param {number} timestamp\r\n   * @fires PSV.before-render\r\n   * @private\r\n   */\r\n  __renderLoop(timestamp) {\r\n    const elapsed = this.timestamp !== null ? timestamp - this.timestamp : 0;\r\n    this.timestamp = timestamp;\r\n\r\n    this.psv.trigger(EVENTS.BEFORE_RENDER, timestamp, elapsed);\r\n    each(this.psv.dynamics, d => d.update(elapsed));\r\n\r\n    if (this.prop.idleTime > 0 && timestamp - this.prop.idleTime > this.config.autorotateDelay) {\r\n      this.psv.startAutorotate();\r\n    }\r\n\r\n    if (this.prop.needsUpdate) {\r\n      this.render();\r\n      this.prop.needsUpdate = false;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @summary Performs a render\r\n   * @description Do not call this method directly, instead call\r\n   * {@link PSV.Viewer#needsUpdate} on {@link PSV.event:before-render}.\r\n   * @fires PSV.render\r\n   */\r\n  render() {\r\n    this.renderer.render(this.scene, this.camera);\r\n    this.psv.trigger(EVENTS.RENDER);\r\n  }\r\n\r\n  /**\r\n   * @summary Applies the texture to the scene, creates the scene if needed\r\n   * @param {PSV.TextureData} textureData\r\n   * @fires PSV.panorama-loaded\r\n   * @package\r\n   */\r\n  setTexture(textureData) {\r\n    this.prop.panoData = textureData.panoData;\r\n\r\n    this.psv.adapter.setTexture(this.mesh, textureData);\r\n\r\n    if (!this.ready) {\r\n      this.renderer.setAnimationLoop(t => this.__renderLoop(t));\r\n      this.ready = true;\r\n    }\r\n\r\n    this.psv.needsUpdate();\r\n\r\n    this.psv.trigger(EVENTS.PANORAMA_LOADED, textureData);\r\n  }\r\n\r\n  /**\r\n   * @summary Apply a panorama data pose to a Mesh\r\n   * @param {PSV.PanoData} [panoData]\r\n   * @param {external:THREE.Mesh} [mesh=this.mesh]\r\n   * @package\r\n   */\r\n  setPanoramaPose(panoData, mesh = this.mesh) {\r\n    // By Google documentation the angles are applied on the camera in order : heading, pitch, roll\r\n    // here we apply the reverse transformation on the sphere\r\n    const cleanCorrection = this.psv.dataHelper.cleanPanoramaPose(panoData);\r\n\r\n    mesh.rotation.set(\r\n      -cleanCorrection.tilt,\r\n      -cleanCorrection.pan,\r\n      -cleanCorrection.roll,\r\n      'ZXY'\r\n    );\r\n  }\r\n\r\n  /**\r\n   * @summary Apply a SphereCorrection to a Mesh\r\n   * @param {PSV.SphereCorrection} [sphereCorrection]\r\n   * @param {external:THREE.Mesh} [mesh=this.meshContainer]\r\n   * @package\r\n   */\r\n  setSphereCorrection(sphereCorrection, mesh = this.meshContainer) {\r\n    const cleanCorrection = this.psv.dataHelper.cleanSphereCorrection(sphereCorrection);\r\n\r\n    mesh.rotation.set(\r\n      cleanCorrection.tilt,\r\n      cleanCorrection.pan,\r\n      cleanCorrection.roll,\r\n      'ZXY'\r\n    );\r\n  }\r\n\r\n  /**\r\n   * @summary Performs transition between the current and a new texture\r\n   * @param {PSV.TextureData} textureData\r\n   * @param {PSV.PanoramaOptions} options\r\n   * @returns {PSV.Animation}\r\n   * @package\r\n   */\r\n  transition(textureData, options) {\r\n    const positionProvided = isExtendedPosition(options);\r\n    const zoomProvided = 'zoom' in options;\r\n\r\n    // create temp group and new mesh, half size to be in \"front\" of the first one\r\n    const group = new THREE.Group();\r\n    const mesh = this.psv.adapter.createMesh(0.5);\r\n    this.psv.adapter.setTexture(mesh, textureData, true);\r\n    this.psv.adapter.setTextureOpacity(mesh, 0);\r\n    this.setPanoramaPose(textureData.panoData, mesh);\r\n    this.setSphereCorrection(options.sphereCorrection, group);\r\n\r\n    // rotate the new sphere to make the target position face the camera\r\n    if (positionProvided) {\r\n      const cleanPosition = this.psv.dataHelper.cleanPosition(options);\r\n      const currentPosition = this.psv.getPosition();\r\n\r\n      // Longitude rotation along the vertical axis\r\n      const verticalAxis = new THREE.Vector3(0, 1, 0);\r\n      group.rotateOnWorldAxis(verticalAxis, cleanPosition.longitude - currentPosition.longitude);\r\n\r\n      // Latitude rotation along the camera horizontal axis\r\n      const horizontalAxis = new THREE.Vector3(0, 1, 0).cross(this.camera.getWorldDirection(new THREE.Vector3())).normalize();\r\n      group.rotateOnWorldAxis(horizontalAxis, cleanPosition.latitude - currentPosition.latitude);\r\n    }\r\n\r\n    group.add(mesh);\r\n    this.scene.add(group);\r\n\r\n    const animation = new Animation({\r\n      properties: {\r\n        opacity: { start: 0.0, end: 1.0 },\r\n        zoom   : zoomProvided ? { start: this.psv.getZoomLevel(), end: options.zoom } : undefined,\r\n      },\r\n      duration  : options.transition,\r\n      easing    : 'outCubic',\r\n      onTick    : (properties) => {\r\n        this.psv.adapter.setTextureOpacity(mesh, properties.opacity);\r\n        this.psv.adapter.setTextureOpacity(this.mesh, 1 - properties.opacity);\r\n\r\n        if (zoomProvided) {\r\n          this.psv.zoom(properties.zoom);\r\n        }\r\n\r\n        this.psv.needsUpdate();\r\n      },\r\n    });\r\n\r\n    animation\r\n      .then((completed) => {\r\n        if (completed) {\r\n          // remove temp sphere and transfer the texture to the main mesh\r\n          this.setTexture(textureData);\r\n          this.psv.adapter.setTextureOpacity(this.mesh, 1);\r\n          this.setPanoramaPose(textureData.panoData);\r\n          this.setSphereCorrection(options.sphereCorrection);\r\n\r\n          // actually rotate the camera\r\n          if (positionProvided) {\r\n            this.psv.rotate(options);\r\n          }\r\n        }\r\n        else {\r\n          this.psv.adapter.disposeTexture(textureData);\r\n        }\r\n\r\n        this.scene.remove(group);\r\n        mesh.geometry.dispose();\r\n        mesh.geometry = null;\r\n      });\r\n\r\n    return animation;\r\n  }\r\n\r\n  /**\r\n   * @summary Calls `dispose` on all objects and textures\r\n   * @param {external:THREE.Object3D} object\r\n   * @private\r\n   */\r\n  __cleanTHREEScene(object) {\r\n    object.traverse((item) => {\r\n      if (item.geometry) {\r\n        item.geometry.dispose();\r\n      }\r\n\r\n      if (item.material) {\r\n        if (Array.isArray(item.material)) {\r\n          item.material.forEach((material) => {\r\n            if (material.map) {\r\n              material.map.dispose();\r\n            }\r\n\r\n            material.dispose();\r\n          });\r\n        }\r\n        else {\r\n          if (item.material.map) {\r\n            item.material.map.dispose();\r\n          }\r\n\r\n          item.material.dispose();\r\n        }\r\n      }\r\n\r\n      if (item.dispose && !(item instanceof THREE.Scene)) {\r\n        item.dispose();\r\n      }\r\n\r\n      if (item !== object) {\r\n        this.__cleanTHREEScene(item);\r\n      }\r\n    });\r\n  }\r\n\r\n}\r\n","import * as THREE from 'three';\r\nimport { AbstractService } from './AbstractService';\r\n\r\n/**\r\n * @summary Texture loader\r\n * @extends PSV.services.AbstractService\r\n * @memberof PSV.services\r\n */\r\nexport class TextureLoader extends AbstractService {\r\n\r\n  /**\r\n   * @param {PSV.Viewer} psv\r\n   */\r\n  constructor(psv) {\r\n    super(psv);\r\n\r\n    /**\r\n     * @summary THREE file loader\r\n     * @type {external:THREE:FileLoader}\r\n     * @private\r\n     */\r\n    this.loader = new THREE.FileLoader();\r\n    this.loader.setResponseType('blob');\r\n    if (this.config.withCredentials) {\r\n      this.loader.setWithCredentials(true);\r\n    }\r\n    if (this.config.requestHeaders && typeof this.config.requestHeaders === 'object') {\r\n      this.loader.setRequestHeader(this.config.requestHeaders);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @override\r\n   */\r\n  destroy() {\r\n    this.abortLoading();\r\n    super.destroy();\r\n  }\r\n\r\n  /**\r\n   * @summary Loads the panorama texture(s)\r\n   * @param {*} panorama\r\n   * @param {PSV.PanoData | PSV.PanoDataProvider} [newPanoData]\r\n   * @returns {Promise.<PSV.TextureData>}\r\n   * @throws {PSV.PSVError} when the image cannot be loaded\r\n   * @package\r\n   * @deprecated\r\n   */\r\n  loadTexture(panorama, newPanoData) {\r\n    return this.psv.adapter.loadTexture(panorama, newPanoData);\r\n  }\r\n\r\n  /**\r\n   * @summary Cancels current HTTP requests\r\n   * @package\r\n   */\r\n  abortLoading() {\r\n    // noop implementation waiting for https://github.com/mrdoob/three.js/pull/23070\r\n  }\r\n\r\n  /**\r\n   * @summary Loads a Blob with FileLoader\r\n   * @param {string} url\r\n   * @param {function(number)} [onProgress]\r\n   * @returns {Promise<Blob>}\r\n   */\r\n  loadFile(url, onProgress) {\r\n    if (this.config.requestHeaders && typeof this.config.requestHeaders === 'function') {\r\n      this.loader.setRequestHeader(this.config.requestHeaders(url));\r\n    }\r\n\r\n    return new Promise((resolve, reject) => {\r\n      let progress = 0;\r\n      onProgress && onProgress(progress);\r\n\r\n      this.loader.load(\r\n        url,\r\n        (result) => {\r\n          progress = 100;\r\n          onProgress && onProgress(progress);\r\n          resolve(result);\r\n        },\r\n        (e) => {\r\n          if (e.lengthComputable) {\r\n            const newProgress = e.loaded / e.total * 100;\r\n            if (newProgress > progress) {\r\n              progress = newProgress;\r\n              onProgress && onProgress(progress);\r\n            }\r\n          }\r\n        },\r\n        (err) => {\r\n          reject(err);\r\n        }\r\n      );\r\n    });\r\n  }\r\n\r\n  /**\r\n   * @summary Loads an Image using FileLoader to have progress events\r\n   * @param {string} url\r\n   * @param {function(number)} [onProgress]\r\n   * @returns {Promise<HTMLImageElement>}\r\n   */\r\n  loadImage(url, onProgress) {\r\n    return this.loadFile(url, onProgress)\r\n      .then(result => new Promise((resolve, reject) => {\r\n        const img = document.createElementNS('http://www.w3.org/1999/xhtml', 'img');\r\n        img.onload = () => {\r\n          URL.revokeObjectURL(img.src);\r\n          resolve(img);\r\n        };\r\n        img.onerror = reject;\r\n        img.src = URL.createObjectURL(result);\r\n      }));\r\n  }\r\n\r\n  /**\r\n   * @summary Preload a panorama file without displaying it\r\n   * @param {*} panorama\r\n   * @returns {Promise}\r\n   */\r\n  preloadPanorama(panorama) {\r\n    if (this.psv.adapter.supportsPreload(panorama)) {\r\n      return this.psv.adapter.loadTexture(panorama);\r\n    }\r\n    else {\r\n      return Promise.resolve();\r\n    }\r\n  }\r\n\r\n}\r\n","import { EVENTS } from '../data/constants';\r\nimport { PSVError } from '../PSVError';\r\nimport { addClasses, cleanPosition } from '../utils';\r\nimport { AbstractComponent } from './AbstractComponent';\r\n\r\nconst STATE = { NONE: 0, SHOWING: 1, HIDING: 2, READY: 3 };\r\n\r\n/**\r\n * @typedef {Object} PSV.components.Tooltip.Position\r\n * @summary Object defining the tooltip position\r\n * @property {number} top - Position of the tip of the arrow of the tooltip, in pixels\r\n * @property {number} left - Position of the tip of the arrow of the tooltip, in pixels\r\n * @property {string|string[]} [position='top center'] - Tooltip position toward it's arrow tip.\r\n *           Accepted values are combinations of `top`, `center`, `bottom` and `left`, `center`, `right`\r\n * @property {Object} [box] - Used when displaying a tooltip on a marker\r\n * @property {number} [box.width=0]\r\n * @property {number} [box.height=0]\r\n */\r\n\r\n/**\r\n * @typedef {PSV.components.Tooltip.Position} PSV.components.Tooltip.Config\r\n * @summary Object defining the tooltip configuration\r\n * @property {string} content - HTML content of the tooltip\r\n * @property {string} [className] - Additional CSS class added to the tooltip\r\n * @property {*} [data] - Userdata associated to the tooltip\r\n */\r\n\r\n/**\r\n * @summary Tooltip component\r\n * @description Never instanciate tooltips directly use {@link PSV.services.TooltipRenderer} instead\r\n * @extends PSV.components.AbstractComponent\r\n * @memberof PSV.components\r\n */\r\nexport class Tooltip extends AbstractComponent {\r\n\r\n  /**\r\n   * @param {PSV.Viewer} psv\r\n   * @param {{arrow: number, offset: number}} size\r\n   */\r\n  constructor(psv, size) {\r\n    super(psv, 'psv-tooltip');\r\n\r\n    /**\r\n     * @override\r\n     * @property {number} arrow\r\n     * @property {number} offset\r\n     * @property {number} width\r\n     * @property {number} height\r\n     * @property {string} pos\r\n     * @property {string} state\r\n     * @property {*} data\r\n     */\r\n    this.prop = {\r\n      ...this.prop,\r\n      ...size,\r\n      state : STATE.NONE,\r\n      width : 0,\r\n      height: 0,\r\n      pos   : '',\r\n      config: null,\r\n      data  : null,\r\n    };\r\n\r\n    /**\r\n     * Tooltip content\r\n     * @member {HTMLElement}\r\n     * @readonly\r\n     * @private\r\n     */\r\n    this.content = document.createElement('div');\r\n    this.content.className = 'psv-tooltip-content';\r\n    this.container.appendChild(this.content);\r\n\r\n    /**\r\n     * Tooltip arrow\r\n     * @member {HTMLElement}\r\n     * @readonly\r\n     * @package\r\n     */\r\n    this.arrow = document.createElement('div');\r\n    this.arrow.className = 'psv-tooltip-arrow';\r\n    this.container.appendChild(this.arrow);\r\n\r\n    this.container.addEventListener('transitionend', this);\r\n\r\n    this.container.style.top = '-1000px';\r\n    this.container.style.left = '-1000px';\r\n  }\r\n\r\n  /**\r\n   * @override\r\n   */\r\n  destroy() {\r\n    delete this.arrow;\r\n    delete this.content;\r\n\r\n    super.destroy();\r\n  }\r\n\r\n  /**\r\n   * @summary Handles events\r\n   * @param {Event} e\r\n   * @private\r\n   */\r\n  handleEvent(e) {\r\n    /* eslint-disable */\r\n    switch (e.type) {\r\n      // @formatter:off\r\n      case 'transitionend': this.__onTransitionEnd(e); break;\r\n      // @formatter:on\r\n    }\r\n    /* eslint-enable */\r\n  }\r\n\r\n  /**\r\n   * @override\r\n   * @summary This method is not supported\r\n   * @throws {PSV.PSVError} always\r\n   */\r\n  toggle() {\r\n    throw new PSVError('Tooltip cannot be toggled');\r\n  }\r\n\r\n  /**\r\n   * @summary Displays the tooltip on the viewer\r\n   * Do not call this method directly, use {@link PSV.services.TooltipRenderer} instead.\r\n   * @param {PSV.components.Tooltip.Config} config\r\n   *\r\n   * @fires PSV.show-tooltip\r\n   * @throws {PSV.PSVError} when the configuration is incorrect\r\n   *\r\n   * @package\r\n   */\r\n  show(config) {\r\n    if (this.prop.state !== STATE.NONE) {\r\n      throw new PSVError('Initialized tooltip cannot be re-initialized');\r\n    }\r\n\r\n    if (config.className) {\r\n      addClasses(this.container, config.className);\r\n    }\r\n\r\n    this.content.innerHTML = config.content;\r\n\r\n    const rect = this.container.getBoundingClientRect();\r\n    this.prop.width = rect.right - rect.left;\r\n    this.prop.height = rect.bottom - rect.top;\r\n\r\n    this.prop.state = STATE.READY;\r\n\r\n    this.move(config);\r\n\r\n    this.prop.data = config.data;\r\n    this.prop.state = STATE.SHOWING;\r\n\r\n    this.psv.trigger(EVENTS.SHOW_TOOLTIP, this.prop.data, this);\r\n\r\n    this.__waitImages();\r\n  }\r\n\r\n  /**\r\n   * @summary Moves the tooltip to a new position\r\n   * @param {PSV.components.Tooltip.Position} config\r\n   *\r\n   * @throws {PSV.PSVError} when the configuration is incorrect\r\n   */\r\n  move(config) {\r\n    if (this.prop.state !== STATE.SHOWING && this.prop.state !== STATE.READY) {\r\n      throw new PSVError('Uninitialized tooltip cannot be moved');\r\n    }\r\n\r\n    this.config = config;\r\n\r\n    const t = this.container;\r\n    const a = this.arrow;\r\n\r\n    // compute size\r\n    const style = {\r\n      posClass : cleanPosition(config.position, 'top center', false),\r\n      width    : this.prop.width,\r\n      height   : this.prop.height,\r\n      top      : 0,\r\n      left     : 0,\r\n      arrowTop : 0,\r\n      arrowLeft: 0,\r\n    };\r\n\r\n    // set initial position\r\n    this.__computeTooltipPosition(style, config);\r\n\r\n    // correct position if overflow\r\n    let refresh = false;\r\n    if (style.top < this.prop.offset) {\r\n      style.posClass[0] = 'bottom';\r\n      refresh = true;\r\n    }\r\n    else if (style.top + style.height > this.psv.prop.size.height - this.prop.offset) {\r\n      style.posClass[0] = 'top';\r\n      refresh = true;\r\n    }\r\n    if (style.left < this.prop.offset) {\r\n      style.posClass[1] = 'right';\r\n      refresh = true;\r\n    }\r\n    else if (style.left + style.width > this.psv.prop.size.width - this.prop.offset) {\r\n      style.posClass[1] = 'left';\r\n      refresh = true;\r\n    }\r\n    if (refresh) {\r\n      this.__computeTooltipPosition(style, config);\r\n    }\r\n\r\n    // apply position\r\n    t.style.top = style.top + 'px';\r\n    t.style.left = style.left + 'px';\r\n\r\n    a.style.top = style.arrowTop + 'px';\r\n    a.style.left = style.arrowLeft + 'px';\r\n\r\n    const newPos = style.posClass.join('-');\r\n    if (newPos !== this.prop.pos) {\r\n      t.classList.remove(`psv-tooltip--${this.prop.pos}`);\r\n\r\n      this.prop.pos = newPos;\r\n      t.classList.add(`psv-tooltip--${this.prop.pos}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @summary Hides the tooltip\r\n   * @fires PSV.hide-tooltip\r\n   */\r\n  hide() {\r\n    this.container.classList.remove('psv-tooltip--visible');\r\n    this.prop.state = STATE.HIDING;\r\n\r\n    this.psv.trigger(EVENTS.HIDE_TOOLTIP, this.prop.data);\r\n  }\r\n\r\n  /**\r\n   * @summary Finalize transition\r\n   * @param {TransitionEvent} e\r\n   * @private\r\n   */\r\n  __onTransitionEnd(e) {\r\n    if (e.propertyName === 'transform') {\r\n      switch (this.prop.state) {\r\n        case STATE.SHOWING:\r\n          this.container.classList.add('psv-tooltip--visible');\r\n          this.prop.state = STATE.READY;\r\n          break;\r\n\r\n        case STATE.HIDING:\r\n          this.prop.state = STATE.NONE;\r\n          this.destroy();\r\n          break;\r\n\r\n        default:\r\n        // nothing\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @summary Computes the position of the tooltip and its arrow\r\n   * @param {Object} style\r\n   * @param {Object} config\r\n   * @private\r\n   */\r\n  __computeTooltipPosition(style, config) {\r\n    let topBottom = false;\r\n\r\n    if (!config.box) {\r\n      config.box = {\r\n        width : 0,\r\n        height: 0,\r\n      };\r\n    }\r\n\r\n    switch (style.posClass[0]) {\r\n      case 'bottom':\r\n        style.top = config.top + config.box.height + this.prop.offset + this.prop.arrow;\r\n        style.arrowTop = -this.prop.arrow * 2;\r\n        topBottom = true;\r\n        break;\r\n\r\n      case 'center':\r\n        style.top = config.top + config.box.height / 2 - style.height / 2;\r\n        style.arrowTop = style.height / 2 - this.prop.arrow;\r\n        break;\r\n\r\n      case 'top':\r\n        style.top = config.top - style.height - this.prop.offset - this.prop.arrow;\r\n        style.arrowTop = style.height;\r\n        topBottom = true;\r\n        break;\r\n\r\n      // no default\r\n    }\r\n\r\n    switch (style.posClass[1]) {\r\n      case 'right':\r\n        if (topBottom) {\r\n          style.left = config.left + config.box.width / 2 - this.prop.offset - this.prop.arrow;\r\n          style.arrowLeft = this.prop.offset;\r\n        }\r\n        else {\r\n          style.left = config.left + config.box.width + this.prop.offset + this.prop.arrow;\r\n          style.arrowLeft = -this.prop.arrow * 2;\r\n        }\r\n        break;\r\n\r\n      case 'center':\r\n        style.left = config.left + config.box.width / 2 - style.width / 2;\r\n        style.arrowLeft = style.width / 2 - this.prop.arrow;\r\n        break;\r\n\r\n      case 'left':\r\n        if (topBottom) {\r\n          style.left = config.left - style.width + config.box.width / 2 + this.prop.offset + this.prop.arrow;\r\n          style.arrowLeft = style.width - this.prop.offset - this.prop.arrow * 2;\r\n        }\r\n        else {\r\n          style.left = config.left - style.width - this.prop.offset - this.prop.arrow;\r\n          style.arrowLeft = style.width;\r\n        }\r\n        break;\r\n\r\n      // no default\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @summary If the tooltip contains images, recompute its size once they are loaded\r\n   * @private\r\n   */\r\n  __waitImages() {\r\n    const images = this.content.querySelectorAll('img');\r\n\r\n    if (images.length > 0) {\r\n      const promises = [];\r\n\r\n      images.forEach((image) => {\r\n        promises.push(new Promise((resolve) => {\r\n          image.onload = resolve;\r\n          image.onerror = resolve;\r\n        }));\r\n      });\r\n\r\n      Promise.all(promises)\r\n        .then(() => {\r\n          if (this.prop.state === STATE.SHOWING || this.prop.state === STATE.READY) {\r\n            const rect = this.container.getBoundingClientRect();\r\n            this.prop.width = rect.right - rect.left;\r\n            this.prop.height = rect.bottom - rect.top;\r\n            this.move(this.config);\r\n          }\r\n        });\r\n    }\r\n  }\r\n\r\n}\r\n","import { Tooltip } from '../components/Tooltip';\r\nimport { getStyle } from '../utils';\r\nimport { AbstractService } from './AbstractService';\r\n\r\n/**\r\n * @summary Tooltip renderer\r\n * @extends PSV.services.AbstractService\r\n * @memberof PSV.services\r\n */\r\nexport class TooltipRenderer extends AbstractService {\r\n\r\n  /**\r\n   * @param {PSV.Viewer} psv\r\n   */\r\n  constructor(psv) {\r\n    super(psv);\r\n\r\n    const testTooltip = new Tooltip(this.psv);\r\n\r\n    /**\r\n     * @summary Computed static sizes\r\n     * @member {Object}\r\n     * @package\r\n     * @property {number} arrowSize\r\n     * @property {number} offset\r\n     */\r\n    this.size = {\r\n      arrow : parseInt(getStyle(testTooltip.arrow, 'borderTopWidth'), 10),\r\n      offset: parseInt(getStyle(testTooltip.container, 'outlineWidth'), 10),\r\n    };\r\n\r\n    testTooltip.destroy();\r\n  }\r\n\r\n  /**\r\n   * @override\r\n   */\r\n  destroy() {\r\n    delete this.size;\r\n\r\n    super.destroy();\r\n  }\r\n\r\n  /**\r\n   * @summary Displays a tooltip on the viewer\r\n   * @param {PSV.components.Tooltip.Config} config\r\n   * @returns {PSV.components.Tooltip}\r\n   *\r\n   * @fires PSV.show-tooltip\r\n   * @throws {PSV.PSVError} when the configuration is incorrect\r\n   *\r\n   * @example\r\n   * viewer.tooltip.create({ content: 'Hello world', top: 200, left: 450, position: 'center bottom'})\r\n   */\r\n  create(config) {\r\n    const tooltip = new Tooltip(this.psv, this.size);\r\n    tooltip.show(config);\r\n\r\n    return tooltip;\r\n  }\r\n\r\n}\r\n","import * as THREE from 'three';\r\nimport { EventEmitter } from 'uevent';\r\nimport { Loader } from './components/Loader';\r\nimport { Navbar } from './components/Navbar';\r\nimport { Notification } from './components/Notification';\r\nimport { Overlay } from './components/Overlay';\r\nimport { Panel } from './components/Panel';\r\nimport { CONFIG_PARSERS, DEFAULTS, DEPRECATED_OPTIONS, getConfig, READONLY_OPTIONS } from './data/config';\r\nimport { CHANGE_EVENTS, DEFAULT_TRANSITION, EVENTS, IDS, SPHERE_RADIUS, VIEWER_DATA } from './data/constants';\r\nimport { SYSTEM } from './data/system';\r\nimport errorIcon from './icons/error.svg';\r\nimport { AbstractPlugin } from './plugins/AbstractPlugin';\r\nimport { PSVError } from './PSVError';\r\nimport { DataHelper } from './services/DataHelper';\r\nimport { EventsHandler } from './services/EventsHandler';\r\nimport { Renderer } from './services/Renderer';\r\nimport { TextureLoader } from './services/TextureLoader';\r\nimport { TooltipRenderer } from './services/TooltipRenderer';\r\nimport {\r\n  Animation,\r\n  Dynamic,\r\n  each,\r\n  exitFullscreen,\r\n  getAbortError,\r\n  getAngle,\r\n  getShortestArc,\r\n  isAbortError,\r\n  isExtendedPosition,\r\n  isFullscreenEnabled,\r\n  isNil,\r\n  logWarn,\r\n  MultiDynamic,\r\n  pluginInterop,\r\n  requestFullscreen,\r\n  throttle,\r\n  toggleClass\r\n} from './utils';\r\n\r\nTHREE.Cache.enabled = true;\r\n\r\n/**\r\n * @summary Main class\r\n * @memberOf PSV\r\n * @extends {external:uEvent.EventEmitter}\r\n */\r\nexport class Viewer extends EventEmitter {\r\n\r\n  /**\r\n   * @param {PSV.Options} options\r\n   * @fires PSV.ready\r\n   * @throws {PSV.PSVError} when the configuration is incorrect\r\n   */\r\n  constructor(options) {\r\n    super();\r\n\r\n    SYSTEM.load();\r\n\r\n    // must support WebGL\r\n    if (!SYSTEM.isWebGLSupported) {\r\n      throw new PSVError('WebGL is not supported.');\r\n    }\r\n\r\n    if (SYSTEM.maxTextureWidth === 0) {\r\n      throw new PSVError('Unable to detect system capabilities');\r\n    }\r\n\r\n    /**\r\n     * @summary Internal properties\r\n     * @member {Object}\r\n     * @protected\r\n     * @property {boolean} ready - when all components are loaded\r\n     * @property {boolean} uiRefresh - if the UI needs to be renderer\r\n     * @property {boolean} needsUpdate - if the view needs to be renderer\r\n     * @property {boolean} fullscreen - if the viewer is currently fullscreen\r\n     * @property {external:THREE.Vector3} direction - direction of the camera\r\n     * @property {number} vFov - vertical FOV\r\n     * @property {number} hFov - horizontal FOV\r\n     * @property {number} aspect - viewer aspect ratio\r\n     * @property {boolean} autorotateEnabled - automatic rotation is enabled\r\n     * @property {PSV.Animation} animationPromise - promise of the current animation\r\n     * @property {Promise} loadingPromise - promise of the setPanorama method\r\n     * @property {number} idleTime - time of the last user action\r\n     * @property {object} objectsObservers\r\n     * @property {PSV.Size} size - size of the container\r\n     * @property {PSV.PanoData} panoData - panorama metadata, if supported\r\n     */\r\n    this.prop = {\r\n      ready            : false,\r\n      uiRefresh        : false,\r\n      needsUpdate      : false,\r\n      fullscreen       : false,\r\n      direction        : new THREE.Vector3(0, 0, SPHERE_RADIUS),\r\n      vFov             : null,\r\n      hFov             : null,\r\n      aspect           : null,\r\n      autorotateEnabled: false,\r\n      animationPromise : null,\r\n      loadingPromise   : null,\r\n      idleTime         : -1,\r\n      objectsObservers : {},\r\n      size             : {\r\n        width : 0,\r\n        height: 0,\r\n      },\r\n      panoData         : {\r\n        fullWidth    : 0,\r\n        fullHeight   : 0,\r\n        croppedWidth : 0,\r\n        croppedHeight: 0,\r\n        croppedX     : 0,\r\n        croppedY     : 0,\r\n        poseHeading  : 0,\r\n        posePitch    : 0,\r\n        poseRoll     : 0,\r\n      },\r\n    };\r\n\r\n    /**\r\n     * @summary Configuration holder\r\n     * @type {PSV.Options}\r\n     * @readonly\r\n     */\r\n    this.config = getConfig(options);\r\n\r\n    /**\r\n     * @summary Top most parent\r\n     * @member {HTMLElement}\r\n     * @readonly\r\n     */\r\n    this.parent = (typeof options.container === 'string') ? document.getElementById(options.container) : options.container;\r\n    this.parent[VIEWER_DATA] = this;\r\n\r\n    /**\r\n     * @summary Main container\r\n     * @member {HTMLElement}\r\n     * @readonly\r\n     */\r\n    this.container = document.createElement('div');\r\n    this.container.classList.add('psv-container');\r\n    this.parent.appendChild(this.container);\r\n\r\n    /**\r\n     * @summary Render adapter\r\n     * @type {PSV.adapters.AbstractAdapter}\r\n     * @readonly\r\n     * @package\r\n     */\r\n    this.adapter = new this.config.adapter[0](this, this.config.adapter[1]); // eslint-disable-line new-cap\r\n\r\n    /**\r\n     * @summary All child components\r\n     * @type {PSV.components.AbstractComponent[]}\r\n     * @readonly\r\n     * @package\r\n     */\r\n    this.children = [];\r\n\r\n    /**\r\n     * @summary All plugins\r\n     * @type {Object<string, PSV.plugins.AbstractPlugin>}\r\n     * @readonly\r\n     * @package\r\n     */\r\n    this.plugins = {};\r\n\r\n    /**\r\n     * @type {PSV.services.Renderer}\r\n     * @readonly\r\n     */\r\n    this.renderer = new Renderer(this);\r\n\r\n    /**\r\n     * @type {PSV.services.TextureLoader}\r\n     * @readonly\r\n     */\r\n    this.textureLoader = new TextureLoader(this);\r\n\r\n    /**\r\n     * @type {PSV.services.EventsHandler}\r\n     * @readonly\r\n     */\r\n    this.eventsHandler = new EventsHandler(this);\r\n\r\n    /**\r\n     * @type {PSV.services.DataHelper}\r\n     * @readonly\r\n     */\r\n    this.dataHelper = new DataHelper(this);\r\n\r\n    /**\r\n     * @member {PSV.components.Loader}\r\n     * @readonly\r\n     */\r\n    this.loader = new Loader(this);\r\n\r\n    /**\r\n     * @member {PSV.components.Navbar}\r\n     * @readonly\r\n     */\r\n    this.navbar = new Navbar(this);\r\n\r\n    /**\r\n     * @member {PSV.components.Panel}\r\n     * @readonly\r\n     */\r\n    this.panel = new Panel(this);\r\n\r\n    /**\r\n     * @member {PSV.services.TooltipRenderer}\r\n     * @readonly\r\n     */\r\n    this.tooltip = new TooltipRenderer(this);\r\n\r\n    /**\r\n     * @member {PSV.components.Notification}\r\n     * @readonly\r\n     */\r\n    this.notification = new Notification(this);\r\n\r\n    /**\r\n     * @member {PSV.components.Overlay}\r\n     * @readonly\r\n     */\r\n    this.overlay = new Overlay(this);\r\n\r\n    /**\r\n     * @member {Record<string, PSV.utils.Dynamic>}\r\n     * @package\r\n     */\r\n    this.dynamics = {\r\n      zoom: new Dynamic((value) => {\r\n        this.prop.vFov = this.dataHelper.zoomLevelToFov(value);\r\n        this.prop.hFov = this.dataHelper.vFovToHFov(this.prop.vFov);\r\n        this.trigger(EVENTS.ZOOM_UPDATED, value);\r\n      }, this.config.defaultZoomLvl, 0, 100),\r\n\r\n      position: new MultiDynamic({\r\n        longitude: new Dynamic(null, this.config.defaultLong, 0, 2 * Math.PI, true),\r\n        latitude : new Dynamic(null, this.config.defaultLat, -Math.PI / 2, Math.PI / 2),\r\n      }, (position) => {\r\n        this.dataHelper.sphericalCoordsToVector3(position, this.prop.direction);\r\n        this.trigger(EVENTS.POSITION_UPDATED, position);\r\n      }),\r\n    };\r\n\r\n    this.__updateSpeeds();\r\n\r\n    this.eventsHandler.init();\r\n\r\n    this.__resizeRefresh = throttle(() => this.refreshUi('resize'), 500);\r\n\r\n    // apply container size\r\n    this.resize(this.config.size);\r\n\r\n    // init plugins\r\n    this.config.plugins.forEach(([plugin, opts]) => {\r\n      this.plugins[plugin.id] = new plugin(this, opts); // eslint-disable-line new-cap\r\n    });\r\n    each(this.plugins, plugin => plugin.init?.());\r\n\r\n    // init buttons\r\n    this.navbar.setButtons(this.config.navbar);\r\n\r\n    // load panorama\r\n    if (this.config.panorama) {\r\n      this.setPanorama(this.config.panorama);\r\n    }\r\n\r\n    toggleClass(this.container, 'psv--is-touch', SYSTEM.isTouchEnabled.initial);\r\n    SYSTEM.isTouchEnabled.promise.then(enabled => toggleClass(this.container, 'psv--is-touch', enabled));\r\n\r\n    // enable GUI after first render\r\n    this.once(EVENTS.RENDER, () => {\r\n      if (this.config.navbar) {\r\n        this.container.classList.add('psv--has-navbar');\r\n        this.navbar.show();\r\n      }\r\n\r\n      // Queue autorotate\r\n      if (!isNil(this.config.autorotateDelay)) {\r\n        this.prop.idleTime = performance.now();\r\n      }\r\n\r\n      this.prop.ready = true;\r\n\r\n      setTimeout(() => {\r\n        this.refreshUi('init');\r\n\r\n        this.trigger(EVENTS.READY);\r\n      }, 0);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * @summary Destroys the viewer\r\n   * @description The memory used by the ThreeJS context is not totally cleared. This will be fixed as soon as possible.\r\n   */\r\n  destroy() {\r\n    this.__stopAll();\r\n    this.stopKeyboardControl();\r\n    this.exitFullscreen();\r\n\r\n    each(this.plugins, plugin => plugin.destroy());\r\n    delete this.plugins;\r\n\r\n    this.children.slice().forEach(child => child.destroy());\r\n    this.children.length = 0;\r\n\r\n    this.eventsHandler.destroy();\r\n    this.renderer.destroy();\r\n    this.textureLoader.destroy();\r\n    this.dataHelper.destroy();\r\n    this.adapter.destroy();\r\n\r\n    this.parent.removeChild(this.container);\r\n    delete this.parent[VIEWER_DATA];\r\n\r\n    delete this.parent;\r\n    delete this.container;\r\n\r\n    delete this.loader;\r\n    delete this.navbar;\r\n    delete this.panel;\r\n    delete this.tooltip;\r\n    delete this.notification;\r\n    delete this.overlay;\r\n    delete this.dynamics;\r\n\r\n    delete this.config;\r\n  }\r\n\r\n  /**\r\n   * @summary Refresh UI\r\n   * @package\r\n   */\r\n  refreshUi(reason) {\r\n    if (!this.prop.ready) {\r\n      return;\r\n    }\r\n\r\n    if (!this.prop.uiRefresh) {\r\n      // console.log(`PhotoSphereViewer: UI Refresh, ${reason}`);\r\n\r\n      this.prop.uiRefresh = true;\r\n\r\n      this.children.every((child) => {\r\n        child.refreshUi();\r\n        return this.prop.uiRefresh === true;\r\n      });\r\n\r\n      this.prop.uiRefresh = false;\r\n    }\r\n    else if (this.prop.uiRefresh !== 'new') {\r\n      this.prop.uiRefresh = 'new';\r\n\r\n      // wait for current refresh to cancel\r\n      setTimeout(() => {\r\n        this.prop.uiRefresh = false;\r\n        this.refreshUi(reason);\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @summary Returns the instance of a plugin if it exists\r\n   * @param {Class<PSV.plugins.AbstractPlugin>|string} pluginId\r\n   * @returns {PSV.plugins.AbstractPlugin}\r\n   */\r\n  getPlugin(pluginId) {\r\n    if (typeof pluginId === 'string') {\r\n      return this.plugins[pluginId];\r\n    }\r\n    else {\r\n      const pluginCtor = pluginInterop(pluginId, AbstractPlugin);\r\n      return pluginCtor ? this.plugins[pluginCtor.id] : undefined;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @summary Returns the current position of the camera\r\n   * @returns {PSV.Position}\r\n   */\r\n  getPosition() {\r\n    return this.dataHelper.cleanPosition(this.dynamics.position.current);\r\n  }\r\n\r\n  /**\r\n   * @summary Returns the current zoom level\r\n   * @returns {number}\r\n   */\r\n  getZoomLevel() {\r\n    return this.dynamics.zoom.current;\r\n  }\r\n\r\n  /**\r\n   * @summary Returns the current viewer size\r\n   * @returns {PSV.Size}\r\n   */\r\n  getSize() {\r\n    return { ...this.prop.size };\r\n  }\r\n\r\n  /**\r\n   * @summary Checks if the automatic rotation is enabled\r\n   * @returns {boolean}\r\n   */\r\n  isAutorotateEnabled() {\r\n    return this.prop.autorotateEnabled;\r\n  }\r\n\r\n  /**\r\n   * @summary Checks if the viewer is in fullscreen\r\n   * @returns {boolean}\r\n   */\r\n  isFullscreenEnabled() {\r\n    if (SYSTEM.fullscreenEvent) {\r\n      return isFullscreenEnabled(this.container);\r\n    }\r\n    else {\r\n      return this.prop.fullscreen;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @summary Flags the view has changed for the next render\r\n   */\r\n  needsUpdate() {\r\n    this.prop.needsUpdate = true;\r\n  }\r\n\r\n  /**\r\n   * @summary Resizes the canvas when the window is resized\r\n   * @fires PSV.size-updated\r\n   */\r\n  autoSize() {\r\n    if (this.container.clientWidth !== this.prop.size.width || this.container.clientHeight !== this.prop.size.height) {\r\n      this.prop.size.width = Math.round(this.container.clientWidth);\r\n      this.prop.size.height = Math.round(this.container.clientHeight);\r\n      this.prop.aspect = this.prop.size.width / this.prop.size.height;\r\n      this.prop.hFov = this.dataHelper.vFovToHFov(this.prop.vFov);\r\n\r\n      this.trigger(EVENTS.SIZE_UPDATED, this.getSize());\r\n      this.__resizeRefresh();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @summary Loads a new panorama file\r\n   * @description Loads a new panorama file, optionally changing the camera position/zoom and activating the transition animation.<br>\r\n   * If the \"options\" parameter is not defined, the camera will not move and the ongoing animation will continue.<br>\r\n   * If another loading is already in progress it will be aborted.\r\n   * @param {*} path - URL of the new panorama file\r\n   * @param {PSV.PanoramaOptions} [options]\r\n   * @returns {Promise<boolean>} resolves false if the loading was aborted by another call\r\n   */\r\n  setPanorama(path, options = {}) {\r\n    this.textureLoader.abortLoading();\r\n    this.prop.transitionAnimation?.cancel();\r\n\r\n    // apply default parameters on first load\r\n    if (!this.prop.ready) {\r\n      if (!('sphereCorrection' in options)) {\r\n        options.sphereCorrection = this.config.sphereCorrection;\r\n      }\r\n      if (!('panoData' in options)) {\r\n        options.panoData = this.config.panoData;\r\n      }\r\n    }\r\n\r\n    if (options.transition === undefined || options.transition === true) {\r\n      options.transition = DEFAULT_TRANSITION;\r\n    }\r\n    if (options.showLoader === undefined) {\r\n      options.showLoader = true;\r\n    }\r\n    if (options.caption === undefined) {\r\n      options.caption = this.config.caption;\r\n    }\r\n    if (options.description === undefined) {\r\n      options.description = this.config.description;\r\n    }\r\n\r\n    const positionProvided = isExtendedPosition(options);\r\n    const zoomProvided = 'zoom' in options;\r\n\r\n    if (positionProvided || zoomProvided) {\r\n      this.__stopAll();\r\n    }\r\n\r\n    this.hideError();\r\n\r\n    this.config.panorama = path;\r\n    this.config.caption = options.caption;\r\n    this.config.description = options.description;\r\n\r\n    const done = (err) => {\r\n      this.loader.hide();\r\n\r\n      this.prop.loadingPromise = null;\r\n\r\n      if (isAbortError(err)) {\r\n        return false;\r\n      }\r\n      else if (err) {\r\n        this.navbar.setCaption('');\r\n        this.showError(this.config.lang.loadError);\r\n        console.error(err);\r\n        throw err;\r\n      }\r\n      else {\r\n        this.resetIdleTimer();\r\n        this.navbar.setCaption(this.config.caption);\r\n        return true;\r\n      }\r\n    };\r\n\r\n    this.navbar.setCaption(`<em>${this.config.loadingTxt || ''}</em>`);\r\n    if (options.showLoader || !this.prop.ready) {\r\n      this.loader.show();\r\n    }\r\n\r\n    const loadingPromise = this.adapter.loadTexture(this.config.panorama, options.panoData)\r\n      .then((textureData) => {\r\n        // check if another panorama was requested\r\n        if (textureData.panorama !== this.config.panorama) {\r\n          this.adapter.disposeTexture(textureData);\r\n          throw getAbortError();\r\n        }\r\n        return textureData;\r\n      });\r\n\r\n    if (!options.transition || !this.prop.ready || !this.adapter.supportsTransition(this.config.panorama)) {\r\n      this.prop.loadingPromise = loadingPromise\r\n        .then((textureData) => {\r\n          this.renderer.show();\r\n          this.renderer.setTexture(textureData);\r\n          this.renderer.setPanoramaPose(textureData.panoData);\r\n          this.renderer.setSphereCorrection(options.sphereCorrection);\r\n\r\n          if (zoomProvided) {\r\n            this.zoom(options.zoom);\r\n          }\r\n          if (positionProvided) {\r\n            this.rotate(options);\r\n          }\r\n        })\r\n        .then(done, done);\r\n    }\r\n    else {\r\n      this.prop.loadingPromise = loadingPromise\r\n        .then((textureData) => {\r\n          this.loader.hide();\r\n\r\n          this.prop.transitionAnimation = this.renderer.transition(textureData, options);\r\n          return this.prop.transitionAnimation\r\n            .then((completed) => {\r\n              this.prop.transitionAnimation = null;\r\n              if (!completed) {\r\n                throw getAbortError();\r\n              }\r\n            });\r\n        })\r\n        .then(done, done);\r\n    }\r\n\r\n    return this.prop.loadingPromise;\r\n  }\r\n\r\n  /**\r\n   * @summary Update options\r\n   * @param {PSV.Options} options\r\n   * @fires PSV.config-changed\r\n   * @throws {PSV.PSVError} when the configuration is incorrect\r\n   */\r\n  setOptions(options) {\r\n    const rawConfig = {\r\n      ...this.config,\r\n      ...options,\r\n    };\r\n\r\n    each(options, (value, key) => {\r\n      if (DEPRECATED_OPTIONS[key]) {\r\n        logWarn(DEPRECATED_OPTIONS[key]);\r\n        return;\r\n      }\r\n\r\n      if (!Object.prototype.hasOwnProperty.call(DEFAULTS, key)) {\r\n        throw new PSVError(`Unknown option ${key}`);\r\n      }\r\n\r\n      if (READONLY_OPTIONS[key]) {\r\n        throw new PSVError(READONLY_OPTIONS[key]);\r\n      }\r\n\r\n      if (CONFIG_PARSERS[key]) {\r\n        this.config[key] = CONFIG_PARSERS[key](value, rawConfig);\r\n      }\r\n      else {\r\n        this.config[key] = value;\r\n      }\r\n\r\n      switch (key) {\r\n        case 'caption':\r\n        case 'description':\r\n          this.navbar.setCaption(this.config.caption);\r\n          break;\r\n\r\n        case 'size':\r\n          this.resize(value);\r\n          break;\r\n\r\n        case 'sphereCorrection':\r\n          this.renderer.setSphereCorrection(value);\r\n          break;\r\n\r\n        case 'navbar':\r\n        case 'lang':\r\n          this.navbar.setButtons(this.config.navbar);\r\n          break;\r\n\r\n        case 'moveSpeed':\r\n        case 'zoomSpeed':\r\n          this.__updateSpeeds();\r\n          break;\r\n\r\n        case 'minFov':\r\n        case 'maxFov':\r\n          this.dynamics.zoom.setValue(this.dataHelper.fovToZoomLevel(this.prop.vFov));\r\n          this.trigger(EVENTS.ZOOM_UPDATED, this.getZoomLevel());\r\n          break;\r\n\r\n        case 'canvasBackground':\r\n          this.renderer.canvasContainer.style.background = this.config.canvasBackground;\r\n          break;\r\n\r\n        case 'autorotateIdle':\r\n          this.resetIdleTimer();\r\n          break;\r\n\r\n        default:\r\n          break;\r\n      }\r\n    });\r\n\r\n    this.needsUpdate();\r\n    this.refreshUi('set options');\r\n\r\n    this.trigger(EVENTS.CONFIG_CHANGED, Object.keys(options));\r\n  }\r\n\r\n  /**\r\n   * @summary Update options\r\n   * @param {string} option\r\n   * @param {any} value\r\n   * @fires PSV.config-changed\r\n   * @throws {PSV.PSVError} when the configuration is incorrect\r\n   */\r\n  setOption(option, value) {\r\n    this.setOptions({ [option]: value });\r\n  }\r\n\r\n  /**\r\n   * @summary Restarts the idle timer (if `autorotateIdle=true`)\r\n   * @package\r\n   */\r\n  resetIdleTimer() {\r\n    this.prop.idleTime = this.config.autorotateIdle ? performance.now() : -1;\r\n  }\r\n\r\n  /**\r\n   * @summary Stops the idle timer\r\n   * @package\r\n   */\r\n  disableIdleTimer() {\r\n    this.prop.idleTime = -1;\r\n  }\r\n\r\n  /**\r\n   * @summary Starts the automatic rotation\r\n   * @fires PSV.autorotate\r\n   */\r\n  startAutorotate(refresh = false) {\r\n    if (refresh && !this.isAutorotateEnabled()) {\r\n      return;\r\n    }\r\n    if (!refresh && this.isAutorotateEnabled()) {\r\n      return;\r\n    }\r\n\r\n    if (!refresh) {\r\n      this.__stopAll();\r\n    }\r\n\r\n    this.dynamics.position.roll({\r\n      longitude: this.config.autorotateSpeed < 0,\r\n    }, Math.abs(this.config.autorotateSpeed / this.config.moveSpeed));\r\n\r\n    this.dynamics.position.goto({\r\n      latitude: this.config.autorotateLat,\r\n    }, Math.abs(this.config.autorotateSpeed / this.config.moveSpeed));\r\n\r\n    this.prop.autorotateEnabled = true;\r\n\r\n    if (!refresh) {\r\n      this.trigger(EVENTS.AUTOROTATE, true);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @summary Stops the automatic rotation\r\n   * @fires PSV.autorotate\r\n   */\r\n  stopAutorotate() {\r\n    if (this.isAutorotateEnabled()) {\r\n      this.dynamics.position.stop();\r\n\r\n      this.prop.autorotateEnabled = false;\r\n\r\n      this.trigger(EVENTS.AUTOROTATE, false);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @summary Starts or stops the automatic rotation\r\n   * @fires PSV.autorotate\r\n   */\r\n  toggleAutorotate() {\r\n    if (this.isAutorotateEnabled()) {\r\n      this.stopAutorotate();\r\n    }\r\n    else {\r\n      this.startAutorotate();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @summary Displays an error message over the viewer\r\n   * @param {string} message\r\n   */\r\n  showError(message) {\r\n    this.overlay.show({\r\n      id         : IDS.ERROR,\r\n      image      : errorIcon,\r\n      text       : message,\r\n      dissmisable: false,\r\n    });\r\n  }\r\n\r\n  /**\r\n   * @summary Hides the error message\r\n   */\r\n  hideError() {\r\n    this.overlay.hide(IDS.ERROR);\r\n  }\r\n\r\n  /**\r\n   * @summary Rotates the view to specific longitude and latitude\r\n   * @param {PSV.ExtendedPosition} position\r\n   * @fires PSV.before-rotate\r\n   * @fires PSV.position-updated\r\n   */\r\n  rotate(position) {\r\n    const e = this.trigger(EVENTS.BEFORE_ROTATE, position);\r\n    if (e.isDefaultPrevented()) {\r\n      return;\r\n    }\r\n\r\n    const cleanPosition = this.change(CHANGE_EVENTS.GET_ROTATE_POSITION, this.dataHelper.cleanPosition(position));\r\n    this.dynamics.position.setValue(cleanPosition);\r\n  }\r\n\r\n  /**\r\n   * @summary Rotates and zooms the view with a smooth animation\r\n   * @param {PSV.AnimateOptions} options - position and/or zoom level\r\n   * @returns {PSV.Animation}\r\n   */\r\n  animate(options) {\r\n    this.__stopAll();\r\n\r\n    const positionProvided = isExtendedPosition(options);\r\n    const zoomProvided = 'zoom' in options;\r\n\r\n    const animProperties = {};\r\n    let duration;\r\n\r\n    // clean/filter position and compute duration\r\n    if (positionProvided) {\r\n      const cleanPosition = this.change(CHANGE_EVENTS.GET_ANIMATE_POSITION, this.dataHelper.cleanPosition(options));\r\n      const currentPosition = this.getPosition();\r\n\r\n      // longitude offset for shortest arc\r\n      const tOffset = getShortestArc(currentPosition.longitude, cleanPosition.longitude);\r\n\r\n      animProperties.longitude = { start: currentPosition.longitude, end: currentPosition.longitude + tOffset };\r\n      animProperties.latitude = { start: currentPosition.latitude, end: cleanPosition.latitude };\r\n\r\n      duration = this.dataHelper.speedToDuration(options.speed, getAngle(currentPosition, cleanPosition));\r\n    }\r\n\r\n    // clean/filter zoom and compute duration\r\n    if (zoomProvided) {\r\n      const dZoom = Math.abs(options.zoom - this.getZoomLevel());\r\n\r\n      animProperties.zoom = { start: this.getZoomLevel(), end: options.zoom };\r\n\r\n      if (!duration) {\r\n        // if animating zoom only and a speed is given, use an arbitrary PI/4 to compute the duration\r\n        duration = this.dataHelper.speedToDuration(options.speed, Math.PI / 4 * dZoom / 100);\r\n      }\r\n    }\r\n\r\n    // if no animation needed\r\n    if (!duration) {\r\n      if (positionProvided) {\r\n        this.rotate(options);\r\n      }\r\n      if (zoomProvided) {\r\n        this.zoom(options.zoom);\r\n      }\r\n\r\n      return new Animation();\r\n    }\r\n\r\n    this.prop.animationPromise = new Animation({\r\n      properties: animProperties,\r\n      duration  : duration,\r\n      easing    : 'inOutSine',\r\n      onTick    : (properties) => {\r\n        if (positionProvided) {\r\n          this.rotate(properties);\r\n        }\r\n        if (zoomProvided) {\r\n          this.zoom(properties.zoom);\r\n        }\r\n      },\r\n    });\r\n\r\n    this.prop.animationPromise.then(() => {\r\n      this.prop.animationPromise = null;\r\n      this.resetIdleTimer();\r\n    });\r\n\r\n    return this.prop.animationPromise;\r\n  }\r\n\r\n  /**\r\n   * @summary Stops the ongoing animation\r\n   * @description The return value is a Promise because the is no guaranty the animation can be stopped synchronously.\r\n   * @returns {Promise} Resolved when the animation has ben cancelled\r\n   */\r\n  stopAnimation() {\r\n    if (this.prop.animationPromise) {\r\n      return new Promise((resolve) => {\r\n        this.prop.animationPromise.then(resolve);\r\n        this.prop.animationPromise.cancel();\r\n        this.prop.animationPromise = null;\r\n      });\r\n    }\r\n    else {\r\n      return Promise.resolve();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @summary Zooms to a specific level between `max_fov` and `min_fov`\r\n   * @param {number} level - new zoom level from 0 to 100\r\n   * @fires PSV.zoom-updated\r\n   */\r\n  zoom(level) {\r\n    this.dynamics.zoom.setValue(level);\r\n  }\r\n\r\n  /**\r\n   * @summary Increases the zoom level\r\n   * @param {number} [step=1]\r\n   */\r\n  zoomIn(step = 1) {\r\n    this.dynamics.zoom.step(step);\r\n  }\r\n\r\n  /**\r\n   * @summary Decreases the zoom level\r\n   * @param {number} [step=1]\r\n   */\r\n  zoomOut(step = 1) {\r\n    this.dynamics.zoom.step(-step);\r\n  }\r\n\r\n  /**\r\n   * @summary Resizes the viewer\r\n   * @param {PSV.CssSize} size\r\n   */\r\n  resize(size) {\r\n    ['width', 'height'].forEach((dim) => {\r\n      if (size && size[dim]) {\r\n        if (/^[0-9.]+$/.test(size[dim])) {\r\n          size[dim] += 'px';\r\n        }\r\n        this.parent.style[dim] = size[dim];\r\n      }\r\n    });\r\n\r\n    this.autoSize();\r\n  }\r\n\r\n  /**\r\n   * @summary Enters the fullscreen mode\r\n   * @fires PSV.fullscreen-updated\r\n   */\r\n  enterFullscreen() {\r\n    if (SYSTEM.fullscreenEvent) {\r\n      requestFullscreen(this.container);\r\n    }\r\n    else {\r\n      this.container.classList.add('psv-container--fullscreen');\r\n      this.autoSize();\r\n      this.eventsHandler.__fullscreenToggled(true);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @summary Exits the fullscreen mode\r\n   * @fires PSV.fullscreen-updated\r\n   */\r\n  exitFullscreen() {\r\n    if (this.isFullscreenEnabled()) {\r\n      if (SYSTEM.fullscreenEvent) {\r\n        exitFullscreen();\r\n      }\r\n      else {\r\n        this.container.classList.remove('psv-container--fullscreen');\r\n        this.autoSize();\r\n        this.eventsHandler.__fullscreenToggled(false);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @summary Enters or exits the fullscreen mode\r\n   * @fires PSV.fullscreen-updated\r\n   */\r\n  toggleFullscreen() {\r\n    if (!this.isFullscreenEnabled()) {\r\n      this.enterFullscreen();\r\n    }\r\n    else {\r\n      this.exitFullscreen();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @summary Enables the keyboard controls (done automatically when entering fullscreen)\r\n   */\r\n  startKeyboardControl() {\r\n    this.eventsHandler.enableKeyboard();\r\n  }\r\n\r\n  /**\r\n   * @summary Disables the keyboard controls (done automatically when exiting fullscreen)\r\n   */\r\n  stopKeyboardControl() {\r\n    this.eventsHandler.disableKeyboard();\r\n  }\r\n\r\n  /**\r\n   * @summary Subscribes to events on objects in the scene\r\n   * @param {string} userDataKey - only objects with the following `userData` will be emitted\r\n   * @param {EventListener} listener - must implement `handleEvent\r\n   * @return {function} call to stop the subscription\r\n   * @package\r\n   */\r\n  observeObjects(userDataKey, listener) {\r\n    this.prop.objectsObservers[userDataKey] = { listener };\r\n\r\n    return () => {\r\n      delete this.prop.objectsObservers[userDataKey];\r\n    };\r\n  }\r\n\r\n  /**\r\n   * @summary Stops all current animations\r\n   * @returns {Promise}\r\n   * @package\r\n   */\r\n  __stopAll() {\r\n    this.trigger(EVENTS.STOP_ALL);\r\n\r\n    this.disableIdleTimer();\r\n    this.stopAutorotate();\r\n    return this.stopAnimation();\r\n  }\r\n\r\n  /**\r\n   * @summary Recomputes dynamics speeds\r\n   * @private\r\n   */\r\n  __updateSpeeds() {\r\n    this.dynamics.zoom.setSpeed(this.config.zoomSpeed * 50);\r\n    this.dynamics.position.setSpeed(THREE.MathUtils.degToRad(this.config.moveSpeed * 50));\r\n  }\r\n\r\n}\r\n"],"names":["PSVError","message","Error","captureStackTrace","stack","prototype","Object","create","name","constructor","AbstractAdapter","psv","destroy","supportsTransition","panorama","supportsPreload","loadTexture","newPanoData","createMesh","scale","setTexture","mesh","textureData","transition","setTextureOpacity","opacity","disposeTexture","id","supportsDownload","DEFAULT_TRANSITION","MOVE_THRESHOLD","DBLCLICK_DELAY","LONGTOUCH_DELAY","TWOFINGERSOVERLAY_DELAY","CTRLZOOM_TIMEOUT","INERTIA_WINDOW","SPHERE_RADIUS","VIEWER_DATA","MESH_USER_DATA","ACTIONS","ROTATE_LAT_UP","ROTATE_LAT_DOWN","ROTATE_LONG_RIGHT","ROTATE_LONG_LEFT","ZOOM_IN","ZOOM_OUT","TOGGLE_AUTOROTATE","EVENTS","AUTOROTATE","BEFORE_RENDER","BEFORE_ROTATE","CLICK","CLOSE_PANEL","CONFIG_CHANGED","DOUBLE_CLICK","FULLSCREEN_UPDATED","HIDE_NOTIFICATION","HIDE_OVERLAY","HIDE_TOOLTIP","KEY_PRESS","LOAD_PROGRESS","OPEN_PANEL","PANORAMA_LOADED","POSITION_UPDATED","READY","RENDER","SHOW_NOTIFICATION","SHOW_OVERLAY","SHOW_TOOLTIP","SIZE_UPDATED","STOP_ALL","ZOOM_UPDATED","CHANGE_EVENTS","GET_ANIMATE_POSITION","GET_ROTATE_POSITION","OBJECT_EVENTS","ENTER_OBJECT","HOVER_OBJECT","LEAVE_OBJECT","IDS","MENU","TWO_FINGERS","CTRL_ZOOM","ERROR","DESCRIPTION","EASINGS","linear","t","inQuad","outQuad","inOutQuad","inCubic","outCubic","inOutCubic","inQuart","outQuart","inOutQuart","inQuint","outQuint","inOutQuint","inSine","Math","cos","PI","outSine","sin","inOutSine","inExpo","pow","outExpo","inOutExpo","inCirc","sqrt","outCirc","inOutCirc","KEY_CODES","Enter","Control","Escape","Space","PageUp","PageDown","ArrowLeft","ArrowUp","ArrowRight","ArrowDown","Delete","Plus","Minus","LOCALSTORAGE_TOUCH_SUPPORT","SYSTEM","loaded","pixelRatio","isWebGLSupported","isTouchEnabled","maxTextureWidth","mouseWheelEvent","fullscreenEvent","load","ctx","getWebGLCtx","window","devicePixelRatio","getMaxTextureWidth","getMouseWheelEvent","getFullscreenEvent","maxCanvasWidth","getMaxCanvasWidth","canvas","document","createElement","names","context","getContext","some","e","initial","navigator","maxTouchPoints","localStorage","promise","Promise","resolve","clear","listenerMouse","listenerTouch","listenerTimeout","addEventListener","listenerTimeoutId","setTimeout","removeEventListener","clearTimeout","getParameter","MAX_TEXTURE_SIZE","maxWidth","width","height","fillStyle","fillRect","getImageData","data","onmousewheel","undefined","FULLSCREEN_EVT_MAP","exitFullscreen","webkitExitFullscreen","mozCancelFullScreen","msExitFullscreen","validExits","keys","filter","exit","length","toggleClass","element","className","active","classList","toggle","contains","add","remove","addClasses","split","forEach","removeClasses","hasParent","el","parent","test","parentNode","getClosest","selector","matches","SVGElement","parentElement","getPosition","left","top","offsetLeft","scrollLeft","clientLeft","offsetTop","scrollTop","clientTop","offsetParent","isFullscreenEnabled","elt","fullscreenElement","webkitFullscreenElement","requestFullscreen","webkitRequestFullscreen","call","getStyle","prop","getComputedStyle","normalizeWheel","event","PIXEL_STEP","LINE_HEIGHT","PAGE_HEIGHT","spinX","spinY","pixelX","pixelY","detail","wheelDelta","wheelDeltaY","wheelDeltaX","axis","HORIZONTAL_AXIS","deltaY","deltaX","deltaMode","bound","x","min","max","loop","value","result","isInteger","Number","isFinite","floor","isPowerOfTwo","log","sum","array","reduce","a","b","distance","p1","p2","y","getShortestArc","from","to","tCandidates","candidate","newCandidate","abs","Infinity","getAngle","position1","position2","acos","latitude","longitude","greatArcDistance","λ1","φ1","λ2","φ2","dasherize","str","replace","s","i","toLowerCase","throttle","func","wait","self","args","timeout","previous","later","Date","now","apply","remaining","arguments","isPlainObject","obj","getPrototypeOf","proto","toString","deepmerge","target","src","first","merge","Array","isArray","key","clone","isEmpty","each","object","callback","isNil","val","firstNonNull","values","deepEqual","obj1","obj2","isObject","pluginInterop","plugin","entries","p","getAbortError","error","isAbortError","err","logWarn","console","warn","isExtendedPosition","key1","key2","getXMPValue","attr","match","parseInt","isNaN","CSS_POSITIONS","bottom","right","center","parsePosition","tokens","toLocaleLowerCase","slice","xFirst","map","token","reverse","parsed","join","parseFloat","LEFT_MAP","TOP_MAP","cleanPosition","defaultValue","allowCenter","tempPos","parseSpeed","speed","speedStr","trim","speedValue","speedUnit","THREE","MathUtils","degToRad","parseAngle","angle","zeroCenter","halfCircle","unit","createTexture","img","texture","Texture","needsUpdate","minFilter","LinearFilter","generateMipmaps","quaternion","Quaternion","applyEulerInverse","vector","euler","setFromEuler","invert","applyQuaternion","Animation","options","__callbacks","easing","__start","delay","__delayTimeout","__animationFrame","requestAnimationFrame","__run","__resolved","timestamp","progress","duration","current","properties","start","end","onTick","__resolve","cb","then","onFulfilled","onRejected","__cancelled","push","cancel","cancelAnimationFrame","catch","finally","onFinally","Dynamic","fn","loopValue","mode","STOP","speedMult","currentSpeed","setSpeed","goto","position","POSITION","step","roll","INFINITE","stop","setValue","update","elapsed","dstStop","targetSpeed","next","MultiDynamic","dynamics","d","positions","steps","rolls","hasUpdates","dynamic","Slider","container","direction","onUpdate","mousedown","mouseover","handleEvent","type","stopPropagation","__onMouseDown","__onMouseEnter","__onMouseLeave","__onTouchStart","__onMouseMove","__onTouchMove","__onMouseUp","__onTouchEnd","evt","__update","changedTouches","moving","boundingClientRect","getBoundingClientRect","cursor","vertical","pos","size","click","VERTICAL","EventEmitter","HORIZONTAL","EquirectangularAdapter","config","resolution","SPHERE_SEGMENTS","SPHERE_HORIZONTAL_SEGMENTS","reject","useXmpData","textureLoader","loadImage","loader","setProgress","xmpPanoData","__loadXMP","panoData","fullWidth","fullHeight","croppedWidth","croppedHeight","croppedX","croppedY","poseHeading","posePitch","poseRoll","__createEquirectangularTexture","onProgress","loadFile","blob","__loadBlobAsString","binary","indexOf","substring","includes","reader","FileReader","onload","onerror","readAsText","ratio","resizedPanoData","buffer","drawImage","geometry","SphereGeometry","material","MeshBasicMaterial","Mesh","dispose","transparent","AbstractComponent","children","visible","appendChild","removeChild","childIdx","splice","child","refreshUi","every","uiRefresh","isVisible","hide","show","style","display","AbstractButton","navbar","collapsable","tabbable","enabled","supported","collapsed","offsetWidth","icon","__setIcon","lang","title","tabIndex","onClick","checkSupported","supportedOrObject","isSupported","toggleActive","iconActive","refresh","disable","enable","collapse","uncollapse","innerHTML","querySelector","groupId","AutorotateButton","on","off","isAutorotateEnabled","autorotateIdle","resetIdleTimer","toggleAutorotate","play","playActive","CustomButton","random","substr","content","MODE_NOTIF","MODE_PANEL","DescriptionButton","closed","__close","caption","getButton","captionHidden","hasDescription","description","__open","notification","panel","info","DownloadButton","link","href","downloadUrl","download","pop","adapter","FullscreenButton","toggleFullscreen","fullscreenIn","fullscreenOut","MenuButton","__hideMenu","__showMenu","MENU_TEMPLATE","BUTTON_DATA","noMargin","clickHandler","li","buttonId","dataset","menuIcon","buttons","dataKey","menu","button","PressHandler","time","down","getTime","up","getOrientedArrow","arrow","AbstractMoveButton","move","handler","__stopAll","MoveDownButton","MoveLeftButton","MoveRightButton","MoveUpButton","AbstractZoomButton","zoom","ZoomInButton","zoomIn","ZoomOutButton","zoomOut","ZoomRangeButton","mediaMinWidth","zoomRange","zoomValue","slider","__onSliderUpdate","ready","__moveZoomValue","getZoomLevel","once","level","AbstractPlugin","init","DEFAULTS","plugins","loadingImg","loadingTxt","fisheye","minFov","maxFov","defaultZoomLvl","defaultLong","defaultLat","sphereCorrection","moveSpeed","zoomSpeed","autorotateDelay","autorotateSpeed","autorotateLat","moveInertia","mousewheel","mousemove","captureCursor","mousewheelCtrlKey","touchmoveTwoFingers","requestHeaders","canvasBackground","withCredentials","autorotate","fullscreen","twoFingers","ctrlZoom","loadError","keyboard","READONLY_OPTIONS","DEPRECATED_OPTIONS","zoomButtonIncrement","mousewheelSpeed","sphereCorrectionReorder","CONFIG_PARSERS","getConfig","tempConfig","hasOwnProperty","NavbarCaption","contentWidth","setCaption","html","availableWidth","__refreshButton","AVAILABLE_BUTTONS","AVAILABLE_GROUPS","registerButton","defaultPosition","unshift","Navbar","setButtons","item","cleanedButtons","__cleanButtons","buttonCtor","warnNotFound","totalWidth","visibleButtons","collapsableButtons","Loader","clientWidth","tickness","lastChild","inner","round","maxHeight","clearRect","lineWidth","strokeStyle","beginPath","arc","stroke","trigger","Notification","contentId","Overlay","dissmisable","image","text","subtext","preventDefault","PANEL_MIN_WIDTH","Panel","mouseX","mouseY","keyHandler","resizer","closeBtn","wasVisible","focus","__startResize","__resize","touches","clientX","clientY","AbstractService","vector2","Vector2","vector3","Vector3","eulerZero","Euler","DataHelper","fovToZoomLevel","fov","temp","zoomLevelToFov","vFovToHFov","vFov","radToDeg","atan","tan","aspect","speedToDuration","textureCoordsToSphericalCoords","point","relativeX","relativeY","equals","renderer","rotation","meshContainer","sphericalCoordsToVector3","applyEuler","vector3ToSphericalCoords","sphericalCoordsToTextureCoords","relativeLong","relativeLat","z","phi","theta","atan2","viewerCoordsToVector3","viewerPoint","sphereIntersect","getIntersections","userData","vector3ToViewerCoords","vectorClone","project","camera","sphericalCoordsToViewerCoords","raycaster","setFromCamera","intersectObjects","scene","cleanSphereCorrection","pan","tilt","cleanPanoramaPose","EventsHandler","state","moveThreshold","keyboardEnabled","zooming","startMouseX","startMouseY","mouseHistory","pinchDist","ctrlKeyDown","dblclickData","dblclickTimeout","longtouchTimeout","twofingersTimeout","ctrlZoomTimeout","__onResize","autoSize","__onKeyDown","__onKeyUp","__fullscreenToggled","__onMouseWheel","enableKeyboard","disableKeyboard","overlay","e2","isDefaultPrevented","action","__startMove","__stopMove","__move","__moveAbsolute","objectsObservers","viewerPos","intersections","dataHelper","emit","observer","listener","CustomEvent","originalEvent","intersection","find","__click","__cancelLongTouch","__cancelTwoFingersOverlay","__startMoveZoom","__stopMoveZoom","gestureIcon","__moveZoom","mousewheelIcon","delta","force","startKeyboardControl","stopKeyboardControl","__logMouseMove","__stopMoveInertia","norm","animationPromise","longtouch","boundingRect","rightclick","viewerX","viewerY","sphereIntersection","psvSphere","sphericalCoords","objects","o","textureCoords","textureX","textureY","NaN","hFov","currentPosition","rotate","containerRect","Renderer","WebGLRenderer","alpha","antialias","setPixelRatio","domElement","Scene","PerspectiveCamera","Group","Raycaster","canvasContainer","background","setAnimationLoop","__cleanTHREEScene","__onSizeUpdated","__onZoomUpdated","__onPositionUpdated","setSize","updateProjectionMatrix","set","lookAt","copy","multiplyScalar","negate","__renderLoop","idleTime","startAutorotate","render","setPanoramaPose","cleanCorrection","setSphereCorrection","positionProvided","zoomProvided","group","verticalAxis","rotateOnWorldAxis","horizontalAxis","cross","getWorldDirection","normalize","animation","completed","traverse","TextureLoader","FileLoader","setResponseType","setWithCredentials","setRequestHeader","abortLoading","url","lengthComputable","newProgress","total","createElementNS","URL","revokeObjectURL","createObjectURL","preloadPanorama","STATE","NONE","SHOWING","HIDING","Tooltip","__onTransitionEnd","rect","__waitImages","posClass","arrowTop","arrowLeft","__computeTooltipPosition","offset","newPos","propertyName","topBottom","box","images","querySelectorAll","promises","all","TooltipRenderer","testTooltip","tooltip","Cache","Viewer","autorotateEnabled","loadingPromise","getElementById","eventsHandler","__updateSpeeds","__resizeRefresh","resize","opts","setPanorama","performance","reason","getPlugin","pluginId","pluginCtor","getSize","clientHeight","path","transitionAnimation","showLoader","hideError","done","showError","setOptions","rawConfig","setOption","option","disableIdleTimer","stopAutorotate","errorIcon","change","animate","animProperties","tOffset","dZoom","stopAnimation","dim","enterFullscreen","observeObjects","userDataKey"],"mappings":"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ACF;AACA;AACA;AACA;AACA;AACEC,EAAAA,YAAY,EAAQ,UAlDA;;AAmDpB;AACF;AACA;AACA;AACA;AACA;AACEC,EAAAA,kBAAkB,EAAE,oBAzDA;;AA0DpB;AACF;AACA;AACA;AACA;AACA;AACEC,EAAAA,iBAAiB,EAAG,mBAhEA;;AAiEpB;AACF;AACA;AACA;AACA;AACA;AACEC,EAAAA,YAAY,EAAQ,cAvEA;;AAwEpB;AACF;AACA;AACA;AACA;AACA;AACEC,EAAAA,YAAY,EAAQ,cA9EA;;AA+EpB;AACF;AACA;AACA;AACA;AACA;AACEC,EAAAA,SAAS,EAAW,WArFA;;AAsFpB;AACF;AACA;AACA;AACA;AACA;AACEC,EAAAA,aAAa,EAAO,eA5FA;;AA6FpB;AACF;AACA;AACA;AACA;AACA;AACEC,EAAAA,UAAU,EAAU,YAnGA;;AAoGpB;AACF;AACA;AACA;AACA;AACA;AACEC,EAAAA,eAAe,EAAK,iBA1GA;;AA2GpB;AACF;AACA;AACA;AACA;AACA;AACEC,EAAAA,gBAAgB,EAAI,kBAjHA;;AAkHpB;AACF;AACA;AACA;AACA;AACEC,EAAAA,KAAK,EAAe,OAvHA;;AAwHpB;AACF;AACA;AACA;AACA;AACEC,EAAAA,MAAM,EAAc,QA7HA;;AA8HpB;AACF;AACA;AACA;AACA;AACA;AACEC,EAAAA,iBAAiB,EAAG,mBApIA;;AAqIpB;AACF;AACA;AACA;AACA;AACA;AACEC,EAAAA,YAAY,EAAQ,cA3IA;;AA4IpB;AACF;AACA;AACA;AACA;AACA;AACA;AACEC,EAAAA,YAAY,EAAQ,cAnJA;;AAoJpB;AACF;AACA;AACA;AACA;AACA;AACEC,EAAAA,YAAY,EAAQ,cA1JA;;AA2JpB;AACF;AACA;AACA;AACA;AACEC,EAAAA,QAAQ,EAAY,UAhKA;;AAiKpB;AACF;AACA;AACA;AACA;AACA;AACEC,EAAAA,YAAY,EAAQ,cAAA;AAvKA,CAAf,CAAA;AA0KP;AACA;AACA;AACA;AACA;AACA;;AACO,IAAMC,aAAa,GAAG;AAC3B;AACF;AACA;AACA;AACA;AACA;AACA;AACEC,EAAAA,oBAAoB,EAAE,sBARK;;AAS3B;AACF;AACA;AACA;AACA;AACA;AACA;AACEC,EAAAA,mBAAmB,EAAG,qBAAA;AAhBK,CAAtB,CAAA;AAmBP;AACA;AACA;AACA;AACA;AACA;;AACO,IAAMC,aAAa,GAAG;AAC3BC,EAAAA,YAAY,EAAE,cADa;AAE3BC,EAAAA,YAAY,EAAE,cAFa;AAG3BC,EAAAA,YAAY,EAAE,cAAA;AAHa,CAAtB,CAAA;AAMP;AACA;AACA;AACA;AACA;AACA;;AACO,IAAMC,GAAG,GAAG;AACjBC,EAAAA,IAAI,EAAS,MADI;AAEjBC,EAAAA,WAAW,EAAE,YAFI;AAGjBC,EAAAA,SAAS,EAAI,UAHI;AAIjBC,EAAAA,KAAK,EAAQ,OAJI;AAKjBC,EAAAA,WAAW,EAAE,aAAA;AALI,CAAZ,CAAA;AAQP;AACA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACO,IAAMC,OAAO,GAAG;EACrBC,MAAM,EAAM,gBAACC,CAAD,EAAA;AAAA,IAAA,OAAOA,CAAP,CAAA;GADS;EAGrBC,MAAM,EAAM,gBAACD,CAAD,EAAA;IAAA,OAAOA,CAAC,GAACA,CAAT,CAAA;GAHS;EAIrBE,OAAO,EAAK,iBAACF,CAAD,EAAA;AAAA,IAAA,OAAOA,CAAC,IAAE,CAAEA,GAAAA,CAAJ,CAAR,CAAA;GAJS;EAKrBG,SAAS,EAAG,mBAACH,CAAD,EAAA;AAAA,IAAA,OAAOA,CAAC,GAAC,EAAF,GAAO,CAAA,GAAEA,CAAF,GAAIA,CAAX,GAAe,CAAC,CAAD,GAAG,CAAC,IAAE,CAAEA,GAAAA,CAAL,IAAQA,CAAjC,CAAA;GALS;EAOrBI,OAAO,EAAK,iBAACJ,CAAD,EAAA;AAAA,IAAA,OAAOA,CAAC,GAACA,CAAF,GAAIA,CAAX,CAAA;GAPS;EAQrBK,QAAQ,EAAI,kBAACL,CAAD,EAAA;AAAA,IAAA,OAAQ,EAAEA,CAAH,GAAMA,CAAN,GAAQA,CAAR,GAAU,CAAjB,CAAA;GARS;EASrBM,UAAU,EAAE,oBAACN,CAAD,EAAA;IAAA,OAAOA,CAAC,GAAC,EAAF,GAAO,CAAA,GAAEA,CAAF,GAAIA,CAAJ,GAAMA,CAAb,GAAiB,CAACA,CAAC,GAAC,CAAH,KAAO,CAAEA,GAAAA,CAAF,GAAI,CAAX,CAAe,IAAA,CAAA,GAAEA,CAAF,GAAI,CAAnB,CAAA,GAAsB,CAA9C,CAAA;GATS;EAWrBO,OAAO,EAAK,iBAACP,CAAD,EAAA;AAAA,IAAA,OAAOA,CAAC,GAACA,CAAF,GAAIA,CAAJ,GAAMA,CAAb,CAAA;GAXS;EAYrBQ,QAAQ,EAAI,kBAACR,CAAD,EAAA;IAAA,OAAO,CAAA,GAAG,EAAEA,CAAH,GAAMA,CAAN,GAAQA,CAAR,GAAUA,CAAnB,CAAA;GAZS;EAarBS,UAAU,EAAE,oBAACT,CAAD,EAAA;IAAA,OAAOA,CAAC,GAAC,EAAF,GAAO,IAAEA,CAAF,GAAIA,CAAJ,GAAMA,CAAN,GAAQA,CAAf,GAAmB,CAAA,GAAE,IAAG,EAAEA,CAAL,GAAQA,CAAR,GAAUA,CAAV,GAAYA,CAAxC,CAAA;GAbS;EAerBU,OAAO,EAAK,iBAACV,CAAD,EAAA;IAAA,OAAOA,CAAC,GAACA,CAAF,GAAIA,CAAJ,GAAMA,CAAN,GAAQA,CAAf,CAAA;GAfS;EAgBrBW,QAAQ,EAAI,kBAACX,CAAD,EAAA;IAAA,OAAO,CAAA,GAAG,EAAEA,CAAH,GAAMA,CAAN,GAAQA,CAAR,GAAUA,CAAV,GAAYA,CAArB,CAAA;GAhBS;EAiBrBY,UAAU,EAAE,oBAACZ,CAAD,EAAA;IAAA,OAAOA,CAAC,GAAC,EAAF,GAAO,EAAA,GAAGA,CAAH,GAAKA,CAAL,GAAOA,CAAP,GAASA,CAAT,GAAWA,CAAlB,GAAsB,CAAA,GAAE,EAAI,GAAA,EAAEA,CAAN,GAASA,CAAT,GAAWA,CAAX,GAAaA,CAAb,GAAeA,CAA9C,CAAA;GAjBS;EAmBrBa,MAAM,EAAM,gBAACb,CAAD,EAAA;AAAA,IAAA,OAAO,CAAEc,GAAAA,IAAI,CAACC,GAAL,CAASf,CAAC,IAAEc,IAAI,CAACE,EAAL,GAAQ,CAAV,CAAV,CAAT,CAAA;GAnBS;EAoBrBC,OAAO,EAAK,iBAACjB,CAAD,EAAA;AAAA,IAAA,OAAOc,IAAI,CAACI,GAAL,CAASlB,CAAC,IAAEc,IAAI,CAACE,EAAL,GAAQ,CAAV,CAAV,CAAP,CAAA;GApBS;EAqBrBG,SAAS,EAAG,mBAACnB,CAAD,EAAA;IAAA,OAAO,EAAA,GAAG,EAAGc,GAAAA,IAAI,CAACC,GAAL,CAASD,IAAI,CAACE,EAAL,GAAQhB,CAAjB,CAAb,CAAA;GArBS;EAuBrBoB,MAAM,EAAM,gBAACpB,CAAD,EAAA;IAAA,OAAOc,IAAI,CAACO,GAAL,CAAS,CAAT,EAAY,EAAA,IAAIrB,CAAC,GAAC,CAAN,CAAZ,CAAP,CAAA;GAvBS;EAwBrBsB,OAAO,EAAK,iBAACtB,CAAD,EAAA;IAAA,OAAO,CAAA,GAAEc,IAAI,CAACO,GAAL,CAAS,CAAT,EAAY,CAAC,EAAD,GAAIrB,CAAhB,CAAT,CAAA;GAxBS;EAyBrBuB,SAAS,EAAG,mBAACvB,CAAD,EAAA;AAAA,IAAA,OAAO,CAACA,CAAC,GAACA,CAAC,GAAC,CAAF,GAAI,CAAP,IAAU,CAAV,GAAc,EAAA,GAAGc,IAAI,CAACO,GAAL,CAAS,CAAT,EAAY,EAAA,GAAGrB,CAAf,CAAjB,GAAqC,CAAA,GAAE,KAAGc,IAAI,CAACO,GAAL,CAAS,CAAT,EAAY,CAAC,EAAD,GAAIrB,CAAhB,CAAjD,CAAA;GAzBS;EA2BrBwB,MAAM,EAAM,gBAACxB,CAAD,EAAA;IAAA,OAAO,CAAA,GAAEc,IAAI,CAACW,IAAL,CAAU,CAAEzB,GAAAA,CAAC,GAACA,CAAd,CAAT,CAAA;GA3BS;EA4BrB0B,OAAO,EAAK,iBAAC1B,CAAD,EAAA;AAAA,IAAA,OAAOc,IAAI,CAACW,IAAL,CAAU,IAAE,CAACzB,CAAC,GAAC,CAAH,KAAOA,CAAC,GAAC,CAAT,CAAZ,CAAP,CAAA;GA5BS;EA6BrB2B,SAAS,EAAG,mBAAC3B,CAAD,EAAA;AAAA,IAAA,OAAO,CAACA,CAAC,IAAE,CAAJ,IAAO,CAAP,GAAW,EAAG,GAAA,EAAA,GAAGc,IAAI,CAACW,IAAL,CAAU,IAAEzB,CAAC,GAACA,CAAd,CAAjB,GAAoC,EAAA,GAAG,EAAGc,GAAAA,IAAI,CAACW,IAAL,CAAU,CAAE,GAAA,CAACzB,CAAC,IAAE,CAAJ,IAAOA,CAAnB,CAAjD,CAAA;AAAA,GAAA;AA7BS,CAAhB;;AAgCP;;AAEA;AACA;AACA;AACA;AACA;AACA;;AACO,IAAM4B,SAAS,GAAG;AACvBC,EAAAA,KAAK,EAAO,OADW;AAEvBC,EAAAA,OAAO,EAAK,SAFW;AAGvBC,EAAAA,MAAM,EAAM,QAHW;AAIvBC,EAAAA,KAAK,EAAO,GAJW;AAKvBC,EAAAA,MAAM,EAAM,QALW;AAMvBC,EAAAA,QAAQ,EAAI,UANW;AAOvBC,EAAAA,SAAS,EAAG,WAPW;AAQvBC,EAAAA,OAAO,EAAK,SARW;AASvBC,EAAAA,UAAU,EAAE,YATW;AAUvBC,EAAAA,SAAS,EAAG,WAVW;AAWvBC,EAAAA,MAAM,EAAM,QAXW;AAYvBC,EAAAA,IAAI,EAAQ,GAZW;AAavBC,EAAAA,KAAK,EAAO,GAAA;AAbW,CAAlB;;;;;;;;;;;;;;;;;;;;;;;ACrXP,IAAMC,0BAA0B,GAAM5F,WAAN,GAAhC,eAAA,CAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACO,IAAM6F,MAAM,GAAG;AACpBC,EAAAA,MAAM,EAAY,KADE;AAEpBC,EAAAA,UAAU,EAAQ,CAFE;AAGpBC,EAAAA,gBAAgB,EAAE,KAHE;AAIpBC,EAAAA,cAAc,EAAI,IAJE;AAKpBC,EAAAA,eAAe,EAAG,CALE;AAMpBC,EAAAA,eAAe,EAAG,IANE;AAOpBC,EAAAA,eAAe,EAAG,IAAA;AAPE,EAAf;AAUP;AACA;AACA;;AACAP,MAAM,CAACQ,IAAP,GAAc,YAAM;AAClB,EAAA,IAAI,CAACR,MAAM,CAACC,MAAZ,EAAoB;IAClB,IAAMQ,GAAG,GAAGC,WAAW,EAAvB,CAAA;IAEAV,MAAM,CAACC,MAAP,GAAgB,IAAhB,CAAA;AACAD,IAAAA,MAAM,CAACE,UAAP,GAAoBS,MAAM,CAACC,gBAAP,IAA2B,CAA/C,CAAA;AACAZ,IAAAA,MAAM,CAACG,gBAAP,GAA0BM,GAAG,IAAI,IAAjC,CAAA;AACAT,IAAAA,MAAM,CAACI,cAAP,GAAwBA,cAAc,EAAtC,CAAA;AACAJ,IAAAA,MAAM,CAACK,eAAP,GAAyBQ,kBAAkB,CAACJ,GAAD,CAA3C,CAAA;AACAT,IAAAA,MAAM,CAACM,eAAP,GAAyBQ,kBAAkB,EAA3C,CAAA;AACAd,IAAAA,MAAM,CAACO,eAAP,GAAyBQ,kBAAkB,EAA3C,CAAA;AACD,GAAA;AACF,CAZD,CAAA;;AAcA,IAAIC,cAAc,GAAG,IAArB,CAAA;;AACAhB,MAAM,CAACiB,iBAAP,GAA2B,YAAM;EAC/B,IAAID,cAAc,KAAK,IAAvB,EAA6B;AAC3BA,IAAAA,cAAc,GAAGC,iBAAiB,CAACjB,MAAM,CAACK,eAAR,CAAlC,CAAA;AACD,GAAA;;AACD,EAAA,OAAOW,cAAP,CAAA;AACD,CALD,CAAA;AAOA;AACA;AACA;AACA;AACA;;;AACA,SAASN,WAAT,GAAuB;AACrB,EAAA,IAAMQ,MAAM,GAAGC,QAAQ,CAACC,aAAT,CAAuB,QAAvB,CAAf,CAAA;EACA,IAAMC,KAAK,GAAG,CAAC,OAAD,EAAU,oBAAV,EAAgC,WAAhC,EAA6C,WAA7C,CAAd,CAAA;EACA,IAAIC,OAAO,GAAG,IAAd,CAAA;;AAEA,EAAA,IAAI,CAACJ,MAAM,CAACK,UAAZ,EAAwB;AACtB,IAAA,OAAO,IAAP,CAAA;AACD,GAAA;;AAED,EAAA,IAAIF,KAAK,CAACG,IAAN,CAAW,UAAClJ,IAAD,EAAU;IACvB,IAAI;AACFgJ,MAAAA,OAAO,GAAGJ,MAAM,CAACK,UAAP,CAAkBjJ,IAAlB,CAAV,CAAA;MACA,OAAOgJ,OAAO,KAAK,IAAnB,CAAA;KAFF,CAIA,OAAOG,CAAP,EAAU;AACR,MAAA,OAAO,KAAP,CAAA;AACD,KAAA;AACF,GARG,CAAJ,EAQI;AACF,IAAA,OAAOH,OAAP,CAAA;AACD,GAVD,MAWK;AACH,IAAA,OAAO,IAAP,CAAA;AACD,GAAA;AACF,CAAA;AAED;AACA;AACA;AACA;AACA;;;AACA,SAASlB,cAAT,GAA0B;EACxB,IAAIsB,OAAO,GAAI,cAAkBf,IAAAA,MAAnB,IAA+BgB,SAAS,CAACC,cAAV,GAA2B,CAAxE,CAAA;;EACA,IAAI7B,0BAA0B,IAAI8B,YAAlC,EAAgD;AAC9CH,IAAAA,OAAO,GAAGG,YAAY,CAAC9B,0BAAD,CAAZ,KAA6C,MAAvD,CAAA;AACD,GAAA;;AAED,EAAA,IAAM+B,OAAO,GAAG,IAAIC,OAAJ,CAAY,UAACC,OAAD,EAAa;AACvC,IAAA,IAAIC,KAAJ,CAAA;;AAEA,IAAA,IAAMC,aAAa,GAAG,SAAhBA,aAAgB,GAAM;MAC1BD,KAAK,EAAA,CAAA;AACLJ,MAAAA,YAAY,CAAC9B,0BAAD,CAAZ,GAA2C,KAA3C,CAAA;MACAiC,OAAO,CAAC,KAAD,CAAP,CAAA;KAHF,CAAA;;AAMA,IAAA,IAAMG,aAAa,GAAG,SAAhBA,aAAgB,GAAM;MAC1BF,KAAK,EAAA,CAAA;AACLJ,MAAAA,YAAY,CAAC9B,0BAAD,CAAZ,GAA2C,IAA3C,CAAA;MACAiC,OAAO,CAAC,IAAD,CAAP,CAAA;KAHF,CAAA;;AAMA,IAAA,IAAMI,eAAe,GAAG,SAAlBA,eAAkB,GAAM;MAC5BH,KAAK,EAAA,CAAA;AACLJ,MAAAA,YAAY,CAAC9B,0BAAD,CAAZ,GAA2C2B,OAA3C,CAAA;MACAM,OAAO,CAACN,OAAD,CAAP,CAAA;KAHF,CAAA;;AAMAf,IAAAA,MAAM,CAAC0B,gBAAP,CAAwB,WAAxB,EAAqCH,aAArC,EAAoD,KAApD,CAAA,CAAA;AACAvB,IAAAA,MAAM,CAAC0B,gBAAP,CAAwB,YAAxB,EAAsCF,aAAtC,EAAqD,KAArD,CAAA,CAAA;AACA,IAAA,IAAMG,iBAAiB,GAAGC,UAAU,CAACH,eAAD,EAAkB,KAAlB,CAApC,CAAA;;AAEAH,IAAAA,KAAK,GAAG,SAAM,KAAA,GAAA;AACZtB,MAAAA,MAAM,CAAC6B,mBAAP,CAA2B,WAA3B,EAAwCN,aAAxC,CAAA,CAAA;AACAvB,MAAAA,MAAM,CAAC6B,mBAAP,CAA2B,YAA3B,EAAyCL,aAAzC,CAAA,CAAA;MACAM,YAAY,CAACH,iBAAD,CAAZ,CAAA;KAHF,CAAA;AAKD,GA9Be,CAAhB,CAAA;EAgCA,OAAO;AAAEZ,IAAAA,OAAO,EAAPA,OAAF;AAAWI,IAAAA,OAAO,EAAPA,OAAAA;GAAlB,CAAA;AACD,CAAA;AAED;AACA;AACA;AACA;AACA;;;AACA,SAASjB,kBAAT,CAA4BJ,GAA5B,EAAiC;EAC/B,IAAIA,GAAG,KAAK,IAAZ,EAAkB;AAChB,IAAA,OAAOA,GAAG,CAACiC,YAAJ,CAAiBjC,GAAG,CAACkC,gBAArB,CAAP,CAAA;AACD,GAFD,MAGK;AACH,IAAA,OAAO,CAAP,CAAA;AACD,GAAA;AACF,CAAA;AAED;AACA;AACA;AACA;AACA;AACA;AACA;;;AACA,SAAS1B,iBAAT,CAA2B2B,QAA3B,EAAqC;AACnC,EAAA,IAAM1B,MAAM,GAAGC,QAAQ,CAACC,aAAT,CAAuB,QAAvB,CAAf,CAAA;AACA,EAAA,IAAMX,GAAG,GAAGS,MAAM,CAACK,UAAP,CAAkB,IAAlB,CAAZ,CAAA;EACAL,MAAM,CAAC2B,KAAP,GAAeD,QAAf,CAAA;AACA1B,EAAAA,MAAM,CAAC4B,MAAP,GAAgBF,QAAQ,GAAG,CAA3B,CAAA;;AAEA,EAAA,OAAO1B,MAAM,CAAC2B,KAAP,GAAe,IAAtB,EAA4B;IAC1BpC,GAAG,CAACsC,SAAJ,GAAgB,OAAhB,CAAA;IACAtC,GAAG,CAACuC,QAAJ,CAAa,CAAb,EAAgB,CAAhB,EAAmB,CAAnB,EAAsB,CAAtB,CAAA,CAAA;;IAEA,IAAI;AACF,MAAA,IAAIvC,GAAG,CAACwC,YAAJ,CAAiB,CAAjB,EAAoB,CAApB,EAAuB,CAAvB,EAA0B,CAA1B,CAA6BC,CAAAA,IAA7B,CAAkC,CAAlC,CAAA,GAAuC,CAA3C,EAA8C;QAC5C,OAAOhC,MAAM,CAAC2B,KAAd,CAAA;AACD,OAAA;AACF,KAJD,CAKA,OAAOpB,CAAP,EAAU;AAET,KAAA;;IAEDP,MAAM,CAAC2B,KAAP,IAAgB,CAAhB,CAAA;IACA3B,MAAM,CAAC4B,MAAP,IAAiB,CAAjB,CAAA;AACD,GAAA;;AAED,EAAA,MAAM,IAAIhL,QAAJ,CAAa,sCAAb,CAAN,CAAA;AACD,CAAA;AAED;AACA;AACA;AACA;AACA;;;AACA,SAASgJ,kBAAT,GAA8B;AAC5B,EAAA,IAAI,aAAaK,QAAQ,CAACC,aAAT,CAAuB,KAAvB,CAAjB,EAAgD;AAAE;AAChD,IAAA,OAAO,OAAP,CAAA;AACD,GAFD,MAGK,IAAID,QAAQ,CAACgC,YAAT,KAA0BC,SAA9B,EAAyC;AAAE;AAC9C,IAAA,OAAO,YAAP,CAAA;AACD,GAFI,MAGA;AAAE;AACL,IAAA,OAAO,gBAAP,CAAA;AACD,GAAA;AACF,CAAA;AAED;AACA;AACA;AACA;AACA;AACA;;;AACA,IAAMC,kBAAkB,GAAG;AACzBC,EAAAA,cAAc,EAAQ,kBADG;AAEzBC,EAAAA,oBAAoB,EAAE,wBAFG;AAGzBC,EAAAA,mBAAmB,EAAG,qBAHG;AAIzBC,EAAAA,gBAAgB,EAAM,oBAAA;AAJG,CAA3B,CAAA;AAQA;AACA;AACA;AACA;AACA;;AACA,SAAS1C,kBAAT,GAA8B;EAC5B,IAAM2C,UAAU,GAAGtL,MAAM,CAACuL,IAAP,CAAYN,kBAAZ,CAAgCO,CAAAA,MAAhC,CAAuC,UAAAC,IAAI,EAAA;IAAA,OAAIA,IAAI,IAAI1C,QAAZ,CAAA;AAAA,GAA3C,CAAnB,CAAA;;EAEA,IAAIuC,UAAU,CAACI,MAAf,EAAuB;AACrB,IAAA,OAAOT,kBAAkB,CAACK,UAAU,CAAC,CAAD,CAAX,CAAzB,CAAA;AACD,GAFD,MAGK;AACH,IAAA,OAAO,IAAP,CAAA;AACD,GAAA;AACF;;AC9ND;AACA;AACA;AACA;AACA;AACA;AACA;AACO,SAASK,WAAT,CAAqBC,OAArB,EAA8BC,SAA9B,EAAyCC,MAAzC,EAAiD;EACtD,IAAIA,MAAM,KAAKd,SAAf,EAA0B;AACxBY,IAAAA,OAAO,CAACG,SAAR,CAAkBC,MAAlB,CAAyBH,SAAzB,CAAA,CAAA;AACD,GAFD,MAGK,IAAIC,MAAM,IAAI,CAACF,OAAO,CAACG,SAAR,CAAkBE,QAAlB,CAA2BJ,SAA3B,CAAf,EAAsD;AACzDD,IAAAA,OAAO,CAACG,SAAR,CAAkBG,GAAlB,CAAsBL,SAAtB,CAAA,CAAA;AACD,GAFI,MAGA,IAAI,CAACC,MAAL,EAAa;AAChBF,IAAAA,OAAO,CAACG,SAAR,CAAkBI,MAAlB,CAAyBN,SAAzB,CAAA,CAAA;AACD,GAAA;AACF,CAAA;AAED;AACA;AACA;AACA;AACA;AACA;;AACO,SAASO,UAAT,CAAoBR,OAApB,EAA6BC,SAA7B,EAAwC;AAC7C,EAAA,IAAIA,SAAJ,EAAe;IACbA,SAAS,CAACQ,KAAV,CAAgB,GAAhB,EAAqBC,OAArB,CAA6B,UAACpM,IAAD,EAAU;AACrCyL,MAAAA,WAAW,CAACC,OAAD,EAAU1L,IAAV,EAAgB,IAAhB,CAAX,CAAA;KADF,CAAA,CAAA;AAGD,GAAA;AACF,CAAA;AAED;AACA;AACA;AACA;AACA;AACA;;AACO,SAASqM,aAAT,CAAuBX,OAAvB,EAAgCC,SAAhC,EAA2C;AAChD,EAAA,IAAIA,SAAJ,EAAe;IACbA,SAAS,CAACQ,KAAV,CAAgB,GAAhB,EAAqBC,OAArB,CAA6B,UAACpM,IAAD,EAAU;AACrCyL,MAAAA,WAAW,CAACC,OAAD,EAAU1L,IAAV,EAAgB,KAAhB,CAAX,CAAA;KADF,CAAA,CAAA;AAGD,GAAA;AACF,CAAA;AAED;AACA;AACA;AACA;AACA;AACA;AACA;;AACO,SAASsM,SAAT,CAAmBC,EAAnB,EAAuBC,MAAvB,EAA+B;EACpC,IAAIC,IAAI,GAAGF,EAAX,CAAA;;EAEA,GAAG;IACD,IAAIE,IAAI,KAAKD,MAAb,EAAqB;AACnB,MAAA,OAAO,IAAP,CAAA;AACD,KAAA;;IACDC,IAAI,GAAGA,IAAI,CAACC,UAAZ,CAAA;AACD,GALD,QAKSD,IALT,EAAA;;AAOA,EAAA,OAAO,KAAP,CAAA;AACD,CAAA;AAED;AACA;AACA;AACA;AACA;AACA;AACA;;AACO,SAASE,UAAT,CAAoBJ,EAApB,EAAwBK,QAAxB,EAAkC;AACvC;AACA,EAAA,IAAI,CAACL,EAAE,CAACM,OAAR,EAAiB;AACf,IAAA,OAAO,IAAP,CAAA;AACD,GAAA;;EAED,IAAIJ,IAAI,GAAGF,EAAX,CAAA;;EAEA,GAAG;AACD,IAAA,IAAIE,IAAI,CAACI,OAAL,CAAaD,QAAb,CAAJ,EAA4B;AAC1B,MAAA,OAAOH,IAAP,CAAA;AACD,KAAA;;IACDA,IAAI,GAAGA,IAAI,YAAYK,UAAhB,GAA6BL,IAAI,CAACC,UAAlC,GAA+CD,IAAI,CAACM,aAA3D,CAAA;AACD,GALD,QAKSN,IALT,EAAA;;AAOA,EAAA,OAAO,IAAP,CAAA;AACD,CAAA;AAED;AACA;AACA;AACA;AACA;AACA;AACA;;AACO,SAASO,WAAT,CAAqBT,EAArB,EAAyB;EAC9B,IAAIU,IAAI,GAAG,CAAX,CAAA;EACA,IAAIC,GAAG,GAAG,CAAV,CAAA;EACA,IAAIT,IAAI,GAAGF,EAAX,CAAA;;AAEA,EAAA,OAAOE,IAAP,EAAa;IACXQ,IAAI,IAAKR,IAAI,CAACU,UAAL,GAAkBV,IAAI,CAACW,UAAvB,GAAoCX,IAAI,CAACY,UAAlD,CAAA;IACAH,GAAG,IAAKT,IAAI,CAACa,SAAL,GAAiBb,IAAI,CAACc,SAAtB,GAAkCd,IAAI,CAACe,SAA/C,CAAA;IACAf,IAAI,GAAGA,IAAI,CAACgB,YAAZ,CAAA;AACD,GAAA;;EAED,OAAO;AAAER,IAAAA,IAAI,EAAJA,IAAF;AAAQC,IAAAA,GAAG,EAAHA,GAAAA;GAAf,CAAA;AACD,CAAA;AAED;AACA;AACA;AACA;AACA;AACA;;AACO,SAASQ,mBAAT,CAA6BC,GAA7B,EAAkC;EACvC,OAAO,CAAC9E,QAAQ,CAAC+E,iBAAT,IAA8B/E,QAAQ,CAACgF,uBAAxC,MAAqEF,GAA5E,CAAA;AACD,CAAA;AAED;AACA;AACA;AACA;AACA;;AACO,SAASG,iBAAT,CAA2BH,GAA3B,EAAgC;EACrC,CAACA,GAAG,CAACG,iBAAJ,IAAyBH,GAAG,CAACI,uBAA9B,EAAuDC,IAAvD,CAA4DL,GAA5D,CAAA,CAAA;AACD,CAAA;AAED;AACA;AACA;AACA;;AACO,SAAS3C,cAAT,GAA0B;EAC/B,CAACnC,QAAQ,CAACmC,cAAT,IAA2BnC,QAAQ,CAACoC,oBAArC,EAA2D+C,IAA3D,CAAgEnF,QAAhE,CAAA,CAAA;AACD,CAAA;AAED;AACA;AACA;AACA;AACA;AACA;AACA;;AACO,SAASoF,QAAT,CAAkBN,GAAlB,EAAuBO,IAAvB,EAA6B;EAClC,OAAO7F,MAAM,CAAC8F,gBAAP,CAAwBR,GAAxB,EAA6B,IAA7B,CAAmCO,CAAAA,IAAnC,CAAP,CAAA;AACD,CAAA;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACO,SAASE,cAAT,CAAwBC,KAAxB,EAA+B;EACpC,IAAMC,UAAU,GAAG,EAAnB,CAAA;EACA,IAAMC,WAAW,GAAG,EAApB,CAAA;EACA,IAAMC,WAAW,GAAG,GAApB,CAAA;EAEA,IAAIC,KAAK,GAAG,CAAZ,CAAA;EACA,IAAIC,KAAK,GAAG,CAAZ,CAAA;EACA,IAAIC,MAAM,GAAG,CAAb,CAAA;AACA,EAAA,IAAIC,MAAM,GAAG,CAAb,CARoC;;EAWpC,IAAI,QAAA,IAAYP,KAAhB,EAAuB;IACrBK,KAAK,GAAGL,KAAK,CAACQ,MAAd,CAAA;AACD,GAAA;;EACD,IAAI,YAAA,IAAgBR,KAApB,EAA2B;AACzBK,IAAAA,KAAK,GAAG,CAACL,KAAK,CAACS,UAAP,GAAoB,GAA5B,CAAA;AACD,GAAA;;EACD,IAAI,aAAA,IAAiBT,KAArB,EAA4B;AAC1BK,IAAAA,KAAK,GAAG,CAACL,KAAK,CAACU,WAAP,GAAqB,GAA7B,CAAA;AACD,GAAA;;EACD,IAAI,aAAA,IAAiBV,KAArB,EAA4B;AAC1BI,IAAAA,KAAK,GAAG,CAACJ,KAAK,CAACW,WAAP,GAAqB,GAA7B,CAAA;AACD,GAtBmC;;;EAyBpC,IAAI,MAAA,IAAUX,KAAV,IAAmBA,KAAK,CAACY,IAAN,KAAeZ,KAAK,CAACa,eAA5C,EAA6D;AAC3DT,IAAAA,KAAK,GAAGC,KAAR,CAAA;AACAA,IAAAA,KAAK,GAAG,CAAR,CAAA;AACD,GAAA;;EAEDC,MAAM,GAAGF,KAAK,GAAGH,UAAjB,CAAA;EACAM,MAAM,GAAGF,KAAK,GAAGJ,UAAjB,CAAA;;EAEA,IAAI,QAAA,IAAYD,KAAhB,EAAuB;IACrBO,MAAM,GAAGP,KAAK,CAACc,MAAf,CAAA;AACD,GAAA;;EACD,IAAI,QAAA,IAAYd,KAAhB,EAAuB;IACrBM,MAAM,GAAGN,KAAK,CAACe,MAAf,CAAA;AACD,GAAA;;EAED,IAAI,CAACT,MAAM,IAAIC,MAAX,KAAsBP,KAAK,CAACgB,SAAhC,EAA2C;AACzC;AACA,IAAA,IAAIhB,KAAK,CAACgB,SAAN,KAAoB,CAAxB,EAA2B;AACzBV,MAAAA,MAAM,IAAIJ,WAAV,CAAA;AACAK,MAAAA,MAAM,IAAIL,WAAV,CAAA;AACD,KAHD;SAKK;AACHI,MAAAA,MAAM,IAAIH,WAAV,CAAA;AACAI,MAAAA,MAAM,IAAIJ,WAAV,CAAA;AACD,KAAA;AACF,GAnDmC;;;AAsDpC,EAAA,IAAIG,MAAM,IAAI,CAACF,KAAf,EAAsB;IACpBA,KAAK,GAAIE,MAAM,GAAG,CAAV,GAAe,CAAC,CAAhB,GAAoB,CAA5B,CAAA;AACD,GAAA;;AACD,EAAA,IAAIC,MAAM,IAAI,CAACF,KAAf,EAAsB;IACpBA,KAAK,GAAIE,MAAM,GAAG,CAAV,GAAe,CAAC,CAAhB,GAAoB,CAA5B,CAAA;AACD,GAAA;;EAED,OAAO;AAAEH,IAAAA,KAAK,EAALA,KAAF;AAASC,IAAAA,KAAK,EAALA,KAAT;AAAgBC,IAAAA,MAAM,EAANA,MAAhB;AAAwBC,IAAAA,MAAM,EAANA,MAAAA;GAA/B,CAAA;AACD;;AC9ND;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO,SAASU,KAAT,CAAeC,CAAf,EAAkBC,GAAlB,EAAuBC,GAAvB,EAA4B;AACjC,EAAA,OAAO5J,IAAI,CAAC4J,GAAL,CAASD,GAAT,EAAc3J,IAAI,CAAC2J,GAAL,CAASC,GAAT,EAAcF,CAAd,CAAd,CAAP,CAAA;AACD,CAAA;AAED;AACA;AACA;AACA;AACA;AACA;;AACO,SAASG,IAAT,CAAcC,KAAd,EAAqBF,GAArB,EAA0B;AAC/B,EAAA,IAAIG,MAAM,GAAGD,KAAK,GAAGF,GAArB,CAAA;;EAEA,IAAIG,MAAM,GAAG,CAAb,EAAgB;AACdA,IAAAA,MAAM,IAAIH,GAAV,CAAA;AACD,GAAA;;AAED,EAAA,OAAOG,MAAP,CAAA;AACD,CAAA;AAED;AACA;AACA;AACA;AACA;AACA;;AACO,SAASC,SAAT,CAAmBF,KAAnB,EAA0B;EAC/B,IAAIG,MAAM,CAACD,SAAX,EAAsB;AACpB,IAAA,OAAOC,MAAM,CAACD,SAAP,CAAiBF,KAAjB,CAAP,CAAA;AACD,GAAA;;AACD,EAAA,OAAO,OAAOA,KAAP,KAAiB,QAAjB,IAA6BG,MAAM,CAACC,QAAP,CAAgBJ,KAAhB,CAA7B,IAAuD9J,IAAI,CAACmK,KAAL,CAAWL,KAAX,MAAsBA,KAApF,CAAA;AACD,CAAA;AAED;AACA;AACA;AACA;AACA;AACA;;AACO,SAASM,YAAT,CAAsBV,CAAtB,EAAyB;AAC9B,EAAA,OAAQ1J,IAAI,CAACqK,GAAL,CAASX,CAAT,CAAc1J,GAAAA,IAAI,CAACqK,GAAL,CAAS,CAAT,CAAf,GAA8B,CAA9B,KAAoC,CAA3C,CAAA;AACD,CAAA;AAED;AACA;AACA;AACA;AACA;AACA;;AACO,SAASC,GAAT,CAAaC,KAAb,EAAoB;AACzB,EAAA,OAAOA,KAAK,CAACC,MAAN,CAAa,UAACC,CAAD,EAAIC,CAAJ,EAAA;IAAA,OAAUD,CAAC,GAAGC,CAAd,CAAA;GAAb,EAA8B,CAA9B,CAAP,CAAA;AACD,CAAA;AAED;AACA;AACA;AACA;AACA;AACA;AACA;;AACO,SAASC,QAAT,CAAkBC,EAAlB,EAAsBC,EAAtB,EAA0B;AAC/B,EAAA,OAAO7K,IAAI,CAACW,IAAL,CAAUX,IAAI,CAACO,GAAL,CAASqK,EAAE,CAAClB,CAAH,GAAOmB,EAAE,CAACnB,CAAnB,EAAsB,CAAtB,CAAA,GAA2B1J,IAAI,CAACO,GAAL,CAASqK,EAAE,CAACE,CAAH,GAAOD,EAAE,CAACC,CAAnB,EAAsB,CAAtB,CAArC,CAAP,CAAA;AACD,CAAA;AAED;AACA;AACA;AACA;AACA;AACA;AACA;;AACO,SAASC,cAAT,CAAwBC,IAAxB,EAA8BC,EAA9B,EAAkC;AACvC,EAAA,IAAMC,WAAW,GAAG,CAClB,CADkB;AAElBlL,EAAAA,IAAI,CAACE,EAAL,GAAU,CAFQ;AAGlB,EAAA,CAACF,IAAI,CAACE,EAAN,GAAW,CAHO;GAApB,CAAA;EAMA,OAAOgL,WAAW,CAACV,MAAZ,CAAmB,UAACV,KAAD,EAAQqB,SAAR,EAAsB;AAC9C,IAAA,IAAMC,YAAY,GAAGH,EAAE,GAAGD,IAAL,GAAYG,SAAjC,CAAA;AACA,IAAA,OAAOnL,IAAI,CAACqL,GAAL,CAASD,YAAT,CAAyBpL,GAAAA,IAAI,CAACqL,GAAL,CAASvB,KAAT,CAAzB,GAA2CsB,YAA3C,GAA0DtB,KAAjE,CAAA;GAFK,EAGJwB,QAHI,CAAP,CAAA;AAID,CAAA;AAED;AACA;AACA;AACA;AACA;AACA;AACA;;AACO,SAASC,QAAT,CAAkBC,SAAlB,EAA6BC,SAA7B,EAAwC;EAC7C,OAAOzL,IAAI,CAAC0L,IAAL,CACL1L,IAAI,CAACC,GAAL,CAASuL,SAAS,CAACG,QAAnB,IACE3L,IAAI,CAACC,GAAL,CAASwL,SAAS,CAACE,QAAnB,CADF,GAEE3L,IAAI,CAACC,GAAL,CAASuL,SAAS,CAACI,SAAV,GAAsBH,SAAS,CAACG,SAAzC,CAFF,GAGE5L,IAAI,CAACI,GAAL,CAASoL,SAAS,CAACG,QAAnB,CACA3L,GAAAA,IAAI,CAACI,GAAL,CAASqL,SAAS,CAACE,QAAnB,CALG,CAAP,CAAA;AAOD,CAAA;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACO,SAASE,gBAAT,CAA0BjB,EAA1B,EAA8BC,EAA9B,EAAkC;EACvC,IAAOiB,EAAP,GAAiBlB,EAAjB,CAAA,CAAA,CAAA;MAAWmB,EAAX,GAAiBnB,EAAjB,CAAA,CAAA,CAAA,CAAA;EACA,IAAOoB,EAAP,GAAiBnB,EAAjB,CAAA,CAAA,CAAA;MAAWoB,EAAX,GAAiBpB,EAAjB,CAAA,CAAA,CAAA,CAAA;AAEA,EAAA,IAAMnB,CAAC,GAAG,CAACsC,EAAE,GAAGF,EAAN,IAAY9L,IAAI,CAACC,GAAL,CAAS,CAAC8L,EAAE,GAAGE,EAAN,IAAY,CAArB,CAAtB,CAAA;AACA,EAAA,IAAMnB,CAAC,GAAImB,EAAE,GAAGF,EAAhB,CAAA;EACA,OAAO/L,IAAI,CAACW,IAAL,CAAU+I,CAAC,GAAGA,CAAJ,GAAQoB,CAAC,GAAGA,CAAtB,CAAP,CAAA;AACD;;AC5HD;AACA;AACA;AACA;AACA;AACA;AACO,SAASoB,SAAT,CAAmBC,GAAnB,EAAwB;EAC7B,OAAOA,GAAG,CAACC,OAAJ,CAAY,8CAAZ,EAA4D,UAACC,CAAD,EAAIC,CAAJ,EAAU;AAC3E,IAAA,OAAO,CAACA,CAAC,GAAG,CAAJ,GAAQ,GAAR,GAAc,EAAf,IAAqBD,CAAC,CAACE,WAAF,EAA5B,CAAA;AACD,GAFM,CAAP,CAAA;AAGD,CAAA;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACO,SAASC,QAAT,CAAkBC,IAAlB,EAAwBC,IAAxB,EAA8B;AACnC;AACA,EAAA,IAAIC,IAAJ,EAAUC,IAAV,EAAgB7C,MAAhB,CAAA;AACA,EAAA,IAAI8C,OAAJ,CAAA;EACA,IAAIC,QAAQ,GAAG,CAAf,CAAA;;AACA,EAAA,IAAMC,KAAK,GAAG,SAARA,KAAQ,GAAW;AACvBD,IAAAA,QAAQ,GAAGE,IAAI,CAACC,GAAL,EAAX,CAAA;AACAJ,IAAAA,OAAO,GAAG5H,SAAV,CAAA;IACA8E,MAAM,GAAG0C,IAAI,CAACS,KAAL,CAAWP,IAAX,EAAiBC,IAAjB,CAAT,CAAA;;IACA,IAAI,CAACC,OAAL,EAAc;MACZF,IAAI,GAAGC,IAAI,GAAG,IAAd,CAAA;AACD,KAAA;GANH,CAAA;;AAQA,EAAA,OAAO,YAAW;AAChB,IAAA,IAAMK,GAAG,GAAGD,IAAI,CAACC,GAAL,EAAZ,CAAA;;IACA,IAAI,CAACH,QAAL,EAAe;AACbA,MAAAA,QAAQ,GAAGG,GAAX,CAAA;AACD,KAAA;;AACD,IAAA,IAAME,SAAS,GAAGT,IAAI,IAAIO,GAAG,GAAGH,QAAV,CAAtB,CAAA;AACAH,IAAAA,IAAI,GAAG,IAAP,CAAA;AACAC,IAAAA,IAAI,GAAGQ,SAAP,CAAA;;AACA,IAAA,IAAID,SAAS,IAAI,CAAb,IAAkBA,SAAS,GAAGT,IAAlC,EAAwC;AACtC,MAAA,IAAIG,OAAJ,EAAa;QACXvI,YAAY,CAACuI,OAAD,CAAZ,CAAA;AACAA,QAAAA,OAAO,GAAG5H,SAAV,CAAA;AACD,OAAA;;AACD6H,MAAAA,QAAQ,GAAGG,GAAX,CAAA;MACAlD,MAAM,GAAG0C,IAAI,CAACS,KAAL,CAAWP,IAAX,EAAiBC,IAAjB,CAAT,CAAA;;MACA,IAAI,CAACC,OAAL,EAAc;QACZF,IAAI,GAAGC,IAAI,GAAG,IAAd,CAAA;AACD,OAAA;AACF,KAVD,MAWK,IAAI,CAACC,OAAL,EAAc;AACjBA,MAAAA,OAAO,GAAGzI,UAAU,CAAC2I,KAAD,EAAQI,SAAR,CAApB,CAAA;AACD,KAAA;;AACD,IAAA,OAAOpD,MAAP,CAAA;GAtBF,CAAA;AAwBA;AACD,CAAA;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACO,SAASsD,aAAT,CAAuBC,GAAvB,EAA4B;AACjC;EACA,IAAI,OAAOA,GAAP,KAAe,QAAf,IAA2BA,GAAG,KAAK,IAAvC,EAA6C;AAC3C;AACA,IAAA,IAAI,OAAOrT,MAAM,CAACsT,cAAd,KAAiC,UAArC,EAAiD;AAC/C,MAAA,IAAMC,KAAK,GAAGvT,MAAM,CAACsT,cAAP,CAAsBD,GAAtB,CAAd,CAAA;MACA,OAAOE,KAAK,KAAKvT,MAAM,CAACD,SAAjB,IAA8BwT,KAAK,KAAK,IAA/C,CAAA;AACD,KAL0C;AAQ3C;;;IACA,OAAOvT,MAAM,CAACD,SAAP,CAAiByT,QAAjB,CAA0BtF,IAA1B,CAA+BmF,GAA/B,CAAA,KAAwC,iBAA/C,CAAA;AACD,GAZgC;;;AAejC,EAAA,OAAO,KAAP,CAAA;AACD,CAAA;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACO,SAASI,SAAT,CAAmBC,MAAnB,EAA2BC,GAA3B,EAAgC;AACrC;EACA,IAAIC,KAAK,GAAGD,GAAZ,CAAA;AAEA,EAAA,OAAQ,SAASE,KAAT,CAAeH,MAAf,EAAuBC,GAAvB,EAA4B;AAClC,IAAA,IAAIG,KAAK,CAACC,OAAN,CAAcJ,GAAd,CAAJ,EAAwB;MACtB,IAAI,CAACD,MAAD,IAAW,CAACI,KAAK,CAACC,OAAN,CAAcL,MAAd,CAAhB,EAAuC;AACrCA,QAAAA,MAAM,GAAG,EAAT,CAAA;AACD,OAFD,MAGK;QACHA,MAAM,CAAChI,MAAP,GAAgB,CAAhB,CAAA;AACD,OAAA;;AACDiI,MAAAA,GAAG,CAACrH,OAAJ,CAAY,UAASjD,CAAT,EAAYgJ,CAAZ,EAAe;QACzBqB,MAAM,CAACrB,CAAD,CAAN,GAAYwB,KAAK,CAAC,IAAD,EAAOxK,CAAP,CAAjB,CAAA;OADF,CAAA,CAAA;AAGD,KAVD,MAWK,IAAI,OAAOsK,GAAP,KAAe,QAAnB,EAA6B;MAChC,IAAI,CAACD,MAAD,IAAWI,KAAK,CAACC,OAAN,CAAcL,MAAd,CAAf,EAAsC;AACpCA,QAAAA,MAAM,GAAG,EAAT,CAAA;AACD,OAAA;;MACD1T,MAAM,CAACuL,IAAP,CAAYoI,GAAZ,EAAiBrH,OAAjB,CAAyB,UAAS0H,GAAT,EAAc;QACrC,IAAI,OAAOL,GAAG,CAACK,GAAD,CAAV,KAAoB,QAApB,IAAgC,CAACL,GAAG,CAACK,GAAD,CAApC,IAA6C,CAACZ,aAAa,CAACO,GAAG,CAACK,GAAD,CAAJ,CAA/D,EAA2E;AACzEN,UAAAA,MAAM,CAACM,GAAD,CAAN,GAAcL,GAAG,CAACK,GAAD,CAAjB,CAAA;SADF,MAGK,IAAIL,GAAG,CAACK,GAAD,CAAH,IAAYJ,KAAhB,EAAuB;AAC1B,UAAA,IAAI,CAACF,MAAM,CAACM,GAAD,CAAX,EAAkB;AAChBN,YAAAA,MAAM,CAACM,GAAD,CAAN,GAAcH,KAAK,CAAC,IAAD,EAAOF,GAAG,CAACK,GAAD,CAAV,CAAnB,CAAA;AACD,WAFD,MAGK;YACHH,KAAK,CAACH,MAAM,CAACM,GAAD,CAAP,EAAcL,GAAG,CAACK,GAAD,CAAjB,CAAL,CAAA;AACD,WAAA;AACF,SAAA;OAXH,CAAA,CAAA;AAaD,KAjBI,MAkBA;AACHN,MAAAA,MAAM,GAAGC,GAAT,CAAA;AACD,KAAA;;AAED,IAAA,OAAOD,MAAP,CAAA;AACD,GAnCO,CAmCNA,MAnCM,EAmCEC,GAnCF,CAAR,CAAA;AAoCA;AACD,CAAA;AAED;AACA;AACA;AACA;AACA;AACA;;AACO,SAASM,KAAT,CAAeN,GAAf,EAAoB;AACzB,EAAA,OAAOF,SAAS,CAAC,IAAD,EAAOE,GAAP,CAAhB,CAAA;AACD,CAAA;AAED;AACA;AACA;AACA;AACA;AACA;;AACO,SAASO,OAAT,CAAiBb,GAAjB,EAAsB;AAC3B,EAAA,OAAO,CAACA,GAAD,IAASrT,MAAM,CAACuL,IAAP,CAAY8H,GAAZ,CAAiB3H,CAAAA,MAAjB,KAA4B,CAA5B,IAAiC2H,GAAG,CAAClT,WAAJ,KAAoBH,MAArE,CAAA;AACD,CAAA;AAED;AACA;AACA;AACA;AACA;AACA;;AACO,SAASmU,IAAT,CAAcC,MAAd,EAAsBC,QAAtB,EAAgC;EACrCrU,MAAM,CAACuL,IAAP,CAAY6I,MAAZ,EAAoB9H,OAApB,CAA4B,UAAC0H,GAAD,EAAS;AACnCK,IAAAA,QAAQ,CAACD,MAAM,CAACJ,GAAD,CAAP,EAAcA,GAAd,CAAR,CAAA;GADF,CAAA,CAAA;AAGD,CAAA;AAED;AACA;AACA;AACA;AACA;AACA;;AACO,SAASM,KAAT,CAAeC,GAAf,EAAoB;AACzB,EAAA,OAAOA,GAAG,KAAK,IAAR,IAAgBA,GAAG,KAAKvJ,SAA/B,CAAA;AACD,CAAA;AAED;AACA;AACA;AACA;AACA;AACA;;AACO,SAASwJ,YAAT,GAAiC;AAAA,EAAA,KAAA,IAAA,IAAA,GAAA,SAAA,CAAA,MAAA,EAARC,MAAQ,GAAA,IAAA,KAAA,CAAA,IAAA,CAAA,EAAA,IAAA,GAAA,CAAA,EAAA,IAAA,GAAA,IAAA,EAAA,IAAA,EAAA,EAAA;IAARA,MAAQ,CAAA,IAAA,CAAA,GAAA,SAAA,CAAA,IAAA,CAAA,CAAA;AAAA,GAAA;;AACtC,EAAA,KAAA,IAAA,EAAA,GAAA,CAAA,EAAA,OAAA,GAAkBA,MAAlB,EAA0B,EAAA,GAAA,OAAA,CAAA,MAAA,EAAA,EAAA,EAAA,EAAA;AAArB,IAAA,IAAMF,GAAG,GAAT,OAAA,CAAA,EAAA,CAAA,CAAA;;AACH,IAAA,IAAI,CAACD,KAAK,CAACC,GAAD,CAAV,EAAiB;AACf,MAAA,OAAOA,GAAP,CAAA;AACD,KAAA;AACF,GAAA;;AAED,EAAA,OAAOvJ,SAAP,CAAA;AACD,CAAA;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACO,SAAS0J,SAAT,CAAmBC,IAAnB,EAAyBC,IAAzB,EAA+B;EACpC,IAAID,IAAI,KAAKC,IAAb,EAAmB;AACjB,IAAA,OAAO,IAAP,CAAA;GADF,MAGK,IAAIC,QAAQ,CAACF,IAAD,CAAR,IAAkBE,QAAQ,CAACD,IAAD,CAA9B,EAAsC;AACzC,IAAA,IAAI5U,MAAM,CAACuL,IAAP,CAAYoJ,IAAZ,CAAkBjJ,CAAAA,MAAlB,KAA6B1L,MAAM,CAACuL,IAAP,CAAYqJ,IAAZ,CAAA,CAAkBlJ,MAAnD,EAA2D;AACzD,MAAA,OAAO,KAAP,CAAA;AACD,KAAA;;AACD,IAAA,KAAA,IAAA,GAAA,GAAA,CAAA,EAAA,YAAA,GAAmB1L,MAAM,CAACuL,IAAP,CAAYoJ,IAAZ,CAAnB,EAAsC,GAAA,GAAA,YAAA,CAAA,MAAA,EAAA,GAAA,EAAA,EAAA;AAAjC,MAAA,IAAMvG,IAAI,GAAV,YAAA,CAAA,GAAA,CAAA,CAAA;;AACH,MAAA,IAAI,CAACsG,SAAS,CAACC,IAAI,CAACvG,IAAD,CAAL,EAAawG,IAAI,CAACxG,IAAD,CAAjB,CAAd,EAAwC;AACtC,QAAA,OAAO,KAAP,CAAA;AACD,OAAA;AACF,KAAA;;AACD,IAAA,OAAO,IAAP,CAAA;AACD,GAVI,MAWA;AACH,IAAA,OAAO,KAAP,CAAA;AACD,GAAA;AACF,CAAA;;AAED,SAASyG,QAAT,CAAkBxB,GAAlB,EAAuB;AACrB,EAAA,OAAO,OAAOA,GAAP,KAAe,QAAf,IAA2BA,GAAG,IAAI,IAAzC,CAAA;AACD;;ACjOD;AACA;AACA;AACA;AACA;AACA;;AACO,SAASyB,aAAT,CAAuBC,MAAvB,EAA+BrB,MAA/B,EAAuC;AAC5C,EAAA,IAAIqB,MAAJ,EAAY;AACV,IAAA,KAAA,IAAA,EAAA,GAAA,CAAA,EAAA,IAAA,GAAA,CAAqB,CAAC,GAAD,EAAMA,MAAN,CAArB,CAAA,CAAA,MAAA,CAAuC/U,MAAM,CAACgV,OAAP,CAAeD,MAAf,CAAvC,CAAgE,EAAA,EAAA,GAAA,IAAA,CAAA,MAAA,EAAA,EAAA,EAAA,EAAA;AAA3D,MAAA,IAAA,OAAA,GAAA,IAAA,CAAA,EAAA,CAAA;AAAA,UAASE,CAAT,GAAA,OAAA,CAAA,CAAA,CAAA,CAAA;;AACH,MAAA,IAAIA,CAAC,CAAClV,SAAF,YAAuB2T,MAA3B,EAAmC;AACjC,QAAA,OAAOuB,CAAP,CAAA;AACD,OAAA;AACF,KAAA;AACF,GAAA;;AACD,EAAA,OAAO,IAAP,CAAA;AACD,CAAA;AAED;AACA;AACA;AACA;AACA;;AACO,SAASC,aAAT,GAAyB;AAC9B,EAAA,IAAMC,KAAK,GAAG,IAAIvV,KAAJ,CAAU,sBAAV,CAAd,CAAA;EACAuV,KAAK,CAACjV,IAAN,GAAa,YAAb,CAAA;AACA,EAAA,OAAOiV,KAAP,CAAA;AACD,CAAA;AAED;AACA;AACA;AACA;AACA;AACA;;AACO,SAASC,YAAT,CAAsBC,GAAtB,EAA2B;EAChC,OAAO,CAAAA,GAAG,IAAH,IAAA,GAAA,KAAA,CAAA,GAAAA,GAAG,CAAEnV,IAAL,MAAc,YAArB,CAAA;AACD,CAAA;AAED;AACA;AACA;AACA;AACA;;AACO,SAASoV,OAAT,CAAiB3V,OAAjB,EAA0B;EAC/B4V,OAAO,CAACC,IAAR,CAAA,qBAAA,GAAmC7V,OAAnC,CAAA,CAAA;AACD,CAAA;AAED;AACA;AACA;AACA;AACA;AACA;;AACO,SAAS8V,kBAAT,CAA4BrB,MAA5B,EAAoC;AACzC,EAAA,OAAO,CAAC,CAAC,GAAD,EAAM,GAAN,CAAD,EAAa,CAAC,WAAD,EAAc,UAAd,CAAb,CAAwChL,CAAAA,IAAxC,CAA6C,UAAkB,IAAA,EAAA;AAAA,IAAA,IAAhBsM,IAAgB,GAAA,IAAA,CAAA,CAAA,CAAA;AAAA,QAAVC,IAAU,GAAA,IAAA,CAAA,CAAA,CAAA,CAAA;AACpE,IAAA,OAAOvB,MAAM,CAACsB,IAAD,CAAN,KAAiB1K,SAAjB,IAA8BoJ,MAAM,CAACuB,IAAD,CAAN,KAAiB3K,SAAtD,CAAA;AACD,GAFM,CAAP,CAAA;AAGD,CAAA;AAED;AACA;AACA;AACA;AACA;AACA;AACA;;AACO,SAAS4K,WAAT,CAAqB9K,IAArB,EAA2B+K,IAA3B,EAAiC;AACtC;AACA,EAAA,IAAI/F,MAAM,GAAGhF,IAAI,CAACgL,KAAL,CAAW,SAAA,GAAYD,IAAZ,GAAmB,eAAnB,GAAqCA,IAArC,GAA4C,GAAvD,CAAb,CAAA;;EACA,IAAI/F,MAAM,KAAK,IAAf,EAAqB;IACnB,IAAMyE,GAAG,GAAGwB,QAAQ,CAACjG,MAAM,CAAC,CAAD,CAAP,EAAY,EAAZ,CAApB,CAAA;AACA,IAAA,OAAOkG,KAAK,CAACzB,GAAD,CAAL,GAAa,IAAb,GAAoBA,GAA3B,CAAA;AACD,GANqC;;;EAStCzE,MAAM,GAAGhF,IAAI,CAACgL,KAAL,CAAW,QAAWD,GAAAA,IAAX,GAAkB,UAA7B,CAAT,CAAA;;EACA,IAAI/F,MAAM,KAAK,IAAf,EAAqB;IACnB,IAAMyE,IAAG,GAAGwB,QAAQ,CAACjG,MAAM,CAAC,CAAD,CAAP,EAAY,EAAZ,CAApB,CAAA;;AACA,IAAA,OAAOkG,KAAK,CAACzB,IAAD,CAAL,GAAa,IAAb,GAAoBA,IAA3B,CAAA;AACD,GAAA;;AAED,EAAA,OAAO,IAAP,CAAA;AACD,CAAA;AAED;AACA;AACA;AACA;AACA;;AACA,IAAM0B,aAAa,GAAG;AACpB7I,EAAAA,GAAG,EAAK,IADY;AAEpB8I,EAAAA,MAAM,EAAE,MAFY;AAGpB/I,EAAAA,IAAI,EAAI,IAHY;AAIpBgJ,EAAAA,KAAK,EAAG,MAJY;AAKpBC,EAAAA,MAAM,EAAE,KAAA;AALY,CAAtB,CAAA;AAQA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACO,SAASC,aAAT,CAAuBxG,KAAvB,EAA8B;EACnC,IAAI,CAACA,KAAL,EAAY;IACV,OAAO;AAAEJ,MAAAA,CAAC,EAAE,GAAL;AAAUoB,MAAAA,CAAC,EAAE,GAAA;KAApB,CAAA;AACD,GAAA;;AAED,EAAA,IAAI,OAAOhB,KAAP,KAAiB,QAArB,EAA+B;AAC7B,IAAA,OAAOA,KAAP,CAAA;AACD,GAAA;;AAED,EAAA,IAAIyG,MAAM,GAAGzG,KAAK,CAAC0G,iBAAN,EAA0BlK,CAAAA,KAA1B,CAAgC,GAAhC,EAAqCmK,KAArC,CAA2C,CAA3C,EAA8C,CAA9C,CAAb,CAAA;;AAEA,EAAA,IAAIF,MAAM,CAAC5K,MAAP,KAAkB,CAAtB,EAAyB;IACvB,IAAIuK,aAAa,CAACK,MAAM,CAAC,CAAD,CAAP,CAAb,KAA6BtL,SAAjC,EAA4C;MAC1CsL,MAAM,GAAG,CAACA,MAAM,CAAC,CAAD,CAAP,EAAY,QAAZ,CAAT,CAAA;AACD,KAFD,MAGK;MACHA,MAAM,GAAG,CAACA,MAAM,CAAC,CAAD,CAAP,EAAYA,MAAM,CAAC,CAAD,CAAlB,CAAT,CAAA;AACD,KAAA;AACF,GAAA;;AAED,EAAA,IAAMG,MAAM,GAAGH,MAAM,CAAC,CAAD,CAAN,KAAc,MAAd,IAAwBA,MAAM,CAAC,CAAD,CAAN,KAAc,OAAtC,IAAiDA,MAAM,CAAC,CAAD,CAAN,KAAc,KAA/D,IAAwEA,MAAM,CAAC,CAAD,CAAN,KAAc,QAArG,CAAA;AAEAA,EAAAA,MAAM,GAAGA,MAAM,CAACI,GAAP,CAAW,UAAAC,KAAK,EAAA;AAAA,IAAA,OAAIV,aAAa,CAACU,KAAD,CAAb,IAAwBA,KAA5B,CAAA;AAAA,GAAhB,CAAT,CAAA;;EAEA,IAAI,CAACF,MAAL,EAAa;AACXH,IAAAA,MAAM,CAACM,OAAP,EAAA,CAAA;AACD,GAAA;;EAED,IAAMC,MAAM,GAAGP,MAAM,CAACQ,IAAP,CAAY,GAAZ,CAAiBhB,CAAAA,KAAjB,CAAuB,yBAAvB,CAAf,CAAA;;AAEA,EAAA,IAAIe,MAAJ,EAAY;IACV,OAAO;MACLpH,CAAC,EAAEsH,UAAU,CAACF,MAAM,CAAC,CAAD,CAAP,CAAV,GAAwB,GADtB;MAELhG,CAAC,EAAEkG,UAAU,CAACF,MAAM,CAAC,CAAD,CAAP,CAAV,GAAwB,GAAA;KAF7B,CAAA;AAID,GALD,MAMK;IACH,OAAO;AAAEpH,MAAAA,CAAC,EAAE,GAAL;AAAUoB,MAAAA,CAAC,EAAE,GAAA;KAApB,CAAA;AACD,GAAA;AACF,CAAA;AAED;AACA;AACA;AACA;;AACA,IAAMmG,QAAQ,GAAG;AAAE,EAAA,CAAA,EAAG,MAAL;AAAa,EAAA,GAAA,EAAK,QAAlB;EAA4B,CAAG,EAAA,OAAA;AAA/B,CAAjB,CAAA;AACA;AACA;AACA;AACA;;AACA,IAAMC,OAAO,GAAG;AAAE,EAAA,CAAA,EAAG,KAAL;AAAY,EAAA,GAAA,EAAK,QAAjB;EAA2B,CAAG,EAAA,QAAA;AAA9B,CAAhB,CAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACO,SAASC,aAAT,CAAuBrH,KAAvB,EAA8BsH,YAA9B,EAA4CC,WAA5C,EAAgE;AAAA,EAAA,IAApBA,WAAoB,KAAA,KAAA,CAAA,EAAA;AAApBA,IAAAA,WAAoB,GAAN,IAAM,CAAA;AAAA,GAAA;;EACrE,IAAI,CAACvH,KAAL,EAAY;AACV,IAAA,OAAOsH,YAAY,CAAC9K,KAAb,CAAmB,GAAnB,CAAP,CAAA;AACD,GAAA;;AAED,EAAA,IAAI,OAAOwD,KAAP,KAAiB,QAArB,EAA+B;AAC7B,IAAA,IAAMwH,OAAO,GAAGhB,aAAa,CAACxG,KAAD,CAA7B,CAAA;;AAEA,IAAA,IAAI,EAAEwH,OAAO,CAAC5H,CAAR,IAAauH,QAAf,CAAA,IAA4B,EAAEK,OAAO,CAACxG,CAAR,IAAaoG,OAAf,CAAhC,EAAyD;AACvD,MAAA,MAAM,IAAIvX,QAAJ,CAA0CmQ,6BAAAA,GAAAA,KAA1C,GAAN,IAAA,CAAA,CAAA;AACD,KAAA;;AAEDA,IAAAA,KAAK,GAAG,CAACoH,OAAO,CAACI,OAAO,CAACxG,CAAT,CAAR,EAAqBmG,QAAQ,CAACK,OAAO,CAAC5H,CAAT,CAA7B,CAAR,CAAA;AACD,GAAA;;AAED,EAAA,IAAI,CAAC2H,WAAD,IAAgBvH,KAAK,CAAC,CAAD,CAAL,KAAa,QAA7B,IAAyCA,KAAK,CAAC,CAAD,CAAL,KAAa,QAA1D,EAAoE;AAClE,IAAA,MAAM,IAAInQ,QAAJ,CAAa,0CAAb,CAAN,CAAA;AACD,GAAA;;AAED,EAAA,OAAOmQ,KAAP,CAAA;AACD,CAAA;AAED;AACA;AACA;AACA;AACA;AACA;AACA;;AACO,SAASyH,UAAT,CAAoBC,KAApB,EAA2B;AAChC,EAAA,IAAIV,MAAJ,CAAA;;AAEA,EAAA,IAAI,OAAOU,KAAP,KAAiB,QAArB,EAA+B;IAC7B,IAAMC,QAAQ,GAAGD,KAAK,CAAC/D,QAAN,EAAiBiE,CAAAA,IAAjB,EAAjB,CAD6B;;AAI7B,IAAA,IAAIC,UAAU,GAAGX,UAAU,CAACS,QAAQ,CAACrF,OAAT,CAAiB,6BAAjB,EAAgD,IAAhD,CAAD,CAA3B,CAAA;AACA,IAAA,IAAMwF,SAAS,GAAGH,QAAQ,CAACrF,OAAT,CAAiB,6BAAjB,EAAgD,IAAhD,CAAA,CAAsDsF,IAAtD,EAAlB,CAL6B;;AAQ7B,IAAA,IAAIE,SAAS,CAAC7B,KAAV,CAAgB,kBAAhB,CAAJ,EAAyC;AACvC4B,MAAAA,UAAU,IAAI,EAAd,CAAA;AACD,KAV4B;;;AAa7B,IAAA,QAAQC,SAAR;AACE;AACA,MAAA,KAAK,KAAL,CAAA;AACA,MAAA,KAAK,oBAAL,CAAA;AACA,MAAA,KAAK,KAAL,CAAA;AACA,MAAA,KAAK,oBAAL;QACEd,MAAM,GAAGe,KAAK,CAACC,SAAN,CAAgBC,QAAhB,CAAyBJ,UAAzB,CAAT,CAAA;AACA,QAAA,MAAA;AAEF;;AACA,MAAA,KAAK,MAAL,CAAA;AACA,MAAA,KAAK,oBAAL,CAAA;AACA,MAAA,KAAK,MAAL,CAAA;AACA,MAAA,KAAK,oBAAL;AACEb,QAAAA,MAAM,GAAGa,UAAT,CAAA;AACA,QAAA,MAAA;AAEF;;AACA,MAAA,KAAK,KAAL,CAAA;AACA,MAAA,KAAK,wBAAL,CAAA;AACA,MAAA,KAAK,KAAL,CAAA;AACA,MAAA,KAAK,wBAAL;AACEb,QAAAA,MAAM,GAAGa,UAAU,GAAG3R,IAAI,CAACE,EAAlB,GAAuB,CAAhC,CAAA;AACA,QAAA,MAAA;AAEF;;AACA,MAAA;AACE,QAAA,MAAM,IAAIvG,QAAJ,CAAa,yBAAyBiY,SAAzB,GAAqC,GAAlD,CAAN,CAAA;AA3BJ,KAAA;AA6BD,GA1CD,MA2CK;AACHd,IAAAA,MAAM,GAAGU,KAAT,CAAA;AACD,GAAA;;AAED,EAAA,OAAOV,MAAP,CAAA;AACD,CAAA;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACO,SAASkB,UAAT,CAAoBC,KAApB,EAA2BC,UAA3B,EAA+CC,UAA/C,EAAwE;AAAA,EAAA,IAA7CD,UAA6C,KAAA,KAAA,CAAA,EAAA;AAA7CA,IAAAA,UAA6C,GAAhC,KAAgC,CAAA;AAAA,GAAA;;AAAA,EAAA,IAAzBC,UAAyB,KAAA,KAAA,CAAA,EAAA;AAAzBA,IAAAA,UAAyB,GAAZD,UAAY,CAAA;AAAA,GAAA;;AAC7E,EAAA,IAAIpB,MAAJ,CAAA;;AAEA,EAAA,IAAI,OAAOmB,KAAP,KAAiB,QAArB,EAA+B;IAC7B,IAAMlC,KAAK,GAAGkC,KAAK,CAAC1F,WAAN,EAAoBmF,CAAAA,IAApB,EAA2B3B,CAAAA,KAA3B,CAAiC,+BAAjC,CAAd,CAAA;;IAEA,IAAI,CAACA,KAAL,EAAY;AACV,MAAA,MAAM,IAAIpW,QAAJ,CAAa,oBAAoBsY,KAApB,GAA4B,GAAzC,CAAN,CAAA;AACD,KAAA;;IAED,IAAMnI,KAAK,GAAGkH,UAAU,CAACjB,KAAK,CAAC,CAAD,CAAN,CAAxB,CAAA;AACA,IAAA,IAAMqC,IAAI,GAAGrC,KAAK,CAAC,CAAD,CAAlB,CAAA;;AAEA,IAAA,IAAIqC,IAAJ,EAAU;AACR,MAAA,QAAQA,IAAR;AACE,QAAA,KAAK,KAAL,CAAA;AACA,QAAA,KAAK,MAAL;UACEtB,MAAM,GAAGe,KAAK,CAACC,SAAN,CAAgBC,QAAhB,CAAyBjI,KAAzB,CAAT,CAAA;AACA,UAAA,MAAA;;AACF,QAAA,KAAK,KAAL,CAAA;AACA,QAAA,KAAK,MAAL;AACEgH,UAAAA,MAAM,GAAGhH,KAAT,CAAA;AACA,UAAA,MAAA;;AACF,QAAA;AACE,UAAA,MAAM,IAAInQ,QAAJ,CAAa,yBAAyByY,IAAzB,GAAgC,GAA7C,CAAN,CAAA;AAVJ,OAAA;AAYD,KAbD,MAcK;AACHtB,MAAAA,MAAM,GAAGhH,KAAT,CAAA;AACD,KAAA;AACF,GA3BD,MA4BK,IAAI,OAAOmI,KAAP,KAAiB,QAAjB,IAA6B,CAAChC,KAAK,CAACgC,KAAD,CAAvC,EAAgD;AACnDnB,IAAAA,MAAM,GAAGmB,KAAT,CAAA;AACD,GAFI,MAGA;AACH,IAAA,MAAM,IAAItY,QAAJ,CAAa,oBAAoBsY,KAApB,GAA4B,GAAzC,CAAN,CAAA;AACD,GAAA;;AAEDnB,EAAAA,MAAM,GAAGjH,IAAI,CAACqI,UAAU,GAAGpB,MAAM,GAAG9Q,IAAI,CAACE,EAAjB,GAAsB4Q,MAAjC,EAAyC9Q,IAAI,CAACE,EAAL,GAAU,CAAnD,CAAb,CAAA;AAEA,EAAA,OAAOgS,UAAU,GAAGzI,KAAK,CAACqH,MAAM,GAAG9Q,IAAI,CAACE,EAAf,EAAmB,CAACF,IAAI,CAACE,EAAN,IAAYiS,UAAU,GAAG,CAAH,GAAO,CAA7B,CAAnB,EAAoDnS,IAAI,CAACE,EAAL,IAAWiS,UAAU,GAAG,CAAH,GAAO,CAA5B,CAApD,CAAR,GAA8FrB,MAA/G,CAAA;AACD,CAAA;AAED;AACA;AACA;AACA;AACA;AACA;;AACO,SAASuB,aAAT,CAAuBC,GAAvB,EAA4B;EACjC,IAAMC,OAAO,GAAG,IAAIV,KAAK,CAACW,OAAV,CAAkBF,GAAlB,CAAhB,CAAA;EACAC,OAAO,CAACE,WAAR,GAAsB,IAAtB,CAAA;AACAF,EAAAA,OAAO,CAACG,SAAR,GAAoBb,KAAK,CAACc,YAA1B,CAAA;EACAJ,OAAO,CAACK,eAAR,GAA0B,KAA1B,CAAA;AACA,EAAA,OAAOL,OAAP,CAAA;AACD,CAAA;AAED,IAAMM,UAAU,GAAG,IAAIhB,KAAK,CAACiB,UAAV,EAAnB,CAAA;AAEA;AACA;AACA;AACA;AACA;AACA;;AACO,SAASC,iBAAT,CAA2BC,MAA3B,EAAmCC,KAAnC,EAA0C;AAC/CJ,EAAAA,UAAU,CAACK,YAAX,CAAwBD,KAAxB,EAA+BE,MAA/B,EAAA,CAAA;EACAH,MAAM,CAACI,eAAP,CAAuBP,UAAvB,CAAA,CAAA;AACD;;ACpUD;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACA,IAAaQ,SAAb,gBAAA,YAAA;AAEE;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACE,EAAA,SAAA,SAAA,CAAYC,OAAZ,EAAqB;AAAA,IAAA,IAAA,KAAA,GAAA,IAAA,CAAA;;IACnB,IAAKC,CAAAA,WAAL,GAAmB,EAAnB,CAAA;;AAEA,IAAA,IAAID,OAAJ,EAAa;MACX,IAAI,CAACA,OAAO,CAACE,MAAT,IAAmB,OAAOF,OAAO,CAACE,MAAf,KAA0B,QAAjD,EAA2D;QACzDF,OAAO,CAACE,MAAR,GAAiBxU,OAAO,CAACsU,OAAO,CAACE,MAAR,IAAkB,QAAnB,CAAxB,CAAA;AACD,OAAA;;MAED,IAAKC,CAAAA,OAAL,GAAe,IAAf,CAAA;MACA,IAAKH,CAAAA,OAAL,GAAeA,OAAf,CAAA;;MAEA,IAAIA,OAAO,CAACI,KAAZ,EAAmB;AACjB,QAAA,IAAA,CAAKC,cAAL,GAAsBvP,UAAU,CAAC,YAAM;UACrC,KAAI,CAACuP,cAAL,GAAsB,IAAtB,CAAA;UACA,KAAI,CAACC,gBAAL,GAAwBpR,MAAM,CAACqR,qBAAP,CAA6B,UAAA3U,CAAC,EAAA;AAAA,YAAA,OAAI,KAAI,CAAC4U,KAAL,CAAW5U,CAAX,CAAJ,CAAA;AAAA,WAA9B,CAAxB,CAAA;AACD,SAH+B,EAG7BoU,OAAO,CAACI,KAHqB,CAAhC,CAAA;AAID,OALD,MAMK;AACH,QAAA,IAAA,CAAKE,gBAAL,GAAwBpR,MAAM,CAACqR,qBAAP,CAA6B,UAAA3U,CAAC,EAAA;AAAA,UAAA,OAAI,KAAI,CAAC4U,KAAL,CAAW5U,CAAX,CAAJ,CAAA;AAAA,SAA9B,CAAxB,CAAA;AACD,OAAA;AACF,KAjBD,MAkBK;MACH,IAAK6U,CAAAA,UAAL,GAAkB,IAAlB,CAAA;AACD,KAAA;AACF,GAAA;AAED;AACF;AACA;AACA;AACA;;;AA1CA,EAAA,IAAA,MAAA,GAAA,SAAA,CAAA,SAAA,CAAA;;AAAA,EAAA,MAAA,CA2CED,KA3CF,GA2CE,SAAME,KAAAA,CAAAA,SAAN,EAAiB;AAAA,IAAA,IAAA,MAAA,GAAA,IAAA,CAAA;;AACf;AACA,IAAA,IAAI,IAAKP,CAAAA,OAAL,KAAiB,IAArB,EAA2B;MACzB,IAAKA,CAAAA,OAAL,GAAeO,SAAf,CAAA;AACD,KAJc;;;IAOf,IAAMC,QAAQ,GAAG,CAACD,SAAS,GAAG,IAAKP,CAAAA,OAAlB,IAA6B,IAAA,CAAKH,OAAL,CAAaY,QAA3D,CAAA;IACA,IAAMC,OAAO,GAAG,EAAhB,CAAA;;IAEA,IAAIF,QAAQ,GAAG,GAAf,EAAoB;AAClB;MACA7F,IAAI,CAAC,IAAKkF,CAAAA,OAAL,CAAac,UAAd,EAA0B,UAAC/L,IAAD,EAAOlO,IAAP,EAAgB;AAC5C,QAAA,IAAIkO,IAAJ,EAAU;UACR8L,OAAO,CAACha,IAAD,CAAP,GAAgBkO,IAAI,CAACgM,KAAL,GAAa,CAAChM,IAAI,CAACiM,GAAL,GAAWjM,IAAI,CAACgM,KAAjB,IAA0B,MAAI,CAACf,OAAL,CAAaE,MAAb,CAAoBS,QAApB,CAAvD,CAAA;AACD,SAAA;AACF,OAJG,CAAJ,CAAA;AAKA,MAAA,IAAA,CAAKX,OAAL,CAAaiB,MAAb,CAAoBJ,OAApB,EAA6BF,QAA7B,CAAA,CAAA;AAEA,MAAA,IAAA,CAAKL,gBAAL,GAAwBpR,MAAM,CAACqR,qBAAP,CAA6B,UAAA3U,CAAC,EAAA;AAAA,QAAA,OAAI,MAAI,CAAC4U,KAAL,CAAW5U,CAAX,CAAJ,CAAA;AAAA,OAA9B,CAAxB,CAAA;AACD,KAVD,MAWK;AACH;MACAkP,IAAI,CAAC,IAAKkF,CAAAA,OAAL,CAAac,UAAd,EAA0B,UAAC/L,IAAD,EAAOlO,IAAP,EAAgB;AAC5C,QAAA,IAAIkO,IAAJ,EAAU;AACR8L,UAAAA,OAAO,CAACha,IAAD,CAAP,GAAgBkO,IAAI,CAACiM,GAArB,CAAA;AACD,SAAA;AACF,OAJG,CAAJ,CAAA;AAKA,MAAA,IAAA,CAAKhB,OAAL,CAAaiB,MAAb,CAAoBJ,OAApB,EAA6B,GAA7B,CAAA,CAAA;AAEA,MAAA,IAAA,CAAKP,gBAAL,GAAwBpR,MAAM,CAACqR,qBAAP,CAA6B,YAAM;QACzD,MAAI,CAACE,UAAL,GAAkB,IAAlB,CAAA;;QACA,MAAI,CAACS,SAAL,CAAe,IAAf,CAAA,CAAA;AACD,OAHuB,CAAxB,CAAA;AAID,KAAA;AACF,GAAA;AAED;AACF;AACA;AAlFA,GAAA;;AAAA,EAAA,MAAA,CAmFEA,SAnFF,GAmFE,SAAU1K,SAAAA,CAAAA,KAAV,EAAiB;AACf,IAAA,IAAA,CAAKyJ,WAAL,CAAiBhN,OAAjB,CAAyB,UAAAkO,EAAE,EAAA;MAAA,OAAIA,EAAE,CAAC3K,KAAD,CAAN,CAAA;KAA3B,CAAA,CAAA;;AACA,IAAA,IAAA,CAAKyJ,WAAL,CAAiB5N,MAAjB,GAA0B,CAA1B,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AACA;AACA;AA7FA,GAAA;;AAAA,EAAA,MAAA,CA8FE+O,IA9FF,GA8FE,SAAA,IAAA,CAAKC,WAAL,EAAyBC,UAAzB,EAA4C;AAAA,IAAA,IAAA,MAAA,GAAA,IAAA,CAAA;;AAAA,IAAA,IAAvCD,WAAuC,KAAA,KAAA,CAAA,EAAA;AAAvCA,MAAAA,WAAuC,GAAzB,IAAyB,CAAA;AAAA,KAAA;;AAAA,IAAA,IAAnBC,UAAmB,KAAA,KAAA,CAAA,EAAA;AAAnBA,MAAAA,UAAmB,GAAN,IAAM,CAAA;AAAA,KAAA;;AAC1C,IAAA,IAAIA,UAAJ,EAAgB;MACdrF,OAAO,CAAC,4DAAD,CAAP,CAAA;AACD,KAAA;;AAED,IAAA,IAAI,IAAKwE,CAAAA,UAAL,IAAmB,IAAA,CAAKc,WAA5B,EAAyC;MACvC,OAAOjR,OAAO,CAACC,OAAR,CAAgB,IAAA,CAAKkQ,UAArB,CACJW,CAAAA,IADI,CACCC,WADD,CAAP,CAAA;AAED,KAAA;;AAED,IAAA,OAAO,IAAI/Q,OAAJ,CAAY,UAACC,OAAD,EAAa;AAC9B,MAAA,MAAI,CAAC0P,WAAL,CAAiBuB,IAAjB,CAAsBjR,OAAtB,CAAA,CAAA;AACD,KAFM,CAGJ6Q,CAAAA,IAHI,CAGCC,WAHD,CAAP,CAAA;AAID,GAAA;AAED;AACF;AACA;AAhHA,GAAA;;EAAA,MAiHEI,CAAAA,MAjHF,GAiHE,SAAS,MAAA,GAAA;AACP,IAAA,IAAI,CAAC,IAAKF,CAAAA,WAAN,IAAqB,CAAC,IAAA,CAAKd,UAA/B,EAA2C;MACzC,IAAKc,CAAAA,WAAL,GAAmB,IAAnB,CAAA;;MACA,IAAKL,CAAAA,SAAL,CAAe,KAAf,CAAA,CAAA;;MAEA,IAAI,IAAA,CAAKb,cAAT,EAAyB;AACvBnR,QAAAA,MAAM,CAAC8B,YAAP,CAAoB,IAAA,CAAKqP,cAAzB,CAAA,CAAA;QACA,IAAKA,CAAAA,cAAL,GAAsB,IAAtB,CAAA;AACD,OAAA;;MACD,IAAI,IAAA,CAAKC,gBAAT,EAA2B;AACzBpR,QAAAA,MAAM,CAACwS,oBAAP,CAA4B,IAAA,CAAKpB,gBAAjC,CAAA,CAAA;QACA,IAAKA,CAAAA,gBAAL,GAAwB,IAAxB,CAAA;AACD,OAAA;AACF,KAAA;AACF,GAAA;AAED;AACF;AACA;AAnIA,GAAA;;EAAA,MAoIEqB,CAAAA,KApIF,GAoIE,SAAQ,MAAA,GAAA;IACN1F,OAAO,CAAC,0CAAD,CAAP,CAAA;IACA,OAAO,IAAA,CAAKmF,IAAL,EAAP,CAAA;AACD,GAAA;AAED;AACF;AACA;AA3IA,GAAA;;AAAA,EAAA,MAAA,CA4IEQ,OA5IF,GA4IE,SAAQC,QAAAA,CAAAA,SAAR,EAAmB;IACjB5F,OAAO,CAAC,4CAAD,CAAP,CAAA;AACA,IAAA,OAAO,IAAKmF,CAAAA,IAAL,CAAUS,SAAV,CAAP,CAAA;AACD,GAAA;AAED;AACF;AACA;AAnJA,GAAA;;EAAA,SAoJStR,CAAAA,OApJT,GAoJE,SAAiB,OAAA,GAAA;IACf0L,OAAO,CAAC,4CAAD,CAAP,CAAA;GArJJ,CAAA;;AAAA,EAAA,OAAA,SAAA,CAAA;AAAA,CAAA;;AC5BA;AACA;AACA;AACA;;AACA,IAAa6F,OAAb,gBAAA,YAAA;AAME;AACF;AACA;AACA;AACA;AACA;AACA;EACE,SAAYC,OAAAA,CAAAA,EAAZ,EAAgBjE,YAAhB,EAAkCzH,GAAlC,EAAmDC,GAAnD,EAAmE0L,SAAnE,EAAsF;AAAA,IAAA,IAAtElE,YAAsE,KAAA,KAAA,CAAA,EAAA;AAAtEA,MAAAA,YAAsE,GAAvD,CAAuD,CAAA;AAAA,KAAA;;AAAA,IAAA,IAApDzH,GAAoD,KAAA,KAAA,CAAA,EAAA;MAApDA,GAAoD,GAA9C,CAAC2B,QAA6C,CAAA;AAAA,KAAA;;AAAA,IAAA,IAAnC1B,GAAmC,KAAA,KAAA,CAAA,EAAA;AAAnCA,MAAAA,GAAmC,GAA7B0B,QAA6B,CAAA;AAAA,KAAA;;AAAA,IAAA,IAAnBgK,SAAmB,KAAA,KAAA,CAAA,EAAA;AAAnBA,MAAAA,SAAmB,GAAP,KAAO,CAAA;AAAA,KAAA;;AACpF;AACJ;AACA;AACA;AACA;IACI,IAAKD,CAAAA,EAAL,GAAUA,EAAV,CAAA;AAEA;AACJ;AACA;AACA;;AACI,IAAA,IAAA,CAAKE,IAAL,GAAYH,OAAO,CAACI,IAApB,CAAA;AAEA;AACJ;AACA;AACA;;IACI,IAAKhE,CAAAA,KAAL,GAAa,CAAb,CAAA;AAEA;AACJ;AACA;AACA;;IACI,IAAKiE,CAAAA,SAAL,GAAiB,CAAjB,CAAA;AAEA;AACJ;AACA;AACA;;IACI,IAAKC,CAAAA,YAAL,GAAoB,CAApB,CAAA;AAEA;AACJ;AACA;AACA;;IACI,IAAK/H,CAAAA,MAAL,GAAc,CAAd,CAAA;AAEA;AACJ;AACA;AACA;;IACI,IAAKwG,CAAAA,OAAL,GAAe/C,YAAf,CAAA;AAEA;AACJ;AACA;AACA;;IACI,IAAKzH,CAAAA,GAAL,GAAWA,GAAX,CAAA;AAEA;AACJ;AACA;AACA;;IACI,IAAKC,CAAAA,GAAL,GAAWA,GAAX,CAAA;AAEA;AACJ;AACA;AACA;;IACI,IAAK0L,CAAAA,SAAL,GAAiBA,SAAjB,CAAA;;AAEA,IAAA,IAAIA,SAAS,IAAI3L,GAAG,KAAK,CAAzB,EAA4B;AAC1B,MAAA,MAAM,IAAIhQ,QAAJ,CAAa,gBAAb,CAAN,CAAA;AACD,KAAA;;IAED,IAAI,IAAA,CAAK0b,EAAT,EAAa;MACX,IAAKA,CAAAA,EAAL,CAAQjE,YAAR,CAAA,CAAA;AACD,KAAA;AACF,GAAA;AAED;AACF;AACA;AACA;;;AAvFA,EAAA,IAAA,MAAA,GAAA,OAAA,CAAA,SAAA,CAAA;;AAAA,EAAA,MAAA,CAwFEuE,QAxFF,GAwFE,SAASnE,QAAAA,CAAAA,KAAT,EAAgB;IACd,IAAKA,CAAAA,KAAL,GAAaA,KAAb,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AACA;AAhGA,GAAA;;AAAA,EAAA,MAAA,CAiGEoE,IAjGF,GAiGE,SAAA,IAAA,CAAKC,QAAL,EAAeJ,SAAf,EAA8B;AAAA,IAAA,IAAfA,SAAe,KAAA,KAAA,CAAA,EAAA;AAAfA,MAAAA,SAAe,GAAH,CAAG,CAAA;AAAA,KAAA;;AAC5B,IAAA,IAAA,CAAKF,IAAL,GAAYH,OAAO,CAACU,QAApB,CAAA;IACA,IAAKnI,CAAAA,MAAL,GAAc,IAAK2H,CAAAA,SAAL,GAAiBzL,IAAI,CAACgM,QAAD,EAAW,IAAKjM,CAAAA,GAAhB,CAArB,GAA4CH,KAAK,CAACoM,QAAD,EAAW,KAAKlM,GAAhB,EAAqB,IAAKC,CAAAA,GAA1B,CAA/D,CAAA;IACA,IAAK6L,CAAAA,SAAL,GAAiBA,SAAjB,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AACA;AA3GA,GAAA;;AAAA,EAAA,MAAA,CA4GEM,IA5GF,GA4GE,SAAA,IAAA,CAAKA,KAAL,EAAWN,SAAX,EAA0B;AAAA,IAAA,IAAfA,SAAe,KAAA,KAAA,CAAA,EAAA;AAAfA,MAAAA,SAAe,GAAH,CAAG,CAAA;AAAA,KAAA;;AACxB,IAAA,IAAI,KAAKF,IAAL,KAAcH,OAAO,CAACU,QAA1B,EAAoC;MAClC,IAAKnI,CAAAA,MAAL,GAAc,IAAA,CAAKwG,OAAnB,CAAA;AACD,KAAA;;AACD,IAAA,IAAA,CAAKyB,IAAL,CAAU,IAAA,CAAKjI,MAAL,GAAcoI,KAAxB,EAA8BN,SAA9B,CAAA,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AACA;AAvHA,GAAA;;AAAA,EAAA,MAAA,CAwHEO,IAxHF,GAwHE,SAAA,IAAA,CAAK7C,MAAL,EAAqBsC,SAArB,EAAoC;AAAA,IAAA,IAA/BtC,MAA+B,KAAA,KAAA,CAAA,EAAA;AAA/BA,MAAAA,MAA+B,GAAtB,KAAsB,CAAA;AAAA,KAAA;;AAAA,IAAA,IAAfsC,SAAe,KAAA,KAAA,CAAA,EAAA;AAAfA,MAAAA,SAAe,GAAH,CAAG,CAAA;AAAA,KAAA;;AAClC,IAAA,IAAA,CAAKF,IAAL,GAAYH,OAAO,CAACa,QAApB,CAAA;AACA,IAAA,IAAA,CAAKtI,MAAL,GAAcwF,MAAM,GAAG,CAAC7H,QAAJ,GAAeA,QAAnC,CAAA;IACA,IAAKmK,CAAAA,SAAL,GAAiBA,SAAjB,CAAA;AACD,GAAA;AAED;AACF;AACA;AAhIA,GAAA;;EAAA,MAiIES,CAAAA,IAjIF,GAiIE,SAAO,IAAA,GAAA;AACL,IAAA,IAAA,CAAKX,IAAL,GAAYH,OAAO,CAACI,IAApB,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AAxIA,GAAA;;AAAA,EAAA,MAAA,CAyIEW,QAzIF,GAyIE,SAASrM,QAAAA,CAAAA,KAAT,EAAgB;IACd,IAAK6D,CAAAA,MAAL,GAAc,IAAK2H,CAAAA,SAAL,GAAiBzL,IAAI,CAACC,KAAD,EAAQ,IAAKF,CAAAA,GAAb,CAArB,GAAyCH,KAAK,CAACK,KAAD,EAAQ,KAAKH,GAAb,EAAkB,IAAKC,CAAAA,GAAvB,CAA5D,CAAA;AACA,IAAA,IAAA,CAAK2L,IAAL,GAAYH,OAAO,CAACI,IAApB,CAAA;;AACA,IAAA,IAAI,IAAK7H,CAAAA,MAAL,KAAgB,IAAA,CAAKwG,OAAzB,EAAkC;MAChC,IAAKA,CAAAA,OAAL,GAAe,IAAA,CAAKxG,MAApB,CAAA;;MACA,IAAI,IAAA,CAAK0H,EAAT,EAAa;QACX,IAAKA,CAAAA,EAAL,CAAQ,IAAA,CAAKlB,OAAb,CAAA,CAAA;AACD,OAAA;;AACD,MAAA,OAAO,IAAP,CAAA;AACD,KAAA;;AACD,IAAA,OAAO,KAAP,CAAA;AACD,GAAA;AAED;AACF;AACA;AAxJA,GAAA;;AAAA,EAAA,MAAA,CAyJEiC,MAzJF,GAyJE,SAAOC,MAAAA,CAAAA,OAAP,EAAgB;AACd;AACA,IAAA,IAAI,KAAKd,IAAL,KAAcH,OAAO,CAACU,QAA1B,EAAoC;AAClC;AACA,MAAA,IAAI,KAAKR,SAAL,IAAkBtV,IAAI,CAACqL,GAAL,CAAS,IAAA,CAAKsC,MAAL,GAAc,KAAKwG,OAA5B,CAAA,GAAuC,KAAKvK,GAAL,GAAW,CAAxE,EAA2E;AACzE,QAAA,IAAA,CAAKuK,OAAL,GAAe,IAAA,CAAKA,OAAL,GAAe,IAAA,CAAKxG,MAApB,GAA6B,IAAA,CAAKwG,OAAL,GAAe,KAAKvK,GAAjD,GAAuD,KAAKuK,OAAL,GAAe,KAAKvK,GAA1F,CAAA;AACD,OAAA;;AAED,MAAA,IAAM0M,OAAO,GAAG,IAAKZ,CAAAA,YAAL,GAAoB,IAAKA,CAAAA,YAAzB,IAAyC,IAAA,CAAKlE,KAAL,GAAa,IAAA,CAAKiE,SAAlB,GAA8B,CAAvE,CAAhB,CAAA;;MACA,IAAIzV,IAAI,CAACqL,GAAL,CAAS,IAAA,CAAKsC,MAAL,GAAc,IAAKwG,CAAAA,OAA5B,CAAwCmC,IAAAA,OAA5C,EAAqD;AACnD,QAAA,IAAA,CAAKf,IAAL,GAAYH,OAAO,CAACI,IAApB,CAAA;AACD,OAAA;AACF,KAZa;;;AAed,IAAA,IAAIe,WAAW,GAAG,IAAKhB,CAAAA,IAAL,KAAcH,OAAO,CAACI,IAAtB,GAA6B,CAA7B,GAAiC,IAAA,CAAKhE,KAAL,GAAa,KAAKiE,SAArE,CAAA;;AACA,IAAA,IAAI,IAAK9H,CAAAA,MAAL,GAAc,IAAA,CAAKwG,OAAvB,EAAgC;MAC9BoC,WAAW,GAAG,CAACA,WAAf,CAAA;AACD,KAAA;;AACD,IAAA,IAAI,IAAKb,CAAAA,YAAL,GAAoBa,WAAxB,EAAqC;MACnC,IAAKb,CAAAA,YAAL,GAAoB1V,IAAI,CAAC2J,GAAL,CAAS4M,WAAT,EAAsB,IAAA,CAAKb,YAAL,GAAoBW,OAAO,GAAG,IAAV,GAAiB,IAAK7E,CAAAA,KAAtB,GAA8B,IAAKiE,CAAAA,SAAnC,GAA+C,CAAzF,CAApB,CAAA;AACD,KAFD,MAGK,IAAI,IAAA,CAAKC,YAAL,GAAoBa,WAAxB,EAAqC;MACxC,IAAKb,CAAAA,YAAL,GAAoB1V,IAAI,CAAC4J,GAAL,CAAS2M,WAAT,EAAsB,IAAA,CAAKb,YAAL,GAAoBW,OAAO,GAAG,IAAV,GAAiB,IAAK7E,CAAAA,KAAtB,GAA8B,IAAKiE,CAAAA,SAAnC,GAA+C,CAAzF,CAApB,CAAA;AACD,KAxBa;;;IA2Bd,IAAIe,IAAI,GAAG,IAAX,CAAA;;IACA,IAAI,IAAA,CAAKrC,OAAL,GAAe,IAAA,CAAKxG,MAApB,IAA8B,IAAA,CAAK+H,YAAvC,EAAqD;AACnDc,MAAAA,IAAI,GAAGxW,IAAI,CAAC4J,GAAL,CAAS,KAAK+D,MAAd,EAAsB,IAAKwG,CAAAA,OAAL,GAAe,IAAKuB,CAAAA,YAAL,GAAoBW,OAApB,GAA8B,IAAnE,CAAP,CAAA;KADF,MAGK,IAAI,IAAA,CAAKlC,OAAL,GAAe,KAAKxG,MAApB,IAA8B,IAAK+H,CAAAA,YAAvC,EAAqD;AACxDc,MAAAA,IAAI,GAAGxW,IAAI,CAAC2J,GAAL,CAAS,KAAKgE,MAAd,EAAsB,IAAKwG,CAAAA,OAAL,GAAe,IAAKuB,CAAAA,YAAL,GAAoBW,OAApB,GAA8B,IAAnE,CAAP,CAAA;AACD,KAjCa;;;IAoCd,IAAIG,IAAI,KAAK,IAAb,EAAmB;MACjBA,IAAI,GAAG,KAAKlB,SAAL,GAAiBzL,IAAI,CAAC2M,IAAD,EAAO,IAAK5M,CAAAA,GAAZ,CAArB,GAAwCH,KAAK,CAAC+M,IAAD,EAAO,KAAK7M,GAAZ,EAAiB,IAAKC,CAAAA,GAAtB,CAApD,CAAA;;AACA,MAAA,IAAI4M,IAAI,KAAK,IAAKrC,CAAAA,OAAlB,EAA2B;QACzB,IAAKA,CAAAA,OAAL,GAAeqC,IAAf,CAAA;;QACA,IAAI,IAAA,CAAKnB,EAAT,EAAa;UACX,IAAKA,CAAAA,EAAL,CAAQ,IAAA,CAAKlB,OAAb,CAAA,CAAA;AACD,SAAA;;AACD,QAAA,OAAO,IAAP,CAAA;AACD,OAAA;AACF,KAAA;;AAED,IAAA,OAAO,KAAP,CAAA;GAxMJ,CAAA;;AAAA,EAAA,OAAA,OAAA,CAAA;AAAA,CAAA,EAAA,CAAA;AAAaiB,QAEJI,OAAO;AAFHJ,QAGJa,WAAW;AAHPb,QAIJU,WAAW;;ACTpB;AACA;AACA;AACA;;AACA,IAAaW,YAAb,gBAAA,YAAA;AAcE;AACF;AACA;AACA;EACE,SAAYC,YAAAA,CAAAA,QAAZ,EAAsBrB,EAAtB,EAA0B;AACxB;AACJ;AACA;AACA;AACA;IACI,IAAKA,CAAAA,EAAL,GAAUA,EAAV,CAAA;AAEA;AACJ;AACA;AACA;AACA;;IACI,IAAKqB,CAAAA,QAAL,GAAgBA,QAAhB,CAAA;;IAEA,IAAI,IAAA,CAAKrB,EAAT,EAAa;MACX,IAAKA,CAAAA,EAAL,CAAQ,IAAA,CAAKlB,OAAb,CAAA,CAAA;AACD,KAAA;AACF,GAAA;AAED;AACF;AACA;AACA;;;AAzCA,EAAA,IAAA,MAAA,GAAA,YAAA,CAAA,SAAA,CAAA;;AAAA,EAAA,MAAA,CA0CEwB,QA1CF,GA0CE,SAASnE,QAAAA,CAAAA,KAAT,EAAgB;AACdpD,IAAAA,IAAI,CAAC,IAAKsI,CAAAA,QAAN,EAAgB,UAACC,CAAD,EAAO;MACzBA,CAAC,CAAChB,QAAF,CAAWnE,KAAX,CAAA,CAAA;AACD,KAFG,CAAJ,CAAA;AAGD,GAAA;AAED;AACF;AACA;AACA;AACA;AApDA,GAAA;;AAAA,EAAA,MAAA,CAqDEoE,IArDF,GAqDE,SAAA,IAAA,CAAKgB,SAAL,EAAgBnB,SAAhB,EAA+B;AAAA,IAAA,IAAA,KAAA,GAAA,IAAA,CAAA;;AAAA,IAAA,IAAfA,SAAe,KAAA,KAAA,CAAA,EAAA;AAAfA,MAAAA,SAAe,GAAH,CAAG,CAAA;AAAA,KAAA;;AAC7BrH,IAAAA,IAAI,CAACwI,SAAD,EAAY,UAACf,QAAD,EAAW1b,IAAX,EAAoB;MAClC,KAAI,CAACuc,QAAL,CAAcvc,IAAd,EAAoByb,IAApB,CAAyBC,QAAzB,EAAmCJ,SAAnC,CAAA,CAAA;AACD,KAFG,CAAJ,CAAA;AAGD,GAAA;AAED;AACF;AACA;AACA;AACA;AA/DA,GAAA;;AAAA,EAAA,MAAA,CAgEEM,IAhEF,GAgEE,SAAA,IAAA,CAAKc,KAAL,EAAYpB,SAAZ,EAA2B;AAAA,IAAA,IAAA,MAAA,GAAA,IAAA,CAAA;;AAAA,IAAA,IAAfA,SAAe,KAAA,KAAA,CAAA,EAAA;AAAfA,MAAAA,SAAe,GAAH,CAAG,CAAA;AAAA,KAAA;;AACzBrH,IAAAA,IAAI,CAACyI,KAAD,EAAQ,UAACd,IAAD,EAAO5b,IAAP,EAAgB;MAC1B,MAAI,CAACuc,QAAL,CAAcvc,IAAd,EAAoB4b,IAApB,CAAyBA,IAAzB,EAA+BN,SAA/B,CAAA,CAAA;AACD,KAFG,CAAJ,CAAA;AAGD,GAAA;AAED;AACF;AACA;AACA;AACA;AA1EA,GAAA;;AAAA,EAAA,MAAA,CA2EEO,IA3EF,GA2EE,SAAA,IAAA,CAAKc,KAAL,EAAYrB,SAAZ,EAA2B;AAAA,IAAA,IAAA,MAAA,GAAA,IAAA,CAAA;;AAAA,IAAA,IAAfA,SAAe,KAAA,KAAA,CAAA,EAAA;AAAfA,MAAAA,SAAe,GAAH,CAAG,CAAA;AAAA,KAAA;;AACzBrH,IAAAA,IAAI,CAAC0I,KAAD,EAAQ,UAACd,IAAD,EAAO7b,IAAP,EAAgB;MAC1B,MAAI,CAACuc,QAAL,CAAcvc,IAAd,EAAoB6b,IAApB,CAAyBA,IAAzB,EAA+BP,SAA/B,CAAA,CAAA;AACD,KAFG,CAAJ,CAAA;AAGD,GAAA;AAED;AACF;AACA;AAnFA,GAAA;;EAAA,MAoFES,CAAAA,IApFF,GAoFE,SAAO,IAAA,GAAA;AACL9H,IAAAA,IAAI,CAAC,IAAA,CAAKsI,QAAN,EAAgB,UAAAC,CAAC,EAAA;MAAA,OAAIA,CAAC,CAACT,IAAF,EAAJ,CAAA;AAAA,KAAjB,CAAJ,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AA3FA,GAAA;;AAAA,EAAA,MAAA,CA4FEC,QA5FF,GA4FE,SAASzH,QAAAA,CAAAA,MAAT,EAAiB;AAAA,IAAA,IAAA,MAAA,GAAA,IAAA,CAAA;;IACf,IAAIqI,UAAU,GAAG,KAAjB,CAAA;AACA3I,IAAAA,IAAI,CAACM,MAAD,EAAS,UAAC5E,KAAD,EAAQ3P,IAAR,EAAiB;MAC5B4c,UAAU,IAAI,MAAI,CAACL,QAAL,CAAcvc,IAAd,CAAoBgc,CAAAA,QAApB,CAA6BrM,KAA7B,CAAd,CAAA;AACD,KAFG,CAAJ,CAAA;;AAIA,IAAA,IAAIiN,UAAU,IAAI,IAAK1B,CAAAA,EAAvB,EAA2B;MACzB,IAAKA,CAAAA,EAAL,CAAQ,IAAA,CAAKlB,OAAb,CAAA,CAAA;AACD,KAAA;;AAED,IAAA,OAAO4C,UAAP,CAAA;AACD,GAAA;AAED;AACF;AACA;AA3GA,GAAA;;AAAA,EAAA,MAAA,CA4GEX,MA5GF,GA4GE,SAAOC,MAAAA,CAAAA,OAAP,EAAgB;IACd,IAAIU,UAAU,GAAG,KAAjB,CAAA;AACA3I,IAAAA,IAAI,CAAC,IAAKsI,CAAAA,QAAN,EAAgB,UAACM,OAAD,EAAa;AAC/BD,MAAAA,UAAU,IAAIC,OAAO,CAACZ,MAAR,CAAeC,OAAf,CAAd,CAAA;AACD,KAFG,CAAJ,CAAA;;AAIA,IAAA,IAAIU,UAAU,IAAI,IAAK1B,CAAAA,EAAvB,EAA2B;MACzB,IAAKA,CAAAA,EAAL,CAAQ,IAAA,CAAKlB,OAAb,CAAA,CAAA;AACD,KAAA;;AAED,IAAA,OAAO4C,UAAP,CAAA;GAtHJ,CAAA;;AAAA,EAAA,YAAA,CAAA,YAAA,EAAA,CAAA;AAAA,IAAA,GAAA,EAAA,SAAA;AAAA,IAAA,GAAA;AAEE;AACF;AACA;AACA;IACE,SAAc,GAAA,GAAA;MACZ,IAAMrI,MAAM,GAAG,EAAf,CAAA;MACAN,IAAI,CAAC,KAAKsI,QAAN,EAAgB,UAACM,OAAD,EAAU7c,IAAV,EAAmB;AACrCuU,QAAAA,MAAM,CAACvU,IAAD,CAAN,GAAe6c,OAAO,CAAC7C,OAAvB,CAAA;AACD,OAFG,CAAJ,CAAA;AAGA,MAAA,OAAOzF,MAAP,CAAA;AACD,KAAA;AAZH,GAAA,CAAA,CAAA,CAAA;;AAAA,EAAA,OAAA,YAAA,CAAA;AAAA,CAAA,EAAA;;ACJA;AACA;AACA;AACA;;AACA,IAAauI,MAAb,gBAAA,UAAA,aAAA,EAAA;AAAA,EAAA,cAAA,CAAA,MAAA,EAAA,aAAA,CAAA,CAAA;;EAaE,SAAqD,MAAA,CAAA,IAAA,EAAA;AAAA,IAAA,IAAA,KAAA,CAAA;;IAAA,IAAvC3c,GAAuC,QAAvCA,GAAuC;QAAlC4c,SAAkC,QAAlCA,SAAkC;QAAvBC,SAAuB,QAAvBA,SAAuB;QAAZC,QAAY,QAAZA,QAAY,CAAA;AACnD,IAAA,KAAA,GAAA,aAAA,CAAA,IAAA,CAAA,IAAA,CAAA,IAAA,IAAA,CAAA;AAEA;AACJ;AACA;AACA;AACA;;IACI,KAAK9c,CAAAA,GAAL,GAAWA,GAAX,CAAA;AAEA;AACJ;AACA;AACA;;IACI,KAAK4c,CAAAA,SAAL,GAAiBA,SAAjB,CAAA;AAEA;AACJ;AACA;AACA;AACA;AACA;AACA;;AACI,IAAA,KAAA,CAAK7O,IAAL,GAAY;AACV+O,MAAAA,QAAQ,EAAGA,QADD;AAEVD,MAAAA,SAAS,EAAEA,SAFD;AAGVE,MAAAA,SAAS,EAAE,KAHD;AAIVC,MAAAA,SAAS,EAAE,KAAA;KAJb,CAAA;;AAOA,IAAA,KAAA,CAAKJ,SAAL,CAAehT,gBAAf,CAAgC,OAAhC,EAAA,sBAAA,CAAA,KAAA,CAAA,CAAA,CAAA;;AACA,IAAA,KAAA,CAAKgT,SAAL,CAAehT,gBAAf,CAAgC,WAAhC,EAAA,sBAAA,CAAA,KAAA,CAAA,CAAA,CAAA;;AACA,IAAA,KAAA,CAAKgT,SAAL,CAAehT,gBAAf,CAAgC,YAAhC,EAAA,sBAAA,CAAA,KAAA,CAAA,CAAA,CAAA;;AACA,IAAA,KAAA,CAAKgT,SAAL,CAAehT,gBAAf,CAAgC,YAAhC,EAAA,sBAAA,CAAA,KAAA,CAAA,CAAA,CAAA;;AACA,IAAA,KAAA,CAAKgT,SAAL,CAAehT,gBAAf,CAAgC,YAAhC,EAAA,sBAAA,CAAA,KAAA,CAAA,CAAA,CAAA;;AACA,IAAA,KAAA,CAAKgT,SAAL,CAAehT,gBAAf,CAAgC,WAAhC,iCAAmD,IAAnD,CAAA,CAAA;;AACA,IAAA,KAAA,CAAKgT,SAAL,CAAehT,gBAAf,CAAgC,WAAhC,iCAAmD,IAAnD,CAAA,CAAA;;IACA1B,MAAM,CAAC0B,gBAAP,CAAwB,SAAxB,EAAA,sBAAA,CAAA,KAAA,CAAA,CAAA,CAAA;IACA1B,MAAM,CAAC0B,gBAAP,CAAwB,UAAxB,EAAA,sBAAA,CAAA,KAAA,CAAA,CAAA,CAAA;AAtCmD,IAAA,OAAA,KAAA,CAAA;AAuCpD,GAAA;AAED;AACF;AACA;;;AAxDA,EAAA,IAAA,MAAA,GAAA,MAAA,CAAA,SAAA,CAAA;;EAAA,MAyDE3J,CAAAA,OAzDF,GAyDE,SAAU,OAAA,GAAA;AACRiI,IAAAA,MAAM,CAAC6B,mBAAP,CAA2B,SAA3B,EAAsC,IAAtC,CAAA,CAAA;AACA7B,IAAAA,MAAM,CAAC6B,mBAAP,CAA2B,UAA3B,EAAuC,IAAvC,CAAA,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AACA;AAlEA,GAAA;;AAAA,EAAA,MAAA,CAmEEkT,WAnEF,GAmEE,SAAYjU,WAAAA,CAAAA,CAAZ,EAAe;AACb;IACA,QAAQA,CAAC,CAACkU,IAAV;AACE;AACA,MAAA,KAAK,OAAL;AAAmBlU,QAAAA,CAAC,CAACmU,eAAF,EAAA,CAAA;AAAwB,QAAA,MAAA;;AAC3C,MAAA,KAAK,WAAL;QAAmB,IAAKC,CAAAA,aAAL,CAAmBpU,CAAnB,CAAA,CAAA;;AAAwB,QAAA,MAAA;;AAC3C,MAAA,KAAK,YAAL;QAAmB,IAAKqU,CAAAA,cAAL,CAAoBrU,CAApB,CAAA,CAAA;;AAAwB,QAAA,MAAA;;AAC3C,MAAA,KAAK,YAAL;QAAmB,IAAKsU,CAAAA,cAAL,CAAoBtU,CAApB,CAAA,CAAA;;AAAwB,QAAA,MAAA;;AAC3C,MAAA,KAAK,YAAL;QAAmB,IAAKuU,CAAAA,cAAL,CAAoBvU,CAApB,CAAA,CAAA;;AAAwB,QAAA,MAAA;;AAC3C,MAAA,KAAK,WAAL;QAAmB,IAAKwU,CAAAA,aAAL,CAAmBxU,CAAnB,CAAA,CAAA;;AAAwB,QAAA,MAAA;;AAC3C,MAAA,KAAK,WAAL;QAAmB,IAAKyU,CAAAA,aAAL,CAAmBzU,CAAnB,CAAA,CAAA;;AAAwB,QAAA,MAAA;;AAC3C,MAAA,KAAK,SAAL;QAAmB,IAAK0U,CAAAA,WAAL,CAAiB1U,CAAjB,CAAA,CAAA;;AAAwB,QAAA,MAAA;;AAC3C,MAAA,KAAK,UAAL;QAAmB,IAAK2U,CAAAA,YAAL,CAAkB3U,CAAlB,CAAA,CAAA;;AAAwB,QAAA,MAAA;AAC3C;AAXF,KAAA;AAaA;;AACD,GAAA;AAED;AACF;AACA;AAvFA,GAAA;;AAAA,EAAA,MAAA,CAwFEoU,aAxFF,GAwFE,SAAcQ,aAAAA,CAAAA,GAAd,EAAmB;AACjB,IAAA,IAAA,CAAK7P,IAAL,CAAUgP,SAAV,GAAsB,IAAtB,CAAA;;AACA,IAAA,IAAA,CAAKc,QAAL,CAAcD,GAAd,EAAmB,IAAnB,CAAA,CAAA;AACD,GAAA;AAED;AACF;AACA;AA/FA,GAAA;;AAAA,EAAA,MAAA,CAgGEP,cAhGF,GAgGE,SAAeO,cAAAA,CAAAA,GAAf,EAAoB;AAClB,IAAA,IAAA,CAAK7P,IAAL,CAAUiP,SAAV,GAAsB,IAAtB,CAAA;;AACA,IAAA,IAAA,CAAKa,QAAL,CAAcD,GAAd,EAAmB,IAAnB,CAAA,CAAA;AACD,GAAA;AAED;AACF;AACA;AAvGA,GAAA;;AAAA,EAAA,MAAA,CAwGEL,cAxGF,GAwGE,SAAeK,cAAAA,CAAAA,GAAf,EAAoB;AAClB,IAAA,IAAA,CAAK7P,IAAL,CAAUiP,SAAV,GAAsB,IAAtB,CAAA;AACA,IAAA,IAAA,CAAKjP,IAAL,CAAUgP,SAAV,GAAsB,IAAtB,CAAA;;IACA,IAAKc,CAAAA,QAAL,CAAcD,GAAG,CAACE,cAAJ,CAAmB,CAAnB,CAAd,EAAqC,IAArC,CAAA,CAAA;AACD,GAAA;AAED;AACF;AACA;AAhHA,GAAA;;AAAA,EAAA,MAAA,CAiHEN,aAjHF,GAiHE,SAAcI,aAAAA,CAAAA,GAAd,EAAmB;IACjB,IAAI,IAAA,CAAK7P,IAAL,CAAUgP,SAAV,IAAuB,IAAKhP,CAAAA,IAAL,CAAUiP,SAArC,EAAgD;AAC9CY,MAAAA,GAAG,CAACT,eAAJ,EAAA,CAAA;;AACA,MAAA,IAAA,CAAKU,QAAL,CAAcD,GAAd,EAAmB,IAAnB,CAAA,CAAA;AACD,KAAA;AACF,GAAA;AAED;AACF;AACA;AA1HA,GAAA;;AAAA,EAAA,MAAA,CA2HEH,aA3HF,GA2HE,SAAcG,aAAAA,CAAAA,GAAd,EAAmB;IACjB,IAAI,IAAA,CAAK7P,IAAL,CAAUgP,SAAV,IAAuB,IAAKhP,CAAAA,IAAL,CAAUiP,SAArC,EAAgD;AAC9CY,MAAAA,GAAG,CAACT,eAAJ,EAAA,CAAA;;MACA,IAAKU,CAAAA,QAAL,CAAcD,GAAG,CAACE,cAAJ,CAAmB,CAAnB,CAAd,EAAqC,IAArC,CAAA,CAAA;AACD,KAAA;AACF,GAAA;AAED;AACF;AACA;AApIA,GAAA;;AAAA,EAAA,MAAA,CAqIEJ,WArIF,GAqIE,SAAYE,WAAAA,CAAAA,GAAZ,EAAiB;AACf,IAAA,IAAI,IAAK7P,CAAAA,IAAL,CAAUgP,SAAd,EAAyB;AACvB,MAAA,IAAA,CAAKhP,IAAL,CAAUgP,SAAV,GAAsB,KAAtB,CAAA;;AACA,MAAA,IAAA,CAAKc,QAAL,CAAcD,GAAd,EAAmB,KAAnB,CAAA,CAAA;AACD,KAAA;AACF,GAAA;AAED;AACF;AACA;AA9IA,GAAA;;AAAA,EAAA,MAAA,CA+IEN,cA/IF,GA+IE,SAAeM,cAAAA,CAAAA,GAAf,EAAoB;AAClB,IAAA,IAAI,IAAK7P,CAAAA,IAAL,CAAUiP,SAAd,EAAyB;AACvB,MAAA,IAAA,CAAKjP,IAAL,CAAUiP,SAAV,GAAsB,KAAtB,CAAA;;AACA,MAAA,IAAA,CAAKa,QAAL,CAAcD,GAAd,EAAmB,IAAnB,CAAA,CAAA;AACD,KAAA;AACF,GAAA;AAED;AACF;AACA;AAxJA,GAAA;;AAAA,EAAA,MAAA,CAyJED,YAzJF,GAyJE,SAAaC,YAAAA,CAAAA,GAAb,EAAkB;AAChB,IAAA,IAAI,IAAK7P,CAAAA,IAAL,CAAUgP,SAAd,EAAyB;AACvB,MAAA,IAAA,CAAKhP,IAAL,CAAUiP,SAAV,GAAsB,KAAtB,CAAA;AACA,MAAA,IAAA,CAAKjP,IAAL,CAAUgP,SAAV,GAAsB,KAAtB,CAAA;;MACA,IAAKc,CAAAA,QAAL,CAAcD,GAAG,CAACE,cAAJ,CAAmB,CAAnB,CAAd,EAAqC,KAArC,CAAA,CAAA;AACD,KAAA;AACF,GAAA;AAED;AACF;AACA;AAnKA,GAAA;;AAAA,EAAA,MAAA,CAoKED,QApKF,GAoKE,SAAA,QAAA,CAASD,GAAT,EAAcG,MAAd,EAAsB;AACpB,IAAA,IAAMC,kBAAkB,GAAG,IAAA,CAAKpB,SAAL,CAAeqB,qBAAf,EAA3B,CAAA;IACA,IAAMC,MAAM,GAAGN,GAAG,CAAC,IAAA,CAAKO,QAAL,GAAgB,SAAhB,GAA4B,SAA7B,CAAlB,CAAA;IACA,IAAMC,GAAG,GAAGJ,kBAAkB,CAAC,IAAA,CAAKG,QAAL,GAAgB,QAAhB,GAA2B,MAA5B,CAA9B,CAAA;IACA,IAAME,IAAI,GAAGL,kBAAkB,CAAC,IAAA,CAAKG,QAAL,GAAgB,QAAhB,GAA2B,OAA5B,CAA/B,CAAA;AACA,IAAA,IAAMjK,GAAG,GAAGxO,IAAI,CAACqL,GAAL,CAAS,CAACqN,GAAG,GAAGF,MAAP,IAAiBG,IAA1B,CAAZ,CAAA;IAEA,IAAKtQ,CAAAA,IAAL,CAAU+O,QAAV,CAAmB;AACjBtN,MAAAA,KAAK,EAAM0E,GADM;MAEjBoK,KAAK,EAAM,CAACP,MAFK;AAGjBhB,MAAAA,SAAS,EAAE,IAAA,CAAKhP,IAAL,CAAUgP,SAHJ;AAIjBC,MAAAA,SAAS,EAAE,IAAA,CAAKjP,IAAL,CAAUiP,SAJJ;AAKjBkB,MAAAA,MAAM,EAAKN,GAAAA;KALb,CAAA,CAAA;GA3KJ,CAAA;;AAAA,EAAA,YAAA,CAAA,MAAA,EAAA,CAAA;AAAA,IAAA,GAAA,EAAA,UAAA;AAAA,IAAA,GAAA;AAKE;AACF;AACA;AACA;IACE,SAAe,GAAA,GAAA;AACb,MAAA,OAAO,KAAK7P,IAAL,CAAU8O,SAAV,KAAwBF,MAAM,CAAC4B,QAAtC,CAAA;AACD,KAAA;AAXH,GAAA,CAAA,CAAA,CAAA;;AAAA,EAAA,OAAA,MAAA,CAAA;AAAA,CAAA,CAA4BC,YAA5B,CAAA,CAAA;AAAa7B,OAEJ4B,WAAW;AAFP5B,OAGJ8B,aAAa;;ACTtB;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACMA;AACA;AACA;AACA;;AAGA;AACA;AACA;AACA;AACA;;AACA,IAAaC,sBAAb,gBAAA,UAAA,gBAAA,EAAA;AAAA,EAAA,cAAA,CAAA,sBAAA,EAAA,gBAAA,CAAA,CAAA;;AAKE;AACF;AACA;AACA;EACE,SAAY1e,sBAAAA,CAAAA,GAAZ,EAAiBgZ,OAAjB,EAA0B;AAAA,IAAA,IAAA,KAAA,CAAA;;AACxB,IAAA,KAAA,GAAA,gBAAA,CAAA,IAAA,CAAA,IAAA,EAAMhZ,GAAN,CAAA,IAAA,IAAA,CAAA;AAEA;AACJ;AACA;AACA;;AACI,IAAA,KAAA,CAAK2e,MAAL,GAAA,QAAA,CAAA;AACEC,MAAAA,UAAU,EAAE,EAAA;AADd,KAAA,EAEK5F,OAFL,CAAA,CAAA;;IAKA,IAAI,CAAClJ,YAAY,CAAC,KAAA,CAAK6O,MAAL,CAAYC,UAAb,CAAjB,EAA2C;AACzC,MAAA,MAAM,IAAIvf,QAAJ,CAAa,wDAAb,CAAN,CAAA;AACD,KAAA;;AAED,IAAA,KAAA,CAAKwf,eAAL,GAAuB,KAAKF,CAAAA,MAAL,CAAYC,UAAnC,CAAA;AACA,IAAA,KAAA,CAAKE,0BAAL,GAAkC,KAAKD,CAAAA,eAAL,GAAuB,CAAzD,CAAA;AAjBwB,IAAA,OAAA,KAAA,CAAA;AAkBzB,GAAA;AAED;AACF;AACA;;;AA/BA,EAAA,IAAA,MAAA,GAAA,sBAAA,CAAA,SAAA,CAAA;;EAAA,MAgCE3e,CAAAA,kBAhCF,GAgCE,SAAqB,kBAAA,GAAA;AACnB,IAAA,OAAO,IAAP,CAAA;AACD,GAAA;AAED;AACF;AACA;AAtCA,GAAA;;EAAA,MAuCEE,CAAAA,eAvCF,GAuCE,SAAkB,eAAA,GAAA;AAChB,IAAA,OAAO,IAAP,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AACA;AACA;AAhDA,GAAA;;AAAA,EAAA,MAAA,CAiDEC,WAjDF,GAiDE,SAAA,WAAA,CAAYF,QAAZ,EAAsBG,WAAtB,EAAmC;AAAA,IAAA,IAAA,MAAA,GAAA,IAAA,CAAA;;AACjC,IAAA,IAAI,OAAOH,QAAP,KAAoB,QAAxB,EAAkC;AAChC,MAAA,IAAIsT,KAAK,CAACC,OAAN,CAAcvT,QAAd,KAA2B,OAAOA,QAAP,KAAoB,QAApB,IAAgC,CAAC,CAACA,QAAQ,CAAC2M,IAA1E,EAAgF;QAC9EmI,OAAO,CAAC,2GAAD,CAAP,CAAA;AACD,OAAA;;MACD,OAAO3L,OAAO,CAACyV,MAAR,CAAe,IAAI1f,QAAJ,CAAa,wDAAb,CAAf,CAAP,CAAA;AACD,KAAA;;AAED,IAAA,OAAO,CACL,CAAC,IAAA,CAAKW,GAAL,CAAS2e,MAAT,CAAgBK,UAAjB,GACI,KAAKhf,GAAL,CAASif,aAAT,CAAuBC,SAAvB,CAAiC/e,QAAjC,EAA2C,UAAAyU,CAAC,EAAA;MAAA,OAAI,MAAI,CAAC5U,GAAL,CAASmf,MAAT,CAAgBC,WAAhB,CAA4BxK,CAA5B,CAAJ,CAAA;AAAA,KAA5C,CACCwF,CAAAA,IADD,CACM,UAAApC,GAAG,EAAA;MAAA,OAAK;AAAEA,QAAAA,GAAG,EAAEA,GAAP;AAAYqH,QAAAA,WAAW,EAAE,IAAA;OAA9B,CAAA;KADT,CADJ,GAGI,IAAKC,CAAAA,SAAL,CAAenf,QAAf,EAAyB,UAAAyU,CAAC,EAAA;MAAA,OAAI,MAAI,CAAC5U,GAAL,CAASmf,MAAT,CAAgBC,WAAhB,CAA4BxK,CAA5B,CAAJ,CAAA;AAAA,KAA1B,CACCwF,CAAAA,IADD,CACM,UAAAiF,WAAW,EAAA;AAAA,MAAA,OAAI,MAAI,CAACrf,GAAL,CAASif,aAAT,CAAuBC,SAAvB,CAAiC/e,QAAjC,CAAA,CAA2Cia,IAA3C,CAAgD,UAAApC,GAAG,EAAA;QAAA,OAAK;AAAEA,UAAAA,GAAG,EAAHA,GAAF;AAAOqH,UAAAA,WAAW,EAAXA,WAAAA;SAAZ,CAAA;AAAA,OAAnD,CAAJ,CAAA;AAAA,KADjB,CAJC,EAOJjF,IAPI,CAOC,UAA0B,IAAA,EAAA;AAAA,MAAA,IAAA,YAAA,EAAA,aAAA,EAAA,aAAA,EAAA,aAAA,EAAA,aAAA,EAAA,aAAA,EAAA,aAAA,EAAA,aAAA,EAAA,aAAA,CAAA;;MAAA,IAAvBpC,GAAuB,QAAvBA,GAAuB;UAAlBqH,WAAkB,QAAlBA,WAAkB,CAAA;;AAC9B,MAAA,IAAI,OAAO/e,WAAP,KAAuB,UAA3B,EAAuC;AACrCA,QAAAA,WAAW,GAAGA,WAAW,CAAC0X,GAAD,CAAzB,CAAA;AACD,OAAA;;AAED,MAAA,IAAMuH,QAAQ,GAAG;AACfC,QAAAA,SAAS,EAAMrL,YAAY,CAAA,CAAA,YAAA,GAAC7T,WAAD,KAAA,IAAA,GAAA,KAAA,CAAA,GAAC,aAAakf,SAAd,EAAyBH,WAAzB,IAAA,IAAA,GAAA,KAAA,CAAA,GAAyBA,WAAW,CAAEG,SAAtC,EAAiDxH,GAAG,CAAC5N,KAArD,CADZ;AAEfqV,QAAAA,UAAU,EAAKtL,YAAY,CAAA,CAAA,aAAA,GAAC7T,WAAD,KAAA,IAAA,GAAA,KAAA,CAAA,GAAC,cAAamf,UAAd,EAA0BJ,WAA1B,IAAA,IAAA,GAAA,KAAA,CAAA,GAA0BA,WAAW,CAAEI,UAAvC,EAAmDzH,GAAG,CAAC3N,MAAvD,CAFZ;AAGfqV,QAAAA,YAAY,EAAGvL,YAAY,CAAA,CAAA,aAAA,GAAC7T,WAAD,KAAA,IAAA,GAAA,KAAA,CAAA,GAAC,cAAaof,YAAd,EAA4BL,WAA5B,IAAA,IAAA,GAAA,KAAA,CAAA,GAA4BA,WAAW,CAAEK,YAAzC,EAAuD1H,GAAG,CAAC5N,KAA3D,CAHZ;AAIfuV,QAAAA,aAAa,EAAExL,YAAY,CAAA,CAAA,aAAA,GAAC7T,WAAD,KAAA,IAAA,GAAA,KAAA,CAAA,GAAC,cAAaqf,aAAd,EAA6BN,WAA7B,IAAA,IAAA,GAAA,KAAA,CAAA,GAA6BA,WAAW,CAAEM,aAA1C,EAAyD3H,GAAG,CAAC3N,MAA7D,CAJZ;AAKfuV,QAAAA,QAAQ,EAAOzL,YAAY,CAAC7T,CAAAA,aAAAA,GAAAA,WAAD,qBAAC,aAAasf,CAAAA,QAAd,EAAwBP,WAAxB,oBAAwBA,WAAW,CAAEO,QAArC,EAA+C,CAA/C,CALZ;AAMfC,QAAAA,QAAQ,EAAO1L,YAAY,CAAC7T,CAAAA,aAAAA,GAAAA,WAAD,qBAAC,aAAauf,CAAAA,QAAd,EAAwBR,WAAxB,oBAAwBA,WAAW,CAAEQ,QAArC,EAA+C,CAA/C,CANZ;AAOfC,QAAAA,WAAW,EAAI3L,YAAY,CAAC7T,CAAAA,aAAAA,GAAAA,WAAD,qBAAC,aAAawf,CAAAA,WAAd,EAA2BT,WAA3B,oBAA2BA,WAAW,CAAES,WAAxC,EAAqD,CAArD,CAPZ;AAQfC,QAAAA,SAAS,EAAM5L,YAAY,CAAC7T,CAAAA,aAAAA,GAAAA,WAAD,qBAAC,aAAayf,CAAAA,SAAd,EAAyBV,WAAzB,oBAAyBA,WAAW,CAAEU,SAAtC,EAAiD,CAAjD,CARZ;AASfC,QAAAA,QAAQ,EAAO7L,YAAY,CAAC7T,CAAAA,aAAAA,GAAAA,WAAD,qBAAC,aAAa0f,CAAAA,QAAd,EAAwBX,WAAxB,IAAwBA,IAAAA,GAAAA,KAAAA,CAAAA,GAAAA,WAAW,CAAEW,QAArC,EAA+C,CAA/C,CAAA;OAT7B,CAAA;;AAYA,MAAA,IAAIT,QAAQ,CAACG,YAAT,KAA0B1H,GAAG,CAAC5N,KAA9B,IAAuCmV,QAAQ,CAACI,aAAT,KAA2B3H,GAAG,CAAC3N,MAA1E,EAAkF;AAChF4K,QAAAA,OAAO,4GACDsK,QAAQ,CAACG,YADR,GAAA,GAAA,GACwBH,QAAQ,CAACI,aADjC,GAC0D3H,WAAAA,GAAAA,GAAG,CAAC5N,KAD9D,GAAA,GAAA,GACuE4N,GAAG,CAAC3N,MAD3E,CAAP,CAAA;AAED,OAAA;;AACD,MAAA,IAAI,CAAC/J,WAAW,IAAI+e,WAAhB,KAAgCE,QAAQ,CAACC,SAAT,KAAuBD,QAAQ,CAACE,UAAT,GAAsB,CAAjF,EAAoF;QAClFxK,OAAO,CAAC,wDAAD,CAAP,CAAA;AACD,OAAA;;MAED,IAAMgD,OAAO,GAAG,MAAI,CAACgI,8BAAL,CAAoCjI,GAApC,EAAyCuH,QAAzC,CAAhB,CAAA;;MAEA,OAAO;AAAEpf,QAAAA,QAAQ,EAARA,QAAF;AAAY8X,QAAAA,OAAO,EAAPA,OAAZ;AAAqBsH,QAAAA,QAAQ,EAARA,QAAAA;OAA5B,CAAA;AACD,KAnCI,CAAP,CAAA;AAoCD,GAAA;AAED;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AAtGA,GAAA;;AAAA,EAAA,MAAA,CAuGED,SAvGF,GAuGE,SAAA,SAAA,CAAUnf,QAAV,EAAoB+f,UAApB,EAAgC;AAAA,IAAA,IAAA,MAAA,GAAA,IAAA,CAAA;;AAC9B,IAAA,OAAO,IAAKlgB,CAAAA,GAAL,CAASif,aAAT,CAAuBkB,QAAvB,CAAgChgB,QAAhC,EAA0C+f,UAA1C,CAAA,CACJ9F,IADI,CACC,UAAAgG,IAAI,EAAA;AAAA,MAAA,OAAI,MAAI,CAACC,kBAAL,CAAwBD,IAAxB,CAAJ,CAAA;AAAA,KADL,CAEJhG,CAAAA,IAFI,CAEC,UAACkG,MAAD,EAAY;AAChB,MAAA,IAAMnQ,CAAC,GAAGmQ,MAAM,CAACC,OAAP,CAAe,YAAf,CAAV,CAAA;AACA,MAAA,IAAMnQ,CAAC,GAAGkQ,MAAM,CAACC,OAAP,CAAe,cAAf,CAAV,CAAA;MACA,IAAM9V,IAAI,GAAG6V,MAAM,CAACE,SAAP,CAAiBrQ,CAAjB,EAAoBC,CAApB,CAAb,CAAA;;AAEA,MAAA,IAAID,CAAC,KAAK,CAAC,CAAP,IAAYC,CAAC,KAAK,CAAC,CAAnB,IAAwB3F,IAAI,CAACgW,QAAL,CAAc,QAAd,CAA5B,EAAqD;QACnD,OAAO;AACLjB,UAAAA,SAAS,EAAMjK,WAAW,CAAC9K,IAAD,EAAO,qBAAP,CADrB;AAELgV,UAAAA,UAAU,EAAKlK,WAAW,CAAC9K,IAAD,EAAO,sBAAP,CAFrB;AAGLiV,UAAAA,YAAY,EAAGnK,WAAW,CAAC9K,IAAD,EAAO,6BAAP,CAHrB;AAILkV,UAAAA,aAAa,EAAEpK,WAAW,CAAC9K,IAAD,EAAO,8BAAP,CAJrB;AAKLmV,UAAAA,QAAQ,EAAOrK,WAAW,CAAC9K,IAAD,EAAO,uBAAP,CALrB;AAMLoV,UAAAA,QAAQ,EAAOtK,WAAW,CAAC9K,IAAD,EAAO,sBAAP,CANrB;AAOLqV,UAAAA,WAAW,EAAIvK,WAAW,CAAC9K,IAAD,EAAO,oBAAP,CAPrB;AAQLsV,UAAAA,SAAS,EAAMxK,WAAW,CAAC9K,IAAD,EAAO,kBAAP,CARrB;AASLuV,UAAAA,QAAQ,EAAOzK,WAAW,CAAC9K,IAAD,EAAO,iBAAP,CAAA;SAT5B,CAAA;AAWD,OAAA;;AAED,MAAA,OAAO,IAAP,CAAA;AACD,KAtBI,CAAP,CAAA;AAuBD,GAAA;AAED;AACF;AACA;AACA;AACA;AACA;AAtIA,GAAA;;AAAA,EAAA,MAAA,CAuIE4V,kBAvIF,GAuIE,SAAmBD,kBAAAA,CAAAA,IAAnB,EAAyB;AACvB,IAAA,OAAO,IAAI9W,OAAJ,CAAY,UAACC,OAAD,EAAUwV,MAAV,EAAqB;AACtC,MAAA,IAAM2B,MAAM,GAAG,IAAIC,UAAJ,EAAf,CAAA;;MACAD,MAAM,CAACE,MAAP,GAAgB,YAAA;AAAA,QAAA,OAAMrX,OAAO,CAACmX,MAAM,CAACjR,MAAR,CAAb,CAAA;OAAhB,CAAA;;MACAiR,MAAM,CAACG,OAAP,GAAiB9B,MAAjB,CAAA;MACA2B,MAAM,CAACI,UAAP,CAAkBV,IAAlB,CAAA,CAAA;AACD,KALM,CAAP,CAAA;AAMD,GAAA;AAED;AACF;AACA;AACA;AACA;AACA;AACA;AAtJA,GAAA;;AAAA,EAAA,MAAA,CAuJEH,8BAvJF,GAuJE,SAAA,8BAAA,CAA+BjI,GAA/B,EAAoCuH,QAApC,EAA8C;AAC5C;IACA,IAAIA,QAAQ,CAACC,SAAT,GAAqBjY,MAAM,CAACK,eAA5B,IACC2X,QAAQ,CAACG,YAAT,KAA0BH,QAAQ,CAACC,SADpC,IAECD,QAAQ,CAACI,aAAT,KAA2BJ,QAAQ,CAACE,UAFzC,EAGE;MACA,IAAMsB,KAAK,GAAGxZ,MAAM,CAACiB,iBAAP,EAA6B+W,GAAAA,QAAQ,CAACC,SAApD,CAAA;;MAEA,IAAMwB,eAAe,GAAQzB,QAAAA,CAAAA,EAAAA,EAAAA,QAAR,CAArB,CAAA;;MACA,IAAIwB,KAAK,GAAG,CAAZ,EAAe;QACbC,eAAe,CAACxB,SAAhB,IAA6BuB,KAA7B,CAAA;QACAC,eAAe,CAACvB,UAAhB,IAA8BsB,KAA9B,CAAA;QACAC,eAAe,CAACtB,YAAhB,IAAgCqB,KAAhC,CAAA;QACAC,eAAe,CAACrB,aAAhB,IAAiCoB,KAAjC,CAAA;QACAC,eAAe,CAACpB,QAAhB,IAA4BmB,KAA5B,CAAA;QACAC,eAAe,CAACnB,QAAhB,IAA4BkB,KAA5B,CAAA;AACD,OAAA;;AAED,MAAA,IAAME,MAAM,GAAGvY,QAAQ,CAACC,aAAT,CAAuB,QAAvB,CAAf,CAAA;AACAsY,MAAAA,MAAM,CAAC7W,KAAP,GAAe4W,eAAe,CAACxB,SAA/B,CAAA;AACAyB,MAAAA,MAAM,CAAC5W,MAAP,GAAgB2W,eAAe,CAACvB,UAAhC,CAAA;AAEA,MAAA,IAAMzX,GAAG,GAAGiZ,MAAM,CAACnY,UAAP,CAAkB,IAAlB,CAAZ,CAAA;AACAd,MAAAA,GAAG,CAACkZ,SAAJ,CAAclJ,GAAd,EACEgJ,eAAe,CAACpB,QADlB,EAC4BoB,eAAe,CAACnB,QAD5C,EAEEmB,eAAe,CAACtB,YAFlB,EAEgCsB,eAAe,CAACrB,aAFhD,CAAA,CAAA;MAIA,OAAO5H,aAAa,CAACkJ,MAAD,CAApB,CAAA;AACD,KAAA;;IAED,OAAOlJ,aAAa,CAACC,GAAD,CAApB,CAAA;AACD,GAAA;AAED;AACF;AACA;AA1LA,GAAA;;AAAA,EAAA,MAAA,CA2LEzX,UA3LF,GA2LE,SAAWC,UAAAA,CAAAA,KAAX,EAAsB;AAAA,IAAA,IAAXA,KAAW,KAAA,KAAA,CAAA,EAAA;AAAXA,MAAAA,KAAW,GAAH,CAAG,CAAA;AAAA,KAAA;;AACpB;AACA,IAAA,IAAM2gB,QAAQ,GAAG,IAAI5J,KAAK,CAAC6J,cAAV,CACf3f,aAAa,GAAGjB,KADD,EAEf,IAAKqe,CAAAA,eAFU,EAGf,IAAKC,CAAAA,0BAHU,EAIf,CAACpZ,IAAI,CAACE,EAAN,GAAW,CAJI,CAMdpF,CAAAA,KANc,CAMR,CAAC,CANO,EAMJ,CANI,EAMD,CANC,CAAjB,CAAA;AAQA,IAAA,IAAM6gB,QAAQ,GAAG,IAAI9J,KAAK,CAAC+J,iBAAV,EAAjB,CAAA;IAEA,OAAO,IAAI/J,KAAK,CAACgK,IAAV,CAAeJ,QAAf,EAAyBE,QAAzB,CAAP,CAAA;AACD,GAAA;AAED;AACF;AACA;AA5MA,GAAA;;AAAA,EAAA,MAAA,CA6ME5gB,UA7MF,GA6ME,SAAA,UAAA,CAAWC,IAAX,EAAiBC,WAAjB,EAA8B;AAAA,IAAA,IAAA,kBAAA,CAAA;;AAC5B,IAAA,CAAA,kBAAA,GAAAD,IAAI,CAAC2gB,QAAL,CAAchL,GAAd,wCAAmBmL,OAAnB,EAAA,CAAA;AACA9gB,IAAAA,IAAI,CAAC2gB,QAAL,CAAchL,GAAd,GAAoB1V,WAAW,CAACsX,OAAhC,CAAA;AACD,GAAA;AAED;AACF;AACA;AApNA,GAAA;;AAAA,EAAA,MAAA,CAqNEpX,iBArNF,GAqNE,SAAA,iBAAA,CAAkBH,IAAlB,EAAwBI,OAAxB,EAAiC;AAC/BJ,IAAAA,IAAI,CAAC2gB,QAAL,CAAcvgB,OAAd,GAAwBA,OAAxB,CAAA;AACAJ,IAAAA,IAAI,CAAC2gB,QAAL,CAAcI,WAAd,GAA4B3gB,OAAO,GAAG,CAAtC,CAAA;AACD,GAAA;AAED;AACF;AACA;AA5NA,GAAA;;AAAA,EAAA,MAAA,CA6NEC,cA7NF,GA6NE,SAAeJ,cAAAA,CAAAA,WAAf,EAA4B;AAAA,IAAA,IAAA,oBAAA,CAAA;;AAC1B,IAAA,CAAA,oBAAA,GAAAA,WAAW,CAACsX,OAAZ,KAAA,IAAA,GAAA,KAAA,CAAA,GAAA,oBAAA,CAAqBuJ,OAArB,EAAA,CAAA;GA9NJ,CAAA;;AAAA,EAAA,OAAA,sBAAA,CAAA;AAAA,CAAA,CAA4CzhB,eAA5C,EAAA;AAAa2e,uBAEJ1d,KAAK;AAFD0d,uBAGJzd,mBAAmB;;ACtB5B;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,IAAaygB,iBAAb,gBAAA,YAAA;AAEE;AACF;AACA;AACA;EACE,SAAYrV,iBAAAA,CAAAA,MAAZ,EAAoBb,SAApB,EAA+B;AAC7B;AACJ;AACA;AACA;AACA;AACI,IAAA,IAAA,CAAKxL,GAAL,GAAWqM,MAAM,CAACrM,GAAP,IAAcqM,MAAzB,CAAA;AAEA;AACJ;AACA;AACA;;IACI,IAAKA,CAAAA,MAAL,GAAcA,MAAd,CAAA;AACA,IAAA,IAAA,CAAKA,MAAL,CAAYsV,QAAZ,CAAqBnH,IAArB,CAA0B,IAA1B,CAAA,CAAA;AAEA;AACJ;AACA;AACA;AACA;AACA;;IACI,IAAKmH,CAAAA,QAAL,GAAgB,EAAhB,CAAA;AAEA;AACJ;AACA;AACA;AACA;AACA;;AACI,IAAA,IAAA,CAAK5T,IAAL,GAAY;AACV6T,MAAAA,OAAO,EAAE,IAAA;KADX,CAAA;AAIA;AACJ;AACA;AACA;;AACI,IAAA,IAAA,CAAKhF,SAAL,GAAiBlU,QAAQ,CAACC,aAAT,CAAuB,KAAvB,CAAjB,CAAA;AACA,IAAA,IAAA,CAAKiU,SAAL,CAAepR,SAAf,GAA2BA,SAA3B,CAAA;AACA,IAAA,IAAA,CAAKa,MAAL,CAAYuQ,SAAZ,CAAsBiF,WAAtB,CAAkC,KAAKjF,SAAvC,CAAA,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;;;AAnDA,EAAA,IAAA,MAAA,GAAA,iBAAA,CAAA,SAAA,CAAA;;EAAA,MAoDE3c,CAAAA,OApDF,GAoDE,SAAU,OAAA,GAAA;AACR,IAAA,IAAA,CAAKoM,MAAL,CAAYuQ,SAAZ,CAAsBkF,WAAtB,CAAkC,KAAKlF,SAAvC,CAAA,CAAA;IAEA,IAAMmF,QAAQ,GAAG,IAAA,CAAK1V,MAAL,CAAYsV,QAAZ,CAAqBpB,OAArB,CAA6B,IAA7B,CAAjB,CAAA;;AACA,IAAA,IAAIwB,QAAQ,KAAK,CAAC,CAAlB,EAAqB;MACnB,IAAK1V,CAAAA,MAAL,CAAYsV,QAAZ,CAAqBK,MAArB,CAA4BD,QAA5B,EAAsC,CAAtC,CAAA,CAAA;AACD,KAAA;;AAED,IAAA,IAAA,CAAKJ,QAAL,CAAcxL,KAAd,GAAsBlK,OAAtB,CAA8B,UAAAgW,KAAK,EAAA;MAAA,OAAIA,KAAK,CAAChiB,OAAN,EAAJ,CAAA;KAAnC,CAAA,CAAA;AACA,IAAA,IAAA,CAAK0hB,QAAL,CAActW,MAAd,GAAuB,CAAvB,CAAA;AAEA,IAAA,OAAO,KAAKuR,SAAZ,CAAA;AACA,IAAA,OAAO,KAAKvQ,MAAZ,CAAA;AACA,IAAA,OAAO,KAAKrM,GAAZ,CAAA;AACA,IAAA,OAAO,KAAK+N,IAAZ,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AACA;AAzEA,GAAA;;EAAA,MA0EEmU,CAAAA,SA1EF,GA0EE,SAAY,SAAA,GAAA;AAAA,IAAA,IAAA,KAAA,GAAA,IAAA,CAAA;;AACV,IAAA,IAAA,CAAKP,QAAL,CAAcQ,KAAd,CAAoB,UAACF,KAAD,EAAW;AAC7BA,MAAAA,KAAK,CAACC,SAAN,EAAA,CAAA;MACA,OAAO,KAAI,CAACliB,GAAL,CAAS+N,IAAT,CAAcqU,SAAd,KAA4B,IAAnC,CAAA;KAFF,CAAA,CAAA;AAID,GAAA;AAED;AACF;AACA;AAnFA,GAAA;;EAAA,MAoFEzW,CAAAA,MApFF,GAoFE,SAAS,MAAA,GAAA;IACP,IAAI,IAAA,CAAK0W,SAAL,EAAJ,EAAsB;AACpB,MAAA,IAAA,CAAKC,IAAL,EAAA,CAAA;AACD,KAFD,MAGK;AACH,MAAA,IAAA,CAAKC,IAAL,EAAA,CAAA;AACD,KAAA;AACF,GAAA;AAED;AACF;AACA;AA/FA,GAAA;;EAAA,MAgGED,CAAAA,IAhGF,GAgGE,SAAO,IAAA,GAAA;AACL,IAAA,IAAA,CAAK1F,SAAL,CAAe4F,KAAf,CAAqBC,OAArB,GAA+B,MAA/B,CAAA;AACA,IAAA,IAAA,CAAK1U,IAAL,CAAU6T,OAAV,GAAoB,KAApB,CAAA;AACD,GAAA;AAED;AACF;AACA;AAvGA,GAAA;;EAAA,MAwGEW,CAAAA,IAxGF,GAwGE,SAAO,IAAA,GAAA;AACL,IAAA,IAAA,CAAK3F,SAAL,CAAe4F,KAAf,CAAqBC,OAArB,GAA+B,EAA/B,CAAA;AACA,IAAA,IAAA,CAAK1U,IAAL,CAAU6T,OAAV,GAAoB,IAApB,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AAhHA,GAAA;;EAAA,MAiHES,CAAAA,SAjHF,GAiHE,SAAY,SAAA,GAAA;IACV,OAAO,IAAA,CAAKtU,IAAL,CAAU6T,OAAjB,CAAA;GAlHJ,CAAA;;AAAA,EAAA,OAAA,iBAAA,CAAA;AAAA,CAAA;;ACJA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AACA,IAAac,cAAb,gBAAA,UAAA,kBAAA,EAAA;AAAA,EAAA,cAAA,CAAA,cAAA,EAAA,kBAAA,CAAA,CAAA;;AAEE;AACF;AACA;AACA;AACA;AACA;;AAGE;AACF;AACA;AACA;AACA;AACA;;AAGE;AACF;AACA;AACA;AACA;AACA;;AAGE;AACF;AACA;AACA;AACA;AACA;;AAGE;AACF;AACA;AACA;AACA;AACA;AACE,EAAA,SAAA,cAAA,CAAYC,MAAZ,EAAoBnX,SAApB,EAAoCoX,WAApC,EAAyDC,QAAzD,EAA0E;AAAA,IAAA,IAAA,KAAA,CAAA;;AAAA,IAAA,IAAtDrX,SAAsD,KAAA,KAAA,CAAA,EAAA;AAAtDA,MAAAA,SAAsD,GAA1C,EAA0C,CAAA;AAAA,KAAA;;AAAA,IAAA,IAAtCoX,WAAsC,KAAA,KAAA,CAAA,EAAA;AAAtCA,MAAAA,WAAsC,GAAxB,KAAwB,CAAA;AAAA,KAAA;;AAAA,IAAA,IAAjBC,QAAiB,KAAA,KAAA,CAAA,EAAA;AAAjBA,MAAAA,QAAiB,GAAN,IAAM,CAAA;AAAA,KAAA;;IACxE,KAAMF,GAAAA,kBAAAA,CAAAA,IAAAA,CAAAA,IAAAA,EAAAA,MAAN,EAAc,aAAA,GAAgBnX,SAA9B,CAAA,IAAA,IAAA,CAAA;AAEA;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;IACI,KAAKuC,CAAAA,IAAL,GACK,QAAA,CAAA,EAAA,EAAA,KAAA,CAAKA,IADV,EAAA;AAEE/M,MAAAA,EAAE,EAAW,KAAA,CAAKlB,WAAL,CAAiBkB,EAFhC;AAGE4hB,MAAAA,WAAW,EAAEA,WAHf;AAIEE,MAAAA,OAAO,EAAM,IAJf;AAKEC,MAAAA,SAAS,EAAI,IALf;AAMEC,MAAAA,SAAS,EAAI,KANf;AAOEvX,MAAAA,MAAM,EAAO,KAPf;MAQErB,KAAK,EAAQ,KAAKwS,CAAAA,SAAL,CAAeqG,WAAAA;AAR9B,KAAA,CAAA,CAAA;;AAWA,IAAA,IAAI,KAAKnjB,CAAAA,WAAL,CAAiBojB,IAArB,EAA2B;AACzB,MAAA,KAAA,CAAKC,SAAL,CAAe,KAAKrjB,CAAAA,WAAL,CAAiBojB,IAAhC,CAAA,CAAA;AACD,KAAA;;AAED,IAAA,IAAI,MAAKnV,IAAL,CAAU/M,EAAV,IAAgB,MAAKhB,GAAL,CAAS2e,MAAT,CAAgByE,IAAhB,CAAqB,KAAA,CAAKrV,IAAL,CAAU/M,EAA/B,CAApB,EAAwD;AACtD,MAAA,KAAA,CAAK4b,SAAL,CAAeyG,KAAf,GAAuB,MAAKrjB,GAAL,CAAS2e,MAAT,CAAgByE,IAAhB,CAAqB,KAAA,CAAKrV,IAAL,CAAU/M,EAA/B,CAAvB,CAAA;AACD,KAAA;;AAED,IAAA,IAAI6hB,QAAJ,EAAc;AACZ,MAAA,KAAA,CAAKjG,SAAL,CAAe0G,QAAf,GAA0B,CAA1B,CAAA;AACD,KAAA;;IAED,KAAK1G,CAAAA,SAAL,CAAehT,gBAAf,CAAgC,OAAhC,EAAyC,UAACZ,CAAD,EAAO;AAC9C,MAAA,IAAI,KAAK+E,CAAAA,IAAL,CAAU+U,OAAd,EAAuB;AACrB,QAAA,KAAA,CAAKS,OAAL,EAAA,CAAA;AACD,OAAA;;AACDva,MAAAA,CAAC,CAACmU,eAAF,EAAA,CAAA;KAJF,CAAA,CAAA;;IAOA,KAAKP,CAAAA,SAAL,CAAehT,gBAAf,CAAgC,SAAhC,EAA2C,UAACZ,CAAD,EAAO;AAChD,MAAA,IAAIA,CAAC,CAAC2K,GAAF,KAAUnN,SAAS,CAACC,KAApB,IAA6B,KAAKsH,CAAAA,IAAL,CAAU+U,OAA3C,EAAoD;AAClD,QAAA,KAAA,CAAKS,OAAL,EAAA,CAAA;;AACAva,QAAAA,CAAC,CAACmU,eAAF,EAAA,CAAA;AACD,OAAA;KAJH,CAAA,CAAA;;AA1CwE,IAAA,OAAA,KAAA,CAAA;AAgDzE,GAAA;AAED;AACF;AACA;;;AA5FA,EAAA,IAAA,MAAA,GAAA,cAAA,CAAA,SAAA,CAAA;;EAAA,MA6FEqG,CAAAA,cA7FF,GA6FE,SAAiB,cAAA,GAAA;AAAA,IAAA,IAAA,MAAA,GAAA,IAAA,CAAA;;AACf,IAAA,IAAMC,iBAAiB,GAAG,IAAKC,CAAAA,WAAL,EAA1B,CAAA;;AACA,IAAA,IAAI3Q,aAAa,CAAC0Q,iBAAD,CAAjB,EAAsC;AACpC,MAAA,IAAIA,iBAAiB,CAACxa,OAAlB,KAA8B,KAAlC,EAAyC;AACvC,QAAA,IAAA,CAAKqZ,IAAL,EAAA,CAAA;AACA,QAAA,IAAA,CAAKvU,IAAL,CAAUgV,SAAV,GAAsB,KAAtB,CAAA;AACD,OAAA;;AAEDU,MAAAA,iBAAiB,CAACpa,OAAlB,CAA0B+Q,IAA1B,CAA+B,UAAC2I,SAAD,EAAe;AAC5C,QAAA,IAAI,CAAC,MAAI,CAAChV,IAAV,EAAgB;AACd,UAAA,OADc;AAEf,SAAA;;AACD,QAAA,MAAI,CAACA,IAAL,CAAUgV,SAAV,GAAsBA,SAAtB,CAAA;;QACA,IAAI,CAACA,SAAL,EAAgB;AACd,UAAA,MAAI,CAACT,IAAL,EAAA,CAAA;AACD,SAFD,MAGK;AACH,UAAA,MAAI,CAACC,IAAL,EAAA,CAAA;AACD,SAAA;OAVH,CAAA,CAAA;AAYD,KAlBD,MAmBK;AACH,MAAA,IAAA,CAAKxU,IAAL,CAAUgV,SAAV,GAAsBU,iBAAtB,CAAA;;MACA,IAAI,CAACA,iBAAL,EAAwB;AACtB,QAAA,IAAA,CAAKnB,IAAL,EAAA,CAAA;AACD,OAAA;AACF,KAAA;AACF,GAAA;AAED;AACF;AACA;AACA;AA7HA,GAAA;;EAAA,MA8HEoB,CAAAA,WA9HF,GA8HE,SAAc,WAAA,GAAA;AACZ,IAAA,OAAO,IAAP,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AArIA,GAAA;;AAAA,EAAA,MAAA,CAsIEC,YAtIF,GAsIE,SAAalY,YAAAA,CAAAA,MAAb,EAAqB;AACnB,IAAA,IAAA,CAAKsC,IAAL,CAAUtC,MAAV,GAAmBA,MAAM,KAAKd,SAAX,GAAuBc,MAAvB,GAAgC,CAAC,IAAKsC,CAAAA,IAAL,CAAUtC,MAA9D,CAAA;IACAH,WAAW,CAAC,IAAKsR,CAAAA,SAAN,EAAiB,oBAAjB,EAAuC,IAAK7O,CAAAA,IAAL,CAAUtC,MAAjD,CAAX,CAAA;;AAEA,IAAA,IAAI,IAAK3L,CAAAA,WAAL,CAAiB8jB,UAArB,EAAiC;AAC/B,MAAA,IAAA,CAAKT,SAAL,CAAe,IAAKpV,CAAAA,IAAL,CAAUtC,MAAV,GAAmB,IAAK3L,CAAAA,WAAL,CAAiB8jB,UAApC,GAAiD,IAAK9jB,CAAAA,WAAL,CAAiBojB,IAAjF,CAAA,CAAA;AACD,KAAA;AACF,GAAA;AAED;AACF;AACA;AAjJA,GAAA;;AAAA,EAAA,MAAA,CAkJEX,IAlJF,GAkJE,SAAKsB,IAAAA,CAAAA,OAAL,EAAqB;AAAA,IAAA,IAAhBA,OAAgB,KAAA,KAAA,CAAA,EAAA;AAAhBA,MAAAA,OAAgB,GAAN,IAAM,CAAA;AAAA,KAAA;;AACnB,IAAA,IAAI,CAAC,IAAA,CAAKxB,SAAL,EAAL,EAAuB;AACrB,MAAA,IAAA,CAAKtU,IAAL,CAAU6T,OAAV,GAAoB,IAApB,CAAA;;AACA,MAAA,IAAI,CAAC,IAAA,CAAK7T,IAAL,CAAUiV,SAAf,EAA0B;AACxB,QAAA,IAAA,CAAKpG,SAAL,CAAe4F,KAAf,CAAqBC,OAArB,GAA+B,EAA/B,CAAA;AACD,OAAA;;AACD,MAAA,IAAIoB,OAAJ,EAAa;AACX,QAAA,IAAA,CAAK7jB,GAAL,CAASkiB,SAAT,kBAAkC,IAAKnU,CAAAA,IAAL,CAAU/M,EAA5C,CAAA,CAAA;AACD,OAAA;AACF,KAAA;AACF,GAAA;AAED;AACF;AACA;AAhKA,GAAA;;AAAA,EAAA,MAAA,CAiKEshB,IAjKF,GAiKE,SAAKuB,IAAAA,CAAAA,OAAL,EAAqB;AAAA,IAAA,IAAhBA,OAAgB,KAAA,KAAA,CAAA,EAAA;AAAhBA,MAAAA,OAAgB,GAAN,IAAM,CAAA;AAAA,KAAA;;IACnB,IAAI,IAAA,CAAKxB,SAAL,EAAJ,EAAsB;AACpB,MAAA,IAAA,CAAKtU,IAAL,CAAU6T,OAAV,GAAoB,KAApB,CAAA;AACA,MAAA,IAAA,CAAKhF,SAAL,CAAe4F,KAAf,CAAqBC,OAArB,GAA+B,MAA/B,CAAA;;AACA,MAAA,IAAIoB,OAAJ,EAAa;AACX,QAAA,IAAA,CAAK7jB,GAAL,CAASkiB,SAAT,kBAAkC,IAAKnU,CAAAA,IAAL,CAAU/M,EAA5C,CAAA,CAAA;AACD,OAAA;AACF,KAAA;AACF,GAAA;AAED;AACF;AACA;AA7KA,GAAA;;EAAA,MA8KE8iB,CAAAA,OA9KF,GA8KE,SAAU,OAAA,GAAA;AACR,IAAA,IAAA,CAAKlH,SAAL,CAAelR,SAAf,CAAyBG,GAAzB,CAA6B,sBAA7B,CAAA,CAAA;AACA,IAAA,IAAA,CAAKkC,IAAL,CAAU+U,OAAV,GAAoB,KAApB,CAAA;AACD,GAAA;AAED;AACF;AACA;AArLA,GAAA;;EAAA,MAsLEiB,CAAAA,MAtLF,GAsLE,SAAS,MAAA,GAAA;AACP,IAAA,IAAA,CAAKnH,SAAL,CAAelR,SAAf,CAAyBI,MAAzB,CAAgC,sBAAhC,CAAA,CAAA;AACA,IAAA,IAAA,CAAKiC,IAAL,CAAU+U,OAAV,GAAoB,IAApB,CAAA;AACD,GAAA;AAED;AACF;AACA;AA7LA,GAAA;;EAAA,MA8LEkB,CAAAA,QA9LF,GA8LE,SAAW,QAAA,GAAA;AACT,IAAA,IAAA,CAAKjW,IAAL,CAAUiV,SAAV,GAAsB,IAAtB,CAAA;AACA,IAAA,IAAA,CAAKpG,SAAL,CAAe4F,KAAf,CAAqBC,OAArB,GAA+B,MAA/B,CAAA;AACD,GAAA;AAED;AACF;AACA;AArMA,GAAA;;EAAA,MAsMEwB,CAAAA,UAtMF,GAsME,SAAa,UAAA,GAAA;AACX,IAAA,IAAA,CAAKlW,IAAL,CAAUiV,SAAV,GAAsB,KAAtB,CAAA;;AACA,IAAA,IAAI,IAAKjV,CAAAA,IAAL,CAAU6T,OAAd,EAAuB;AACrB,MAAA,IAAA,CAAKhF,SAAL,CAAe4F,KAAf,CAAqBC,OAArB,GAA+B,EAA/B,CAAA;AACD,KAAA;AACF,GAAA;AAED;AACF;AACA;AACA;AACA;AACA;AAlNA,GAAA;;AAAA,EAAA,MAAA,CAmNEU,SAnNF,GAmNE,SAAA,SAAA,CAAUD,IAAV,EAAgBtG,SAAhB,EAA4C;AAAA,IAAA,IAA5BA,SAA4B,KAAA,KAAA,CAAA,EAAA;MAA5BA,SAA4B,GAAhB,KAAKA,SAAW,CAAA;AAAA,KAAA;;AAC1C,IAAA,IAAIsG,IAAJ,EAAU;AACRtG,MAAAA,SAAS,CAACsH,SAAV,GAAsBhB,IAAtB,CADQ;;MAGRtG,SAAS,CAACuH,aAAV,CAAwB,KAAxB,EAA+BzY,SAA/B,CAAyCG,GAAzC,CAA6C,gBAA7C,CAAA,CAAA;AACD,KAJD,MAKK;MACH+Q,SAAS,CAACsH,SAAV,GAAsB,EAAtB,CAAA;AACD,KAAA;AACF,GAAA;AAED;AACF;AACA;AACA;AACA;AAlOA,GAAA;;EAAA,MAmOEX,CAAAA,OAnOF,GAmOE,SAAU,OAAA,GAAA;AACR,IAAA,MAAM,IAAIlkB,QAAJ,CAAA,uCAAA,GAAoD,KAAK0O,IAAL,CAAU/M,EAA9D,GAAN,KAAA,CAAA,CAAA;GApOJ,CAAA;;AAAA,EAAA,OAAA,cAAA,CAAA;AAAA,CAAA,CAAoC0gB,iBAApC,EAAA;AAAagB,eAQJ1hB,KAAK;AARD0hB,eAgBJ0B,UAAU;AAhBN1B,eAwBJQ,OAAO;AAxBHR,eAgCJkB,aAAa;;;;;;AC1CtB;AACA;AACA;AACA;AACA;;AACA,IAAaS,gBAAb,gBAAA,UAAA,eAAA,EAAA;AAAA,EAAA,cAAA,CAAA,gBAAA,EAAA,eAAA,CAAA,CAAA;;AAME;AACF;AACA;AACE,EAAA,SAAA,gBAAA,CAAY1B,MAAZ,EAAoB;AAAA,IAAA,IAAA,KAAA,CAAA;;AAClB,IAAA,KAAA,GAAA,eAAA,CAAA,IAAA,CAAA,IAAA,EAAMA,MAAN,EAAc,+CAAd,EAA+D,IAA/D,CAAA,IAAA,IAAA,CAAA;;AAEA,IAAA,KAAA,CAAK3iB,GAAL,CAASskB,EAAT,CAAYliB,MAAM,CAACC,UAAnB,EAAA,sBAAA,CAAA,KAAA,CAAA,CAAA,CAAA;;AAHkB,IAAA,OAAA,KAAA,CAAA;AAInB,GAAA;AAED;AACF;AACA;;;AAjBA,EAAA,IAAA,MAAA,GAAA,gBAAA,CAAA,SAAA,CAAA;;EAAA,MAkBEpC,CAAAA,OAlBF,GAkBE,SAAU,OAAA,GAAA;IACR,IAAKD,CAAAA,GAAL,CAASukB,GAAT,CAAaniB,MAAM,CAACC,UAApB,EAAgC,IAAhC,CAAA,CAAA;;AAEA,IAAA,eAAA,CAAA,SAAA,CAAMpC,OAAN,CAAA,IAAA,CAAA,IAAA,CAAA,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AACA;AA5BA,GAAA;;AAAA,EAAA,MAAA,CA6BEgd,WA7BF,GA6BE,SAAYjU,WAAAA,CAAAA,CAAZ,EAAe;AACb;IACA,QAAQA,CAAC,CAACkU,IAAV;AACE;MACA,KAAK9a,MAAM,CAACC,UAAZ;AAAwB,QAAA,IAAA,CAAKshB,YAAL,CAAkB3a,CAAC,CAACsJ,IAAF,CAAO,CAAP,CAAlB,CAAA,CAAA;AAA8B,QAAA,MAAA;AACtD;AAHF,KAAA;AAKA;;AACD,GAAA;AAED;AACF;AACA;AACA;AA1CA,GAAA;;EAAA,MA2CEiR,CAAAA,OA3CF,GA2CE,SAAU,OAAA,GAAA;AACR,IAAA,IAAI,IAAKvjB,CAAAA,GAAL,CAASwkB,mBAAT,EAAJ,EAAoC;AAClC,MAAA,IAAA,CAAKxkB,GAAL,CAAS2e,MAAT,CAAgB8F,cAAhB,GAAiC,KAAjC,CAAA;MACA,IAAKzkB,CAAAA,GAAL,CAAS0kB,cAAT,EAAA,CAAA;AACD,KAAA;;IACD,IAAK1kB,CAAAA,GAAL,CAAS2kB,gBAAT,EAAA,CAAA;GAhDJ,CAAA;;AAAA,EAAA,OAAA,gBAAA,CAAA;AAAA,CAAA,CAAsCjC,cAAtC,CAAA,CAAA;AAAa2B,iBAEJrjB,KAAK;AAFDqjB,iBAGJnB,OAAO0B;AAHHP,iBAIJT,aAAaiB;;ACXtB;AACA;AACA;AACA;AACA;;AACA,IAAaC,YAAb,gBAAA,UAAA,eAAA,EAAA;AAAA,EAAA,cAAA,CAAA,YAAA,EAAA,eAAA,CAAA,CAAA;;AAEE;AACF;AACA;AACA;EACE,SAAYnC,YAAAA,CAAAA,MAAZ,EAAoBhE,MAApB,EAA4B;AAAA,IAAA,IAAA,KAAA,CAAA;;AAC1B,IAAA,KAAA,GAAA,eAAA,CAAA,IAAA,CAAA,IAAA,EAAMgE,MAAN,EAAc,mBAAd,EAAmChE,MAAM,CAACiE,WAAP,KAAuB,KAA1D,EAAiEjE,MAAM,CAACkE,QAAP,KAAoB,KAArF,CAAA,IAAA,IAAA,CAAA;AAEA;AACJ;AACA;AACA;AACA;;IACI,KAAKlE,CAAAA,MAAL,GAAcA,MAAd,CAAA;;AAEA,IAAA,IAAI,KAAKA,CAAAA,MAAL,CAAY3d,EAAhB,EAAoB;AAClB,MAAA,KAAA,CAAK+M,IAAL,CAAU/M,EAAV,GAAe,KAAK2d,CAAAA,MAAL,CAAY3d,EAA3B,CAAA;AACD,KAFD,MAGK;AACH,MAAA,KAAA,CAAK+M,IAAL,CAAU/M,EAAV,GAAe,YAAe0E,GAAAA,IAAI,CAACqf,MAAL,EAAA,CAAc5R,QAAd,CAAuB,EAAvB,CAA2B6R,CAAAA,MAA3B,CAAkC,CAAlC,EAAqC,CAArC,CAA9B,CAAA;AACD,KAAA;;AAED,IAAA,IAAI,KAAKrG,CAAAA,MAAL,CAAYnT,SAAhB,EAA2B;MACzBO,UAAU,CAAC,MAAK6Q,SAAN,EAAiB,MAAK+B,MAAL,CAAYnT,SAA7B,CAAV,CAAA;AACD,KAAA;;AAED,IAAA,IAAI,KAAKmT,CAAAA,MAAL,CAAY0E,KAAhB,EAAuB;AACrB,MAAA,KAAA,CAAKzG,SAAL,CAAeyG,KAAf,GAAuB,KAAK1E,CAAAA,MAAL,CAAY0E,KAAnC,CAAA;AACD,KAAA;;AAED,IAAA,IAAI,KAAK1E,CAAAA,MAAL,CAAYsG,OAAhB,EAAyB;AACvB,MAAA,KAAA,CAAKrI,SAAL,CAAesH,SAAf,GAA2B,KAAKvF,CAAAA,MAAL,CAAYsG,OAAvC,CAAA;AACD,KAAA;;AAED,IAAA,KAAA,CAAKlX,IAAL,CAAU3D,KAAV,GAAkB,KAAKwS,CAAAA,SAAL,CAAeqG,WAAjC,CAAA;;AAEA,IAAA,IAAI,MAAKtE,MAAL,CAAYmE,OAAZ,KAAwB,KAA5B,EAAmC;AACjC,MAAA,KAAA,CAAKgB,OAAL,EAAA,CAAA;AACD,KAAA;;AAED,IAAA,IAAI,MAAKnF,MAAL,CAAYiD,OAAZ,KAAwB,KAA5B,EAAmC;AACjC,MAAA,KAAA,CAAKU,IAAL,EAAA,CAAA;AACD,KAAA;;AArCyB,IAAA,OAAA,KAAA,CAAA;AAsC3B,GAAA;AAED;AACF;AACA;;;AAhDA,EAAA,IAAA,MAAA,GAAA,YAAA,CAAA,SAAA,CAAA;;EAAA,MAiDEriB,CAAAA,OAjDF,GAiDE,SAAU,OAAA,GAAA;AACR,IAAA,OAAO,KAAK0e,MAAZ,CAAA;;AAEA,IAAA,eAAA,CAAA,SAAA,CAAM1e,OAAN,CAAA,IAAA,CAAA,IAAA,CAAA,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AA1DA,GAAA;;EAAA,MA2DEsjB,CAAAA,OA3DF,GA2DE,SAAU,OAAA,GAAA;AACR,IAAA,IAAI,IAAK5E,CAAAA,MAAL,CAAY4E,OAAhB,EAAyB;AACvB,MAAA,IAAA,CAAK5E,MAAL,CAAY4E,OAAZ,CAAoB3Q,KAApB,CAA0B,KAAK5S,GAA/B,CAAA,CAAA;AACD,KAAA;GA9DL,CAAA;;AAAA,EAAA,OAAA,YAAA,CAAA;AAAA,CAAA,CAAkC0iB,cAAlC,CAAA;;;;ACJA,IAAMwC,UAAU,GAAG,CAAnB,CAAA;AACA,IAAMC,UAAU,GAAG,CAAnB,CAAA;AAEA;AACA;AACA;AACA;AACA;;AACA,IAAaC,iBAAb,gBAAA,UAAA,eAAA,EAAA;AAAA,EAAA,cAAA,CAAA,iBAAA,EAAA,eAAA,CAAA,CAAA;;AAKE;AACF;AACA;AACE,EAAA,SAAA,iBAAA,CAAYzC,MAAZ,EAAoB;AAAA,IAAA,IAAA,KAAA,CAAA;;IAClB,KAAMA,GAAAA,eAAAA,CAAAA,IAAAA,CAAAA,IAAAA,EAAAA,MAAN,EAAc,gDAAd,CAAA,IAAA,IAAA,CAAA;AAEA;AACJ;AACA;AACA;;IACI,KAAK5U,CAAAA,IAAL,GACK,QAAA,CAAA,EAAA,EAAA,KAAA,CAAKA,IADV,EAAA;AAEEkN,MAAAA,IAAI,EAAE,IAAA;AAFR,KAAA,CAAA,CAAA;;AAKA,IAAA,KAAA,CAAKjb,GAAL,CAASskB,EAAT,CAAYliB,MAAM,CAACS,iBAAnB,EAAA,sBAAA,CAAA,KAAA,CAAA,CAAA,CAAA;;AACA,IAAA,KAAA,CAAK7C,GAAL,CAASskB,EAAT,CAAYliB,MAAM,CAACmB,iBAAnB,EAAA,sBAAA,CAAA,KAAA,CAAA,CAAA,CAAA;;AACA,IAAA,KAAA,CAAKvD,GAAL,CAASskB,EAAT,CAAYliB,MAAM,CAACK,WAAnB,EAAA,sBAAA,CAAA,KAAA,CAAA,CAAA,CAAA;;AACA,IAAA,KAAA,CAAKzC,GAAL,CAASskB,EAAT,CAAYliB,MAAM,CAACc,UAAnB,EAAA,sBAAA,CAAA,KAAA,CAAA,CAAA,CAAA;;AAfkB,IAAA,OAAA,KAAA,CAAA;AAgBnB,GAAA;AAED;AACF;AACA;;;AA5BA,EAAA,IAAA,MAAA,GAAA,iBAAA,CAAA,SAAA,CAAA;;EAAA,MA6BEjD,CAAAA,OA7BF,GA6BE,SAAU,OAAA,GAAA;IACR,IAAKD,CAAAA,GAAL,CAASukB,GAAT,CAAaniB,MAAM,CAACS,iBAApB,EAAuC,IAAvC,CAAA,CAAA;IACA,IAAK7C,CAAAA,GAAL,CAASukB,GAAT,CAAaniB,MAAM,CAACmB,iBAApB,EAAuC,IAAvC,CAAA,CAAA;IACA,IAAKvD,CAAAA,GAAL,CAASukB,GAAT,CAAaniB,MAAM,CAACK,WAApB,EAAiC,IAAjC,CAAA,CAAA;IACA,IAAKzC,CAAAA,GAAL,CAASukB,GAAT,CAAaniB,MAAM,CAACc,UAApB,EAAgC,IAAhC,CAAA,CAAA;;AAEA,IAAA,eAAA,CAAA,SAAA,CAAMjD,OAAN,CAAA,IAAA,CAAA,IAAA,CAAA,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AACA;AA1CA,GAAA;;AAAA,EAAA,MAAA,CA2CEgd,WA3CF,GA2CE,SAAYjU,WAAAA,CAAAA,CAAZ,EAAe;AACb,IAAA,IAAI,CAAC,IAAA,CAAK+E,IAAL,CAAUkN,IAAf,EAAqB;AACnB,MAAA,OAAA;AACD,KAAA;;IAED,IAAIoK,MAAM,GAAG,KAAb,CAAA;;IACA,QAAQrc,CAAC,CAACkU,IAAV;MACE,KAAK9a,MAAM,CAACS,iBAAZ;AACEwiB,QAAAA,MAAM,GAAG,IAAKtX,CAAAA,IAAL,CAAUkN,IAAV,KAAmBiK,UAA5B,CAAA;AACA,QAAA,MAAA;;MAEF,KAAK9iB,MAAM,CAACmB,iBAAZ;AACE8hB,QAAAA,MAAM,GAAG,IAAKtX,CAAAA,IAAL,CAAUkN,IAAV,KAAmBiK,UAAnB,IAAiClc,CAAC,CAACsJ,IAAF,CAAO,CAAP,CAAclO,KAAAA,GAAG,CAACK,WAA5D,CAAA;AACA,QAAA,MAAA;;MAEF,KAAKrC,MAAM,CAACK,WAAZ;AACE4iB,QAAAA,MAAM,GAAG,IAAKtX,CAAAA,IAAL,CAAUkN,IAAV,KAAmBkK,UAA5B,CAAA;AACA,QAAA,MAAA;;MAEF,KAAK/iB,MAAM,CAACc,UAAZ;AACEmiB,QAAAA,MAAM,GAAG,IAAKtX,CAAAA,IAAL,CAAUkN,IAAV,KAAmBkK,UAAnB,IAAiCnc,CAAC,CAACsJ,IAAF,CAAO,CAAP,CAAclO,KAAAA,GAAG,CAACK,WAA5D,CAAA;AACA,QAAA,MAAA;AAfJ,KAAA;;AAoBA,IAAA,IAAI4gB,MAAJ,EAAY;MACV,IAAK1B,CAAAA,YAAL,CAAkB,KAAlB,CAAA,CAAA;AACA,MAAA,IAAA,CAAK5V,IAAL,CAAUkN,IAAV,GAAiB,IAAjB,CAAA;AACD,KAAA;AACF,GAAA;AAED;AACF;AACA;AA7EA,GAAA;;AAAA,EAAA,MAAA,CA8EEqH,IA9EF,GA8EE,SAAKuB,IAAAA,CAAAA,OAAL,EAAc;IACZ,eAAMvB,CAAAA,SAAAA,CAAAA,IAAN,YAAWuB,OAAX,CAAA,CAAA;;AAEA,IAAA,IAAI,IAAK9V,CAAAA,IAAL,CAAUkN,IAAd,EAAoB;AAClB,MAAA,IAAA,CAAKqK,OAAL,EAAA,CAAA;AACD,KAAA;AACF,GAAA;AAED;AACF;AACA;AACA;AAzFA,GAAA;;AAAA,EAAA,MAAA,CA0FEpD,SA1FF,GA0FE,SAAU2B,SAAAA,CAAAA,OAAV,EAA2B;AAAA,IAAA,IAAjBA,OAAiB,KAAA,KAAA,CAAA,EAAA;AAAjBA,MAAAA,OAAiB,GAAP,KAAO,CAAA;AAAA,KAAA;;AACzB,IAAA,IAAIA,OAAJ,EAAa;AACX,MAAA,IAAM0B,OAAO,GAAG,IAAKvlB,CAAAA,GAAL,CAAS2iB,MAAT,CAAgB6C,SAAhB,CAA0B,SAA1B,EAAqC,KAArC,CAAhB,CAAA;MACA,IAAMC,aAAa,GAAGF,OAAO,IAAI,CAACA,OAAO,CAAClD,SAAR,EAAlC,CAAA;MACA,IAAMqD,cAAc,GAAG,CAAC,CAAC,KAAK1lB,GAAL,CAAS2e,MAAT,CAAgBgH,WAAzC,CAAA;;MAEA,IAAIF,aAAa,IAAIC,cAArB,EAAqC;QACnC,IAAKnD,CAAAA,IAAL,CAAU,KAAV,CAAA,CAAA;AACD,OAFD,MAGK;QACH,IAAKD,CAAAA,IAAL,CAAU,KAAV,CAAA,CAAA;AACD,OAAA;AACF,KAAA;AACF,GAAA;AAED;AACF;AACA;AACA;AA5GA,GAAA;;EAAA,MA6GEiB,CAAAA,OA7GF,GA6GE,SAAU,OAAA,GAAA;AACR,IAAA,IAAI,IAAKxV,CAAAA,IAAL,CAAUkN,IAAd,EAAoB;AAClB,MAAA,IAAA,CAAKqK,OAAL,EAAA,CAAA;AACD,KAFD,MAGK;AACH,MAAA,IAAA,CAAKM,MAAL,EAAA,CAAA;AACD,KAAA;AACF,GAAA;AAED;AACF;AACA;AAxHA,GAAA;;EAAA,MAyHEN,CAAAA,OAzHF,GAyHE,SAAU,OAAA,GAAA;IACR,QAAQ,IAAA,CAAKvX,IAAL,CAAUkN,IAAlB;AACE,MAAA,KAAKiK,UAAL;QACE,IAAKllB,CAAAA,GAAL,CAAS6lB,YAAT,CAAsBvD,IAAtB,CAA2Ble,GAAG,CAACK,WAA/B,CAAA,CAAA;AACA,QAAA,MAAA;;AACF,MAAA,KAAK0gB,UAAL;QACE,IAAKnlB,CAAAA,GAAL,CAAS8lB,KAAT,CAAexD,IAAf,CAAoBle,GAAG,CAACK,WAAxB,CAAA,CAAA;AACA,QAAA,MAAA;AANJ,KAAA;AASD,GAAA;AAED;AACF;AACA;AAvIA,GAAA;;EAAA,MAwIEmhB,CAAAA,MAxIF,GAwIE,SAAS,MAAA,GAAA;IACP,IAAKjC,CAAAA,YAAL,CAAkB,IAAlB,CAAA,CAAA;;AAEA,IAAA,IAAI,KAAK3jB,GAAL,CAAS2e,MAAT,CAAgBgH,WAApB,EAAiC;AAC/B,MAAA,IAAA,CAAK5X,IAAL,CAAUkN,IAAV,GAAiBkK,UAAjB,CAAA;AACA,MAAA,IAAA,CAAKnlB,GAAL,CAAS8lB,KAAT,CAAevD,IAAf,CAAoB;QAClBvhB,EAAE,EAAOoD,GAAG,CAACK,WADK;QAElBwgB,OAAO,EAAA,EAAA,IAAK,KAAKjlB,GAAL,CAAS2e,MAAT,CAAgB4G,OAAhB,WAAgC,IAAKvlB,CAAAA,GAAL,CAAS2e,MAAT,CAAgB4G,OAAhD,GAAgE,MAAA,GAAA,EAArE,IAA0E,IAAKvlB,CAAAA,GAAL,CAAS2e,MAAT,CAAgBgH,WAAAA;OAFnG,CAAA,CAAA;AAID,KAND,MAOK;AACH,MAAA,IAAA,CAAK5X,IAAL,CAAUkN,IAAV,GAAiBiK,UAAjB,CAAA;AACA,MAAA,IAAA,CAAKllB,GAAL,CAAS6lB,YAAT,CAAsBtD,IAAtB,CAA2B;QACzBvhB,EAAE,EAAOoD,GAAG,CAACK,WADY;AAEzBwgB,QAAAA,OAAO,EAAE,IAAA,CAAKjlB,GAAL,CAAS2e,MAAT,CAAgB4G,OAAAA;OAF3B,CAAA,CAAA;AAID,KAAA;GAxJL,CAAA;;AAAA,EAAA,OAAA,iBAAA,CAAA;AAAA,CAAA,CAAuC7C,cAAvC,CAAA,CAAA;AAAa0C,kBAEJpkB,KAAK;AAFDokB,kBAGJlC,OAAO6C;;;;ACZhB;AACA;AACA;AACA;AACA;;AACA,IAAaC,cAAb,gBAAA,UAAA,eAAA,EAAA;AAAA,EAAA,cAAA,CAAA,cAAA,EAAA,eAAA,CAAA,CAAA;;AAKE;AACF;AACA;AACE,EAAA,SAAA,cAAA,CAAYrD,MAAZ,EAAoB;AAAA,IAAA,OAClB,2BAAMA,MAAN,EAAc,6CAAd,EAA6D,IAA7D,CADkB,IAAA,IAAA,CAAA;AAEnB,GAAA;AAED;AACF;AACA;AACA;;;AAfA,EAAA,IAAA,MAAA,GAAA,cAAA,CAAA,SAAA,CAAA;;EAAA,MAgBEY,CAAAA,OAhBF,GAgBE,SAAU,OAAA,GAAA;AAAA,IAAA,IAAA,KAAA,GAAA,IAAA,CAAA;;AACR,IAAA,IAAM0C,IAAI,GAAGvd,QAAQ,CAACC,aAAT,CAAuB,GAAvB,CAAb,CAAA;AACAsd,IAAAA,IAAI,CAACC,IAAL,GAAY,IAAA,CAAKlmB,GAAL,CAAS2e,MAAT,CAAgBwH,WAAhB,IAA+B,IAAKnmB,CAAAA,GAAL,CAAS2e,MAAT,CAAgBxe,QAA3D,CAAA;AACA8lB,IAAAA,IAAI,CAACG,QAAL,GAAgBH,IAAI,CAACC,IAAL,CAAUla,KAAV,CAAgB,GAAhB,CAAqBqa,CAAAA,GAArB,EAAhB,CAAA;AACA,IAAA,IAAA,CAAKrmB,GAAL,CAAS4c,SAAT,CAAmBiF,WAAnB,CAA+BoE,IAA/B,CAAA,CAAA;AACAA,IAAAA,IAAI,CAAC3H,KAAL,EAAA,CAAA;AAEAxU,IAAAA,UAAU,CAAC,YAAM;AACf,MAAA,KAAI,CAAC9J,GAAL,CAAS4c,SAAT,CAAmBkF,WAAnB,CAA+BmE,IAA/B,CAAA,CAAA;KADQ,EAEP,GAFO,CAAV,CAAA;AAGD,GAAA;AAED;AACF;AACA;AA9BA,GAAA;;EAAA,MA+BE/D,CAAAA,SA/BF,GA+BE,SAAY,SAAA,GAAA;AACV,IAAA,IAAMa,SAAS,GAAG,IAAA,CAAK/iB,GAAL,CAASsmB,OAAT,CAAiBxmB,WAAjB,CAA6BmB,gBAA7B,IAAiD,IAAKjB,CAAAA,GAAL,CAAS2e,MAAT,CAAgBwH,WAAnF,CAAA;;AACA,IAAA,IAAIpD,SAAS,IAAI,CAAC,KAAKhV,IAAL,CAAU6T,OAA5B,EAAqC;AACnC,MAAA,IAAA,CAAKW,IAAL,EAAA,CAAA;KADF,MAGK,IAAI,CAACQ,SAAD,IAAc,IAAKhV,CAAAA,IAAL,CAAU6T,OAA5B,EAAqC;AACxC,MAAA,IAAA,CAAKU,IAAL,EAAA,CAAA;AACD,KAAA;GAtCL,CAAA;;AAAA,EAAA,OAAA,cAAA,CAAA;AAAA,CAAA,CAAoCI,cAApC,CAAA,CAAA;AAAasD,eAEJhlB,KAAK;AAFDglB,eAGJ9C,OAAOkD;;;;;;ACNhB;AACA;AACA;AACA;AACA;;AACA,IAAaG,gBAAb,gBAAA,UAAA,eAAA,EAAA;AAAA,EAAA,cAAA,CAAA,gBAAA,EAAA,eAAA,CAAA,CAAA;;AAME;AACF;AACA;AACE,EAAA,SAAA,gBAAA,CAAY5D,MAAZ,EAAoB;AAAA,IAAA,IAAA,KAAA,CAAA;;IAClB,KAAMA,GAAAA,eAAAA,CAAAA,IAAAA,CAAAA,IAAAA,EAAAA,MAAN,EAAc,+CAAd,CAAA,IAAA,IAAA,CAAA;;AAEA,IAAA,KAAA,CAAK3iB,GAAL,CAASskB,EAAT,CAAYliB,MAAM,CAACQ,kBAAnB,EAAA,sBAAA,CAAA,KAAA,CAAA,CAAA,CAAA;;AAHkB,IAAA,OAAA,KAAA,CAAA;AAInB,GAAA;AAED;AACF;AACA;;;AAjBA,EAAA,IAAA,MAAA,GAAA,gBAAA,CAAA,SAAA,CAAA;;EAAA,MAkBE3C,CAAAA,OAlBF,GAkBE,SAAU,OAAA,GAAA;IACR,IAAKD,CAAAA,GAAL,CAASukB,GAAT,CAAaniB,MAAM,CAACQ,kBAApB,EAAwC,IAAxC,CAAA,CAAA;;AAEA,IAAA,eAAA,CAAA,SAAA,CAAM3C,OAAN,CAAA,IAAA,CAAA,IAAA,CAAA,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AACA;AA5BA,GAAA;;AAAA,EAAA,MAAA,CA6BEgd,WA7BF,GA6BE,SAAYjU,WAAAA,CAAAA,CAAZ,EAAe;AACb;IACA,QAAQA,CAAC,CAACkU,IAAV;AACE;MACA,KAAK9a,MAAM,CAACQ,kBAAZ;AAAgC,QAAA,IAAA,CAAK+gB,YAAL,CAAkB3a,CAAC,CAACsJ,IAAF,CAAO,CAAP,CAAlB,CAAA,CAAA;AAA8B,QAAA,MAAA;AAC9D;AAHF,KAAA;AAKA;;AACD,GAAA;AAED;AACF;AACA;AACA;AA1CA,GAAA;;EAAA,MA2CEiR,CAAAA,OA3CF,GA2CE,SAAU,OAAA,GAAA;IACR,IAAKvjB,CAAAA,GAAL,CAASwmB,gBAAT,EAAA,CAAA;GA5CJ,CAAA;;AAAA,EAAA,OAAA,gBAAA,CAAA;AAAA,CAAA,CAAsC9D,cAAtC,CAAA,CAAA;AAAa6D,iBAEJvlB,KAAK;AAFDulB,iBAGJrD,OAAOuD;AAHHF,iBAIJ3C,aAAa8C;;;;ACTtB;AACA;AACA;AACA;AACA;;AACA,IAAaC,UAAb,gBAAA,UAAA,eAAA,EAAA;AAAA,EAAA,cAAA,CAAA,UAAA,EAAA,eAAA,CAAA,CAAA;;AAKE;AACF;AACA;AACA;AACA;;AAGE;AACF;AACA;AACA;AACA;AACA;AACA;;AAeE;AACF;AACA;AACE,EAAA,SAAA,UAAA,CAAYhE,MAAZ,EAAoB;AAAA,IAAA,IAAA,KAAA,CAAA;;IAClB,KAAMA,GAAAA,eAAAA,CAAAA,IAAAA,CAAAA,IAAAA,EAAAA,MAAN,EAAc,yCAAd,CAAA,IAAA,IAAA,CAAA;;AAEA,IAAA,KAAA,CAAK3iB,GAAL,CAASskB,EAAT,CAAYliB,MAAM,CAACc,UAAnB,EAAA,sBAAA,CAAA,KAAA,CAAA,CAAA,CAAA;;AACA,IAAA,KAAA,CAAKlD,GAAL,CAASskB,EAAT,CAAYliB,MAAM,CAACK,WAAnB,EAAA,sBAAA,CAAA,KAAA,CAAA,CAAA,CAAA;;AAEA,IAAA,eAAA,CAAA,SAAA,CAAM6f,IAAN,CAAA,IAAA,CAAA,sBAAA,CAAA,KAAA,CAAA,CAAA,CAAA;;AANkB,IAAA,OAAA,KAAA,CAAA;AAOnB,GAAA;AAED;AACF;AACA;;;AA/CA,EAAA,IAAA,MAAA,GAAA,UAAA,CAAA,SAAA,CAAA;;EAAA,MAgDEriB,CAAAA,OAhDF,GAgDE,SAAU,OAAA,GAAA;IACR,IAAKD,CAAAA,GAAL,CAASukB,GAAT,CAAaniB,MAAM,CAACc,UAApB,EAAgC,IAAhC,CAAA,CAAA;IACA,IAAKlD,CAAAA,GAAL,CAASukB,GAAT,CAAaniB,MAAM,CAACK,WAApB,EAAiC,IAAjC,CAAA,CAAA;;AAEA,IAAA,eAAA,CAAA,SAAA,CAAMxC,OAAN,CAAA,IAAA,CAAA,IAAA,CAAA,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AACA;AA3DA,GAAA;;AAAA,EAAA,MAAA,CA4DEgd,WA5DF,GA4DE,SAAYjU,WAAAA,CAAAA,CAAZ,EAAe;AACb;IACA,QAAQA,CAAC,CAACkU,IAAV;AACE;MACA,KAAK9a,MAAM,CAACc,UAAZ;QAAyB,IAAKygB,CAAAA,YAAL,CAAkB3a,CAAC,CAACsJ,IAAF,CAAO,CAAP,CAAA,KAAclO,GAAG,CAACC,IAApC,CAAA,CAAA;AAA2C,QAAA,MAAA;;MACpE,KAAKjC,MAAM,CAACK,WAAZ;QAAyB,IAAKkhB,CAAAA,YAAL,CAAkB,KAAlB,CAAA,CAAA;AAA0B,QAAA,MAAA;AACnD;AAJF,KAAA;AAMA;;AACD,GAAA;AAED;AACF;AACA;AAzEA,GAAA;;AAAA,EAAA,MAAA,CA0EErB,IA1EF,GA0EE,SAAKuB,IAAAA,CAAAA,OAAL,EAAc;IACZ,eAAMvB,CAAAA,SAAAA,CAAAA,IAAN,YAAWuB,OAAX,CAAA,CAAA;;AACA,IAAA,IAAA,CAAK+C,UAAL,EAAA,CAAA;AACD,GAAA;AAED;AACF;AACA;AAjFA,GAAA;;AAAA,EAAA,MAAA,CAkFErE,IAlFF,GAkFE,SAAKsB,IAAAA,CAAAA,OAAL,EAAc;IACZ,eAAMtB,CAAAA,SAAAA,CAAAA,IAAN,YAAWsB,OAAX,CAAA,CAAA;;AAEA,IAAA,IAAI,IAAK9V,CAAAA,IAAL,CAAUtC,MAAd,EAAsB;AACpB,MAAA,IAAA,CAAKob,UAAL,EAAA,CAAA;AACD,KAAA;AACF,GAAA;AAED;AACF;AACA;AACA;AA7FA,GAAA;;EAAA,MA8FEtD,CAAAA,OA9FF,GA8FE,SAAU,OAAA,GAAA;AACR,IAAA,IAAI,IAAKxV,CAAAA,IAAL,CAAUtC,MAAd,EAAsB;AACpB,MAAA,IAAA,CAAKmb,UAAL,EAAA,CAAA;AACD,KAFD,MAGK;AACH,MAAA,IAAA,CAAKC,UAAL,EAAA,CAAA;AACD,KAAA;GApGL,CAAA;;EAAA,MAuGEA,CAAAA,UAvGF,GAuGE,SAAa,UAAA,GAAA;AAAA,IAAA,IAAA,MAAA,GAAA,IAAA,CAAA;;AACX,IAAA,IAAA,CAAK7mB,GAAL,CAAS8lB,KAAT,CAAevD,IAAf,CAAoB;MAClBvhB,EAAE,EAAYoD,GAAG,CAACC,IADA;AAElB4gB,MAAAA,OAAO,EAAO0B,UAAU,CAACG,aAAX,CAAyB,IAAA,CAAKza,MAAL,CAAY2W,SAArC,EAAgD,IAAKhjB,CAAAA,GAArD,EAA0D4R,SAAS,CAAC+U,UAAU,CAACI,WAAZ,CAAnE,CAFI;AAGlBC,MAAAA,QAAQ,EAAM,IAHI;MAIlBC,YAAY,EAAE,SAACje,YAAAA,CAAAA,CAAD,EAAO;AACnB,QAAA,IAAMke,EAAE,GAAGle,CAAC,CAACqK,MAAF,GAAW7G,UAAU,CAACxD,CAAC,CAACqK,MAAH,EAAW,IAAX,CAArB,GAAwC1I,SAAnD,CAAA;AACA,QAAA,IAAMwc,QAAQ,GAAGD,EAAE,GAAGA,EAAE,CAACE,OAAH,CAAWT,UAAU,CAACI,WAAtB,CAAH,GAAwCpc,SAA3D,CAAA;;AAEA,QAAA,IAAIwc,QAAJ,EAAc;AACZ,UAAA,MAAI,CAAC9a,MAAL,CAAYmZ,SAAZ,CAAsB2B,QAAtB,EAAgC5D,OAAhC,EAAA,CAAA;;AACA,UAAA,MAAI,CAACqD,UAAL,EAAA,CAAA;AACD,SAAA;AACF,OAAA;KAZH,CAAA,CAAA;GAxGJ,CAAA;;EAAA,MAwHEA,CAAAA,UAxHF,GAwHE,SAAa,UAAA,GAAA;IACX,IAAK5mB,CAAAA,GAAL,CAAS8lB,KAAT,CAAexD,IAAf,CAAoBle,GAAG,CAACC,IAAxB,CAAA,CAAA;GAzHJ,CAAA;;AAAA,EAAA,OAAA,UAAA,CAAA;AAAA,CAAA,CAAgCqe,cAAhC,CAAA,CAAA;AAAaiE,WAEJ3lB,KAAK;AAFD2lB,WAGJzD,OAAOmE;AAHHV,WAUJI,cAAc;;AAVVJ,WAmBJG,gBAAgB,UAACQ,OAAD,EAAUtnB,GAAV,EAAeunB,OAAf,EAAA;AAAA,EAAA,OAAA,kGAAA,GAEYF,QAFZ,GAAA,GAAA,GAEwBrnB,GAAG,CAAC2e,MAAJ,CAAWyE,IAAX,CAAgBoE,IAFxC,yDAInBF,OAAO,CAACjR,GAAR,CAAY,UAAAoR,MAAM,EAAA;AAAA,IAAA,OAAA,iBAAA,GACTF,OADS,GACGE,KAAAA,GAAAA,MAAM,CAAC1Z,IAAP,CAAY/M,EADf,GAEuBymB,mGAAAA,GAAAA,MAAM,CAAC7K,SAAP,CAAiBsH,SAFxC,GAAA,2DAAA,GAGwBuD,MAAM,CAAC7K,SAAP,CAAiByG,KAHzC,GAAA,0BAAA,CAAA;AAAA,GAAlB,CAKC5M,CAAAA,IALD,CAKM,EALN,CAJmB,GAAA,qBAAA,CAAA;AAAA;;;;AC7BzB;AACA;AACA;AACA;AACA;AACA,IAAaiR,YAAb,gBAAA,YAAA;AAEE,EAAA,SAAA,YAAA,CAAYtO,KAAZ,EAAyB;AAAA,IAAA,IAAbA,KAAa,KAAA,KAAA,CAAA,EAAA;AAAbA,MAAAA,KAAa,GAAL,GAAK,CAAA;AAAA,KAAA;;IACvB,IAAKA,CAAAA,KAAL,GAAaA,KAAb,CAAA;IACA,IAAKuO,CAAAA,IAAL,GAAY,CAAZ,CAAA;IACA,IAAKpV,CAAAA,OAAL,GAAe,IAAf,CAAA;AACD,GAAA;;AANH,EAAA,IAAA,MAAA,GAAA,YAAA,CAAA,SAAA,CAAA;;EAAA,MAQEqV,CAAAA,IARF,GAQE,SAAO,IAAA,GAAA;IACL,IAAI,IAAA,CAAKrV,OAAT,EAAkB;MAChBvI,YAAY,CAAC,IAAKuI,CAAAA,OAAN,CAAZ,CAAA;MACA,IAAKA,CAAAA,OAAL,GAAe,IAAf,CAAA;AACD,KAAA;;AAED,IAAA,IAAA,CAAKoV,IAAL,GAAY,IAAIjV,IAAJ,EAAA,CAAWmV,OAAX,EAAZ,CAAA;GAdJ,CAAA;;AAAA,EAAA,MAAA,CAiBEC,EAjBF,GAiBE,SAAG3N,EAAAA,CAAAA,EAAH,EAAO;AAAA,IAAA,IAAA,KAAA,GAAA,IAAA,CAAA;;IACL,IAAI,CAAC,IAAKwN,CAAAA,IAAV,EAAgB;AACd,MAAA,OAAA;AACD,KAAA;;IAED,IAAM5L,OAAO,GAAG,IAAIrJ,IAAJ,GAAWmV,OAAX,EAAA,GAAuB,KAAKF,IAA5C,CAAA;;AACA,IAAA,IAAI5L,OAAO,GAAG,IAAK3C,CAAAA,KAAnB,EAA0B;AACxB,MAAA,IAAA,CAAK7G,OAAL,GAAezI,UAAU,CAAC,YAAM;QAC9BqQ,EAAE,EAAA,CAAA;QACF,KAAI,CAAC5H,OAAL,GAAe,IAAf,CAAA;QACA,KAAI,CAACoV,IAAL,GAAY,CAAZ,CAAA;OAHuB,EAItB,IAAKvO,CAAAA,KAJiB,CAAzB,CAAA;AAKD,KAND,MAOK;MACHe,EAAE,EAAA,CAAA;MACF,IAAKwN,CAAAA,IAAL,GAAY,CAAZ,CAAA;AACD,KAAA;GAjCL,CAAA;;AAAA,EAAA,OAAA,YAAA,CAAA;AAAA,CAAA,EAAA;;ACCO,SAASI,gBAAT,CAA0BlL,SAA1B,EAAqC;EAC1C,IAAIlF,KAAK,GAAG,CAAZ,CAAA;;AACA,EAAA,QAAQkF,SAAR;AACE;AACA,IAAA,KAAK,IAAL;AAAWlF,MAAAA,KAAK,GAAG,EAAR,CAAA;AAAY,MAAA,MAAA;;AACvB,IAAA,KAAK,OAAL;AAAcA,MAAAA,KAAK,GAAG,GAAR,CAAA;AAAa,MAAA,MAAA;;AAC3B,IAAA,KAAK,MAAL;MAAaA,KAAK,GAAG,CAAC,EAAT,CAAA;AAAa,MAAA,MAAA;;AAC1B,IAAA;AAASA,MAAAA,KAAK,GAAG,CAAR,CAAA;AAAW,MAAA,MAAA;AACpB;AANF,GAAA;;AASA,EAAA,OAAOqQ,KAAK,CAAClW,OAAN,CAAc,UAAd,EAAA,SAAA,GAAoC6F,KAApC,CAAP,CAAA;AACD,CAAA;AAED;AACA;AACA;AACA;AACA;;AACA,IAAasQ,kBAAb,gBAAA,UAAA,eAAA,EAAA;AAAA,EAAA,cAAA,CAAA,kBAAA,EAAA,eAAA,CAAA,CAAA;;AAIE;AACF;AACA;AACA;EACE,SAAYtF,kBAAAA,CAAAA,MAAZ,EAAoBnT,KAApB,EAA2B;AAAA,IAAA,IAAA,KAAA,CAAA;;IACzB,KAAMmT,GAAAA,eAAAA,CAAAA,IAAAA,CAAAA,IAAAA,EAAAA,MAAN,EAAc,yCAAd,CAAA,IAAA,IAAA,CAAA;IAEA,KAAK/F,CAAAA,SAAL,CAAeyG,KAAf,GAAuB,KAAA,CAAKrjB,GAAL,CAAS2e,MAAT,CAAgByE,IAAhB,CAAqB8E,IAA5C,CAAA;AAEA;AACJ;AACA;AACA;AACA;;IACI,KAAKna,CAAAA,IAAL,GACK,QAAA,CAAA,EAAA,EAAA,KAAA,CAAKA,IADV,EAAA;AAEEyB,MAAAA,KAAK,EAAIA,KAFX;MAGE2Y,OAAO,EAAE,IAAIT,YAAJ,EAAA;AAHX,KAAA,CAAA,CAAA;;AAMA,IAAA,KAAA,CAAK9K,SAAL,CAAehT,gBAAf,CAAgC,WAAhC,EAAA,sBAAA,CAAA,KAAA,CAAA,CAAA,CAAA;;AACA,IAAA,KAAA,CAAKgT,SAAL,CAAehT,gBAAf,CAAgC,SAAhC,EAAA,sBAAA,CAAA,KAAA,CAAA,CAAA,CAAA;;AACA,IAAA,KAAA,CAAKgT,SAAL,CAAehT,gBAAf,CAAgC,OAAhC,EAAA,sBAAA,CAAA,KAAA,CAAA,CAAA,CAAA;;AACA,IAAA,KAAA,CAAK5J,GAAL,CAAS4c,SAAT,CAAmBhT,gBAAnB,CAAoC,SAApC,EAAA,sBAAA,CAAA,KAAA,CAAA,CAAA,CAAA;;AACA,IAAA,KAAA,CAAK5J,GAAL,CAAS4c,SAAT,CAAmBhT,gBAAnB,CAAoC,UAApC,EAAA,sBAAA,CAAA,KAAA,CAAA,CAAA,CAAA;;AApByB,IAAA,OAAA,KAAA,CAAA;AAqB1B,GAAA;AAED;AACF;AACA;;;AAjCA,EAAA,IAAA,MAAA,GAAA,kBAAA,CAAA,SAAA,CAAA;;EAAA,MAkCE3J,CAAAA,OAlCF,GAkCE,SAAU,OAAA,GAAA;AACR,IAAA,IAAA,CAAKyd,WAAL,EAAA,CAAA;;IAEA,IAAK1d,CAAAA,GAAL,CAAS4c,SAAT,CAAmB7S,mBAAnB,CAAuC,SAAvC,EAAkD,IAAlD,CAAA,CAAA;IACA,IAAK/J,CAAAA,GAAL,CAAS4c,SAAT,CAAmB7S,mBAAnB,CAAuC,UAAvC,EAAmD,IAAnD,CAAA,CAAA;;AAEA,IAAA,eAAA,CAAA,SAAA,CAAM9J,OAAN,CAAA,IAAA,CAAA,IAAA,CAAA,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AACA;AA/CA,GAAA;;AAAA,EAAA,MAAA,CAgDEgd,WAhDF,GAgDE,SAAYjU,WAAAA,CAAAA,CAAZ,EAAe;AACb;IACA,QAAQA,CAAC,CAACkU,IAAV;AACE;AACA,MAAA,KAAK,WAAL;AAAkB,QAAA,IAAA,CAAKE,aAAL,EAAA,CAAA;;AAAsB,QAAA,MAAA;;AACxC,MAAA,KAAK,SAAL;AAAkB,QAAA,IAAA,CAAKM,WAAL,EAAA,CAAA;;AAAoB,QAAA,MAAA;;AACtC,MAAA,KAAK,UAAL;AAAkB,QAAA,IAAA,CAAKA,WAAL,EAAA,CAAA;;AAAoB,QAAA,MAAA;;AACtC,MAAA,KAAK,SAAL;QAAkB1U,CAAC,CAAC2K,GAAF,KAAUnN,SAAS,CAACC,KAApB,IAA6B,IAAK2W,CAAAA,aAAL,EAA7B,CAAA;AAAmD,QAAA,MAAA;;AACrE,MAAA,KAAK,OAAL;QAAkBpU,CAAC,CAAC2K,GAAF,KAAUnN,SAAS,CAACC,KAApB,IAA6B,IAAKiX,CAAAA,WAAL,EAA7B,CAAA;AAAiD,QAAA,MAAA;AACnE;AAPF,KAAA;AASA;;AACD,GAAA;AAED;AACF;AACA;AAhEA,GAAA;;EAAA,MAiEEgG,CAAAA,WAjEF,GAiEE,SAAc,WAAA,GAAA;IACZ,OAAO;AACLza,MAAAA,OAAO,EAAE,CAAC1B,MAAM,CAACI,cAAP,CAAsBsB,OAD3B;MAELI,OAAO,EAAE9B,MAAM,CAACI,cAAP,CAAsB0B,OAAtB,CAA8B+Q,IAA9B,CAAmC,UAAA0I,OAAO,EAAA;AAAA,QAAA,OAAI,CAACA,OAAL,CAAA;OAA1C,CAAA;KAFX,CAAA;AAID,GAAA;AAED;AACF;AACA;AA1EA,GAAA;;EAAA,MA2EES,CAAAA,OA3EF,GA2EE,SAAA,OAAA,GAAU;AAET,GAAA;AAED;AACF;AACA;AAjFA,GAAA;;EAAA,MAkFEnG,CAAAA,aAlFF,GAkFE,SAAgB,aAAA,GAAA;AACd,IAAA,IAAI,CAAC,IAAA,CAAKrP,IAAL,CAAU+U,OAAf,EAAwB;AACtB,MAAA,OAAA;AACD,KAAA;;IAED,IAAK9iB,CAAAA,GAAL,CAASooB,SAAT,EAAA,CAAA;;IACA,IAAKpoB,CAAAA,GAAL,CAASoc,QAAT,CAAkBb,QAAlB,CAA2BG,IAA3B,CAAgC,IAAA,CAAK3N,IAAL,CAAUyB,KAA1C,CAAA,CAAA;AACA,IAAA,IAAA,CAAKzB,IAAL,CAAUoa,OAAV,CAAkBP,IAAlB,EAAA,CAAA;AACD,GAAA;AAED;AACF;AACA;AA9FA,GAAA;;EAAA,MA+FElK,CAAAA,WA/FF,GA+FE,SAAc,WAAA,GAAA;AAAA,IAAA,IAAA,MAAA,GAAA,IAAA,CAAA;;AACZ,IAAA,IAAI,CAAC,IAAA,CAAK3P,IAAL,CAAU+U,OAAf,EAAwB;AACtB,MAAA,OAAA;AACD,KAAA;;AAED,IAAA,IAAA,CAAK/U,IAAL,CAAUoa,OAAV,CAAkBL,EAAlB,CAAqB,YAAM;AACzB,MAAA,MAAI,CAAC9nB,GAAL,CAASoc,QAAT,CAAkBb,QAAlB,CAA2BK,IAA3B,EAAA,CAAA;;MACA,MAAI,CAAC5b,GAAL,CAAS0kB,cAAT,EAAA,CAAA;KAFF,CAAA,CAAA;GApGJ,CAAA;;AAAA,EAAA,OAAA,kBAAA,CAAA;AAAA,CAAA,CAAwChC,cAAxC,CAAA,CAAA;AAAauF,mBAEJ7D,UAAU;;ACzBnB;AACA;AACA;AACA;AACA;;AACA,IAAaiE,cAAb,gBAAA,UAAA,mBAAA,EAAA;AAAA,EAAA,cAAA,CAAA,cAAA,EAAA,mBAAA,CAAA,CAAA;;AAKE;AACF;AACA;AACE,EAAA,SAAA,cAAA,CAAY1F,MAAZ,EAAoB;IAAA,OAClB,mBAAA,CAAA,IAAA,CAAA,IAAA,EAAMA,MAAN,EAAc;AAAEtR,MAAAA,QAAQ,EAAE,IAAA;AAAZ,KAAd,CADkB,IAAA,IAAA,CAAA;AAEnB,GAAA;;AAVH,EAAA,OAAA,cAAA,CAAA;AAAA,CAAA,CAAoC4W,kBAApC,CAAA,CAAA;AAAaI,eAEJrnB,KAAK;AAFDqnB,eAGJnF,OAAO6E,gBAAgB,CAAC,MAAD;;ACRhC;AACA;AACA;AACA;AACA;;AACA,IAAaO,cAAb,gBAAA,UAAA,mBAAA,EAAA;AAAA,EAAA,cAAA,CAAA,cAAA,EAAA,mBAAA,CAAA,CAAA;;AAKE;AACF;AACA;AACE,EAAA,SAAA,cAAA,CAAY3F,MAAZ,EAAoB;IAAA,OAClB,mBAAA,CAAA,IAAA,CAAA,IAAA,EAAMA,MAAN,EAAc;AAAErR,MAAAA,SAAS,EAAE,IAAA;AAAb,KAAd,CADkB,IAAA,IAAA,CAAA;AAEnB,GAAA;;AAVH,EAAA,OAAA,cAAA,CAAA;AAAA,CAAA,CAAoC2W,kBAApC,CAAA,CAAA;AAAaK,eAEJtnB,KAAK;AAFDsnB,eAGJpF,OAAO6E,gBAAgB,CAAC,MAAD;;ACRhC;AACA;AACA;AACA;AACA;;AACA,IAAaQ,eAAb,gBAAA,UAAA,mBAAA,EAAA;AAAA,EAAA,cAAA,CAAA,eAAA,EAAA,mBAAA,CAAA,CAAA;;AAKE;AACF;AACA;AACE,EAAA,SAAA,eAAA,CAAY5F,MAAZ,EAAoB;IAAA,OAClB,mBAAA,CAAA,IAAA,CAAA,IAAA,EAAMA,MAAN,EAAc;AAAErR,MAAAA,SAAS,EAAE,KAAA;AAAb,KAAd,CADkB,IAAA,IAAA,CAAA;AAEnB,GAAA;;AAVH,EAAA,OAAA,eAAA,CAAA;AAAA,CAAA,CAAqC2W,kBAArC,CAAA,CAAA;AAAaM,gBAEJvnB,KAAK;AAFDunB,gBAGJrF,OAAO6E,gBAAgB,CAAC,OAAD;;ACRhC;AACA;AACA;AACA;AACA;;AACA,IAAaS,YAAb,gBAAA,UAAA,mBAAA,EAAA;AAAA,EAAA,cAAA,CAAA,YAAA,EAAA,mBAAA,CAAA,CAAA;;AAKE;AACF;AACA;AACE,EAAA,SAAA,YAAA,CAAY7F,MAAZ,EAAoB;IAAA,OAClB,mBAAA,CAAA,IAAA,CAAA,IAAA,EAAMA,MAAN,EAAc;AAAEtR,MAAAA,QAAQ,EAAE,KAAA;AAAZ,KAAd,CADkB,IAAA,IAAA,CAAA;AAEnB,GAAA;;AAVH,EAAA,OAAA,YAAA,CAAA;AAAA,CAAA,CAAkC4W,kBAAlC,CAAA,CAAA;AAAaO,aAEJxnB,KAAK;AAFDwnB,aAGJtF,OAAO6E,gBAAgB,CAAC,IAAD;;ACLhC;AACA;AACA;AACA;AACA;;AACA,IAAaU,kBAAb,gBAAA,UAAA,eAAA,EAAA;AAAA,EAAA,cAAA,CAAA,kBAAA,EAAA,eAAA,CAAA,CAAA;;AAIE;AACF;AACA;AACA;EACE,SAAY9F,kBAAAA,CAAAA,MAAZ,EAAoBnT,KAApB,EAA2B;AAAA,IAAA,IAAA,KAAA,CAAA;;IACzB,KAAMmT,GAAAA,eAAAA,CAAAA,IAAAA,CAAAA,IAAAA,EAAAA,MAAN,EAAc,yCAAd,CAAA,IAAA,IAAA,CAAA;AAEA;AACJ;AACA;AACA;AACA;;IACI,KAAK5U,CAAAA,IAAL,GACK,QAAA,CAAA,EAAA,EAAA,KAAA,CAAKA,IADV,EAAA;AAEEyB,MAAAA,KAAK,EAAIA,KAFX;MAGE2Y,OAAO,EAAE,IAAIT,YAAJ,EAAA;AAHX,KAAA,CAAA,CAAA;;AAMA,IAAA,KAAA,CAAK9K,SAAL,CAAehT,gBAAf,CAAgC,WAAhC,EAAA,sBAAA,CAAA,KAAA,CAAA,CAAA,CAAA;;AACA,IAAA,KAAA,CAAKgT,SAAL,CAAehT,gBAAf,CAAgC,SAAhC,EAAA,sBAAA,CAAA,KAAA,CAAA,CAAA,CAAA;;AACA,IAAA,KAAA,CAAKgT,SAAL,CAAehT,gBAAf,CAAgC,OAAhC,EAAA,sBAAA,CAAA,KAAA,CAAA,CAAA,CAAA;;AACA,IAAA,KAAA,CAAK5J,GAAL,CAAS4c,SAAT,CAAmBhT,gBAAnB,CAAoC,SAApC,EAAA,sBAAA,CAAA,KAAA,CAAA,CAAA,CAAA;;AACA,IAAA,KAAA,CAAK5J,GAAL,CAAS4c,SAAT,CAAmBhT,gBAAnB,CAAoC,UAApC,EAAA,sBAAA,CAAA,KAAA,CAAA,CAAA,CAAA;;AAlByB,IAAA,OAAA,KAAA,CAAA;AAmB1B,GAAA;AAED;AACF;AACA;;;AA/BA,EAAA,IAAA,MAAA,GAAA,kBAAA,CAAA,SAAA,CAAA;;EAAA,MAgCE3J,CAAAA,OAhCF,GAgCE,SAAU,OAAA,GAAA;AACR,IAAA,IAAA,CAAKyd,WAAL,EAAA,CAAA;;IAEA,IAAK1d,CAAAA,GAAL,CAAS4c,SAAT,CAAmB7S,mBAAnB,CAAuC,SAAvC,EAAkD,IAAlD,CAAA,CAAA;IACA,IAAK/J,CAAAA,GAAL,CAAS4c,SAAT,CAAmB7S,mBAAnB,CAAuC,UAAvC,EAAmD,IAAnD,CAAA,CAAA;;AAEA,IAAA,eAAA,CAAA,SAAA,CAAM9J,OAAN,CAAA,IAAA,CAAA,IAAA,CAAA,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AACA;AA7CA,GAAA;;AAAA,EAAA,MAAA,CA8CEgd,WA9CF,GA8CE,SAAYjU,WAAAA,CAAAA,CAAZ,EAAe;AACb;IACA,QAAQA,CAAC,CAACkU,IAAV;AACE;AACA,MAAA,KAAK,WAAL;AAAkB,QAAA,IAAA,CAAKE,aAAL,EAAA,CAAA;;AAAsB,QAAA,MAAA;;AACxC,MAAA,KAAK,SAAL;AAAkB,QAAA,IAAA,CAAKM,WAAL,EAAA,CAAA;;AAAoB,QAAA,MAAA;;AACtC,MAAA,KAAK,UAAL;AAAkB,QAAA,IAAA,CAAKA,WAAL,EAAA,CAAA;;AAAoB,QAAA,MAAA;;AACtC,MAAA,KAAK,SAAL;QAAkB1U,CAAC,CAAC2K,GAAF,KAAUnN,SAAS,CAACC,KAApB,IAA6B,IAAK2W,CAAAA,aAAL,EAA7B,CAAA;AAAmD,QAAA,MAAA;;AACrE,MAAA,KAAK,OAAL;QAAkBpU,CAAC,CAAC2K,GAAF,KAAUnN,SAAS,CAACC,KAApB,IAA6B,IAAKiX,CAAAA,WAAL,EAA7B,CAAA;AAAiD,QAAA,MAAA;AACnE;AAPF,KAAA;AASA;;AACD,GAAA;AAED;AACF;AACA;AA9DA,GAAA;;EAAA,MA+DEgG,CAAAA,WA/DF,GA+DE,SAAc,WAAA,GAAA;IACZ,OAAO;AACLza,MAAAA,OAAO,EAAE,CAAC1B,MAAM,CAACI,cAAP,CAAsBsB,OAD3B;MAELI,OAAO,EAAE9B,MAAM,CAACI,cAAP,CAAsB0B,OAAtB,CAA8B+Q,IAA9B,CAAmC,UAAA0I,OAAO,EAAA;AAAA,QAAA,OAAI,CAACA,OAAL,CAAA;OAA1C,CAAA;KAFX,CAAA;AAID,GAAA;AAED;AACF;AACA;AAxEA,GAAA;;EAAA,MAyEES,CAAAA,OAzEF,GAyEE,SAAA,OAAA,GAAU;AAET,GAAA;AAED;AACF;AACA;AA/EA,GAAA;;EAAA,MAgFEnG,CAAAA,aAhFF,GAgFE,SAAgB,aAAA,GAAA;AACd,IAAA,IAAI,CAAC,IAAA,CAAKrP,IAAL,CAAU+U,OAAf,EAAwB;AACtB,MAAA,OAAA;AACD,KAAA;;IAED,IAAK9iB,CAAAA,GAAL,CAASoc,QAAT,CAAkBsM,IAAlB,CAAuBhN,IAAvB,CAA4B,IAAA,CAAK3N,IAAL,CAAUyB,KAAtC,CAAA,CAAA;AACA,IAAA,IAAA,CAAKzB,IAAL,CAAUoa,OAAV,CAAkBP,IAAlB,EAAA,CAAA;AACD,GAAA;AAED;AACF;AACA;AA3FA,GAAA;;EAAA,MA4FElK,CAAAA,WA5FF,GA4FE,SAAc,WAAA,GAAA;AAAA,IAAA,IAAA,MAAA,GAAA,IAAA,CAAA;;AACZ,IAAA,IAAI,CAAC,IAAA,CAAK3P,IAAL,CAAU+U,OAAf,EAAwB;AACtB,MAAA,OAAA;AACD,KAAA;;AAED,IAAA,IAAA,CAAK/U,IAAL,CAAUoa,OAAV,CAAkBL,EAAlB,CAAqB,YAAA;MAAA,OAAM,MAAI,CAAC9nB,GAAL,CAASoc,QAAT,CAAkBsM,IAAlB,CAAuB9M,IAAvB,EAAN,CAAA;KAArB,CAAA,CAAA;GAjGJ,CAAA;;AAAA,EAAA,OAAA,kBAAA,CAAA;AAAA,CAAA,CAAwC8G,cAAxC,CAAA,CAAA;AAAa+F,mBAEJrE,UAAU;;;;ACTnB;AACA;AACA;AACA;AACA;;AACA,IAAauE,YAAb,gBAAA,UAAA,mBAAA,EAAA;AAAA,EAAA,cAAA,CAAA,YAAA,EAAA,mBAAA,CAAA,CAAA;;AAKE;AACF;AACA;AACE,EAAA,SAAA,YAAA,CAAYhG,MAAZ,EAAoB;AAAA,IAAA,OAClB,mBAAMA,CAAAA,IAAAA,CAAAA,IAAAA,EAAAA,MAAN,EAAc,KAAd,CADkB,IAAA,IAAA,CAAA;AAEnB,GAAA;;AAVH,EAAA,OAAA,YAAA,CAAA;AAAA,CAAA,CAAkC8F,kBAAlC,CAAA,CAAA;AAAaE,aAEJ3nB,KAAK;AAFD2nB,aAGJzF,OAAO0F;;;;ACRhB;AACA;AACA;AACA;AACA;;AACA,IAAaC,aAAb,gBAAA,UAAA,mBAAA,EAAA;AAAA,EAAA,cAAA,CAAA,aAAA,EAAA,mBAAA,CAAA,CAAA;;AAKE;AACF;AACA;AACE,EAAA,SAAA,aAAA,CAAYlG,MAAZ,EAAoB;AAAA,IAAA,OAClB,mBAAMA,CAAAA,IAAAA,CAAAA,IAAAA,EAAAA,MAAN,EAAc,IAAd,CADkB,IAAA,IAAA,CAAA;AAEnB,GAAA;;AAVH,EAAA,OAAA,aAAA,CAAA;AAAA,CAAA,CAAmC8F,kBAAnC,CAAA,CAAA;AAAaI,cAEJ7nB,KAAK;AAFD6nB,cAGJ3F,OAAO4F;;ACNhB;AACA;AACA;AACA;AACA;;AACA,IAAaC,eAAb,gBAAA,UAAA,eAAA,EAAA;AAAA,EAAA,cAAA,CAAA,eAAA,EAAA,eAAA,CAAA,CAAA;;AAKE;AACF;AACA;AACE,EAAA,SAAA,eAAA,CAAYpG,MAAZ,EAAoB;AAAA,IAAA,IAAA,KAAA,CAAA;;AAClB,IAAA,KAAA,GAAA,eAAA,CAAA,IAAA,CAAA,IAAA,EAAMA,MAAN,EAAc,gBAAd,EAAgC,KAAhC,EAAuC,KAAvC,CAAA,IAAA,IAAA,CAAA;AAEA;AACJ;AACA;AACA;;IACI,KAAK5U,CAAAA,IAAL,GACK,QAAA,CAAA,EAAA,EAAA,KAAA,CAAKA,IADV,EAAA;AAEEib,MAAAA,aAAa,EAAE,CAAA;AAFjB,KAAA,CAAA,CAAA;AAKA;AACJ;AACA;AACA;AACA;;AACI,IAAA,KAAA,CAAKC,SAAL,GAAiBvgB,QAAQ,CAACC,aAAT,CAAuB,KAAvB,CAAjB,CAAA;AACA,IAAA,KAAA,CAAKsgB,SAAL,CAAezd,SAAf,GAA2B,qBAA3B,CAAA;;AACA,IAAA,KAAA,CAAKoR,SAAL,CAAeiF,WAAf,CAA2B,MAAKoH,SAAhC,CAAA,CAAA;AAEA;AACJ;AACA;AACA;AACA;;;AACI,IAAA,KAAA,CAAKC,SAAL,GAAiBxgB,QAAQ,CAACC,aAAT,CAAuB,KAAvB,CAAjB,CAAA;AACA,IAAA,KAAA,CAAKugB,SAAL,CAAe1d,SAAf,GAA2B,uBAA3B,CAAA;;AACA,IAAA,KAAA,CAAKyd,SAAL,CAAepH,WAAf,CAA2B,MAAKqH,SAAhC,CAAA,CAAA;AAEA;AACJ;AACA;AACA;AACA;;;AACI,IAAA,KAAA,CAAKC,MAAL,GAAc,IAAIxM,MAAJ,CAAW;MACvBC,SAAS,EAAE,MAAKA,SADO;MAEvBC,SAAS,EAAEF,MAAM,CAAC8B,UAFK;MAGvB3B,QAAQ,EAAG,kBAAA9T,CAAC,EAAA;AAAA,QAAA,OAAI,KAAKogB,CAAAA,gBAAL,CAAsBpgB,CAAtB,CAAJ,CAAA;AAAA,OAAA;AAHW,KAAX,CAAd,CAAA;AAMA,IAAA,KAAA,CAAK+E,IAAL,CAAUib,aAAV,GAA0BtT,QAAQ,CAAC5H,QAAQ,CAAC,KAAA,CAAK8O,SAAN,EAAiB,UAAjB,CAAT,EAAuC,EAAvC,CAAlC,CAAA;;AAEA,IAAA,KAAA,CAAK5c,GAAL,CAASskB,EAAT,CAAYliB,MAAM,CAACwB,YAAnB,EAAA,sBAAA,CAAA,KAAA,CAAA,CAAA,CAAA;;AACA,IAAA,IAAI,MAAK5D,GAAL,CAAS+N,IAAT,CAAcsb,KAAlB,EAAyB;AACvB,MAAA,KAAA,CAAKC,eAAL,CAAqB,KAAA,CAAKtpB,GAAL,CAASupB,YAAT,EAArB,CAAA,CAAA;AACD,KAFD,MAGK;AACH,MAAA,KAAA,CAAKvpB,GAAL,CAASwpB,IAAT,CAAcpnB,MAAM,CAACiB,KAArB,EAAA,sBAAA,CAAA,KAAA,CAAA,CAAA,CAAA;AACD,KAAA;;AAED,IAAA,KAAA,CAAK6e,SAAL,EAAA,CAAA;;AAnDkB,IAAA,OAAA,KAAA,CAAA;AAoDnB,GAAA;AAED;AACF;AACA;;;AAhEA,EAAA,IAAA,MAAA,GAAA,eAAA,CAAA,SAAA,CAAA;;EAAA,MAiEEjiB,CAAAA,OAjEF,GAiEE,SAAU,OAAA,GAAA;IACR,IAAKkpB,CAAAA,MAAL,CAAYlpB,OAAZ,EAAA,CAAA;AAEA,IAAA,OAAO,KAAKgpB,SAAZ,CAAA;AACA,IAAA,OAAO,KAAKC,SAAZ,CAAA;IAEA,IAAKlpB,CAAAA,GAAL,CAASukB,GAAT,CAAaniB,MAAM,CAACwB,YAApB,EAAkC,IAAlC,CAAA,CAAA;IACA,IAAK5D,CAAAA,GAAL,CAASukB,GAAT,CAAaniB,MAAM,CAACiB,KAApB,EAA2B,IAA3B,CAAA,CAAA;;AAEA,IAAA,eAAA,CAAA,SAAA,CAAMpD,OAAN,CAAA,IAAA,CAAA,IAAA,CAAA,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AACA;AAjFA,GAAA;;AAAA,EAAA,MAAA,CAkFEgd,WAlFF,GAkFE,SAAYjU,WAAAA,CAAAA,CAAZ,EAAe;AACb;IACA,QAAQA,CAAC,CAACkU,IAAV;AACE;MACA,KAAK9a,MAAM,CAACwB,YAAZ;AAA0B,QAAA,IAAA,CAAK0lB,eAAL,CAAqBtgB,CAAC,CAACsJ,IAAF,CAAO,CAAP,CAArB,CAAA,CAAA;;AAAiC,QAAA,MAAA;;MAC3D,KAAKlQ,MAAM,CAACiB,KAAZ;AAA0B,QAAA,IAAA,CAAKimB,eAAL,CAAqB,IAAA,CAAKtpB,GAAL,CAASupB,YAAT,EAArB,CAAA,CAAA;;AAA+C,QAAA,MAAA;AACzE;AAJF,KAAA;AAMA;;AACD,GAAA;AAED;AACF;AACA;AA/FA,GAAA;;EAAA,MAgGE7F,CAAAA,WAhGF,GAgGE,SAAc,WAAA,GAAA;IACZ,OAAO;AACLza,MAAAA,OAAO,EAAE,CAAC1B,MAAM,CAACI,cAAP,CAAsBsB,OAD3B;MAELI,OAAO,EAAE9B,MAAM,CAACI,cAAP,CAAsB0B,OAAtB,CAA8B+Q,IAA9B,CAAmC,UAAA0I,OAAO,EAAA;AAAA,QAAA,OAAI,CAACA,OAAL,CAAA;OAA1C,CAAA;KAFX,CAAA;AAID,GAAA;AAED;AACF;AACA;AAzGA,GAAA;;EAAA,MA0GEZ,CAAAA,SA1GF,GA0GE,SAAY,SAAA,GAAA;AACV,IAAA,IAAI,IAAKnU,CAAAA,IAAL,CAAUgV,SAAd,EAAyB;AACvB,MAAA,IAAI,KAAK/iB,GAAL,CAAS+N,IAAT,CAAcsQ,IAAd,CAAmBjU,KAAnB,IAA4B,IAAK2D,CAAAA,IAAL,CAAUib,aAAtC,IAAuD,KAAKjb,IAAL,CAAU6T,OAArE,EAA8E;AAC5E,QAAA,IAAA,CAAKU,IAAL,EAAA,CAAA;OADF,MAGK,IAAI,IAAKtiB,CAAAA,GAAL,CAAS+N,IAAT,CAAcsQ,IAAd,CAAmBjU,KAAnB,GAA2B,IAAK2D,CAAAA,IAAL,CAAUib,aAArC,IAAsD,CAAC,IAAKjb,CAAAA,IAAL,CAAU6T,OAArE,EAA8E;AACjF,QAAA,IAAA,CAAKW,IAAL,EAAA,CAAA;AACD,OAAA;AACF,KAAA;AACF,GAAA;AAED;AACF;AACA;AAvHA,GAAA;;EAAA,MAwHEgB,CAAAA,OAxHF,GAwHE,SAAA,OAAA,GAAU;AAET,GAAA;AAED;AACF;AACA;AACA;AACA;AAhIA,GAAA;;AAAA,EAAA,MAAA,CAiIE+F,eAjIF,GAiIE,SAAgBG,eAAAA,CAAAA,KAAhB,EAAuB;IACrB,IAAKP,CAAAA,SAAL,CAAe1G,KAAf,CAAqB1V,IAArB,GAA6B2c,KAAK,GAAG,GAAR,GAAc,IAAA,CAAKR,SAAL,CAAehG,WAA7B,GAA2C,IAAKiG,CAAAA,SAAL,CAAejG,WAAf,GAA6B,CAAzE,GAA8E,IAA1G,CAAA;AACD,GAAA;AAGD;AACF;AACA;AACA;AAzIA,GAAA;;AAAA,EAAA,MAAA,CA0IEmG,gBA1IF,GA0IE,SAAiBpgB,gBAAAA,CAAAA,CAAjB,EAAoB;IAClB,IAAIA,CAAC,CAAC+T,SAAN,EAAiB;MACf,IAAK/c,CAAAA,GAAL,CAAS0oB,IAAT,CAAc1f,CAAC,CAACwG,KAAF,GAAU,GAAxB,CAAA,CAAA;AACD,KAAA;GA7IL,CAAA;;AAAA,EAAA,OAAA,eAAA,CAAA;AAAA,CAAA,CAAqCkT,cAArC,CAAA,CAAA;AAAaqG,gBAEJ/nB,KAAK;AAFD+nB,gBAGJ3E,UAAU;;ACXnB;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AACA,IAAasF,cAAb,gBAAA,UAAA,aAAA,EAAA;AAAA,EAAA,cAAA,CAAA,cAAA,EAAA,aAAA,CAAA,CAAA;;AAEE;AACF;AACA;AACA;AACA;AACA;;AAGE;AACF;AACA;AACE,EAAA,SAAA,cAAA,CAAY1pB,GAAZ,EAAiB;AAAA,IAAA,IAAA,KAAA,CAAA;;AACf,IAAA,KAAA,GAAA,aAAA,CAAA,IAAA,CAAA,IAAA,CAAA,IAAA,IAAA,CAAA;AAEA;AACJ;AACA;AACA;AACA;;IACI,KAAKA,CAAAA,GAAL,GAAWA,GAAX,CAAA;AARe,IAAA,OAAA,KAAA,CAAA;AAShB,GAAA;AAED;AACF;AACA;AACA;;;AA3BA,EAAA,IAAA,MAAA,GAAA,cAAA,CAAA,SAAA,CAAA;;EAAA,MA4BE2pB,CAAAA,IA5BF,GA4BE,SAAA,IAAA,GAAO,EACN;AAED;AACF;AACA;AACA;AAlCA,GAAA;;EAAA,MAmCE1pB,CAAAA,OAnCF,GAmCE,SAAU,OAAA,GAAA;AACR,IAAA,OAAO,KAAKD,GAAZ,CAAA;GApCJ,CAAA;;AAAA,EAAA,OAAA,cAAA,CAAA;AAAA,CAAA,CAAoCwe,YAApC,EAAA;AAAakL,eAQJ1oB,KAAK;;;ACZd;AACA;AACA;AACA;AACA;AACA;;AACO,IAAM4oB,QAAQ,GAAG;AACtBzpB,EAAAA,QAAQ,EAAa,IADC;AAEtByc,EAAAA,SAAS,EAAY,IAFC;AAGtB0J,EAAAA,OAAO,EAAc,IAHC;AAItBuD,EAAAA,OAAO,EAAc,EAJC;AAKtBtE,EAAAA,OAAO,EAAc,IALC;AAMtBI,EAAAA,WAAW,EAAU,IANC;AAOtBQ,EAAAA,WAAW,EAAU,IAPC;AAQtB2D,EAAAA,UAAU,EAAW,IARC;AAStBC,EAAAA,UAAU,EAAW,YATC;AAUtB1L,EAAAA,IAAI,EAAiB,IAVC;AAWtB2L,EAAAA,OAAO,EAAc,KAXC;AAYtBC,EAAAA,MAAM,EAAe,EAZC;AAatBC,EAAAA,MAAM,EAAe,EAbC;AActBC,EAAAA,cAAc,EAAO,EAdC;AAetBC,EAAAA,WAAW,EAAU,CAfC;AAgBtBC,EAAAA,UAAU,EAAW,CAhBC;AAiBtBC,EAAAA,gBAAgB,EAAK,IAjBC;AAkBtBC,EAAAA,SAAS,EAAY,CAlBC;AAmBtBC,EAAAA,SAAS,EAAY,CAnBC;AAoBtBC,EAAAA,eAAe,EAAM,IApBC;AAqBtBhG,EAAAA,cAAc,EAAO,KArBC;AAsBtBiG,EAAAA,eAAe,EAAM,MAtBC;AAuBtBC,EAAAA,aAAa,EAAQ,IAvBC;AAwBtBC,EAAAA,WAAW,EAAU,IAxBC;AAyBtBC,EAAAA,UAAU,EAAW,IAzBC;AA0BtBC,EAAAA,SAAS,EAAY,IA1BC;AA2BtBC,EAAAA,aAAa,EAAQ,KA3BC;AA4BtBC,EAAAA,iBAAiB,EAAI,KA5BC;AA6BtBC,EAAAA,mBAAmB,EAAE,KA7BC;AA8BtBjM,EAAAA,UAAU,EAAW,IA9BC;AA+BtBO,EAAAA,QAAQ,EAAa,IA/BC;AAgCtB2L,EAAAA,cAAc,EAAO,IAhCC;AAiCtBC,EAAAA,gBAAgB,EAAK,MAjCC;AAkCtBC,EAAAA,eAAe,EAAM,KAlCC;AAmCtBzI,EAAAA,MAAM,EAAe,CACnB,YADmB,EAEnB,MAFmB,EAGnB,MAHmB,EAInB,UAJmB,EAKnB,aALmB,EAMnB,SANmB,EAOnB,YAPmB,CAnCC;AA4CtBS,EAAAA,IAAI,EAAiB;AACnBiI,IAAAA,UAAU,EAAE,oBADO;AAEnB3C,IAAAA,IAAI,EAAQ,MAFO;AAGnBI,IAAAA,OAAO,EAAK,UAHO;AAInBF,IAAAA,MAAM,EAAM,SAJO;AAKnBV,IAAAA,IAAI,EAAQ,MALO;AAMnB9B,IAAAA,QAAQ,EAAI,UANO;AAOnBkF,IAAAA,UAAU,EAAE,YAPO;AAQnB9D,IAAAA,IAAI,EAAQ,MARO;AASnB+D,IAAAA,UAAU,EAAE,6BATO;AAUnBC,IAAAA,QAAQ,EAAI,qCAVO;AAWnBC,IAAAA,SAAS,EAAG,+BAAA;GAvDQ;AAyDtBC,EAAAA,QAAQ,GACLllB,SAAAA,GAAAA,EAAAA,EAAAA,SAAAA,CAAAA,SAAS,CAACQ,OADL,IACkBpF,OAAO,CAACC,aAD1B,EAAA,SAAA,CAEL2E,SAAS,CAACU,SAFL,CAAA,GAEkBtF,OAAO,CAACE,eAF1B,EAGL0E,SAAAA,CAAAA,SAAS,CAACS,UAHL,CAGkBrF,GAAAA,OAAO,CAACG,iBAH1B,EAAA,SAAA,CAILyE,SAAS,CAACO,SAJL,CAIkBnF,GAAAA,OAAO,CAACI,gBAJ1B,YAKLwE,SAAS,CAACK,MALL,CAAA,GAKkBjF,OAAO,CAACK,OAL1B,EAAA,SAAA,CAMLuE,SAAS,CAACM,QANL,CAMkBlF,GAAAA,OAAO,CAACM,QAN1B,EAAA,SAAA,CAOLsE,SAAS,CAACY,IAPL,CAOkBxF,GAAAA,OAAO,CAACK,OAP1B,EAQLuE,SAAAA,CAAAA,SAAS,CAACa,KARL,IAQkBzF,OAAO,CAACM,QAR1B,EAAA,SAAA,CASLsE,SAAS,CAACI,KATL,CASkBhF,GAAAA,OAAO,CAACO,iBAT1B,EAAA,SAAA,CAAA;AAzDc,EAAjB;AAsEP;AACA;AACA;AACA;;AACO,IAAMwpB,gBAAgB,GAAG;AAC9BxrB,EAAAA,QAAQ,EAAG,+CADmB;AAE9Bof,EAAAA,QAAQ,EAAG,+CAFmB;AAG9B3C,EAAAA,SAAS,EAAE,gCAHmB;AAI9B0J,EAAAA,OAAO,EAAI,uBAJmB;AAK9BuD,EAAAA,OAAO,EAAI,uBAAA;AALmB,CAAzB,CAAA;AAQP;AACA;AACA;AACA;;AACO,IAAM+B,kBAAkB,GAAG;AAChCC,EAAAA,mBAAmB,EAAM,kDADO;AAEhCC,EAAAA,eAAe,EAAU,8CAFO;AAGhCC,EAAAA,uBAAuB,EAAE,uCAAA;AAHO,CAA3B,CAAA;AAMP;AACA;AACA;AACA;;AACO,IAAMC,cAAc,GAAG;EAC5BpP,SAAS,EAAQ,SAACA,SAAAA,CAAAA,UAAD,EAAe;IAC9B,IAAI,CAACA,UAAL,EAAgB;AACd,MAAA,MAAM,IAAIvd,QAAJ,CAAa,+BAAb,CAAN,CAAA;AACD,KAAA;;AACD,IAAA,OAAOud,UAAP,CAAA;GAL0B;EAO5B0J,OAAO,EAAU,SAACA,OAAAA,CAAAA,QAAD,EAAa;IAC5B,IAAI,CAACA,QAAL,EAAc;MACZA,QAAO,GAAG,CAAC5H,sBAAD,CAAV,CAAA;KADF,MAGK,IAAIjL,KAAK,CAACC,OAAN,CAAc4S,QAAd,CAAJ,EAA4B;AAC/BA,MAAAA,QAAO,GAAG,CAAC7R,aAAa,CAAC6R,QAAO,CAAC,CAAD,CAAR,EAAavmB,eAAb,CAAd,EAA6CumB,QAAO,CAAC,CAAD,CAApD,CAAV,CAAA;AACD,KAFI,MAGA;MACHA,QAAO,GAAG,CAAC7R,aAAa,CAAC6R,QAAD,EAAUvmB,eAAV,CAAd,CAAV,CAAA;AACD,KAAA;;AACD,IAAA,IAAI,CAACumB,QAAO,CAAC,CAAD,CAAZ,EAAiB;AACf,MAAA,MAAM,IAAIjnB,QAAJ,CAAa,4CAAb,CAAN,CAAA;AACD,KAAA;;AACD,IAAA,OAAOinB,QAAP,CAAA;GApB0B;EAsB5B8D,WAAW,EAAM,SAACA,WAAAA,CAAAA,YAAD,EAAiB;AAChC;IACA,OAAO1S,UAAU,CAAC0S,YAAD,CAAjB,CAAA;GAxB0B;EA0B5BC,UAAU,EAAO,SAACA,UAAAA,CAAAA,WAAD,EAAgB;AAC/B;AACA,IAAA,OAAO3S,UAAU,CAAC2S,WAAD,EAAa,IAAb,CAAjB,CAAA;GA5B0B;AA8B5BJ,EAAAA,MAAM,EAAW,SAAA,MAAA,CAACA,OAAD,EAAStL,MAAT,EAAoB;AACnC;AACA,IAAA,IAAIA,MAAM,CAACuL,MAAP,GAAgBD,OAApB,EAA4B;MAC1BhV,OAAO,CAAC,oCAAD,CAAP,CAAA;MACAgV,OAAM,GAAGtL,MAAM,CAACuL,MAAhB,CAAA;AACD,KALkC;;;AAOnC,IAAA,OAAO/a,KAAK,CAAC8a,OAAD,EAAS,CAAT,EAAY,GAAZ,CAAZ,CAAA;GArC0B;AAuC5BC,EAAAA,MAAM,EAAW,SAAA,MAAA,CAACA,OAAD,EAASvL,MAAT,EAAoB;AACnC;AACA,IAAA,IAAIuL,OAAM,GAAGvL,MAAM,CAACsL,MAApB,EAA4B;MAC1BC,OAAM,GAAGvL,MAAM,CAACsL,MAAhB,CAAA;AACD,KAJkC;;;AAMnC,IAAA,OAAO9a,KAAK,CAAC+a,OAAD,EAAS,CAAT,EAAY,GAAZ,CAAZ,CAAA;GA7C0B;EA+C5B9G,IAAI,EAAa,SAACA,IAAAA,CAAAA,KAAD,EAAU;IACzB,IAAI3P,KAAK,CAACC,OAAN,CAAc0P,KAAI,CAACmI,UAAnB,CAAJ,EAAoC;MAClCtW,OAAO,CAAC,sCAAD,CAAP,CAAA;MACAmO,KAAI,CAACmI,UAAL,GAAkBnI,KAAI,CAACmI,UAAL,CAAgB,CAAhB,CAAlB,CAAA;AACD,KAAA;;AACD,IAAA,OAAA,QAAA,CAAA,EAAA,EACK3B,QAAQ,CAACxG,IADd,EAEKA,KAFL,CAAA,CAAA;GApD0B;EAyD5BsI,QAAQ,EAAS,SAACA,QAAAA,CAAAA,UAAD,EAAc;AAC7B;IACA,IAAIA,UAAQ,KAAK,IAAjB,EAAuB;AACrB,MAAA,OAAO9X,KAAK,CAACgW,QAAQ,CAAC8B,QAAV,CAAZ,CAAA;AACD,KAAA;;AACD,IAAA,OAAOA,UAAP,CAAA;GA9D0B;AAgE5Bf,EAAAA,aAAa,EAAI,SAAA,aAAA,CAACA,cAAD,EAAgBhM,MAAhB,EAA2B;AAC1C;IACA,IAAIgM,cAAa,KAAK,IAAtB,EAA4B;AAC1B,MAAA,OAAOjT,UAAU,CAACiH,MAAM,CAAC0L,UAAR,EAAoB,IAApB,CAAjB,CAAA;AACD,KAFD;SAIK;AACH,MAAA,OAAO3S,UAAU,CAACiT,cAAD,EAAgB,IAAhB,CAAjB,CAAA;AACD,KAAA;GAxEyB;EA0E5BD,eAAe,EAAE,SAACA,eAAAA,CAAAA,gBAAD,EAAqB;IACpC,OAAOzT,UAAU,CAACyT,gBAAD,CAAjB,CAAA;GA3E0B;AA6E5BjG,EAAAA,cAAc,EAAG,SAAA,cAAA,CAACA,eAAD,EAAiB9F,MAAjB,EAA4B;IAC3C,IAAI8F,eAAc,IAAIxQ,KAAK,CAAC0K,MAAM,CAAC8L,eAAR,CAA3B,EAAqD;MACnDxV,OAAO,CAAC,oDAAD,CAAP,CAAA;AACA,MAAA,OAAO,KAAP,CAAA;AACD,KAAA;;AACD,IAAA,OAAOwP,eAAP,CAAA;GAlF0B;EAoF5BuF,OAAO,EAAU,SAACA,OAAAA,CAAAA,QAAD,EAAa;AAC5B;IACA,IAAIA,QAAO,KAAK,IAAhB,EAAsB;AACpB,MAAA,OAAO,CAAP,CAAA;AACD,KAFD,MAGK,IAAIA,QAAO,KAAK,KAAhB,EAAuB;AAC1B,MAAA,OAAO,CAAP,CAAA;AACD,KAAA;;AACD,IAAA,OAAOA,QAAP,CAAA;GA5F0B;EA8F5BH,OAAO,EAAU,SAACA,OAAAA,CAAAA,QAAD,EAAa;AAC5B,IAAA,OAAOA,QAAO,CACXxT,GADI,CACA,UAAC3B,MAAD,EAAY;AACf,MAAA,IAAIjB,KAAK,CAACC,OAAN,CAAcgB,MAAd,CAAJ,EAA2B;AACzBA,QAAAA,MAAM,GAAG,CAACD,aAAa,CAACC,MAAM,CAAC,CAAD,CAAP,EAAYgV,cAAZ,CAAd,EAA2ChV,MAAM,CAAC,CAAD,CAAjD,CAAT,CAAA;AACD,OAFD,MAGK;QACHA,MAAM,GAAG,CAACD,aAAa,CAACC,MAAD,EAASgV,cAAT,CAAd,CAAT,CAAA;AACD,OAAA;;AACD,MAAA,IAAI,CAAChV,MAAM,CAAC,CAAD,CAAX,EAAgB;AACd,QAAA,MAAM,IAAIrV,QAAJ,CAAa,2CAAb,CAAN,CAAA;AACD,OAAA;;AACD,MAAA,OAAOqV,MAAP,CAAA;AACD,KAZI,CAAP,CAAA;AAaD,GAAA;AA5G2B,CAAvB,CAAA;AA+GP;AACA;AACA;AACA;AACA;AACA;AACA;;AACO,SAASuX,SAAT,CAAmBjT,OAAnB,EAA4B;AACjC,EAAA,IAAMkT,UAAU,GAAGtY,KAAK,CAACgW,QAAD,CAAxB,CAAA;AACAxW,EAAAA,SAAS,CAAC8Y,UAAD,EAAalT,OAAb,CAAT,CAAA;EAEA,IAAM2F,MAAM,GAAG,EAAf,CAAA;AAEA7K,EAAAA,IAAI,CAACoY,UAAD,EAAa,UAAC1c,KAAD,EAAQmE,GAAR,EAAgB;AAC/B,IAAA,IAAIiY,kBAAkB,CAACjY,GAAD,CAAtB,EAA6B;AAC3BsB,MAAAA,OAAO,CAAC2W,kBAAkB,CAACjY,GAAD,CAAnB,CAAP,CAAA;AACA,MAAA,OAAA;AACD,KAAA;;AAED,IAAA,IAAI,CAAChU,MAAM,CAACD,SAAP,CAAiBysB,cAAjB,CAAgCte,IAAhC,CAAqC+b,QAArC,EAA+CjW,GAA/C,CAAL,EAA0D;AACxD,MAAA,MAAM,IAAItU,QAAJ,CAA+BsU,iBAAAA,GAAAA,GAA/B,CAAN,CAAA;AACD,KAAA;;AAED,IAAA,IAAIqY,cAAc,CAACrY,GAAD,CAAlB,EAAyB;AACvBgL,MAAAA,MAAM,CAAChL,GAAD,CAAN,GAAcqY,cAAc,CAACrY,GAAD,CAAd,CAAoBnE,KAApB,EAA2B0c,UAA3B,CAAd,CAAA;AACD,KAFD,MAGK;AACHvN,MAAAA,MAAM,CAAChL,GAAD,CAAN,GAAcnE,KAAd,CAAA;AACD,KAAA;AACF,GAhBG,CAAJ,CAAA;AAkBA,EAAA,OAAOmP,MAAP,CAAA;AACD;;ACzPD;AACA;AACA;AACA;AACA;;AACA,IAAayN,aAAb,gBAAA,UAAA,kBAAA,EAAA;AAAA,EAAA,cAAA,CAAA,aAAA,EAAA,kBAAA,CAAA,CAAA;;AAIE;AACF;AACA;AACA;EACE,SAAYzJ,aAAAA,CAAAA,MAAZ,EAAoB4C,OAApB,EAA6B;AAAA,IAAA,IAAA,KAAA,CAAA;;IAC3B,KAAM5C,GAAAA,kBAAAA,CAAAA,IAAAA,CAAAA,IAAAA,EAAAA,MAAN,EAAc,aAAd,CAAA,IAAA,IAAA,CAAA;AAEA;AACJ;AACA;AACA;AACA;AACA;AACA;;IACI,KAAK5U,CAAAA,IAAL,GACK,QAAA,CAAA,EAAA,EAAA,KAAA,CAAKA,IADV,EAAA;AAEE/M,MAAAA,EAAE,EAAY,KAAA,CAAKlB,WAAL,CAAiBkB,EAFjC;AAGE4hB,MAAAA,WAAW,EAAG,KAHhB;AAIExY,MAAAA,KAAK,EAAS,CAJhB;AAKEiiB,MAAAA,YAAY,EAAE,CAAA;AALhB,KAAA,CAAA,CAAA;AAQA;AACJ;AACA;AACA;AACA;;AACI,IAAA,KAAA,CAAKpH,OAAL,GAAevc,QAAQ,CAACC,aAAT,CAAuB,KAAvB,CAAf,CAAA;AACA,IAAA,KAAA,CAAKsc,OAAL,CAAazZ,SAAb,GAAyB,qBAAzB,CAAA;;AACA,IAAA,KAAA,CAAKoR,SAAL,CAAeiF,WAAf,CAA2B,MAAKoD,OAAhC,CAAA,CAAA;;IAEA,KAAKqH,CAAAA,UAAL,CAAgB/G,OAAhB,CAAA,CAAA;;AA3B2B,IAAA,OAAA,KAAA,CAAA;AA4B5B,GAAA;AAED;AACF;AACA;;;AAxCA,EAAA,IAAA,MAAA,GAAA,aAAA,CAAA,SAAA,CAAA;;EAAA,MAyCEtlB,CAAAA,OAzCF,GAyCE,SAAU,OAAA,GAAA;AACR,IAAA,OAAO,KAAKglB,OAAZ,CAAA;;AAEA,IAAA,kBAAA,CAAA,SAAA,CAAMhlB,OAAN,CAAA,IAAA,CAAA,IAAA,CAAA,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AAlDA,GAAA;;AAAA,EAAA,MAAA,CAmDEqsB,UAnDF,GAmDE,SAAWC,UAAAA,CAAAA,IAAX,EAAiB;AACf,IAAA,IAAA,CAAKhK,IAAL,EAAA,CAAA;AACA,IAAA,IAAA,CAAK0C,OAAL,CAAaf,SAAb,GAAyBqI,IAAzB,CAAA;IACA,IAAKxe,CAAAA,IAAL,CAAUse,YAAV,GAAyBE,IAAI,GAAG,IAAA,CAAKtH,OAAL,CAAahC,WAAhB,GAA8B,CAA3D,CAAA;AACA,IAAA,IAAA,CAAKf,SAAL,EAAA,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AA7DA,GAAA;;EAAA,MA8DEA,CAAAA,SA9DF,GA8DE,SAAY,SAAA,GAAA;AACV,IAAA,IAAMsK,cAAc,GAAG,IAAK5P,CAAAA,SAAL,CAAeqG,WAAtC,CAAA;;AACA,IAAA,IAAIuJ,cAAc,IAAI,IAAA,CAAKze,IAAL,CAAUse,YAAhC,EAA8C;AAC5C,MAAA,IAAA,CAAK9J,IAAL,EAAA,CAAA;KADF,MAGK,IAAIiK,cAAc,GAAG,KAAKze,IAAL,CAAUse,YAA/B,EAA6C;AAChD,MAAA,IAAA,CAAK/J,IAAL,EAAA,CAAA;AACD,KAAA;;AACD,IAAA,IAAA,CAAKmK,eAAL,EAAA,CAAA;AACD,GAAA;AAED;AACF;AACA;AA3EA,GAAA;;EAAA,MA4EEnK,CAAAA,IA5EF,GA4EE,SAAO,IAAA,GAAA;AACL,IAAA,IAAA,CAAK2C,OAAL,CAAazC,KAAb,CAAmBC,OAAnB,GAA6B,MAA7B,CAAA;AACA,IAAA,IAAA,CAAK1U,IAAL,CAAU6T,OAAV,GAAoB,KAApB,CAAA;AACD,GAAA;AAED;AACF;AACA;AAnFA,GAAA;;EAAA,MAoFEW,CAAAA,IApFF,GAoFE,SAAO,IAAA,GAAA;AACL,IAAA,IAAA,CAAK0C,OAAL,CAAazC,KAAb,CAAmBC,OAAnB,GAA6B,EAA7B,CAAA;AACA,IAAA,IAAA,CAAK1U,IAAL,CAAU6T,OAAV,GAAoB,IAApB,CAAA;AACD,GAAA;AAED;AACF;AACA;AA3FA,GAAA;;EAAA,MA4FE6K,CAAAA,eA5FF,GA4FE,SAAkB,eAAA,GAAA;AAAA,IAAA,IAAA,qBAAA,CAAA;;AAChB,IAAA,CAAA,qBAAA,GAAA,IAAA,CAAKzsB,GAAL,CAAS2iB,MAAT,CAAgB6C,SAAhB,CAA0BJ,iBAAiB,CAACpkB,EAA5C,EAAgD,KAAhD,CAAwDkhB,KAAAA,IAAAA,GAAAA,KAAAA,CAAAA,GAAAA,qBAAAA,CAAAA,SAAxD,CAAkE,IAAlE,CAAA,CAAA;GA7FJ,CAAA;;AAAA,EAAA,OAAA,aAAA,CAAA;AAAA,CAAA,CAAmCR,iBAAnC,CAAA,CAAA;AAAa0K,cAEJprB,KAAK;;ACSd;AACA;AACA;AACA;AACA;;AACA,IAAM0rB,iBAAiB,GAAG,EAA1B,CAAA;AAEA;AACA;AACA;AACA;AACA;;AACA,IAAMC,gBAAgB,GAAG,EAAzB,CAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AACO,SAASC,cAAT,CAAwBnF,MAAxB,EAAgCoF,eAAhC,EAAiD;AACtD,EAAA,IAAI,CAACpF,MAAM,CAACzmB,EAAZ,EAAgB;AACd,IAAA,MAAM,IAAI3B,QAAJ,CAAa,uBAAb,CAAN,CAAA;AACD,GAAA;;AAEDqtB,EAAAA,iBAAiB,CAACjF,MAAM,CAACzmB,EAAR,CAAjB,GAA+BymB,MAA/B,CAAA;;EAEA,IAAIA,MAAM,CAACrD,OAAX,EAAoB;AAClBuI,IAAAA,gBAAgB,CAAClF,MAAM,CAACrD,OAAR,CAAhB,GAAmCuI,gBAAgB,CAAClF,MAAM,CAACrD,OAAR,CAAhB,IAAoC,EAAvE,CAAA;IACAuI,gBAAgB,CAAClF,MAAM,CAACrD,OAAR,CAAhB,CAAiC5J,IAAjC,CAAsCiN,MAAtC,CAAA,CAAA;AACD,GAAA;;AAED,EAAA,IAAI,OAAOoF,eAAP,KAA2B,QAA/B,EAAyC;AACvC,IAAA,QAAQA,eAAR;AACE,MAAA,KAAK,OAAL;AACEjD,QAAAA,QAAQ,CAACjH,MAAT,CAAgBmK,OAAhB,CAAwBrF,MAAM,CAACzmB,EAA/B,CAAA,CAAA;AACA,QAAA,MAAA;;AACF,MAAA,KAAK,KAAL;AACE4oB,QAAAA,QAAQ,CAACjH,MAAT,CAAgBnI,IAAhB,CAAqBiN,MAAM,CAACzmB,EAA5B,CAAA,CAAA;AACA,QAAA,MAAA;;AACF,MAAA;AACE,QAAA,IAAA,qBAAA,GAAkB6rB,eAAe,CAAC7gB,KAAhB,CAAsB,GAAtB,CAAlB;AAAA,YAAOhL,EAAP,GAAA,qBAAA,CAAA,CAAA,CAAA;AAAA,YAAWod,GAAX,GAAA,qBAAA,CAAA,CAAA,CAAA,CAAA;;QACAwL,QAAQ,CAACjH,MAAT,CAAgBX,MAAhB,CAAuB4H,QAAQ,CAACjH,MAAT,CAAgBpC,OAAhB,CAAwBvf,EAAxB,CAAA,IAA+Bod,GAAG,KAAK,OAAR,GAAkB,CAAlB,GAAsB,CAArD,CAAvB,EAAgF,CAAhF,EAAmFqJ,MAAM,CAACzmB,EAA1F,CAAA,CAAA;AATJ,KAAA;AAWD,GAAA;AACF,CAAA;AAED,CACEqjB,gBADF,EAEEwE,aAFF,EAGEE,eAHF,EAIEJ,YAJF,EAKEvD,iBALF,EAMEY,cANF,EAOEO,gBAPF,EAQE+B,cARF,EASEC,eATF,EAUEC,YAVF,EAWEH,cAXF,CAAA,CAYEpc,OAZF,CAYU2gB,cAZV,CAAA,CAAA;AAcA;AACA;AACA;AACA;AACA;;AACA,IAAaG,MAAb,gBAAA,UAAA,kBAAA,EAAA;AAAA,EAAA,cAAA,CAAA,MAAA,EAAA,kBAAA,CAAA,CAAA;;AAEE;AACF;AACA;AACE,EAAA,SAAA,MAAA,CAAY/sB,GAAZ,EAAiB;AAAA,IAAA,IAAA,KAAA,CAAA;;IACf,KAAMA,GAAAA,kBAAAA,CAAAA,IAAAA,CAAAA,IAAAA,EAAAA,GAAN,EAAW,+BAAX,CAAA,IAAA,IAAA,CAAA;AAEA;AACJ;AACA;AACA;AACA;;IACI,KAAK2hB,CAAAA,QAAL,GAAgB,EAAhB,CAAA;AAEA;AACJ;AACA;AACA;AACA;;IACI,KAAKqB,CAAAA,SAAL,GAAiB,EAAjB,CAAA;AAfe,IAAA,OAAA,KAAA,CAAA;AAgBhB,GAAA;AAED;AACF;AACA;AACA;AACA;;;AA3BA,EAAA,IAAA,MAAA,GAAA,MAAA,CAAA,SAAA,CAAA;;AAAA,EAAA,MAAA,CA4BEgK,UA5BF,GA4BE,SAAW1F,UAAAA,CAAAA,OAAX,EAAoB;AAAA,IAAA,IAAA,MAAA,GAAA,IAAA,CAAA;;AAClB,IAAA,IAAA,CAAK3F,QAAL,CAAcxL,KAAd,GAAsBlK,OAAtB,CAA8B,UAAAghB,IAAI,EAAA;MAAA,OAAIA,IAAI,CAAChtB,OAAL,EAAJ,CAAA;KAAlC,CAAA,CAAA;AACA,IAAA,IAAA,CAAK0hB,QAAL,CAActW,MAAd,GAAuB,CAAvB,CAAA;;IAEA,IAAM6hB,cAAc,GAAG,IAAKC,CAAAA,cAAL,CAAoB7F,OAApB,CAAvB,CAJkB;;;IAOlB,IAAI4F,cAAc,CAAC3M,OAAf,CAAuB6L,aAAa,CAACprB,EAArC,MAA6C,CAAC,CAA9C,IAAmDksB,cAAc,CAAC3M,OAAf,CAAuB6E,iBAAiB,CAACpkB,EAAzC,CAAA,KAAiD,CAAC,CAAzG,EAA4G;AAC1GksB,MAAAA,cAAc,CAAClL,MAAf,CAAsBkL,cAAc,CAAC3M,OAAf,CAAuB6L,aAAa,CAACprB,EAArC,CAAtB,EAAgE,CAAhE,EAAmEokB,iBAAiB,CAACpkB,EAArF,CAAA,CAAA;AACD,KAAA;AAED;;;AACAksB,IAAAA,cAAc,CAACjhB,OAAf,CAAuB,UAACwb,MAAD,EAAY;AACjC,MAAA,IAAI,OAAOA,MAAP,KAAkB,QAAtB,EAAgC;AAC9B,QAAA,IAAI3C,YAAJ,CAAiB,MAAjB,EAAuB2C,MAAvB,CAAA,CAAA;AACD,OAFD,MAGK,IAAIiF,iBAAiB,CAACjF,MAAD,CAArB,EAA+B;AAClC,QAAA,IAAIiF,iBAAiB,CAACjF,MAAD,CAArB,CAA8B,MAA9B,CAAA,CAAA;AACD,OAFI,MAGA,IAAIkF,gBAAgB,CAAClF,MAAD,CAApB,EAA8B;AACjCkF,QAAAA,gBAAgB,CAAClF,MAAD,CAAhB,CAAyBxb,OAAzB,CAAiC,UAAAmhB,UAAU,EAAA;AAAA,UAAA,OAAI,IAAIA,UAAJ,CAAe,MAAf,CAAJ,CAAA;AAAA,SAA3C,EADiC;AAElC,OAFI,MAGA,IAAI3F,MAAM,KAAK2E,aAAa,CAACprB,EAA7B,EAAiC;QACpC,IAAIorB,aAAJ,CAAkB,MAAlB,EAAwB,MAAI,CAACpsB,GAAL,CAAS2e,MAAT,CAAgB4G,OAAxC,CAAA,CAAA;AACD,OAFI,MAGA;AACH,QAAA,MAAM,IAAIlmB,QAAJ,CAAa,iBAAA,GAAoBooB,MAAjC,CAAN,CAAA;AACD,OAAA;KAfH,CAAA,CAAA;IAkBA,IAAId,UAAJ,CAAe,IAAf,CAAA,CAAA;AACA;;AAEA,IAAA,IAAA,CAAKhF,QAAL,CAAc1V,OAAd,CAAsB,UAACghB,IAAD,EAAU;AAC9B,MAAA,IAAI,OAAOA,IAAI,CAACzJ,cAAZ,KAA+B,UAAnC,EAA+C;AAC7CyJ,QAAAA,IAAI,CAACzJ,cAAL,EAAA,CAAA;AACD,OAAA;KAHH,CAAA,CAAA;AAKD,GAAA;AAED;AACF;AACA;AACA;AAvEA,GAAA;;AAAA,EAAA,MAAA,CAwEE8I,UAxEF,GAwEE,SAAWC,UAAAA,CAAAA,IAAX,EAAiB;IACf,IAAMhH,OAAO,GAAG,IAAA,CAAKC,SAAL,CAAe4G,aAAa,CAACprB,EAA7B,EAAiC,KAAjC,CAAhB,CAAA;AACAukB,IAAAA,OAAO,QAAP,GAAAA,KAAAA,CAAAA,GAAAA,OAAO,CAAE+G,UAAT,CAAoBC,IAApB,CAAA,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AACA;AACA;AAlFA,GAAA;;AAAA,EAAA,MAAA,CAmFE/G,SAnFF,GAmFE,SAAA,SAAA,CAAUxkB,EAAV,EAAcqsB,YAAd,EAAmC;AAAA,IAAA,IAArBA,YAAqB,KAAA,KAAA,CAAA,EAAA;AAArBA,MAAAA,YAAqB,GAAN,IAAM,CAAA;AAAA,KAAA;;IACjC,IAAI5F,MAAM,GAAG,IAAb,CAAA;AAEA,IAAA,IAAA,CAAK9F,QAAL,CAAc5Y,IAAd,CAAmB,UAACkkB,IAAD,EAAU;AAC3B,MAAA,IAAIA,IAAI,CAAClf,IAAL,CAAU/M,EAAV,KAAiBA,EAArB,EAAyB;AACvBymB,QAAAA,MAAM,GAAGwF,IAAT,CAAA;AACA,QAAA,OAAO,IAAP,CAAA;AACD,OAHD,MAIK;AACH,QAAA,OAAO,KAAP,CAAA;AACD,OAAA;KAPH,CAAA,CAAA;;AAUA,IAAA,IAAI,CAACxF,MAAD,IAAW4F,YAAf,EAA6B;MAC3BpY,OAAO,CAAA,WAAA,GAAYjU,EAAZ,GAAP,4BAAA,CAAA,CAAA;AACD,KAAA;;AAED,IAAA,OAAOymB,MAAP,CAAA;AACD,GAAA;AAED;AACF;AACA;AAzGA,GAAA;;EAAA,MA0GElF,CAAAA,IA1GF,GA0GE,SAAO,IAAA,GAAA;AACL,IAAA,IAAA,CAAK3F,SAAL,CAAelR,SAAf,CAAyBG,GAAzB,CAA6B,kBAA7B,CAAA,CAAA;AACA,IAAA,IAAA,CAAKkC,IAAL,CAAU6T,OAAV,GAAoB,IAApB,CAAA;AACD,GAAA;AAED;AACF;AACA;AAjHA,GAAA;;EAAA,MAkHEU,CAAAA,IAlHF,GAkHE,SAAO,IAAA,GAAA;AACL,IAAA,IAAA,CAAK1F,SAAL,CAAelR,SAAf,CAAyBI,MAAzB,CAAgC,kBAAhC,CAAA,CAAA;AACA,IAAA,IAAA,CAAKiC,IAAL,CAAU6T,OAAV,GAAoB,KAApB,CAAA;AACD,GAAA;AAED;AACF;AACA;AAzHA,GAAA;;EAAA,MA0HEM,CAAAA,SA1HF,GA0HE,SAAY,SAAA,GAAA;AACV,IAAA,kBAAA,CAAA,SAAA,CAAMA,SAAN,CAAA,IAAA,CAAA,IAAA,CAAA,CAAA;;IAEA,IAAI,IAAA,CAAKliB,GAAL,CAAS+N,IAAT,CAAcqU,SAAd,KAA4B,IAAhC,EAAsC;AACpC,MAAA,IAAMoK,cAAc,GAAG,IAAK5P,CAAAA,SAAL,CAAeqG,WAAtC,CAAA;MAEA,IAAIqK,UAAU,GAAG,CAAjB,CAAA;MACA,IAAMC,cAAc,GAAG,EAAvB,CAAA;MACA,IAAMC,kBAAkB,GAAG,EAA3B,CAAA;AAEA,MAAA,IAAA,CAAK7L,QAAL,CAAc1V,OAAd,CAAsB,UAACghB,IAAD,EAAU;AAC9B,QAAA,IAAIA,IAAI,CAAClf,IAAL,CAAU6T,OAAd,EAAuB;AACrB0L,UAAAA,UAAU,IAAIL,IAAI,CAAClf,IAAL,CAAU3D,KAAxB,CAAA;UACAmjB,cAAc,CAAC/S,IAAf,CAAoByS,IAApB,CAAA,CAAA;;AACA,UAAA,IAAIA,IAAI,CAAClf,IAAL,CAAU6U,WAAd,EAA2B;YACzB4K,kBAAkB,CAAChT,IAAnB,CAAwByS,IAAxB,CAAA,CAAA;AACD,WAAA;AACF,SAAA;OAPH,CAAA,CAAA;;AAUA,MAAA,IAAI,CAACM,cAAc,CAACliB,MAApB,EAA4B;AAC1B,QAAA,OAAA;AACD,OAAA;;MAED,IAAImhB,cAAc,GAAGc,UAAjB,IAA+BE,kBAAkB,CAACniB,MAAnB,GAA4B,CAA/D,EAAkE;AAChEmiB,QAAAA,kBAAkB,CAACvhB,OAAnB,CAA2B,UAAAghB,IAAI,EAAA;UAAA,OAAIA,IAAI,CAACjJ,QAAL,EAAJ,CAAA;SAA/B,CAAA,CAAA;QACA,IAAKhB,CAAAA,SAAL,GAAiBwK,kBAAjB,CAAA;QAEA,IAAKhI,CAAAA,SAAL,CAAemB,UAAU,CAAC3lB,EAA1B,CAA8BuhB,CAAAA,IAA9B,CAAmC,KAAnC,CAAA,CAAA;AACD,OALD,MAMK,IAAIiK,cAAc,IAAIc,UAAlB,IAAgC,IAAKtK,CAAAA,SAAL,CAAe3X,MAAf,GAAwB,CAA5D,EAA+D;AAClE,QAAA,IAAA,CAAK2X,SAAL,CAAe/W,OAAf,CAAuB,UAAAghB,IAAI,EAAA;UAAA,OAAIA,IAAI,CAAChJ,UAAL,EAAJ,CAAA;SAA3B,CAAA,CAAA;QACA,IAAKjB,CAAAA,SAAL,GAAiB,EAAjB,CAAA;QAEA,IAAKwC,CAAAA,SAAL,CAAemB,UAAU,CAAC3lB,EAA1B,CAA8BshB,CAAAA,IAA9B,CAAmC,KAAnC,CAAA,CAAA;AACD,OAAA;;MAED,IAAMiD,OAAO,GAAG,IAAA,CAAKC,SAAL,CAAe4G,aAAa,CAACprB,EAA7B,EAAiC,KAAjC,CAAhB,CAAA;;AACA,MAAA,IAAIukB,OAAJ,EAAa;AACXA,QAAAA,OAAO,CAACrD,SAAR,EAAA,CAAA;AACD,OAAA;AACF,KAAA;AACF,GAAA;AAED;AACF;AACA;AACA;AAzKA,GAAA;;AAAA,EAAA,MAAA,CA0KEiL,cA1KF,GA0KE,SAAe7F,cAAAA,CAAAA,OAAf,EAAwB;AACtB;IACA,IAAIA,OAAO,KAAK,IAAhB,EAAsB;AACpB,MAAA,OAAO1T,KAAK,CAACgW,QAAQ,CAACjH,MAAV,CAAZ,CAAA;AACD,KAFD;AAAA,SAIK,IAAI,OAAO2E,OAAP,KAAmB,QAAvB,EAAiC;AACpC,MAAA,OAAOA,OAAO,CAACtb,KAAR,CAAc,MAAd,CAAP,CAAA;AACD,KAFI,MAGA;MACH,OAAOsb,OAAO,IAAI,EAAlB,CAAA;AACD,KAAA;GArLL,CAAA;;AAAA,EAAA,OAAA,MAAA,CAAA;AAAA,CAAA,CAA4B5F,iBAA5B,CAAA;;ACjFA;AACA;AACA;AACA;AACA;;AACA,IAAa+L,MAAb,gBAAA,UAAA,kBAAA,EAAA;AAAA,EAAA,cAAA,CAAA,MAAA,EAAA,kBAAA,CAAA,CAAA;;AAEE;AACF;AACA;AACE,EAAA,SAAA,MAAA,CAAYztB,GAAZ,EAAiB;AAAA,IAAA,IAAA,KAAA,CAAA;;IACf,KAAMA,GAAAA,kBAAAA,CAAAA,IAAAA,CAAAA,IAAAA,EAAAA,GAAN,EAAW,sBAAX,CAAA,IAAA,IAAA,CAAA;AAEA;AACJ;AACA;AACA;AACA;AACA;;AACI,IAAA,KAAA,CAAKmf,MAAL,GAAczW,QAAQ,CAACC,aAAT,CAAuB,KAAvB,CAAd,CAAA;AACA,IAAA,KAAA,CAAKwW,MAAL,CAAY3T,SAAZ,GAAwB,YAAxB,CAAA;;AACA,IAAA,KAAA,CAAKoR,SAAL,CAAeiF,WAAf,CAA2B,MAAK1C,MAAhC,CAAA,CAAA;AAEA;AACJ;AACA;AACA;AACA;AACA;;;AACI,IAAA,KAAA,CAAK1W,MAAL,GAAcC,QAAQ,CAACC,aAAT,CAAuB,QAAvB,CAAd,CAAA;AACA,IAAA,KAAA,CAAKF,MAAL,CAAY+C,SAAZ,GAAwB,mBAAxB,CAAA;IAEA,KAAK/C,CAAAA,MAAL,CAAY2B,KAAZ,GAAoB,KAAA,CAAK+U,MAAL,CAAYuO,WAAZ,GAA0BnmB,MAAM,CAACE,UAArD,CAAA;IACA,KAAKgB,CAAAA,MAAL,CAAY4B,MAAZ,GAAqB,KAAA,CAAK8U,MAAL,CAAYuO,WAAZ,GAA0BnmB,MAAM,CAACE,UAAtD,CAAA;;AACA,IAAA,KAAA,CAAK0X,MAAL,CAAY0C,WAAZ,CAAwB,MAAKpZ,MAA7B,CAAA,CAAA;AAEA;AACJ;AACA;AACA;AACA;;;IACI,KAAKsF,CAAAA,IAAL,GACK,QAAA,CAAA,EAAA,EAAA,KAAA,CAAKA,IADV,EAAA;AAEE4f,MAAAA,QAAQ,EAAE,CAAC,KAAA,CAAKxO,MAAL,CAAY8D,WAAZ,GAA0B,KAAA,CAAK9D,MAAL,CAAYuO,WAAvC,IAAsD,CAAtD,GAA0DnmB,MAAM,CAACE,UAF7E;AAGEoS,MAAAA,OAAO,EAAG,IAAA;AAHZ,KAAA,CAAA,CAAA;;AAMA,IAAA,KAAA,CAAKqI,SAAL,EAAA,CAAA;;AACA,IAAA,KAAA,CAAKI,IAAL,EAAA,CAAA;;AAtCe,IAAA,OAAA,KAAA,CAAA;AAuChB,GAAA;AAED;AACF;AACA;;;AAhDA,EAAA,IAAA,MAAA,GAAA,MAAA,CAAA,SAAA,CAAA;;EAAA,MAiDEriB,CAAAA,OAjDF,GAiDE,SAAU,OAAA,GAAA;AACR,IAAA,OAAO,KAAKkf,MAAZ,CAAA;AACA,IAAA,OAAO,KAAK1W,MAAZ,CAAA;;AAEA,IAAA,kBAAA,CAAA,SAAA,CAAMxI,OAAN,CAAA,IAAA,CAAA,IAAA,CAAA,CAAA;AACD,GAAA;AAED;AACF;AACA;AA1DA,GAAA;;EAAA,MA2DEiiB,CAAAA,SA3DF,GA2DE,SAAY,SAAA,GAAA;AACV,IAAA,IAAI,KAAKnU,IAAL,CAAU8L,OAAV,MAAuB,IAAA,CAAK7Z,GAAL,CAAS2e,MAAT,CAAgBmL,UAAhB,IAA8B,KAAK9pB,GAAL,CAAS2e,MAAT,CAAgBoL,UAArE,CAAJ,EAAsF;AACpF,MAAA,IAAI,IAAKhc,CAAAA,IAAL,CAAU8L,OAAd,EAAuB;AACrB,QAAA,IAAA,CAAKsF,MAAL,CAAY2C,WAAZ,CAAwB,IAAK3C,CAAAA,MAAL,CAAYyO,SAApC,CAAA,CAAA;AACD,OAAA;;AAED,MAAA,IAAIC,KAAJ,CAAA;;AACA,MAAA,IAAI,KAAK7tB,GAAL,CAAS2e,MAAT,CAAgBmL,UAApB,EAAgC;AAC9B+D,QAAAA,KAAK,GAAGnlB,QAAQ,CAACC,aAAT,CAAuB,KAAvB,CAAR,CAAA;QACAklB,KAAK,CAACriB,SAAN,GAAkB,kBAAlB,CAAA;QACAqiB,KAAK,CAACva,GAAN,GAAY,IAAA,CAAKtT,GAAL,CAAS2e,MAAT,CAAgBmL,UAA5B,CAAA;OAHF,MAKK,IAAI,IAAK9pB,CAAAA,GAAL,CAAS2e,MAAT,CAAgBoL,UAApB,EAAgC;AACnC8D,QAAAA,KAAK,GAAGnlB,QAAQ,CAACC,aAAT,CAAuB,KAAvB,CAAR,CAAA;QACAklB,KAAK,CAACriB,SAAN,GAAkB,iBAAlB,CAAA;QACAqiB,KAAK,CAAC3J,SAAN,GAAkB,IAAA,CAAKlkB,GAAL,CAAS2e,MAAT,CAAgBoL,UAAlC,CAAA;AACD,OAAA;;AACD,MAAA,IAAI8D,KAAJ,EAAW;AACT,QAAA,IAAMxP,IAAI,GAAG3Y,IAAI,CAACooB,KAAL,CAAWpoB,IAAI,CAACW,IAAL,CAAU,IAAIX,IAAI,CAACO,GAAL,CAAS,CAAC,IAAKwC,CAAAA,MAAL,CAAY2B,KAAZ,GAAoB,CAApB,GAAwB,IAAK2D,CAAAA,IAAL,CAAU4f,QAAV,GAAqB,CAA9C,IAAmDpmB,MAAM,CAACE,UAAnE,EAA+E,CAA/E,CAAd,CAAX,CAAb,CAAA;AACAomB,QAAAA,KAAK,CAACrL,KAAN,CAAYrY,QAAZ,GAAuBkU,IAAI,GAAG,IAA9B,CAAA;AACAwP,QAAAA,KAAK,CAACrL,KAAN,CAAYuL,SAAZ,GAAwB1P,IAAI,GAAG,IAA/B,CAAA;AACA,QAAA,IAAA,CAAKc,MAAL,CAAY0C,WAAZ,CAAwBgM,KAAxB,CAAA,CAAA;AACD,OAAA;;AAED,MAAA,IAAA,CAAK9f,IAAL,CAAU8L,OAAV,GAAoB,IAAA,CAAK7Z,GAAL,CAAS2e,MAAT,CAAgBmL,UAAhB,IAA8B,IAAK9pB,CAAAA,GAAL,CAAS2e,MAAT,CAAgBoL,UAAlE,CAAA;AACD,KAAA;AACF,GAAA;AAED;AACF;AACA;AACA;AA1FA,GAAA;;AAAA,EAAA,MAAA,CA2FE3K,WA3FF,GA2FE,SAAY5P,WAAAA,CAAAA,KAAZ,EAAmB;IACjB,IAAM3G,OAAO,GAAG,IAAKJ,CAAAA,MAAL,CAAYK,UAAZ,CAAuB,IAAvB,CAAhB,CAAA;AAEAD,IAAAA,OAAO,CAACmlB,SAAR,CAAkB,CAAlB,EAAqB,CAArB,EAAwB,IAAKvlB,CAAAA,MAAL,CAAY2B,KAApC,EAA2C,IAAK3B,CAAAA,MAAL,CAAY4B,MAAvD,CAAA,CAAA;AAEAxB,IAAAA,OAAO,CAAColB,SAAR,GAAoB,IAAKlgB,CAAAA,IAAL,CAAU4f,QAA9B,CAAA;IACA9kB,OAAO,CAACqlB,WAAR,GAAsBpgB,QAAQ,CAAC,IAAKqR,CAAAA,MAAN,EAAc,OAAd,CAA9B,CAAA;AAEAtW,IAAAA,OAAO,CAACslB,SAAR,EAAA,CAAA;IACAtlB,OAAO,CAACulB,GAAR,CACE,IAAK3lB,CAAAA,MAAL,CAAY2B,KAAZ,GAAoB,CADtB,EACyB,IAAA,CAAK3B,MAAL,CAAY4B,MAAZ,GAAqB,CAD9C,EAEE,IAAK5B,CAAAA,MAAL,CAAY2B,KAAZ,GAAoB,CAApB,GAAwB,IAAA,CAAK2D,IAAL,CAAU4f,QAAV,GAAqB,CAF/C,EAGE,CAACjoB,IAAI,CAACE,EAAN,GAAW,CAHb,EAGgBuJ,KAAK,CAACK,KAAD,EAAQ,CAAR,EAAW,GAAX,CAAL,GAAuB,GAAvB,GAA6B,CAA7B,GAAiC9J,IAAI,CAACE,EAAtC,GAA2CF,IAAI,CAACE,EAAL,GAAU,CAHrE,CAAA,CAAA;AAKAiD,IAAAA,OAAO,CAACwlB,MAAR,EAAA,CAAA;AAEA,IAAA,IAAA,CAAKruB,GAAL,CAASsuB,OAAT,CAAiBlsB,MAAM,CAACa,aAAxB,EAAuCyC,IAAI,CAACooB,KAAL,CAAWte,KAAX,CAAvC,CAAA,CAAA;GA3GJ,CAAA;;AAAA,EAAA,OAAA,MAAA,CAAA;AAAA,CAAA,CAA4BkS,iBAA5B,CAAA;;ACNA;AACA;AACA;AACA;AACA;;AACA,IAAa6M,YAAb,gBAAA,UAAA,kBAAA,EAAA;AAAA,EAAA,cAAA,CAAA,YAAA,EAAA,kBAAA,CAAA,CAAA;;AAEE;AACF;AACA;AACE,EAAA,SAAA,YAAA,CAAYvuB,GAAZ,EAAiB;AAAA,IAAA,IAAA,KAAA,CAAA;;IACf,KAAMA,GAAAA,kBAAAA,CAAAA,IAAAA,CAAAA,IAAAA,EAAAA,GAAN,EAAW,kBAAX,CAAA,IAAA,IAAA,CAAA;AAEA;AACJ;AACA;AACA;;IACI,KAAK+N,CAAAA,IAAL,GACK,QAAA,CAAA,EAAA,EAAA,KAAA,CAAKA,IADV,EAAA;AAEE6T,MAAAA,OAAO,EAAI,KAFb;AAGE4M,MAAAA,SAAS,EAAE7jB,SAHb;AAIE4H,MAAAA,OAAO,EAAI,IAAA;AAJb,KAAA,CAAA,CAAA;AAOA;AACJ;AACA;AACA;AACA;AACA;;AACI,IAAA,KAAA,CAAK0S,OAAL,GAAevc,QAAQ,CAACC,aAAT,CAAuB,KAAvB,CAAf,CAAA;AACA,IAAA,KAAA,CAAKsc,OAAL,CAAazZ,SAAb,GAAyB,0BAAzB,CAAA;;AACA,IAAA,KAAA,CAAKoR,SAAL,CAAeiF,WAAf,CAA2B,MAAKoD,OAAhC,CAAA,CAAA;;AAEA,IAAA,KAAA,CAAKA,OAAL,CAAarb,gBAAb,CAA8B,OAA9B,EAAuC,YAAA;MAAA,OAAM,KAAA,CAAK0Y,IAAL,EAAN,CAAA;KAAvC,CAAA,CAAA;;AAxBe,IAAA,OAAA,KAAA,CAAA;AAyBhB,GAAA;AAED;AACF;AACA;;;AAlCA,EAAA,IAAA,MAAA,GAAA,YAAA,CAAA,SAAA,CAAA;;EAAA,MAmCEriB,CAAAA,OAnCF,GAmCE,SAAU,OAAA,GAAA;AACR,IAAA,OAAO,KAAKglB,OAAZ,CAAA;;AAEA,IAAA,kBAAA,CAAA,SAAA,CAAMhlB,OAAN,CAAA,IAAA,CAAA,IAAA,CAAA,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AA5CA,GAAA;;AAAA,EAAA,MAAA,CA6CEoiB,SA7CF,GA6CE,SAAUrhB,SAAAA,CAAAA,EAAV,EAAc;IACZ,OAAO,IAAA,CAAK+M,IAAL,CAAU6T,OAAV,KAAsB,CAAC5gB,EAAD,IAAO,CAAC,IAAA,CAAK+M,IAAL,CAAUygB,SAAlB,IAA+B,IAAKzgB,CAAAA,IAAL,CAAUygB,SAAV,KAAwBxtB,EAA7E,CAAP,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AACA;AArDA,GAAA;;EAAA,MAsDE2K,CAAAA,MAtDF,GAsDE,SAAS,MAAA,GAAA;AACP,IAAA,MAAM,IAAItM,QAAJ,CAAa,gCAAb,CAAN,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAtEA,GAAA;;AAAA,EAAA,MAAA,CAuEEkjB,IAvEF,GAuEE,SAAK5D,IAAAA,CAAAA,MAAL,EAAa;AAAA,IAAA,IAAA,MAAA,GAAA,IAAA,CAAA;;AACX,IAAA,IAAI,IAAK5Q,CAAAA,IAAL,CAAUwE,OAAd,EAAuB;AACrBvI,MAAAA,YAAY,CAAC,IAAA,CAAK+D,IAAL,CAAUwE,OAAX,CAAZ,CAAA;AACA,MAAA,IAAA,CAAKxE,IAAL,CAAUwE,OAAV,GAAoB,IAApB,CAAA;AACD,KAAA;;AAED,IAAA,IAAI,OAAOoM,MAAP,KAAkB,QAAtB,EAAgC;AAC9BA,MAAAA,MAAM,GAAG;AAAEsG,QAAAA,OAAO,EAAEtG,MAAAA;OAApB,CAAA;AACD,KAAA;;AAED,IAAA,IAAA,CAAK5Q,IAAL,CAAUygB,SAAV,GAAsB7P,MAAM,CAAC3d,EAA7B,CAAA;AACA,IAAA,IAAA,CAAKikB,OAAL,CAAaf,SAAb,GAAyBvF,MAAM,CAACsG,OAAhC,CAAA;AAEA,IAAA,IAAA,CAAKrI,SAAL,CAAelR,SAAf,CAAyBG,GAAzB,CAA6B,2BAA7B,CAAA,CAAA;AACA,IAAA,IAAA,CAAKkC,IAAL,CAAU6T,OAAV,GAAoB,IAApB,CAAA;IAEA,IAAK5hB,CAAAA,GAAL,CAASsuB,OAAT,CAAiBlsB,MAAM,CAACmB,iBAAxB,EAA2Cob,MAAM,CAAC3d,EAAlD,CAAA,CAAA;;IAEA,IAAI2d,MAAM,CAACpM,OAAX,EAAoB;AAClB,MAAA,IAAA,CAAKxE,IAAL,CAAUwE,OAAV,GAAoBzI,UAAU,CAAC,YAAA;AAAA,QAAA,OAAM,MAAI,CAACwY,IAAL,CAAU3D,MAAM,CAAC3d,EAAjB,CAAN,CAAA;AAAA,OAAD,EAA6B2d,MAAM,CAACpM,OAApC,CAA9B,CAAA;AACD,KAAA;AACF,GAAA;AAED;AACF;AACA;AACA;AACA;AAlGA,GAAA;;AAAA,EAAA,MAAA,CAmGE+P,IAnGF,GAmGE,SAAKthB,IAAAA,CAAAA,EAAL,EAAS;AACP,IAAA,IAAI,IAAKqhB,CAAAA,SAAL,CAAerhB,EAAf,CAAJ,EAAwB;AACtB,MAAA,IAAMwtB,SAAS,GAAG,IAAKzgB,CAAAA,IAAL,CAAUygB,SAA5B,CAAA;AAEA,MAAA,IAAA,CAAK5R,SAAL,CAAelR,SAAf,CAAyBI,MAAzB,CAAgC,2BAAhC,CAAA,CAAA;AACA,MAAA,IAAA,CAAKiC,IAAL,CAAU6T,OAAV,GAAoB,KAApB,CAAA;AAEA,MAAA,IAAA,CAAK7T,IAAL,CAAUygB,SAAV,GAAsB7jB,SAAtB,CAAA;MAEA,IAAK3K,CAAAA,GAAL,CAASsuB,OAAT,CAAiBlsB,MAAM,CAACS,iBAAxB,EAA2C2rB,SAA3C,CAAA,CAAA;AACD,KAAA;GA7GL,CAAA;;AAAA,EAAA,OAAA,YAAA,CAAA;AAAA,CAAA,CAAkC9M,iBAAlC,CAAA;;ACLA;AACA;AACA;AACA;AACA;;AACA,IAAa+M,OAAb,gBAAA,UAAA,kBAAA,EAAA;AAAA,EAAA,cAAA,CAAA,OAAA,EAAA,kBAAA,CAAA,CAAA;;AAEE;AACF;AACA;AACE,EAAA,SAAA,OAAA,CAAYzuB,GAAZ,EAAiB;AAAA,IAAA,IAAA,KAAA,CAAA;;IACf,KAAMA,GAAAA,kBAAAA,CAAAA,IAAAA,CAAAA,IAAAA,EAAAA,GAAN,EAAW,aAAX,CAAA,IAAA,IAAA,CAAA;AAEA;AACJ;AACA;AACA;AACA;;IACI,KAAK+N,CAAAA,IAAL,GACK,QAAA,CAAA,EAAA,EAAA,KAAA,CAAKA,IADV,EAAA;AAEEygB,MAAAA,SAAS,EAAI7jB,SAFf;AAGE+jB,MAAAA,WAAW,EAAE,IAAA;AAHf,KAAA,CAAA,CAAA;AAMA;AACJ;AACA;AACA;AACA;AACA;;AACI,IAAA,KAAA,CAAKC,KAAL,GAAajmB,QAAQ,CAACC,aAAT,CAAuB,KAAvB,CAAb,CAAA;AACA,IAAA,KAAA,CAAKgmB,KAAL,CAAWnjB,SAAX,GAAuB,mBAAvB,CAAA;;AACA,IAAA,KAAA,CAAKoR,SAAL,CAAeiF,WAAf,CAA2B,MAAK8M,KAAhC,CAAA,CAAA;AAEA;AACJ;AACA;AACA;AACA;AACA;;;AACI,IAAA,KAAA,CAAKC,IAAL,GAAYlmB,QAAQ,CAACC,aAAT,CAAuB,KAAvB,CAAZ,CAAA;AACA,IAAA,KAAA,CAAKimB,IAAL,CAAUpjB,SAAV,GAAsB,kBAAtB,CAAA;;AACA,IAAA,KAAA,CAAKoR,SAAL,CAAeiF,WAAf,CAA2B,MAAK+M,IAAhC,CAAA,CAAA;AAEA;AACJ;AACA;AACA;AACA;AACA;;;AACI,IAAA,KAAA,CAAKC,OAAL,GAAenmB,QAAQ,CAACC,aAAT,CAAuB,KAAvB,CAAf,CAAA;AACA,IAAA,KAAA,CAAKkmB,OAAL,CAAarjB,SAAb,GAAyB,qBAAzB,CAAA;;AACA,IAAA,KAAA,CAAKoR,SAAL,CAAeiF,WAAf,CAA2B,MAAKgN,OAAhC,CAAA,CAAA;;AAEA,IAAA,KAAA,CAAK7uB,GAAL,CAASskB,EAAT,CAAYliB,MAAM,CAACI,KAAnB,EAAA,sBAAA,CAAA,KAAA,CAAA,CAAA,CAAA;;AACA,IAAA,KAAA,CAAKxC,GAAL,CAASskB,EAAT,CAAYliB,MAAM,CAACY,SAAnB,EAAA,sBAAA,CAAA,KAAA,CAAA,CAAA,CAAA;;AAEA,IAAA,kBAAA,CAAA,SAAA,CAAMsf,IAAN,CAAA,IAAA,CAAA,sBAAA,CAAA,KAAA,CAAA,CAAA,CAAA;;AA/Ce,IAAA,OAAA,KAAA,CAAA;AAgDhB,GAAA;AAED;AACF;AACA;;;AAzDA,EAAA,IAAA,MAAA,GAAA,OAAA,CAAA,SAAA,CAAA;;EAAA,MA0DEriB,CAAAA,OA1DF,GA0DE,SAAU,OAAA,GAAA;IACR,IAAKD,CAAAA,GAAL,CAASukB,GAAT,CAAaniB,MAAM,CAACI,KAApB,EAA2B,IAA3B,CAAA,CAAA;IACA,IAAKxC,CAAAA,GAAL,CAASukB,GAAT,CAAaniB,MAAM,CAACY,SAApB,EAA+B,IAA/B,CAAA,CAAA;AAEA,IAAA,OAAO,KAAK2rB,KAAZ,CAAA;AACA,IAAA,OAAO,KAAKC,IAAZ,CAAA;AACA,IAAA,OAAO,KAAKC,OAAZ,CAAA;;AAEA,IAAA,kBAAA,CAAA,SAAA,CAAM5uB,OAAN,CAAA,IAAA,CAAA,IAAA,CAAA,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AACA;AAzEA,GAAA;;AAAA,EAAA,MAAA,CA0EEgd,WA1EF,GA0EE,SAAYjU,WAAAA,CAAAA,CAAZ,EAAe;AACb;IACA,QAAQA,CAAC,CAACkU,IAAV;MACE,KAAK9a,MAAM,CAACI,KAAZ;AACE,QAAA,IAAI,KAAK6f,SAAL,EAAA,IAAoB,KAAKtU,IAAL,CAAU2gB,WAAlC,EAA+C;AAC7C,UAAA,IAAA,CAAKpM,IAAL,EAAA,CAAA;AACAtZ,UAAAA,CAAC,CAACmU,eAAF,EAAA,CAAA;AACD,SAAA;;AACD,QAAA,MAAA;;MACF,KAAK/a,MAAM,CAACY,SAAZ;AACE,QAAA,IAAI,KAAKqf,SAAL,EAAA,IAAoB,IAAKtU,CAAAA,IAAL,CAAU2gB,WAA9B,IAA6C1lB,CAAC,CAACsJ,IAAF,CAAO,CAAP,MAAc9L,SAAS,CAACG,MAAzE,EAAiF;AAC/E,UAAA,IAAA,CAAK2b,IAAL,EAAA,CAAA;AACAtZ,UAAAA,CAAC,CAAC8lB,cAAF,EAAA,CAAA;AACD,SAAA;;AACD,QAAA,MAAA;AAZJ,KAAA;AAcA;;AACD,GAAA;AAED;AACF;AACA;AACA;AAhGA,GAAA;;AAAA,EAAA,MAAA,CAiGEzM,SAjGF,GAiGE,SAAUrhB,SAAAA,CAAAA,EAAV,EAAc;IACZ,OAAO,IAAA,CAAK+M,IAAL,CAAU6T,OAAV,KAAsB,CAAC5gB,EAAD,IAAO,CAAC,IAAA,CAAK+M,IAAL,CAAUygB,SAAlB,IAA+B,IAAKzgB,CAAAA,IAAL,CAAUygB,SAAV,KAAwBxtB,EAA7E,CAAP,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AACA;AAzGA,GAAA;;EAAA,MA0GE2K,CAAAA,MA1GF,GA0GE,SAAS,MAAA,GAAA;AACP,IAAA,MAAM,IAAItM,QAAJ,CAAa,2BAAb,CAAN,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAvHA,GAAA;;AAAA,EAAA,MAAA,CAwHEkjB,IAxHF,GAwHE,SAAK5D,IAAAA,CAAAA,MAAL,EAAa;AACX,IAAA,IAAI,OAAOA,MAAP,KAAkB,QAAtB,EAAgC;AAC9BA,MAAAA,MAAM,GAAG;AAAEiQ,QAAAA,IAAI,EAAEjQ,MAAAA;OAAjB,CAAA;AACD,KAAA;;AAED,IAAA,IAAA,CAAK5Q,IAAL,CAAUygB,SAAV,GAAsB7P,MAAM,CAAC3d,EAA7B,CAAA;IACA,IAAK+M,CAAAA,IAAL,CAAU2gB,WAAV,GAAwB/P,MAAM,CAAC+P,WAAP,KAAuB,KAA/C,CAAA;IACA,IAAKC,CAAAA,KAAL,CAAWzK,SAAX,GAAuBvF,MAAM,CAACgQ,KAAP,IAAgB,EAAvC,CAAA;IACA,IAAKC,CAAAA,IAAL,CAAU1K,SAAV,GAAsBvF,MAAM,CAACiQ,IAAP,IAAe,EAArC,CAAA;IACA,IAAKC,CAAAA,OAAL,CAAa3K,SAAb,GAAyBvF,MAAM,CAACkQ,OAAP,IAAkB,EAA3C,CAAA;;AAEA,IAAA,kBAAA,CAAA,SAAA,CAAMtM,IAAN,CAAA,IAAA,CAAA,IAAA,CAAA,CAAA;;IAEA,IAAKviB,CAAAA,GAAL,CAASsuB,OAAT,CAAiBlsB,MAAM,CAACoB,YAAxB,EAAsCmb,MAAM,CAAC3d,EAA7C,CAAA,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AACA;AA5IA,GAAA;;AAAA,EAAA,MAAA,CA6IEshB,IA7IF,GA6IE,SAAKthB,IAAAA,CAAAA,EAAL,EAAS;AACP,IAAA,IAAI,IAAKqhB,CAAAA,SAAL,CAAerhB,EAAf,CAAJ,EAAwB;AACtB,MAAA,IAAMwtB,SAAS,GAAG,IAAKzgB,CAAAA,IAAL,CAAUygB,SAA5B,CAAA;;AAEA,MAAA,kBAAA,CAAA,SAAA,CAAMlM,IAAN,CAAA,IAAA,CAAA,IAAA,CAAA,CAAA;;AAEA,MAAA,IAAA,CAAKvU,IAAL,CAAUygB,SAAV,GAAsB7jB,SAAtB,CAAA;MAEA,IAAK3K,CAAAA,GAAL,CAASsuB,OAAT,CAAiBlsB,MAAM,CAACU,YAAxB,EAAsC0rB,SAAtC,CAAA,CAAA;AACD,KAAA;GAtJL,CAAA;;AAAA,EAAA,OAAA,OAAA,CAAA;AAAA,CAAA,CAA6B9M,iBAA7B,CAAA;;ACHA;AACA;AACA;AACA;AACA;AACA;;AACA,IAAMqN,eAAe,GAAG,GAAxB,CAAA;AAEA;AACA;AACA;AACA;AACA;;AACA,IAAaC,KAAb,gBAAA,UAAA,kBAAA,EAAA;AAAA,EAAA,cAAA,CAAA,KAAA,EAAA,kBAAA,CAAA,CAAA;;AAEE;AACF;AACA;AACE,EAAA,SAAA,KAAA,CAAYhvB,GAAZ,EAAiB;AAAA,IAAA,IAAA,KAAA,CAAA;;IACf,KAAMA,GAAAA,kBAAAA,CAAAA,IAAAA,CAAAA,IAAAA,EAAAA,GAAN,EAAW,8BAAX,CAAA,IAAA,IAAA,CAAA;AAEA;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;IACI,KAAK+N,CAAAA,IAAL,GACK,QAAA,CAAA,EAAA,EAAA,KAAA,CAAKA,IADV,EAAA;AAEE6T,MAAAA,OAAO,EAAO,KAFhB;AAGE4M,MAAAA,SAAS,EAAK7jB,SAHhB;AAIEskB,MAAAA,MAAM,EAAQ,CAJhB;AAKEC,MAAAA,MAAM,EAAQ,CALhB;AAMEnS,MAAAA,SAAS,EAAK,KANhB;AAOEkK,MAAAA,YAAY,EAAE,IAPhB;AAQEkI,MAAAA,UAAU,EAAI,IARhB;AASE/kB,MAAAA,KAAK,EAAS,EAAA;AAThB,KAAA,CAAA,CAAA;AAYA,IAAA,IAAMglB,OAAO,GAAG1mB,QAAQ,CAACC,aAAT,CAAuB,KAAvB,CAAhB,CAAA;IACAymB,OAAO,CAAC5jB,SAAR,GAAoB,mBAApB,CAAA;;AACA,IAAA,KAAA,CAAKoR,SAAL,CAAeiF,WAAf,CAA2BuN,OAA3B,CAAA,CAAA;;AAEA,IAAA,IAAMC,QAAQ,GAAG3mB,QAAQ,CAACC,aAAT,CAAuB,KAAvB,CAAjB,CAAA;IACA0mB,QAAQ,CAAC7jB,SAAT,GAAqB,wBAArB,CAAA;;AACA,IAAA,KAAA,CAAKoR,SAAL,CAAeiF,WAAf,CAA2BwN,QAA3B,CAAA,CAAA;AAEA;AACJ;AACA;AACA;AACA;AACA;;;AACI,IAAA,KAAA,CAAKpK,OAAL,GAAevc,QAAQ,CAACC,aAAT,CAAuB,KAAvB,CAAf,CAAA;AACA,IAAA,KAAA,CAAKsc,OAAL,CAAazZ,SAAb,GAAyB,mBAAzB,CAAA;;AACA,IAAA,KAAA,CAAKoR,SAAL,CAAeiF,WAAf,CAA2B,KAAKoD,CAAAA,OAAhC,EAxCe;;;IA2Cf,KAAKrI,CAAAA,SAAL,CAAehT,gBAAf,CAAgCrC,MAAM,CAACM,eAAvC,EAAwD,UAAAmB,CAAC,EAAA;MAAA,OAAIA,CAAC,CAACmU,eAAF,EAAJ,CAAA;KAAzD,CAAA,CAAA;;AAEAkS,IAAAA,QAAQ,CAACzlB,gBAAT,CAA0B,OAA1B,EAAmC,YAAA;MAAA,OAAM,KAAA,CAAK0Y,IAAL,EAAN,CAAA;AAAA,KAAnC,EA7Ce;;IAgDf8M,OAAO,CAACxlB,gBAAR,CAAyB,WAAzB,EAAA,sBAAA,CAAA,KAAA,CAAA,CAAA,CAAA;IACAwlB,OAAO,CAACxlB,gBAAR,CAAyB,YAAzB,EAAA,sBAAA,CAAA,KAAA,CAAA,CAAA,CAAA;;AACA,IAAA,KAAA,CAAK5J,GAAL,CAAS4c,SAAT,CAAmBhT,gBAAnB,CAAoC,SAApC,EAAA,sBAAA,CAAA,KAAA,CAAA,CAAA,CAAA;;AACA,IAAA,KAAA,CAAK5J,GAAL,CAAS4c,SAAT,CAAmBhT,gBAAnB,CAAoC,UAApC,EAAA,sBAAA,CAAA,KAAA,CAAA,CAAA,CAAA;;AACA,IAAA,KAAA,CAAK5J,GAAL,CAAS4c,SAAT,CAAmBhT,gBAAnB,CAAoC,WAApC,EAAA,sBAAA,CAAA,KAAA,CAAA,CAAA,CAAA;;AACA,IAAA,KAAA,CAAK5J,GAAL,CAAS4c,SAAT,CAAmBhT,gBAAnB,CAAoC,WAApC,EAAA,sBAAA,CAAA,KAAA,CAAA,CAAA,CAAA;;AAEA,IAAA,KAAA,CAAK5J,GAAL,CAASskB,EAAT,CAAYliB,MAAM,CAACY,SAAnB,EAAA,sBAAA,CAAA,KAAA,CAAA,CAAA,CAAA;;AAvDe,IAAA,OAAA,KAAA,CAAA;AAwDhB,GAAA;AAED;AACF;AACA;;;AAjEA,EAAA,IAAA,MAAA,GAAA,KAAA,CAAA,SAAA,CAAA;;EAAA,MAkEE/C,CAAAA,OAlEF,GAkEE,SAAU,OAAA,GAAA;IACR,IAAKD,CAAAA,GAAL,CAASukB,GAAT,CAAaniB,MAAM,CAACY,SAApB,EAA+B,IAA/B,CAAA,CAAA;IAEA,IAAKhD,CAAAA,GAAL,CAAS4c,SAAT,CAAmB7S,mBAAnB,CAAuC,WAAvC,EAAoD,IAApD,CAAA,CAAA;IACA,IAAK/J,CAAAA,GAAL,CAAS4c,SAAT,CAAmB7S,mBAAnB,CAAuC,WAAvC,EAAoD,IAApD,CAAA,CAAA;IACA,IAAK/J,CAAAA,GAAL,CAAS4c,SAAT,CAAmB7S,mBAAnB,CAAuC,SAAvC,EAAkD,IAAlD,CAAA,CAAA;IACA,IAAK/J,CAAAA,GAAL,CAAS4c,SAAT,CAAmB7S,mBAAnB,CAAuC,UAAvC,EAAmD,IAAnD,CAAA,CAAA;AAEA,IAAA,OAAO,KAAKgE,IAAZ,CAAA;AACA,IAAA,OAAO,KAAKkX,OAAZ,CAAA;;AAEA,IAAA,kBAAA,CAAA,SAAA,CAAMhlB,OAAN,CAAA,IAAA,CAAA,IAAA,CAAA,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AACA;AApFA,GAAA;;AAAA,EAAA,MAAA,CAqFEgd,WArFF,GAqFE,SAAYjU,WAAAA,CAAAA,CAAZ,EAAe;AACb;IACA,QAAQA,CAAC,CAACkU,IAAV;AACE;AACA,MAAA,KAAK,WAAL;QAAmB,IAAKE,CAAAA,aAAL,CAAmBpU,CAAnB,CAAA,CAAA;;AAAwB,QAAA,MAAA;;AAC3C,MAAA,KAAK,YAAL;QAAmB,IAAKuU,CAAAA,cAAL,CAAoBvU,CAApB,CAAA,CAAA;;AAAwB,QAAA,MAAA;;AAC3C,MAAA,KAAK,WAAL;QAAmB,IAAKwU,CAAAA,aAAL,CAAmBxU,CAAnB,CAAA,CAAA;;AAAwB,QAAA,MAAA;;AAC3C,MAAA,KAAK,WAAL;QAAmB,IAAKyU,CAAAA,aAAL,CAAmBzU,CAAnB,CAAA,CAAA;;AAAwB,QAAA,MAAA;;AAC3C,MAAA,KAAK,SAAL;QAAmB,IAAK0U,CAAAA,WAAL,CAAiB1U,CAAjB,CAAA,CAAA;;AAAwB,QAAA,MAAA;;AAC3C,MAAA,KAAK,UAAL;QAAmB,IAAK0U,CAAAA,WAAL,CAAiB1U,CAAjB,CAAA,CAAA;;AAAwB,QAAA,MAAA;;MAC3C,KAAK5G,MAAM,CAACY,SAAZ;AACE,QAAA,IAAI,IAAKqf,CAAAA,SAAL,EAAoBrZ,IAAAA,CAAC,CAACsJ,IAAF,CAAO,CAAP,CAAc9L,KAAAA,SAAS,CAACG,MAAhD,EAAwD;AACtD,UAAA,IAAA,CAAK2b,IAAL,EAAA,CAAA;AACAtZ,UAAAA,CAAC,CAAC8lB,cAAF,EAAA,CAAA;AACD,SAAA;;AACD,QAAA,MAAA;AACF;AAdF,KAAA;AAgBA;;AACD,GAAA;AAED;AACF;AACA;AACA;AA7GA,GAAA;;AAAA,EAAA,MAAA,CA8GEzM,SA9GF,GA8GE,SAAUrhB,SAAAA,CAAAA,EAAV,EAAc;IACZ,OAAO,IAAA,CAAK+M,IAAL,CAAU6T,OAAV,KAAsB,CAAC5gB,EAAD,IAAO,CAAC,IAAA,CAAK+M,IAAL,CAAUygB,SAAlB,IAA+B,IAAKzgB,CAAAA,IAAL,CAAUygB,SAAV,KAAwBxtB,EAA7E,CAAP,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AACA;AAtHA,GAAA;;EAAA,MAuHE2K,CAAAA,MAvHF,GAuHE,SAAS,MAAA,GAAA;AACP,IAAA,MAAM,IAAItM,QAAJ,CAAa,yBAAb,CAAN,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AApIA,GAAA;;AAAA,EAAA,MAAA,CAqIEkjB,IArIF,GAqIE,SAAK5D,IAAAA,CAAAA,MAAL,EAAa;AAAA,IAAA,IAAA,MAAA,GAAA,IAAA,CAAA;;IACX,IAAM2Q,UAAU,GAAG,IAAKjN,CAAAA,SAAL,CAAe1D,MAAM,CAAC3d,EAAtB,CAAnB,CAAA;;AAEA,IAAA,IAAI,OAAO2d,MAAP,KAAkB,QAAtB,EAAgC;AAC9BA,MAAAA,MAAM,GAAG;AAAEsG,QAAAA,OAAO,EAAEtG,MAAAA;OAApB,CAAA;AACD,KAAA;;AAED,IAAA,IAAA,CAAK5Q,IAAL,CAAUygB,SAAV,GAAsB7P,MAAM,CAAC3d,EAA7B,CAAA;AACA,IAAA,IAAA,CAAK+M,IAAL,CAAU6T,OAAV,GAAoB,IAApB,CAAA;;AAEA,IAAA,IAAI,IAAK7T,CAAAA,IAAL,CAAUkZ,YAAd,EAA4B;MAC1B,IAAKhC,CAAAA,OAAL,CAAalb,mBAAb,CAAiC,OAAjC,EAA0C,IAAA,CAAKgE,IAAL,CAAUkZ,YAApD,CAAA,CAAA;MACA,IAAKhC,CAAAA,OAAL,CAAalb,mBAAb,CAAiC,SAAjC,EAA4C,IAAA,CAAKgE,IAAL,CAAUohB,UAAtD,CAAA,CAAA;AACA,MAAA,IAAA,CAAKphB,IAAL,CAAUkZ,YAAV,GAAyB,IAAzB,CAAA;AACA,MAAA,IAAA,CAAKlZ,IAAL,CAAUohB,UAAV,GAAuB,IAAvB,CAAA;AACD,KAAA;;AAED,IAAA,IAAIxQ,MAAM,CAAC3d,EAAP,IAAa,IAAK+M,CAAAA,IAAL,CAAU3D,KAAV,CAAgBuU,MAAM,CAAC3d,EAAvB,CAAjB,EAA6C;AAC3C,MAAA,IAAA,CAAK4b,SAAL,CAAe4F,KAAf,CAAqBpY,KAArB,GAA6B,IAAA,CAAK2D,IAAL,CAAU3D,KAAV,CAAgBuU,MAAM,CAAC3d,EAAvB,CAA7B,CAAA;AACD,KAFD,MAGK,IAAI2d,MAAM,CAACvU,KAAX,EAAkB;MACrB,IAAKwS,CAAAA,SAAL,CAAe4F,KAAf,CAAqBpY,KAArB,GAA6BuU,MAAM,CAACvU,KAApC,CAAA;AACD,KAFI,MAGA;AACH,MAAA,IAAA,CAAKwS,SAAL,CAAe4F,KAAf,CAAqBpY,KAArB,GAA6B,IAA7B,CAAA;AACD,KAAA;;AAED,IAAA,IAAA,CAAK6a,OAAL,CAAaf,SAAb,GAAyBvF,MAAM,CAACsG,OAAhC,CAAA;AACA,IAAA,IAAA,CAAKA,OAAL,CAAa7X,SAAb,GAAyB,CAAzB,CAAA;AACA,IAAA,IAAA,CAAKwP,SAAL,CAAelR,SAAf,CAAyBG,GAAzB,CAA6B,iBAA7B,CAAA,CAAA;IAEAP,WAAW,CAAC,IAAK2Z,CAAAA,OAAN,EAAe,8BAAf,EAA+CtG,MAAM,CAACqI,QAAP,KAAoB,IAAnE,CAAX,CAAA;;IAEA,IAAIrI,MAAM,CAACsI,YAAX,EAAyB;AACvB,MAAA,IAAA,CAAKlZ,IAAL,CAAUkZ,YAAV,GAAyBtI,MAAM,CAACsI,YAAhC,CAAA;;AACA,MAAA,IAAA,CAAKlZ,IAAL,CAAUohB,UAAV,GAAuB,UAACnmB,CAAD,EAAO;AAC5B,QAAA,IAAIA,CAAC,CAAC2K,GAAF,KAAUnN,SAAS,CAACC,KAAxB,EAA+B;UAC7BkY,MAAM,CAACsI,YAAP,CAAoBje,CAApB,CAAA,CAAA;AACD,SAAA;OAHH,CAAA;;MAKA,IAAKic,CAAAA,OAAL,CAAarb,gBAAb,CAA8B,OAA9B,EAAuC,IAAA,CAAKmE,IAAL,CAAUkZ,YAAjD,CAAA,CAAA;MACA,IAAKhC,CAAAA,OAAL,CAAarb,gBAAb,CAA8B,SAA9B,EAAyC,IAAA,CAAKmE,IAAL,CAAUohB,UAAnD,CAAA,CARuB;;MAWvB,IAAI,CAACG,UAAL,EAAiB;AACfxlB,QAAAA,UAAU,CAAC,YAAM;AAAA,UAAA,IAAA,qBAAA,CAAA;;AACf,UAAA,CAAA,qBAAA,GAAA,MAAI,CAACmb,OAAL,CAAad,aAAb,CAA2B,qBAA3B,4CAAmDoL,KAAnD,EAAA,CAAA;SADQ,EAEP,GAFO,CAAV,CAAA;AAGD,OAAA;AACF,KAAA;;IAED,IAAKvvB,CAAAA,GAAL,CAASsuB,OAAT,CAAiBlsB,MAAM,CAACc,UAAxB,EAAoCyb,MAAM,CAAC3d,EAA3C,CAAA,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AACA;AA/LA,GAAA;;AAAA,EAAA,MAAA,CAgMEshB,IAhMF,GAgME,SAAKthB,IAAAA,CAAAA,EAAL,EAAS;AACP,IAAA,IAAI,IAAKqhB,CAAAA,SAAL,CAAerhB,EAAf,CAAJ,EAAwB;AACtB,MAAA,IAAMwtB,SAAS,GAAG,IAAKzgB,CAAAA,IAAL,CAAUygB,SAA5B,CAAA;AAEA,MAAA,IAAA,CAAKzgB,IAAL,CAAU6T,OAAV,GAAoB,KAApB,CAAA;AACA,MAAA,IAAA,CAAK7T,IAAL,CAAUygB,SAAV,GAAsB7jB,SAAtB,CAAA;AAEA,MAAA,IAAA,CAAKsa,OAAL,CAAaf,SAAb,GAAyB,IAAzB,CAAA;AACA,MAAA,IAAA,CAAKtH,SAAL,CAAelR,SAAf,CAAyBI,MAAzB,CAAgC,iBAAhC,CAAA,CAAA;;AAEA,MAAA,IAAI,IAAKiC,CAAAA,IAAL,CAAUkZ,YAAd,EAA4B;QAC1B,IAAKhC,CAAAA,OAAL,CAAalb,mBAAb,CAAiC,OAAjC,EAA0C,IAAA,CAAKgE,IAAL,CAAUkZ,YAApD,CAAA,CAAA;AACA,QAAA,IAAA,CAAKlZ,IAAL,CAAUkZ,YAAV,GAAyB,IAAzB,CAAA;AACD,OAAA;;MAED,IAAKjnB,CAAAA,GAAL,CAASsuB,OAAT,CAAiBlsB,MAAM,CAACK,WAAxB,EAAqC+rB,SAArC,CAAA,CAAA;AACD,KAAA;AACF,GAAA;AAED;AACF;AACA;AACA;AACA;AAvNA,GAAA;;AAAA,EAAA,MAAA,CAwNEpR,aAxNF,GAwNE,SAAcQ,aAAAA,CAAAA,GAAd,EAAmB;AACjBA,IAAAA,GAAG,CAACT,eAAJ,EAAA,CAAA;;IACA,IAAKqS,CAAAA,aAAL,CAAmB5R,GAAnB,CAAA,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AACA;AAjOA,GAAA;;AAAA,EAAA,MAAA,CAkOEL,cAlOF,GAkOE,SAAeK,cAAAA,CAAAA,GAAf,EAAoB;AAClBA,IAAAA,GAAG,CAACT,eAAJ,EAAA,CAAA;;AACA,IAAA,IAAA,CAAKqS,aAAL,CAAmB5R,GAAG,CAACE,cAAJ,CAAmB,CAAnB,CAAnB,CAAA,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AACA;AA3OA,GAAA;;AAAA,EAAA,MAAA,CA4OEJ,WA5OF,GA4OE,SAAYE,WAAAA,CAAAA,GAAZ,EAAiB;AACf,IAAA,IAAI,IAAK7P,CAAAA,IAAL,CAAUgP,SAAd,EAAyB;AACvBa,MAAAA,GAAG,CAACT,eAAJ,EAAA,CAAA;AACA,MAAA,IAAA,CAAKpP,IAAL,CAAUgP,SAAV,GAAsB,KAAtB,CAAA;AACA,MAAA,IAAA,CAAKkI,OAAL,CAAavZ,SAAb,CAAuBI,MAAvB,CAA8B,mCAA9B,CAAA,CAAA;AACD,KAAA;AACF,GAAA;AAED;AACF;AACA;AACA;AACA;AAxPA,GAAA;;AAAA,EAAA,MAAA,CAyPE0R,aAzPF,GAyPE,SAAcI,aAAAA,CAAAA,GAAd,EAAmB;AACjB,IAAA,IAAI,IAAK7P,CAAAA,IAAL,CAAUgP,SAAd,EAAyB;AACvBa,MAAAA,GAAG,CAACT,eAAJ,EAAA,CAAA;;MACA,IAAKsS,CAAAA,QAAL,CAAc7R,GAAd,CAAA,CAAA;AACD,KAAA;AACF,GAAA;AAED;AACF;AACA;AACA;AACA;AApQA,GAAA;;AAAA,EAAA,MAAA,CAqQEH,aArQF,GAqQE,SAAcG,aAAAA,CAAAA,GAAd,EAAmB;AACjB,IAAA,IAAI,IAAK7P,CAAAA,IAAL,CAAUgP,SAAd,EAAyB;AACvB,MAAA,IAAA,CAAK0S,QAAL,CAAc7R,GAAG,CAAC8R,OAAJ,CAAY,CAAZ,CAAd,CAAA,CAAA;AACD,KAAA;AACF,GAAA;AAED;AACF;AACA;AACA;AACA;AA/QA,GAAA;;AAAA,EAAA,MAAA,CAgREF,aAhRF,GAgRE,SAAc5R,aAAAA,CAAAA,GAAd,EAAmB;AACjB,IAAA,IAAA,CAAK7P,IAAL,CAAUkhB,MAAV,GAAmBrR,GAAG,CAAC+R,OAAvB,CAAA;AACA,IAAA,IAAA,CAAK5hB,IAAL,CAAUmhB,MAAV,GAAmBtR,GAAG,CAACgS,OAAvB,CAAA;AACA,IAAA,IAAA,CAAK7hB,IAAL,CAAUgP,SAAV,GAAsB,IAAtB,CAAA;AACA,IAAA,IAAA,CAAKkI,OAAL,CAAavZ,SAAb,CAAuBG,GAAvB,CAA2B,mCAA3B,CAAA,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AACA;AA3RA,GAAA;;AAAA,EAAA,MAAA,CA4RE4jB,QA5RF,GA4RE,SAAS7R,QAAAA,CAAAA,GAAT,EAAc;AACZ,IAAA,IAAMxO,CAAC,GAAGwO,GAAG,CAAC+R,OAAd,CAAA;AACA,IAAA,IAAMnf,CAAC,GAAGoN,GAAG,CAACgS,OAAd,CAAA;IACA,IAAMxlB,KAAK,GAAG1E,IAAI,CAAC4J,GAAL,CAASyf,eAAT,EAA0B,IAAKnS,CAAAA,SAAL,CAAeqG,WAAf,IAA8B7T,CAAC,GAAG,IAAA,CAAKrB,IAAL,CAAUkhB,MAA5C,CAA1B,CAAA,GAAiF,IAA/F,CAAA;;AAEA,IAAA,IAAI,IAAKlhB,CAAAA,IAAL,CAAUygB,SAAd,EAAyB;MACvB,IAAKzgB,CAAAA,IAAL,CAAU3D,KAAV,CAAgB,KAAK2D,IAAL,CAAUygB,SAA1B,CAAA,GAAuCpkB,KAAvC,CAAA;AACD,KAAA;;AAED,IAAA,IAAA,CAAKwS,SAAL,CAAe4F,KAAf,CAAqBpY,KAArB,GAA6BA,KAA7B,CAAA;AAEA,IAAA,IAAA,CAAK2D,IAAL,CAAUkhB,MAAV,GAAmB7f,CAAnB,CAAA;AACA,IAAA,IAAA,CAAKrB,IAAL,CAAUmhB,MAAV,GAAmB1e,CAAnB,CAAA;GAxSJ,CAAA;;AAAA,EAAA,OAAA,KAAA,CAAA;AAAA,CAAA,CAA2BkR,iBAA3B,CAAA;;;;ACnBA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,IAAamO,eAAb,gBAAA,YAAA;AAEE;AACF;AACA;AACE,EAAA,SAAA,eAAA,CAAY7vB,GAAZ,EAAiB;AACf;AACJ;AACA;AACA;AACA;IACI,IAAKA,CAAAA,GAAL,GAAWA,GAAX,CAAA;AAEA;AACJ;AACA;AACA;AACA;;AACI,IAAA,IAAA,CAAK2e,MAAL,GAAc3e,GAAG,CAAC2e,MAAlB,CAAA;AAEA;AACJ;AACA;AACA;AACA;;AACI,IAAA,IAAA,CAAK5Q,IAAL,GAAY/N,GAAG,CAAC+N,IAAhB,CAAA;AACD,GAAA;AAED;AACF;AACA;;;AA9BA,EAAA,IAAA,MAAA,GAAA,eAAA,CAAA,SAAA,CAAA;;EAAA,MA+BE9N,CAAAA,OA/BF,GA+BE,SAAU,OAAA,GAAA;AACR,IAAA,OAAO,KAAKD,GAAZ,CAAA;AACA,IAAA,OAAO,KAAK2e,MAAZ,CAAA;AACA,IAAA,OAAO,KAAK5Q,IAAZ,CAAA;GAlCJ,CAAA;;AAAA,EAAA,OAAA,eAAA,CAAA;AAAA,CAAA,EAAA;;ACHA,IAAM+hB,OAAO,GAAG,IAAIvY,KAAK,CAACwY,OAAV,EAAhB,CAAA;AACA,IAAMC,OAAO,GAAG,IAAIzY,KAAK,CAAC0Y,OAAV,EAAhB,CAAA;AACA,IAAMC,SAAS,GAAG,IAAI3Y,KAAK,CAAC4Y,KAAV,CAAgB,CAAhB,EAAmB,CAAnB,EAAsB,CAAtB,EAAyB,KAAzB,CAAlB,CAAA;AAEA;AACA;AACA;AACA;AACA;;AACA,IAAaC,UAAb,gBAAA,UAAA,gBAAA,EAAA;AAAA,EAAA,cAAA,CAAA,UAAA,EAAA,gBAAA,CAAA,CAAA;;AAEE;AACF;AACA;AACE,EAAA,SAAA,UAAA,CAAYpwB,GAAZ,EAAiB;IAAA,OACf,gBAAA,CAAA,IAAA,CAAA,IAAA,EAAMA,GAAN,CADe,IAAA,IAAA,CAAA;AAEhB,GAAA;AAED;AACF;AACA;AACA;AACA;;;AAbA,EAAA,IAAA,MAAA,GAAA,UAAA,CAAA,SAAA,CAAA;;AAAA,EAAA,MAAA,CAcEqwB,cAdF,GAcE,SAAeC,cAAAA,CAAAA,GAAf,EAAoB;IAClB,IAAMC,IAAI,GAAG7qB,IAAI,CAACooB,KAAL,CAAW,CAACwC,GAAG,GAAG,IAAA,CAAK3R,MAAL,CAAYsL,MAAnB,KAA8B,IAAA,CAAKtL,MAAL,CAAYuL,MAAZ,GAAqB,IAAKvL,CAAAA,MAAL,CAAYsL,MAA/D,CAAyE,GAAA,GAApF,CAAb,CAAA;AACA,IAAA,OAAOsG,IAAI,GAAG,CAAA,IAAKA,IAAI,GAAG,EAAZ,CAAd,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AACA;AAvBA,GAAA;;AAAA,EAAA,MAAA,CAwBEC,cAxBF,GAwBE,SAAe/G,cAAAA,CAAAA,KAAf,EAAsB;AACpB,IAAA,OAAO,KAAK9K,MAAL,CAAYuL,MAAZ,GAAsBT,KAAK,GAAG,GAAT,IAAiB,IAAK9K,CAAAA,MAAL,CAAYsL,MAAZ,GAAqB,KAAKtL,MAAL,CAAYuL,MAAlD,CAA5B,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AACA;AAhCA,GAAA;;AAAA,EAAA,MAAA,CAiCEuG,UAjCF,GAiCE,SAAWC,UAAAA,CAAAA,IAAX,EAAiB;AACf,IAAA,OAAOnZ,KAAK,CAACC,SAAN,CAAgBmZ,QAAhB,CAAyB,CAAIjrB,GAAAA,IAAI,CAACkrB,IAAL,CAAUlrB,IAAI,CAACmrB,GAAL,CAAStZ,KAAK,CAACC,SAAN,CAAgBC,QAAhB,CAAyBiZ,IAAzB,CAAA,GAAiC,CAA1C,CAAA,GAA+C,IAAK3iB,CAAAA,IAAL,CAAU+iB,MAAnE,CAA7B,CAAP,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AACA;AACA;AA1CA,GAAA;;AAAA,EAAA,MAAA,CA2CEC,eA3CF,GA2CE,SAAA,eAAA,CAAgBvhB,KAAhB,EAAuBmI,KAAvB,EAA8B;AAC5B,IAAA,IAAI,CAACnI,KAAD,IAAU,OAAOA,KAAP,KAAiB,QAA/B,EAAyC;AACvC;AACA,MAAA,IAAM0H,KAAK,GAAG1H,KAAK,GAAGyH,UAAU,CAACzH,KAAD,CAAb,GAAuB,IAAKmP,CAAAA,MAAL,CAAY+L,eAAtD,CAFuC;;MAIvC,OAAO/S,KAAK,GAAGjS,IAAI,CAACqL,GAAL,CAASmG,KAAT,CAAR,GAA0B,IAAjC,CAAA;AACD,KALD,MAMK;AACH,MAAA,OAAOxR,IAAI,CAACqL,GAAL,CAASvB,KAAT,CAAP,CAAA;AACD,KAAA;AACF,GAAA;AAED;AACF;AACA;AACA;AACA;AACA;AA5DA,GAAA;;AAAA,EAAA,MAAA,CA6DEwhB,8BA7DF,GA6DE,SAA+BC,8BAAAA,CAAAA,KAA/B,EAAsC;AACpC,IAAA,IAAM1R,QAAQ,GAAG,IAAKxR,CAAAA,IAAL,CAAUwR,QAA3B,CAAA;;IACA,IAAI,CAACA,QAAL,EAAe;AACb,MAAA,MAAM,IAAIlgB,QAAJ,CAAa,uDAAb,CAAN,CAAA;AACD,KAAA;;AAED,IAAA,IAAM6xB,SAAS,GAAG,CAACD,KAAK,CAAC7hB,CAAN,GAAUmQ,QAAQ,CAACK,QAApB,IAAgCL,QAAQ,CAACC,SAAzC,GAAqD9Z,IAAI,CAACE,EAA1D,GAA+D,CAAjF,CAAA;AACA,IAAA,IAAMurB,SAAS,GAAG,CAACF,KAAK,CAACzgB,CAAN,GAAU+O,QAAQ,CAACM,QAApB,IAAgCN,QAAQ,CAACE,UAAzC,GAAsD/Z,IAAI,CAACE,EAA7E,CAAA;AAEA,IAAA,IAAM6J,MAAM,GAAG;AACb6B,MAAAA,SAAS,EAAE4f,SAAS,IAAIxrB,IAAI,CAACE,EAAlB,GAAuBsrB,SAAS,GAAGxrB,IAAI,CAACE,EAAxC,GAA6CsrB,SAAS,GAAGxrB,IAAI,CAACE,EAD5D;AAEbyL,MAAAA,QAAQ,EAAG3L,IAAI,CAACE,EAAL,GAAU,CAAV,GAAcurB,SAAAA;AAFZ,KAAf,CAToC;;AAepC,IAAA,IAAI,CAACjB,SAAS,CAACkB,MAAV,CAAiB,IAAA,CAAKpxB,GAAL,CAASqxB,QAAT,CAAkB3wB,IAAlB,CAAuB4wB,QAAxC,CAAD,IAAsD,CAACpB,SAAS,CAACkB,MAAV,CAAiB,IAAKpxB,CAAAA,GAAL,CAASqxB,QAAT,CAAkBE,aAAlB,CAAgCD,QAAjD,CAA3D,EAAuH;AACrH,MAAA,IAAA,CAAKE,wBAAL,CAA8B/hB,MAA9B,EAAsCugB,OAAtC,CAAA,CAAA;MACAA,OAAO,CAACyB,UAAR,CAAmB,IAAKzxB,CAAAA,GAAL,CAASqxB,QAAT,CAAkB3wB,IAAlB,CAAuB4wB,QAA1C,CAAA,CAAA;MACAtB,OAAO,CAACyB,UAAR,CAAmB,IAAKzxB,CAAAA,GAAL,CAASqxB,QAAT,CAAkBE,aAAlB,CAAgCD,QAAnD,CAAA,CAAA;AACA,MAAA,OAAO,IAAKI,CAAAA,wBAAL,CAA8B1B,OAA9B,CAAP,CAAA;AACD,KALD,MAMK;AACH,MAAA,OAAOvgB,MAAP,CAAA;AACD,KAAA;AACF,GAAA;AAED;AACF;AACA;AACA;AACA;AACA;AA5FA,GAAA;;AAAA,EAAA,MAAA,CA6FEkiB,8BA7FF,GA6FE,SAA+BpW,8BAAAA,CAAAA,QAA/B,EAAyC;AACvC,IAAA,IAAMgE,QAAQ,GAAG,IAAKxR,CAAAA,IAAL,CAAUwR,QAA3B,CAAA;;IACA,IAAI,CAACA,QAAL,EAAe;AACb,MAAA,MAAM,IAAIlgB,QAAJ,CAAa,uDAAb,CAAN,CAAA;AACD,KAJsC;;;AAOvC,IAAA,IAAI,CAAC6wB,SAAS,CAACkB,MAAV,CAAiB,IAAA,CAAKpxB,GAAL,CAASqxB,QAAT,CAAkB3wB,IAAlB,CAAuB4wB,QAAxC,CAAD,IAAsD,CAACpB,SAAS,CAACkB,MAAV,CAAiB,IAAKpxB,CAAAA,GAAL,CAASqxB,QAAT,CAAkBE,aAAlB,CAAgCD,QAAjD,CAA3D,EAAuH;AACrH,MAAA,IAAA,CAAKE,wBAAL,CAA8BjW,QAA9B,EAAwCyU,OAAxC,CAAA,CAAA;MACAvX,iBAAiB,CAACuX,OAAD,EAAU,IAAKhwB,CAAAA,GAAL,CAASqxB,QAAT,CAAkBE,aAAlB,CAAgCD,QAA1C,CAAjB,CAAA;MACA7Y,iBAAiB,CAACuX,OAAD,EAAU,IAAKhwB,CAAAA,GAAL,CAASqxB,QAAT,CAAkB3wB,IAAlB,CAAuB4wB,QAAjC,CAAjB,CAAA;AACA/V,MAAAA,QAAQ,GAAG,IAAA,CAAKmW,wBAAL,CAA8B1B,OAA9B,CAAX,CAAA;AACD,KAAA;;AAED,IAAA,IAAM4B,YAAY,GAAGrW,QAAQ,CAACjK,SAAT,GAAqB5L,IAAI,CAACE,EAA1B,GAA+B,CAA/B,GAAmC2Z,QAAQ,CAACC,SAAjE,CAAA;AACA,IAAA,IAAMqS,WAAW,GAAGtW,QAAQ,CAAClK,QAAT,GAAoB3L,IAAI,CAACE,EAAzB,GAA8B2Z,QAAQ,CAACE,UAA3D,CAAA;IAEA,OAAO;AACLrQ,MAAAA,CAAC,EAAE1J,IAAI,CAACooB,KAAL,CAAWvS,QAAQ,CAACjK,SAAT,GAAqB5L,IAAI,CAACE,EAA1B,GAA+BgsB,YAAY,GAAGrS,QAAQ,CAACC,SAAT,GAAqB,CAAnE,GAAuEoS,YAAY,GAAGrS,QAAQ,CAACC,SAAT,GAAqB,CAAtH,CAA2HD,GAAAA,QAAQ,CAACK,QADlI;AAELpP,MAAAA,CAAC,EAAE9K,IAAI,CAACooB,KAAL,CAAWvO,QAAQ,CAACE,UAAT,GAAsB,CAAtB,GAA0BoS,WAArC,CAAA,GAAoDtS,QAAQ,CAACM,QAAAA;KAFlE,CAAA;AAID,GAAA;AAED;AACF;AACA;AACA;AACA;AACA;AAzHA,GAAA;;AAAA,EAAA,MAAA,CA0HE2R,wBA1HF,GA0HE,SAAA,wBAAA,CAAyBjW,QAAzB,EAAmC7C,MAAnC,EAA2C;IACzC,IAAI,CAACA,MAAL,EAAa;AACXA,MAAAA,MAAM,GAAG,IAAInB,KAAK,CAAC0Y,OAAV,EAAT,CAAA;AACD,KAAA;;IACDvX,MAAM,CAACtJ,CAAP,GAAW3N,aAAa,GAAG,CAACiE,IAAI,CAACC,GAAL,CAAS4V,QAAQ,CAAClK,QAAlB,CAAjB,GAA+C3L,IAAI,CAACI,GAAL,CAASyV,QAAQ,CAACjK,SAAlB,CAA1D,CAAA;AACAoH,IAAAA,MAAM,CAAClI,CAAP,GAAW/O,aAAa,GAAGiE,IAAI,CAACI,GAAL,CAASyV,QAAQ,CAAClK,QAAlB,CAA3B,CAAA;IACAqH,MAAM,CAACoZ,CAAP,GAAWrwB,aAAa,GAAGiE,IAAI,CAACC,GAAL,CAAS4V,QAAQ,CAAClK,QAAlB,CAAhB,GAA8C3L,IAAI,CAACC,GAAL,CAAS4V,QAAQ,CAACjK,SAAlB,CAAzD,CAAA;AACA,IAAA,OAAOoH,MAAP,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AACA;AAxIA,GAAA;;AAAA,EAAA,MAAA,CAyIEgZ,wBAzIF,GAyIE,SAAyBhZ,wBAAAA,CAAAA,MAAzB,EAAiC;AAC/B,IAAA,IAAMqZ,GAAG,GAAGrsB,IAAI,CAAC0L,IAAL,CAAUsH,MAAM,CAAClI,CAAP,GAAW9K,IAAI,CAACW,IAAL,CAAUqS,MAAM,CAACtJ,CAAP,GAAWsJ,MAAM,CAACtJ,CAAlB,GAAsBsJ,MAAM,CAAClI,CAAP,GAAWkI,MAAM,CAAClI,CAAxC,GAA4CkI,MAAM,CAACoZ,CAAP,GAAWpZ,MAAM,CAACoZ,CAAxE,CAArB,CAAZ,CAAA;AACA,IAAA,IAAME,KAAK,GAAGtsB,IAAI,CAACusB,KAAL,CAAWvZ,MAAM,CAACtJ,CAAlB,EAAqBsJ,MAAM,CAACoZ,CAA5B,CAAd,CAAA;IAEA,OAAO;AACLxgB,MAAAA,SAAS,EAAE0gB,KAAK,GAAG,CAAR,GAAY,CAACA,KAAb,GAAqBtsB,IAAI,CAACE,EAAL,GAAU,CAAV,GAAcosB,KADzC;AAEL3gB,MAAAA,QAAQ,EAAG3L,IAAI,CAACE,EAAL,GAAU,CAAV,GAAcmsB,GAAAA;KAF3B,CAAA;AAID,GAAA;AAED;AACF;AACA;AACA;AACA;AAvJA,GAAA;;AAAA,EAAA,MAAA,CAwJEG,qBAxJF,GAwJE,SAAsBC,qBAAAA,CAAAA,WAAtB,EAAmC;IACjC,IAAMC,eAAe,GAAG,IAAA,CAAKC,gBAAL,CAAsBF,WAAtB,CAAmChnB,CAAAA,MAAnC,CAA0C,UAAA6G,CAAC,EAAA;AAAA,MAAA,OAAIA,CAAC,CAAC+B,MAAF,CAASue,QAAT,CAAkB3wB,cAAlB,CAAJ,CAAA;AAAA,KAA3C,CAAxB,CAAA;;IAEA,IAAIywB,eAAe,CAAC/mB,MAApB,EAA4B;AAC1B,MAAA,OAAO+mB,eAAe,CAAC,CAAD,CAAf,CAAmBnB,KAA1B,CAAA;AACD,KAFD,MAGK;AACH,MAAA,OAAO,IAAP,CAAA;AACD,KAAA;AACF,GAAA;AAED;AACF;AACA;AACA;AACA;AAvKA,GAAA;;AAAA,EAAA,MAAA,CAwKEsB,qBAxKF,GAwKE,SAAsB7Z,qBAAAA,CAAAA,MAAtB,EAA8B;AAC5B,IAAA,IAAM8Z,WAAW,GAAG9Z,MAAM,CAAC9E,KAAP,EAApB,CAAA;IACA4e,WAAW,CAACC,OAAZ,CAAoB,IAAA,CAAKzyB,GAAL,CAASqxB,QAAT,CAAkBqB,MAAtC,CAAA,CAAA;IAEA,OAAO;MACLtjB,CAAC,EAAE1J,IAAI,CAACooB,KAAL,CAAW,CAAC0E,WAAW,CAACpjB,CAAZ,GAAgB,CAAjB,IAAsB,CAAtB,GAA0B,IAAKrB,CAAAA,IAAL,CAAUsQ,IAAV,CAAejU,KAApD,CADE;AAELoG,MAAAA,CAAC,EAAE9K,IAAI,CAACooB,KAAL,CAAW,CAAC,IAAI0E,WAAW,CAAChiB,CAAjB,IAAsB,CAAtB,GAA0B,IAAA,CAAKzC,IAAL,CAAUsQ,IAAV,CAAehU,MAApD,CAAA;KAFL,CAAA;AAID,GAAA;AAED;AACF;AACA;AACA;AACA;AAtLA,GAAA;;AAAA,EAAA,MAAA,CAuLEsoB,6BAvLF,GAuLE,SAA8BpX,6BAAAA,CAAAA,QAA9B,EAAwC;IACtC,OAAO,IAAA,CAAKgX,qBAAL,CAA2B,IAAKf,CAAAA,wBAAL,CAA8BjW,QAA9B,EAAwCyU,OAAxC,CAA3B,CAAP,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AACA;AA/LA,GAAA;;AAAA,EAAA,MAAA,CAgMEqC,gBAhMF,GAgME,SAAiBF,gBAAAA,CAAAA,WAAjB,EAA8B;AAC5BrC,IAAAA,OAAO,CAAC1gB,CAAR,GAAY,CAAA,GAAI+iB,WAAW,CAAC/iB,CAAhB,GAAoB,IAAA,CAAKrB,IAAL,CAAUsQ,IAAV,CAAejU,KAAnC,GAA2C,CAAvD,CAAA;AACA0lB,IAAAA,OAAO,CAACtf,CAAR,GAAY,CAAC,CAAD,GAAK2hB,WAAW,CAAC3hB,CAAjB,GAAqB,KAAKzC,IAAL,CAAUsQ,IAAV,CAAehU,MAApC,GAA6C,CAAzD,CAAA;AAEA,IAAA,IAAA,CAAKrK,GAAL,CAASqxB,QAAT,CAAkBuB,SAAlB,CAA4BC,aAA5B,CAA0C/C,OAA1C,EAAmD,IAAK9vB,CAAAA,GAAL,CAASqxB,QAAT,CAAkBqB,MAArE,CAAA,CAAA;IAEA,OAAO,IAAA,CAAK1yB,GAAL,CAASqxB,QAAT,CAAkBuB,SAAlB,CAA4BE,gBAA5B,CAA6C,IAAK9yB,CAAAA,GAAL,CAASqxB,QAAT,CAAkB0B,KAAlB,CAAwBpR,QAArE,EAA+E,IAA/E,CACJxW,CAAAA,MADI,CACG,UAAA6G,CAAC,EAAA;AAAA,MAAA,OAAI,CAAC,CAACA,CAAC,CAAC+B,MAAF,CAASue,QAAf,CAAA;AAAA,KADJ,CAAP,CAAA;AAED,GAAA;AAED;AACF;AACA;AACA;AACA;AA9MA,GAAA;;AAAA,EAAA,MAAA,CA+MEzb,aA/MF,GA+ME,SAAc0E,aAAAA,CAAAA,QAAd,EAAwB;IACtB,IAAIA,QAAQ,CAACnM,CAAT,KAAezE,SAAf,IAA4B4Q,QAAQ,CAAC/K,CAAT,KAAe7F,SAA/C,EAA0D;AACxD,MAAA,OAAO,IAAKqmB,CAAAA,8BAAL,CAAoCzV,QAApC,CAAP,CAAA;AACD,KAFD,MAGK;MACH,OAAO;AACLjK,QAAAA,SAAS,EAAEoG,UAAU,CAAC6D,QAAQ,CAACjK,SAAV,CADhB;AAELD,QAAAA,QAAQ,EAAGqG,UAAU,CAAC6D,QAAQ,CAAClK,QAAV,EAAoB,IAApB,CAAA;OAFvB,CAAA;AAID,KAAA;AACF,GAAA;AAED;AACF;AACA;AACA;AACA;AA/NA,GAAA;;AAAA,EAAA,MAAA,CAgOE2hB,qBAhOF,GAgOE,SAAsB1I,qBAAAA,CAAAA,gBAAtB,EAAwC;IACtC,OAAO;AACL2I,MAAAA,GAAG,EAAGvb,UAAU,CAAC,CAAA4S,gBAAgB,IAAA,IAAhB,GAAAA,KAAAA,CAAAA,GAAAA,gBAAgB,CAAE2I,GAAlB,KAAyB,CAA1B,CADX;AAELC,MAAAA,IAAI,EAAExb,UAAU,CAAC,CAAA4S,gBAAgB,IAAhB,IAAA,GAAA,KAAA,CAAA,GAAAA,gBAAgB,CAAE4I,IAAlB,KAA0B,CAA3B,EAA8B,IAA9B,CAFX;AAGLxX,MAAAA,IAAI,EAAEhE,UAAU,CAAC,CAAA4S,gBAAgB,IAAhB,IAAA,GAAA,KAAA,CAAA,GAAAA,gBAAgB,CAAE5O,IAAlB,KAA0B,CAA3B,EAA8B,IAA9B,EAAoC,KAApC,CAAA;KAHlB,CAAA;AAKD,GAAA;AAED;AACF;AACA;AACA;AACA;AA5OA,GAAA;;AAAA,EAAA,MAAA,CA6OEyX,iBA7OF,GA6OE,SAAkB5T,iBAAAA,CAAAA,QAAlB,EAA4B;IAC1B,OAAO;AACL0T,MAAAA,GAAG,EAAG1b,KAAK,CAACC,SAAN,CAAgBC,QAAhB,CAAyB,CAAA8H,QAAQ,IAAA,IAAR,YAAAA,QAAQ,CAAEO,WAAV,KAAyB,CAAlD,CADD;AAELoT,MAAAA,IAAI,EAAE3b,KAAK,CAACC,SAAN,CAAgBC,QAAhB,CAAyB,CAAA8H,QAAQ,IAAA,IAAR,YAAAA,QAAQ,CAAEQ,SAAV,KAAuB,CAAhD,CAFD;AAGLrE,MAAAA,IAAI,EAAEnE,KAAK,CAACC,SAAN,CAAgBC,QAAhB,CAAyB,CAAA8H,QAAQ,QAAR,GAAAA,KAAAA,CAAAA,GAAAA,QAAQ,CAAES,QAAV,KAAsB,CAA/C,CAAA;KAHR,CAAA;GA9OJ,CAAA;;AAAA,EAAA,OAAA,UAAA,CAAA;AAAA,CAAA,CAAgC6P,eAAhC,CAAA;;;;;;ACOA;AACA;AACA;AACA;AACA;;AACA,IAAauD,aAAb,gBAAA,UAAA,gBAAA,EAAA;AAAA,EAAA,cAAA,CAAA,aAAA,EAAA,gBAAA,CAAA,CAAA;;AAEE;AACF;AACA;AACE,EAAA,SAAA,aAAA,CAAYpzB,GAAZ,EAAiB;AAAA,IAAA,IAAA,KAAA,CAAA;;AACf,IAAA,KAAA,GAAA,gBAAA,CAAA,IAAA,CAAA,IAAA,EAAMA,GAAN,CAAA,IAAA,IAAA,CAAA;AAEA;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACI,IAAA,KAAA,CAAKqzB,KAAL,GAAa;AACXC,MAAAA,aAAa,EAAMnyB,cAAc,GAAGoG,MAAM,CAACE,UADhC;AAEX8rB,MAAAA,eAAe,EAAI,KAFR;AAGXxV,MAAAA,MAAM,EAAa,KAHR;AAIXyV,MAAAA,OAAO,EAAY,KAJR;AAKXC,MAAAA,WAAW,EAAQ,CALR;AAMXC,MAAAA,WAAW,EAAQ,CANR;AAOXzE,MAAAA,MAAM,EAAa,CAPR;AAQXC,MAAAA,MAAM,EAAa,CARR;AASXyE,MAAAA,YAAY,EAAO,EATR;AAUXC,MAAAA,SAAS,EAAU,CAVR;MAWXzE,UAAU,EAAS,IAAIzH,YAAJ,EAXR;AAYXmM,MAAAA,WAAW,EAAQ,KAZR;AAaXC,MAAAA,YAAY,EAAO,IAbR;AAcXC,MAAAA,eAAe,EAAI,IAdR;AAeXC,MAAAA,gBAAgB,EAAG,IAfR;AAgBXC,MAAAA,iBAAiB,EAAE,IAhBR;AAiBXC,MAAAA,eAAe,EAAI,IAAA;KAjBrB,CAAA;AAoBA;AACJ;AACA;AACA;AACA;;IACI,KAAKC,CAAAA,UAAL,GAAkBjiB,QAAQ,CAAC,YAAA;AAAA,MAAA,OAAM,KAAKlS,CAAAA,GAAL,CAASo0B,QAAT,EAAN,CAAA;KAAD,EAA4B,EAA5B,CAA1B,CAAA;AAhDe,IAAA,OAAA,KAAA,CAAA;AAiDhB,GAAA;AAED;AACF;AACA;AACA;;;AA3DA,EAAA,IAAA,MAAA,GAAA,aAAA,CAAA,SAAA,CAAA;;EAAA,MA4DEzK,CAAAA,IA5DF,GA4DE,SAAO,IAAA,GAAA;AACLzhB,IAAAA,MAAM,CAAC0B,gBAAP,CAAwB,QAAxB,EAAkC,IAAlC,CAAA,CAAA;AACA1B,IAAAA,MAAM,CAAC0B,gBAAP,CAAwB,SAAxB,EAAmC,IAAnC,CAAA,CAAA;AACA1B,IAAAA,MAAM,CAAC0B,gBAAP,CAAwB,OAAxB,EAAiC,IAAjC,CAAA,CAAA;IACA,IAAK5J,CAAAA,GAAL,CAAS4c,SAAT,CAAmBhT,gBAAnB,CAAoC,YAApC,EAAkD,IAAlD,CAAA,CAAA;IACA,IAAK5J,CAAAA,GAAL,CAAS4c,SAAT,CAAmBhT,gBAAnB,CAAoC,WAApC,EAAiD,IAAjD,CAAA,CAAA;IACA,IAAK5J,CAAAA,GAAL,CAAS4c,SAAT,CAAmBhT,gBAAnB,CAAoC,YAApC,EAAkD,IAAlD,CAAA,CAAA;IACA,IAAK5J,CAAAA,GAAL,CAAS4c,SAAT,CAAmBhT,gBAAnB,CAAoC,WAApC,EAAiD,IAAjD,CAAA,CAAA;AACA1B,IAAAA,MAAM,CAAC0B,gBAAP,CAAwB,SAAxB,EAAmC,IAAnC,CAAA,CAAA;IACA,IAAK5J,CAAAA,GAAL,CAAS4c,SAAT,CAAmBhT,gBAAnB,CAAoC,YAApC,EAAkD,IAAlD,CAAA,CAAA;IACA,IAAK5J,CAAAA,GAAL,CAAS4c,SAAT,CAAmBhT,gBAAnB,CAAoC,WAApC,EAAiD,IAAjD,CAAA,CAAA;AACA1B,IAAAA,MAAM,CAAC0B,gBAAP,CAAwB,UAAxB,EAAoC,IAApC,CAAA,CAAA;IACA,IAAK5J,CAAAA,GAAL,CAAS4c,SAAT,CAAmBhT,gBAAnB,CAAoCrC,MAAM,CAACM,eAA3C,EAA4D,IAA5D,CAAA,CAAA;;IAEA,IAAIN,MAAM,CAACO,eAAX,EAA4B;AAC1BY,MAAAA,QAAQ,CAACkB,gBAAT,CAA0BrC,MAAM,CAACO,eAAjC,EAAkD,IAAlD,CAAA,CAAA;AACD,KAAA;AACF,GAAA;AAED;AACF;AACA;AAjFA,GAAA;;EAAA,MAkFE7H,CAAAA,OAlFF,GAkFE,SAAU,OAAA,GAAA;AACRiI,IAAAA,MAAM,CAAC6B,mBAAP,CAA2B,QAA3B,EAAqC,IAArC,CAAA,CAAA;AACA7B,IAAAA,MAAM,CAAC6B,mBAAP,CAA2B,SAA3B,EAAsC,IAAtC,CAAA,CAAA;AACA7B,IAAAA,MAAM,CAAC6B,mBAAP,CAA2B,OAA3B,EAAoC,IAApC,CAAA,CAAA;IACA,IAAK/J,CAAAA,GAAL,CAAS4c,SAAT,CAAmB7S,mBAAnB,CAAuC,YAAvC,EAAqD,IAArD,CAAA,CAAA;IACA,IAAK/J,CAAAA,GAAL,CAAS4c,SAAT,CAAmB7S,mBAAnB,CAAuC,WAAvC,EAAoD,IAApD,CAAA,CAAA;IACA,IAAK/J,CAAAA,GAAL,CAAS4c,SAAT,CAAmB7S,mBAAnB,CAAuC,YAAvC,EAAqD,IAArD,CAAA,CAAA;IACA,IAAK/J,CAAAA,GAAL,CAAS4c,SAAT,CAAmB7S,mBAAnB,CAAuC,WAAvC,EAAoD,IAApD,CAAA,CAAA;AACA7B,IAAAA,MAAM,CAAC6B,mBAAP,CAA2B,SAA3B,EAAsC,IAAtC,CAAA,CAAA;IACA,IAAK/J,CAAAA,GAAL,CAAS4c,SAAT,CAAmB7S,mBAAnB,CAAuC,YAAvC,EAAqD,IAArD,CAAA,CAAA;IACA,IAAK/J,CAAAA,GAAL,CAAS4c,SAAT,CAAmB7S,mBAAnB,CAAuC,WAAvC,EAAoD,IAApD,CAAA,CAAA;AACA7B,IAAAA,MAAM,CAAC6B,mBAAP,CAA2B,UAA3B,EAAuC,IAAvC,CAAA,CAAA;IACA,IAAK/J,CAAAA,GAAL,CAAS4c,SAAT,CAAmB7S,mBAAnB,CAAuCxC,MAAM,CAACM,eAA9C,EAA+D,IAA/D,CAAA,CAAA;;IAEA,IAAIN,MAAM,CAACO,eAAX,EAA4B;AAC1BY,MAAAA,QAAQ,CAACqB,mBAAT,CAA6BxC,MAAM,CAACO,eAApC,EAAqD,IAArD,CAAA,CAAA;AACD,KAAA;;AAEDkC,IAAAA,YAAY,CAAC,IAAA,CAAKqpB,KAAL,CAAWU,eAAZ,CAAZ,CAAA;AACA/pB,IAAAA,YAAY,CAAC,IAAA,CAAKqpB,KAAL,CAAWW,gBAAZ,CAAZ,CAAA;AACAhqB,IAAAA,YAAY,CAAC,IAAA,CAAKqpB,KAAL,CAAWY,iBAAZ,CAAZ,CAAA;AACAjqB,IAAAA,YAAY,CAAC,IAAA,CAAKqpB,KAAL,CAAWa,eAAZ,CAAZ,CAAA;AAEA,IAAA,OAAO,KAAKb,KAAZ,CAAA;;AAEA,IAAA,gBAAA,CAAA,SAAA,CAAMpzB,OAAN,CAAA,IAAA,CAAA,IAAA,CAAA,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AACA;AAlHA,GAAA;;AAAA,EAAA,MAAA,CAmHEgd,WAnHF,GAmHE,SAAYW,WAAAA,CAAAA,GAAZ,EAAiB;AACf;IACA,QAAQA,GAAG,CAACV,IAAZ;AACE;AACA,MAAA,KAAK,QAAL;AAAiB,QAAA,IAAA,CAAKiX,UAAL,EAAA,CAAA;;AAAmB,QAAA,MAAA;;AACpC,MAAA,KAAK,SAAL;QAAiB,IAAKE,CAAAA,WAAL,CAAiBzW,GAAjB,CAAA,CAAA;;AAAuB,QAAA,MAAA;;AACxC,MAAA,KAAK,OAAL;AAAiB,QAAA,IAAA,CAAK0W,SAAL,EAAA,CAAA;;AAAkB,QAAA,MAAA;;AACnC,MAAA,KAAK,SAAL;QAAiB,IAAK5W,CAAAA,WAAL,CAAiBE,GAAjB,CAAA,CAAA;;AAAuB,QAAA,MAAA;;AACxC,MAAA,KAAK,UAAL;QAAiB,IAAKD,CAAAA,YAAL,CAAkBC,GAAlB,CAAA,CAAA;;AAAwB,QAAA,MAAA;;MACzC,KAAKrW,MAAM,CAACO,eAAZ;AAA6B,QAAA,IAAA,CAAKysB,mBAAL,EAAA,CAAA;;AAA4B,QAAA,MAAA;AACzD;AARF,KAAA;AAUA;;;IAEA,IAAI,CAAC/nB,UAAU,CAACoR,GAAG,CAACvK,MAAL,EAAa,qBAAb,CAAf,EAAoD;AAClD;MACA,QAAQuK,GAAG,CAACV,IAAZ;AACE;AACA,QAAA,KAAK,WAAL;UAAmB,IAAKE,CAAAA,aAAL,CAAmBQ,GAAnB,CAAA,CAAA;;AAAyB,UAAA,MAAA;;AAC5C,QAAA,KAAK,YAAL;UAAmB,IAAKP,CAAAA,cAAL,CAAoBO,GAApB,CAAA,CAAA;;AAA0B,UAAA,MAAA;;AAC7C,QAAA,KAAK,YAAL;UAAmB,IAAKN,CAAAA,cAAL,CAAoBM,GAApB,CAAA,CAAA;;AAA0B,UAAA,MAAA;;AAC7C,QAAA,KAAK,WAAL;UAAmB,IAAKJ,CAAAA,aAAL,CAAmBI,GAAnB,CAAA,CAAA;;AAAyB,UAAA,MAAA;;AAC5C,QAAA,KAAK,YAAL;UAAmB,IAAKL,CAAAA,cAAL,CAAoBK,GAApB,CAAA,CAAA;;AAA0B,UAAA,MAAA;;AAC7C,QAAA,KAAK,WAAL;UAAmB,IAAKH,CAAAA,aAAL,CAAmBG,GAAnB,CAAA,CAAA;;AAAyB,UAAA,MAAA;;QAC5C,KAAKrW,MAAM,CAACM,eAAZ;UAA6B,IAAK2sB,CAAAA,cAAL,CAAoB5W,GAApB,CAAA,CAAA;;AAA0B,UAAA,MAAA;AACvD;AATF,OAAA;AAWA;;AACD,KAAA;AACF,GAAA;AAED;AACF;AACA;AACA;AArJA,GAAA;;EAAA,MAsJE6W,CAAAA,cAtJF,GAsJE,SAAiB,cAAA,GAAA;AACf,IAAA,IAAA,CAAKpB,KAAL,CAAWE,eAAX,GAA6B,IAA7B,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AA7JA,GAAA;;EAAA,MA8JEmB,CAAAA,eA9JF,GA8JE,SAAkB,eAAA,GAAA;AAChB,IAAA,IAAA,CAAKrB,KAAL,CAAWE,eAAX,GAA6B,KAA7B,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AACA;AAtKA,GAAA;;AAAA,EAAA,MAAA,CAuKEc,WAvKF,GAuKE,SAAYrrB,WAAAA,CAAAA,CAAZ,EAAe;AACb,IAAA,IAAI,IAAK2V,CAAAA,MAAL,CAAYqM,iBAAhB,EAAmC;MACjC,IAAKqI,CAAAA,KAAL,CAAWQ,WAAX,GAAyB7qB,CAAC,CAAC2K,GAAF,KAAUnN,SAAS,CAACE,OAA7C,CAAA;;AAEA,MAAA,IAAI,IAAK2sB,CAAAA,KAAL,CAAWQ,WAAf,EAA4B;AAC1B7pB,QAAAA,YAAY,CAAC,IAAA,CAAKqpB,KAAL,CAAWa,eAAZ,CAAZ,CAAA;QACA,IAAKl0B,CAAAA,GAAL,CAAS20B,OAAT,CAAiBrS,IAAjB,CAAsBle,GAAG,CAACG,SAA1B,CAAA,CAAA;AACD,OAAA;AACF,KAAA;;AAED,IAAA,IAAMqwB,EAAE,GAAG,IAAK50B,CAAAA,GAAL,CAASsuB,OAAT,CAAiBlsB,MAAM,CAACY,SAAxB,EAAmCgG,CAAC,CAAC2K,GAArC,CAAX,CAAA;;AACA,IAAA,IAAIihB,EAAE,CAACC,kBAAH,EAAJ,EAA6B;AAC3B,MAAA,OAAA;AACD,KAAA;;AAED,IAAA,IAAI,CAAC,IAAA,CAAKxB,KAAL,CAAWE,eAAhB,EAAiC;AAC/B,MAAA,OAAA;AACD,KAAA;;IAED,IAAMuB,MAAM,GAAG,IAAA,CAAKnW,MAAL,CAAY+M,QAAZ,CAAqB1iB,CAAC,CAAC2K,GAAvB,CAAf,CAAA;;AACA,IAAA,IAAImhB,MAAM,KAAKlzB,OAAO,CAACO,iBAAvB,EAA0C;MACxC,IAAKnC,CAAAA,GAAL,CAAS2kB,gBAAT,EAAA,CAAA;KADF,MAGK,IAAImQ,MAAM,IAAI,CAAC,IAAKzB,CAAAA,KAAL,CAAWlE,UAAX,CAAsBxH,IAArC,EAA2C;MAC9C,IAAImN,MAAM,KAAKlzB,OAAO,CAACK,OAAnB,IAA8B6yB,MAAM,KAAKlzB,OAAO,CAACM,QAArD,EAA+D;QAC7D,IAAKlC,CAAAA,GAAL,CAASooB,SAAT,EAAA,CAAA;AACD,OAAA;AAED;;;AACA,MAAA,QAAQ0M,MAAR;AACE;QACA,KAAKlzB,OAAO,CAACC,aAAb;AAA4B,UAAA,IAAA,CAAK7B,GAAL,CAASoc,QAAT,CAAkBb,QAAlB,CAA2BG,IAA3B,CAAgC;AAACrK,YAAAA,QAAQ,EAAE,KAAA;WAA3C,CAAA,CAAA;AAAoD,UAAA,MAAA;;QAChF,KAAKzP,OAAO,CAACE,eAAb;AAA8B,UAAA,IAAA,CAAK9B,GAAL,CAASoc,QAAT,CAAkBb,QAAlB,CAA2BG,IAA3B,CAAgC;AAACrK,YAAAA,QAAQ,EAAE,IAAA;WAA3C,CAAA,CAAA;AAAoD,UAAA,MAAA;;QAClF,KAAKzP,OAAO,CAACG,iBAAb;AAAgC,UAAA,IAAA,CAAK/B,GAAL,CAASoc,QAAT,CAAkBb,QAAlB,CAA2BG,IAA3B,CAAgC;AAACpK,YAAAA,SAAS,EAAE,KAAA;WAA5C,CAAA,CAAA;AAAqD,UAAA,MAAA;;QACrF,KAAK1P,OAAO,CAACI,gBAAb;AAA+B,UAAA,IAAA,CAAKhC,GAAL,CAASoc,QAAT,CAAkBb,QAAlB,CAA2BG,IAA3B,CAAgC;AAACpK,YAAAA,SAAS,EAAE,IAAA;WAA5C,CAAA,CAAA;AAAoD,UAAA,MAAA;;QACnF,KAAK1P,OAAO,CAACK,OAAb;UAAsB,IAAKjC,CAAAA,GAAL,CAASoc,QAAT,CAAkBsM,IAAlB,CAAuBhN,IAAvB,CAA4B,KAA5B,CAAA,CAAA;AAAoC,UAAA,MAAA;;QAC1D,KAAK9Z,OAAO,CAACM,QAAb;UAAuB,IAAKlC,CAAAA,GAAL,CAASoc,QAAT,CAAkBsM,IAAlB,CAAuBhN,IAAvB,CAA4B,IAA5B,CAAA,CAAA;AAAmC,UAAA,MAAA;AAC1D;AARF,OAAA;AAUA;;;AAEA,MAAA,IAAA,CAAK2X,KAAL,CAAWlE,UAAX,CAAsBvH,IAAtB,EAAA,CAAA;AACD,KAAA;AACF,GAAA;AAED;AACF;AACA;AACA;AAvNA,GAAA;;EAAA,MAwNE0M,CAAAA,SAxNF,GAwNE,SAAY,SAAA,GAAA;AAAA,IAAA,IAAA,MAAA,GAAA,IAAA,CAAA;;AACV,IAAA,IAAA,CAAKjB,KAAL,CAAWQ,WAAX,GAAyB,KAAzB,CAAA;;AAEA,IAAA,IAAI,CAAC,IAAA,CAAKR,KAAL,CAAWE,eAAhB,EAAiC;AAC/B,MAAA,OAAA;AACD,KAAA;;AAED,IAAA,IAAA,CAAKF,KAAL,CAAWlE,UAAX,CAAsBrH,EAAtB,CAAyB,YAAM;AAC7B,MAAA,MAAI,CAAC9nB,GAAL,CAASoc,QAAT,CAAkBb,QAAlB,CAA2BK,IAA3B,EAAA,CAAA;;AACA,MAAA,MAAI,CAAC5b,GAAL,CAASoc,QAAT,CAAkBsM,IAAlB,CAAuB9M,IAAvB,EAAA,CAAA;;MACA,MAAI,CAAC5b,GAAL,CAAS0kB,cAAT,EAAA,CAAA;KAHF,CAAA,CAAA;AAKD,GAAA;AAED;AACF;AACA;AACA;AACA;AA1OA,GAAA;;AAAA,EAAA,MAAA,CA2OEtH,aA3OF,GA2OE,SAAcQ,aAAAA,CAAAA,GAAd,EAAmB;IACjB,IAAI,CAAC,IAAKe,CAAAA,MAAL,CAAYmM,SAAb,IAA0B,IAAKnM,CAAAA,MAAL,CAAYoM,aAA1C,EAAyD;AACvD,MAAA,OAAA;AACD,KAAA;;IAED,IAAKgK,CAAAA,WAAL,CAAiBnX,GAAjB,CAAA,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AACA;AAvPA,GAAA;;AAAA,EAAA,MAAA,CAwPEP,cAxPF,GAwPE,SAAeO,cAAAA,CAAAA,GAAf,EAAoB;IAClB,IAAI,CAAC,IAAKe,CAAAA,MAAL,CAAYmM,SAAb,IAA0B,CAAC,IAAKnM,CAAAA,MAAL,CAAYoM,aAA3C,EAA0D;AACxD,MAAA,OAAA;AACD,KAAA;;IAED,IAAKgK,CAAAA,WAAL,CAAiBnX,GAAjB,CAAA,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AACA;AApQA,GAAA;;AAAA,EAAA,MAAA,CAqQEF,WArQF,GAqQE,SAAYE,WAAAA,CAAAA,GAAZ,EAAiB;IACf,IAAI,CAAC,IAAKe,CAAAA,MAAL,CAAYmM,SAAb,IAA0B,IAAKnM,CAAAA,MAAL,CAAYoM,aAA1C,EAAyD;AACvD,MAAA,OAAA;AACD,KAAA;;IAED,IAAKiK,CAAAA,UAAL,CAAgBpX,GAAhB,CAAA,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AACA;AAjRA,GAAA;;AAAA,EAAA,MAAA,CAkREN,cAlRF,GAkRE,SAAeM,cAAAA,CAAAA,GAAf,EAAoB;IAClB,IAAI,CAAC,IAAKe,CAAAA,MAAL,CAAYmM,SAAb,IAA0B,CAAC,IAAKnM,CAAAA,MAAL,CAAYoM,aAA3C,EAA0D;AACxD,MAAA,OAAA;AACD,KAAA;;IAED,IAAKiK,CAAAA,UAAL,CAAgBpX,GAAhB,CAAA,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AACA;AA9RA,GAAA;;AAAA,EAAA,MAAA,CA+REJ,aA/RF,GA+RE,SAAcI,aAAAA,CAAAA,GAAd,EAAmB;AACjB,IAAA,IAAI,IAAKe,CAAAA,MAAL,CAAYmM,SAAhB,EAA2B;AACzB,MAAA,IAAIlN,GAAG,CAAC0J,OAAJ,KAAgB,CAApB,EAAuB;AACrB1J,QAAAA,GAAG,CAACkR,cAAJ,EAAA,CAAA;;QACA,IAAKmG,CAAAA,MAAL,CAAYrX,GAAZ,CAAA,CAAA;AACD,OAHD,MAIK,IAAI,IAAA,CAAKe,MAAL,CAAYoM,aAAhB,EAA+B;QAClC,IAAKmK,CAAAA,cAAL,CAAoBtX,GAApB,CAAA,CAAA;AACD,OAAA;AACF,KAAA;;IAED,IAAI,CAAC/J,OAAO,CAAC,IAAA,CAAK9F,IAAL,CAAUonB,gBAAX,CAAZ,EAA0C;MACxC,IAAMC,SAAS,GAAGvoB,WAAW,CAAC,KAAK7M,GAAL,CAAS4c,SAAV,CAA7B,CAAA;AAEA,MAAA,IAAMuV,WAAW,GAAG;AAClB/iB,QAAAA,CAAC,EAAEwO,GAAG,CAAC+R,OAAJ,GAAcyF,SAAS,CAACtoB,IADT;AAElB0D,QAAAA,CAAC,EAAEoN,GAAG,CAACgS,OAAJ,GAAcwF,SAAS,CAACroB,GAAAA;OAF7B,CAAA;MAKA,IAAMsoB,aAAa,GAAG,IAAA,CAAKr1B,GAAL,CAASs1B,UAAT,CAAoBjD,gBAApB,CAAqCF,WAArC,CAAtB,CAAA;;MAEA,IAAMoD,IAAI,GAAG,SAAPA,IAAO,CAACC,QAAD,EAAW7hB,GAAX,EAAgBuJ,IAAhB,EAAyB;QACpCsY,QAAQ,CAACC,QAAT,CAAkBxY,WAAlB,CAA8B,IAAIyY,WAAJ,CAAgBxY,IAAhB,EAAsB;AAClDxO,UAAAA,MAAM,EAAE;AACNinB,YAAAA,aAAa,EAAE/X,GADT;YAEN7J,MAAM,EAASyhB,QAAQ,CAACzhB,MAFlB;YAGNtJ,IAAI,EAAW+qB,QAAQ,CAACzhB,MAAT,CAAgBue,QAAhB,CAAyB3e,GAAzB,CAHT;AAINwe,YAAAA,WAAW,EAAIA,WAAAA;AAJT,WAAA;AAD0C,SAAtB,CAA9B,CAAA,CAAA;OADF,CAAA;;MAWAre,IAAI,CAAC,IAAK/F,CAAAA,IAAL,CAAUonB,gBAAX,EAA6B,UAACK,QAAD,EAAW7hB,GAAX,EAAmB;AAClD,QAAA,IAAMiiB,YAAY,GAAGP,aAAa,CAACQ,IAAd,CAAmB,UAAA7jB,CAAC,EAAA;AAAA,UAAA,OAAIA,CAAC,CAAC+B,MAAF,CAASue,QAAT,CAAkB3e,GAAlB,CAAJ,CAAA;AAAA,SAApB,CAArB,CAAA;;AAEA,QAAA,IAAIiiB,YAAJ,EAAkB;UAChB,IAAIJ,QAAQ,CAACzhB,MAAT,IAAmB6hB,YAAY,CAAC7hB,MAAb,KAAwByhB,QAAQ,CAACzhB,MAAxD,EAAgE;YAC9DwhB,IAAI,CAACC,QAAD,EAAW7hB,GAAX,EAAgB3P,aAAa,CAACG,YAA9B,CAAJ,CAAA;YACA,OAAOqxB,QAAQ,CAACzhB,MAAhB,CAAA;AACD,WAAA;;AAED,UAAA,IAAI,CAACyhB,QAAQ,CAACzhB,MAAd,EAAsB;AACpByhB,YAAAA,QAAQ,CAACzhB,MAAT,GAAkB6hB,YAAY,CAAC7hB,MAA/B,CAAA;YACAwhB,IAAI,CAACC,QAAD,EAAW7hB,GAAX,EAAgB3P,aAAa,CAACC,YAA9B,CAAJ,CAAA;AACD,WAHD,MAIK;YACHsxB,IAAI,CAACC,QAAD,EAAW7hB,GAAX,EAAgB3P,aAAa,CAACE,YAA9B,CAAJ,CAAA;AACD,WAAA;AACF,SAbD,MAcK,IAAIsxB,QAAQ,CAACzhB,MAAb,EAAqB;UACxBwhB,IAAI,CAACC,QAAD,EAAW7hB,GAAX,EAAgB3P,aAAa,CAACG,YAA9B,CAAJ,CAAA;UACA,OAAOqxB,QAAQ,CAACzhB,MAAhB,CAAA;AACD,SAAA;AACF,OArBG,CAAJ,CAAA;AAsBD,KAAA;AACF,GAAA;AAED;AACF;AACA;AACA;AACA;AA5VA,GAAA;;AAAA,EAAA,MAAA,CA6VEwJ,cA7VF,GA6VE,SAAeK,cAAAA,CAAAA,GAAf,EAAoB;AAAA,IAAA,IAAA,MAAA,GAAA,IAAA,CAAA;;AAClB,IAAA,IAAI,CAAC,IAAA,CAAKe,MAAL,CAAYmM,SAAjB,EAA4B;AAC1B,MAAA,OAAA;AACD,KAAA;;AAED,IAAA,IAAIlN,GAAG,CAAC8R,OAAJ,CAAYrkB,MAAZ,KAAuB,CAA3B,EAA8B;AAC5B,MAAA,IAAI,CAAC,IAAA,CAAKsT,MAAL,CAAYsM,mBAAjB,EAAsC;AACpC,QAAA,IAAA,CAAK8J,WAAL,CAAiBnX,GAAG,CAAC8R,OAAJ,CAAY,CAAZ,CAAjB,CAAA,CAAA;;QACA9R,GAAG,CAACkR,cAAJ,EAAA,CAFoC;AAGrC,OAAA;;AAED,MAAA,IAAI,CAAC,IAAA,CAAK/gB,IAAL,CAAUimB,gBAAf,EAAiC;AAC/B,QAAA,IAAA,CAAKjmB,IAAL,CAAUimB,gBAAV,GAA6BlqB,UAAU,CAAC,YAAM;UAC5C,MAAI,CAACgsB,OAAL,CAAalY,GAAG,CAAC8R,OAAJ,CAAY,CAAZ,CAAb,EAA6B,IAA7B,CAAA,CAAA;;AACA,UAAA,MAAI,CAAC3hB,IAAL,CAAUimB,gBAAV,GAA6B,IAA7B,CAAA;SAFqC,EAGpC3yB,eAHoC,CAAvC,CAAA;AAID,OAAA;KAXH,MAaK,IAAIuc,GAAG,CAAC8R,OAAJ,CAAYrkB,MAAZ,KAAuB,CAA3B,EAA8B;AACjC,MAAA,IAAA,CAAK0qB,iBAAL,EAAA,CAAA;;AACA,MAAA,IAAA,CAAKC,yBAAL,EAAA,CAAA;;MACA,IAAKC,CAAAA,eAAL,CAAqBrY,GAArB,CAAA,CAAA;;AACAA,MAAAA,GAAG,CAACkR,cAAJ,EAAA,CAAA;AACD,KAAA;AACF,GAAA;AAED;AACF;AACA;AACA;AACA;AA3XA,GAAA;;AAAA,EAAA,MAAA,CA4XEnR,YA5XF,GA4XE,SAAaC,YAAAA,CAAAA,GAAb,EAAkB;AAChB,IAAA,IAAI,CAAC,IAAA,CAAKe,MAAL,CAAYmM,SAAjB,EAA4B;AAC1B,MAAA,OAAA;AACD,KAAA;;AAED,IAAA,IAAA,CAAKiL,iBAAL,EAAA,CAAA;;AACA,IAAA,IAAA,CAAKC,yBAAL,EAAA,CAAA;;AAEA,IAAA,IAAIpY,GAAG,CAAC8R,OAAJ,CAAYrkB,MAAZ,KAAuB,CAA3B,EAA8B;AAC5B,MAAA,IAAA,CAAK6qB,cAAL,EAAA,CAAA;KADF,MAGK,IAAItY,GAAG,CAAC8R,OAAJ,CAAYrkB,MAAZ,KAAuB,CAA3B,EAA8B;AACjC,MAAA,IAAA,CAAK2pB,UAAL,CAAgBpX,GAAG,CAACE,cAAJ,CAAmB,CAAnB,CAAhB,CAAA,CAAA;AACD,KAAA;AACF,GAAA;AAED;AACF;AACA;AACA;AACA;AAhZA,GAAA;;AAAA,EAAA,MAAA,CAiZEL,aAjZF,GAiZE,SAAcG,aAAAA,CAAAA,GAAd,EAAmB;AAAA,IAAA,IAAA,MAAA,GAAA,IAAA,CAAA;;AACjB,IAAA,IAAI,CAAC,IAAA,CAAKe,MAAL,CAAYmM,SAAjB,EAA4B;AAC1B,MAAA,OAAA;AACD,KAAA;;AAED,IAAA,IAAA,CAAKiL,iBAAL,EAAA,CAAA;;AAEA,IAAA,IAAInY,GAAG,CAAC8R,OAAJ,CAAYrkB,MAAZ,KAAuB,CAA3B,EAA8B;AAC5B,MAAA,IAAI,IAAKsT,CAAAA,MAAL,CAAYsM,mBAAhB,EAAqC;AACnC,QAAA,IAAI,CAAC,IAAA,CAAKld,IAAL,CAAUkmB,iBAAf,EAAkC;AAChC,UAAA,IAAA,CAAKlmB,IAAL,CAAUkmB,iBAAV,GAA8BnqB,UAAU,CAAC,YAAM;AAC7C,YAAA,MAAI,CAAC9J,GAAL,CAAS20B,OAAT,CAAiBpS,IAAjB,CAAsB;cACpBvhB,EAAE,EAAKoD,GAAG,CAACE,WADS;AAEpBqqB,cAAAA,KAAK,EAAEwH,WAFa;AAGpBvH,cAAAA,IAAI,EAAG,MAAI,CAACjQ,MAAL,CAAYyE,IAAZ,CAAiBmI,UAAAA;aAH1B,CAAA,CAAA;WADsC,EAMrCjqB,uBANqC,CAAxC,CAAA;AAOD,SAAA;AACF,OAVD,MAWK;AACHsc,QAAAA,GAAG,CAACkR,cAAJ,EAAA,CAAA;;AACA,QAAA,IAAA,CAAKmG,MAAL,CAAYrX,GAAG,CAAC8R,OAAJ,CAAY,CAAZ,CAAZ,CAAA,CAAA;AACD,OAAA;KAfH,MAiBK,IAAI9R,GAAG,CAAC8R,OAAJ,CAAYrkB,MAAZ,KAAuB,CAA3B,EAA8B;AACjCuS,MAAAA,GAAG,CAACkR,cAAJ,EAAA,CAAA;;MACA,IAAKsH,CAAAA,UAAL,CAAgBxY,GAAhB,CAAA,CAAA;;AACA,MAAA,IAAA,CAAKoY,yBAAL,EAAA,CAAA;AACD,KAAA;AACF,GAAA;AAED;AACF;AACA;AACA;AAnbA,GAAA;;EAAA,MAobED,CAAAA,iBApbF,GAobE,SAAoB,iBAAA,GAAA;AAClB,IAAA,IAAI,IAAKhoB,CAAAA,IAAL,CAAUimB,gBAAd,EAAgC;AAC9BhqB,MAAAA,YAAY,CAAC,IAAA,CAAK+D,IAAL,CAAUimB,gBAAX,CAAZ,CAAA;AACA,MAAA,IAAA,CAAKjmB,IAAL,CAAUimB,gBAAV,GAA6B,IAA7B,CAAA;AACD,KAAA;AACF,GAAA;AAED;AACF;AACA;AACA;AA9bA,GAAA;;EAAA,MA+bEgC,CAAAA,yBA/bF,GA+bE,SAA4B,yBAAA,GAAA;AAC1B,IAAA,IAAI,IAAKjoB,CAAAA,IAAL,CAAUkmB,iBAAd,EAAiC;AAC/BjqB,MAAAA,YAAY,CAAC,IAAA,CAAK+D,IAAL,CAAUkmB,iBAAX,CAAZ,CAAA;AACA,MAAA,IAAA,CAAKlmB,IAAL,CAAUkmB,iBAAV,GAA8B,IAA9B,CAAA;AACD,KAAA;;IACD,IAAKj0B,CAAAA,GAAL,CAAS20B,OAAT,CAAiBrS,IAAjB,CAAsBle,GAAG,CAACE,WAA1B,CAAA,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AACA;AA3cA,GAAA;;AAAA,EAAA,MAAA,CA4cEkwB,cA5cF,GA4cE,SAAe5W,cAAAA,CAAAA,GAAf,EAAoB;AAAA,IAAA,IAAA,MAAA,GAAA,IAAA,CAAA;;AAClB,IAAA,IAAI,CAAC,IAAA,CAAKe,MAAL,CAAYkM,UAAjB,EAA6B;AAC3B,MAAA,OAAA;AACD,KAAA;;IAED,IAAI,IAAA,CAAKlM,MAAL,CAAYqM,iBAAZ,IAAiC,CAAC,IAAKqI,CAAAA,KAAL,CAAWQ,WAAjD,EAA8D;AAC5D,MAAA,IAAA,CAAK7zB,GAAL,CAAS20B,OAAT,CAAiBpS,IAAjB,CAAsB;QACpBvhB,EAAE,EAAKoD,GAAG,CAACG,SADS;AAEpBoqB,QAAAA,KAAK,EAAE0H,cAFa;AAGpBzH,QAAAA,IAAI,EAAG,IAAA,CAAKjQ,MAAL,CAAYyE,IAAZ,CAAiBoI,QAAAA;OAH1B,CAAA,CAAA;AAMAxhB,MAAAA,YAAY,CAAC,IAAA,CAAKqpB,KAAL,CAAWa,eAAZ,CAAZ,CAAA;AACA,MAAA,IAAA,CAAKb,KAAL,CAAWa,eAAX,GAA6BpqB,UAAU,CAAC,YAAA;QAAA,OAAM,MAAI,CAAC9J,GAAL,CAAS20B,OAAT,CAAiBrS,IAAjB,CAAsBle,GAAG,CAACG,SAA1B,CAAN,CAAA;OAAD,EAA6ChD,gBAA7C,CAAvC,CAAA;AAEA,MAAA,OAAA;AACD,KAAA;;AAEDqc,IAAAA,GAAG,CAACkR,cAAJ,EAAA,CAAA;AACAlR,IAAAA,GAAG,CAACT,eAAJ,EAAA,CAAA;AAEA,IAAA,IAAMmZ,KAAK,GAAGroB,cAAc,CAAC2P,GAAD,CAAd,CAAoBrP,KAApB,GAA4B,CAA5B,GAAgC,IAAKoQ,CAAAA,MAAL,CAAY6L,SAA1D,CAAA;;IACA,IAAI8L,KAAK,KAAK,CAAd,EAAiB;MACf,IAAKt2B,CAAAA,GAAL,CAASoc,QAAT,CAAkBsM,IAAlB,CAAuBjN,IAAvB,CAA4B,CAAC6a,KAA7B,EAAoC,CAApC,CAAA,CAAA;AACD,KAAA;AACF,GAAA;AAED;AACF;AACA;AACA;AACA;AACA;AA5eA,GAAA;;AAAA,EAAA,MAAA,CA6eE/B,mBA7eF,GA6eE,SAAoBgC,mBAAAA,CAAAA,KAApB,EAA2B;AACzB,IAAA,IAAA,CAAKxoB,IAAL,CAAUud,UAAV,GAAuBiL,KAAK,KAAK5rB,SAAV,GAAsB4rB,KAAtB,GAA8BhpB,mBAAmB,CAAC,IAAA,CAAKvN,GAAL,CAAS4c,SAAV,CAAxE,CAAA;;AAEA,IAAA,IAAI,IAAK+B,CAAAA,MAAL,CAAY+M,QAAhB,EAA0B;AACxB,MAAA,IAAI,IAAK3d,CAAAA,IAAL,CAAUud,UAAd,EAA0B;QACxB,IAAKtrB,CAAAA,GAAL,CAASw2B,oBAAT,EAAA,CAAA;AACD,OAFD,MAGK;QACH,IAAKx2B,CAAAA,GAAL,CAASy2B,mBAAT,EAAA,CAAA;AACD,OAAA;AACF,KAAA;;IAED,IAAKz2B,CAAAA,GAAL,CAASsuB,OAAT,CAAiBlsB,MAAM,CAACQ,kBAAxB,EAA4C,IAAA,CAAKmL,IAAL,CAAUud,UAAtD,CAAA,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AACA;AAhgBA,GAAA;;AAAA,EAAA,MAAA,CAigBEyJ,WAjgBF,GAigBE,SAAYnX,WAAAA,CAAAA,GAAZ,EAAiB;AAAA,IAAA,IAAA,MAAA,GAAA,IAAA,CAAA;;AACf,IAAA,IAAA,CAAK5d,GAAL,CAASooB,SAAT,EACGhO,CAAAA,IADH,CACQ,YAAM;AACV,MAAA,MAAI,CAACiZ,KAAL,CAAWpE,MAAX,GAAoBrR,GAAG,CAAC+R,OAAxB,CAAA;AACA,MAAA,MAAI,CAAC0D,KAAL,CAAWnE,MAAX,GAAoBtR,GAAG,CAACgS,OAAxB,CAAA;MACA,MAAI,CAACyD,KAAL,CAAWI,WAAX,GAAyB,MAAI,CAACJ,KAAL,CAAWpE,MAApC,CAAA;MACA,MAAI,CAACoE,KAAL,CAAWK,WAAX,GAAyB,MAAI,CAACL,KAAL,CAAWnE,MAApC,CAAA;AACA,MAAA,MAAI,CAACmE,KAAL,CAAWtV,MAAX,GAAoB,IAApB,CAAA;AACA,MAAA,MAAI,CAACsV,KAAL,CAAWG,OAAX,GAAqB,KAArB,CAAA;AAEA,MAAA,MAAI,CAACH,KAAL,CAAWM,YAAX,CAAwBtoB,MAAxB,GAAiC,CAAjC,CAAA;;MACA,MAAI,CAACqrB,cAAL,CAAoB9Y,GAApB,CAAA,CAAA;KAVJ,CAAA,CAAA;AAYD,GAAA;AAED;AACF;AACA;AACA;AACA;AAphBA,GAAA;;AAAA,EAAA,MAAA,CAqhBEqY,eArhBF,GAqhBE,SAAgBrY,eAAAA,CAAAA,GAAhB,EAAqB;AAAA,IAAA,IAAA,MAAA,GAAA,IAAA,CAAA;;AACnB,IAAA,IAAA,CAAK5d,GAAL,CAASooB,SAAT,EACGhO,CAAAA,IADH,CACQ,YAAM;AACV,MAAA,IAAM9J,EAAE,GAAG;AAAElB,QAAAA,CAAC,EAAEwO,GAAG,CAAC8R,OAAJ,CAAY,CAAZ,EAAeC,OAApB;AAA6Bnf,QAAAA,CAAC,EAAEoN,GAAG,CAAC8R,OAAJ,CAAY,CAAZ,CAAeE,CAAAA,OAAAA;OAA1D,CAAA;AACA,MAAA,IAAMrf,EAAE,GAAG;AAAEnB,QAAAA,CAAC,EAAEwO,GAAG,CAAC8R,OAAJ,CAAY,CAAZ,EAAeC,OAApB;AAA6Bnf,QAAAA,CAAC,EAAEoN,GAAG,CAAC8R,OAAJ,CAAY,CAAZ,CAAeE,CAAAA,OAAAA;OAA1D,CAAA;MAEA,MAAI,CAACyD,KAAL,CAAWO,SAAX,GAAuBvjB,QAAQ,CAACC,EAAD,EAAKC,EAAL,CAA/B,CAAA;AACA,MAAA,MAAI,CAAC8iB,KAAL,CAAWpE,MAAX,GAAoB,CAAC3e,EAAE,CAAClB,CAAH,GAAOmB,EAAE,CAACnB,CAAX,IAAgB,CAApC,CAAA;AACA,MAAA,MAAI,CAACikB,KAAL,CAAWnE,MAAX,GAAoB,CAAC5e,EAAE,CAACE,CAAH,GAAOD,EAAE,CAACC,CAAX,IAAgB,CAApC,CAAA;MACA,MAAI,CAAC6iB,KAAL,CAAWI,WAAX,GAAyB,MAAI,CAACJ,KAAL,CAAWpE,MAApC,CAAA;MACA,MAAI,CAACoE,KAAL,CAAWK,WAAX,GAAyB,MAAI,CAACL,KAAL,CAAWnE,MAApC,CAAA;AACA,MAAA,MAAI,CAACmE,KAAL,CAAWtV,MAAX,GAAoB,IAApB,CAAA;AACA,MAAA,MAAI,CAACsV,KAAL,CAAWG,OAAX,GAAqB,IAArB,CAAA;KAXJ,CAAA,CAAA;AAaD,GAAA;AAED;AACF;AACA;AACA;AACA;AACA;AA1iBA,GAAA;;AAAA,EAAA,MAAA,CA2iBEwB,UA3iBF,GA2iBE,SAAWpX,UAAAA,CAAAA,GAAX,EAAgB;IACd,IAAK5d,CAAAA,GAAL,CAAS0kB,cAAT,EAAA,CAAA;;IAEA,IAAI,CAAClY,UAAU,CAACoR,GAAG,CAACvK,MAAL,EAAa,gBAAb,CAAf,EAA+C;AAC7C,MAAA,IAAA,CAAKggB,KAAL,CAAWtV,MAAX,GAAoB,KAApB,CAAA;AACA,MAAA,IAAA,CAAKsV,KAAL,CAAWM,YAAX,CAAwBtoB,MAAxB,GAAiC,CAAjC,CAAA;AACA,MAAA,OAAA;AACD,KAAA;;AAED,IAAA,IAAI,IAAKgoB,CAAAA,KAAL,CAAWtV,MAAf,EAAuB;AACrB;AACA,MAAA,IAAIrY,IAAI,CAACqL,GAAL,CAAS6M,GAAG,CAAC+R,OAAJ,GAAc,IAAA,CAAK0D,KAAL,CAAWI,WAAlC,CAAiD,GAAA,IAAA,CAAKJ,KAAL,CAAWC,aAA5D,IACC5tB,IAAI,CAACqL,GAAL,CAAS6M,GAAG,CAACgS,OAAJ,GAAc,IAAA,CAAKyD,KAAL,CAAWK,WAAlC,CAAiD,GAAA,IAAA,CAAKL,KAAL,CAAWC,aADjE,EACgF;QAC9E,IAAKwC,CAAAA,OAAL,CAAalY,GAAb,CAAA,CAAA;;AACA,QAAA,IAAA,CAAKyV,KAAL,CAAWtV,MAAX,GAAoB,KAApB,CAAA;AACD,OAJD;AAAA,WAMK,IAAI,IAAA,CAAKY,MAAL,CAAYiM,WAAhB,EAA6B;QAChC,IAAK8L,CAAAA,cAAL,CAAoB9Y,GAApB,CAAA,CAAA;;QACA,IAAK+Y,CAAAA,iBAAL,CAAuB/Y,GAAvB,CAAA,CAAA;AACD,OAHI,MAIA;AACH,QAAA,IAAA,CAAKyV,KAAL,CAAWtV,MAAX,GAAoB,KAApB,CAAA;AACD,OAAA;;AAED,MAAA,IAAA,CAAKsV,KAAL,CAAWM,YAAX,CAAwBtoB,MAAxB,GAAiC,CAAjC,CAAA;AACD,KAAA;AACF,GAAA;AAED;AACF;AACA;AACA;AA3kBA,GAAA;;EAAA,MA4kBE6qB,CAAAA,cA5kBF,GA4kBE,SAAiB,cAAA,GAAA;IACf,IAAKl2B,CAAAA,GAAL,CAAS0kB,cAAT,EAAA,CAAA;AACA,IAAA,IAAA,CAAK2O,KAAL,CAAWM,YAAX,CAAwBtoB,MAAxB,GAAiC,CAAjC,CAAA;AACA,IAAA,IAAA,CAAKgoB,KAAL,CAAWtV,MAAX,GAAoB,KAApB,CAAA;AACA,IAAA,IAAA,CAAKsV,KAAL,CAAWG,OAAX,GAAqB,KAArB,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AACA;AAvlBA,GAAA;;AAAA,EAAA,MAAA,CAwlBEmD,iBAxlBF,GAwlBE,SAAkB/Y,iBAAAA,CAAAA,GAAlB,EAAuB;AAAA,IAAA,IAAA,MAAA,GAAA,IAAA,CAAA;;AACrB,IAAA,IAAMf,SAAS,GAAG;AAChBzN,MAAAA,CAAC,EAAEwO,GAAG,CAAC+R,OAAJ,GAAc,IAAA,CAAK0D,KAAL,CAAWM,YAAX,CAAwB,CAAxB,CAAA,CAA2B,CAA3B,CADD;AAEhBnjB,MAAAA,CAAC,EAAEoN,GAAG,CAACgS,OAAJ,GAAc,IAAA,CAAKyD,KAAL,CAAWM,YAAX,CAAwB,CAAxB,CAAA,CAA2B,CAA3B,CAAA;KAFnB,CAAA;IAKA,IAAMiD,IAAI,GAAGlxB,IAAI,CAACW,IAAL,CAAUwW,SAAS,CAACzN,CAAV,GAAcyN,SAAS,CAACzN,CAAxB,GAA4ByN,SAAS,CAACrM,CAAV,GAAcqM,SAAS,CAACrM,CAA9D,CAAb,CAAA;AAEA,IAAA,IAAA,CAAKzC,IAAL,CAAU8oB,gBAAV,GAA6B,IAAI9d,SAAJ,CAAc;AACzCe,MAAAA,UAAU,EAAE;AACV6V,QAAAA,OAAO,EAAE;UAAE5V,KAAK,EAAE6D,GAAG,CAAC+R,OAAb;AAAsB3V,UAAAA,GAAG,EAAE4D,GAAG,CAAC+R,OAAJ,GAAc9S,SAAS,CAACzN,CAAAA;SADlD;AAEVwgB,QAAAA,OAAO,EAAE;UAAE7V,KAAK,EAAE6D,GAAG,CAACgS,OAAb;AAAsB5V,UAAAA,GAAG,EAAE4D,GAAG,CAACgS,OAAJ,GAAc/S,SAAS,CAACrM,CAAAA;AAAnD,SAAA;OAH8B;AAKzCoJ,MAAAA,QAAQ,EAAIgd,IAAI,GAAGp1B,cAAP,GAAwB,GALK;AAMzC0X,MAAAA,MAAM,EAAM,SAN6B;MAOzCe,MAAM,EAAM,SAACH,MAAAA,CAAAA,UAAD,EAAgB;AAC1B,QAAA,MAAI,CAACmb,MAAL,CAAYnb,UAAZ,EAAwB,KAAxB,CAAA,CAAA;AACD,OAAA;AATwC,KAAd,CAA7B,CAAA;AAYA,IAAA,IAAA,CAAK/L,IAAL,CAAU8oB,gBAAV,CACGzc,IADH,CACQ,YAAM;AACV,MAAA,MAAI,CAACiZ,KAAL,CAAWtV,MAAX,GAAoB,KAApB,CAAA;KAFJ,CAAA,CAAA;AAID,GAAA;AAED;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AAznBA,GAAA;;AAAA,EAAA,MAAA,CA0nBE+X,OA1nBF,GA0nBE,SAAA,OAAA,CAAQlY,GAAR,EAAakZ,SAAb,EAAgC;AAAA,IAAA,IAAA,MAAA,GAAA,IAAA,CAAA;;AAAA,IAAA,IAAnBA,SAAmB,KAAA,KAAA,CAAA,EAAA;AAAnBA,MAAAA,SAAmB,GAAP,KAAO,CAAA;AAAA,KAAA;;IAC9B,IAAMC,YAAY,GAAG,IAAK/2B,CAAAA,GAAL,CAAS4c,SAAT,CAAmBqB,qBAAnB,EAArB,CAAA;AAEA;AACJ;AACA;;AACI,IAAA,IAAMxT,IAAI,GAAG;AACXusB,MAAAA,UAAU,EAAEF,SAAS,IAAIlZ,GAAG,CAAC6J,MAAJ,KAAe,CAD7B;MAEXpU,MAAM,EAAMuK,GAAG,CAACvK,MAFL;MAGXsc,OAAO,EAAK/R,GAAG,CAAC+R,OAHL;MAIXC,OAAO,EAAKhS,GAAG,CAACgS,OAJL;AAKXqH,MAAAA,OAAO,EAAKrZ,GAAG,CAAC+R,OAAJ,GAAcoH,YAAY,CAACjqB,IAL5B;AAMXoqB,MAAAA,OAAO,EAAKtZ,GAAG,CAACgS,OAAJ,GAAcmH,YAAY,CAAChqB,GAAAA;KANzC,CAAA;IASA,IAAMsoB,aAAa,GAAG,IAAKr1B,CAAAA,GAAL,CAASs1B,UAAT,CAAoBjD,gBAApB,CAAqC;MACzDjjB,CAAC,EAAE3E,IAAI,CAACwsB,OADiD;MAEzDzmB,CAAC,EAAE/F,IAAI,CAACysB,OAAAA;AAFiD,KAArC,CAAtB,CAAA;AAKA,IAAA,IAAMC,kBAAkB,GAAG9B,aAAa,CAACQ,IAAd,CAAmB,UAAA7jB,CAAC,EAAA;AAAA,MAAA,OAAIA,CAAC,CAAC+B,MAAF,CAASue,QAAT,CAAkB8E,SAAtB,CAAA;AAAA,KAApB,CAA3B,CAAA;;AAEA,IAAA,IAAID,kBAAJ,EAAwB;AACtB,MAAA,IAAME,eAAe,GAAG,IAAKr3B,CAAAA,GAAL,CAASs1B,UAAT,CAAoB5D,wBAApB,CAA6CyF,kBAAkB,CAAClG,KAAhE,CAAxB,CAAA;AACAxmB,MAAAA,IAAI,CAAC6G,SAAL,GAAiB+lB,eAAe,CAAC/lB,SAAjC,CAAA;AACA7G,MAAAA,IAAI,CAAC4G,QAAL,GAAgBgmB,eAAe,CAAChmB,QAAhC,CAAA;MAEA5G,IAAI,CAAC6sB,OAAL,GAAejC,aAAa,CAAChf,GAAd,CAAkB,UAAArE,CAAC,EAAA;QAAA,OAAIA,CAAC,CAAC+B,MAAN,CAAA;AAAA,OAAnB,CAAiC5I,CAAAA,MAAjC,CAAwC,UAAAosB,CAAC,EAAA;AAAA,QAAA,OAAI,CAACA,CAAC,CAACjF,QAAF,CAAW8E,SAAhB,CAAA;AAAA,OAAzC,CAAf,CAAA;;MAEA,IAAI;QACF,IAAMI,aAAa,GAAG,IAAA,CAAKx3B,GAAL,CAASs1B,UAAT,CAAoB3D,8BAApB,CAAmDlnB,IAAnD,CAAtB,CAAA;AACAA,QAAAA,IAAI,CAACgtB,QAAL,GAAgBD,aAAa,CAACpoB,CAA9B,CAAA;AACA3E,QAAAA,IAAI,CAACitB,QAAL,GAAgBF,aAAa,CAAChnB,CAA9B,CAAA;OAHF,CAKA,OAAOxH,CAAP,EAAU;QACRyB,IAAI,CAACgtB,QAAL,GAAgBE,GAAhB,CAAA;QACAltB,IAAI,CAACitB,QAAL,GAAgBC,GAAhB,CAAA;AACD,OAAA;;AAED,MAAA,IAAI,CAAC,IAAA,CAAKtE,KAAL,CAAWU,eAAhB,EAAiC;QAC/B,IAAK/zB,CAAAA,GAAL,CAASsuB,OAAT,CAAiBlsB,MAAM,CAACI,KAAxB,EAA+BiI,IAA/B,CAAA,CAAA;AAEA,QAAA,IAAA,CAAK4oB,KAAL,CAAWS,YAAX,GAA0BlgB,KAAK,CAACnJ,IAAD,CAA/B,CAAA;AACA,QAAA,IAAA,CAAK4oB,KAAL,CAAWU,eAAX,GAA6BjqB,UAAU,CAAC,YAAM;AAC5C,UAAA,MAAI,CAACupB,KAAL,CAAWU,eAAX,GAA6B,IAA7B,CAAA;AACA,UAAA,MAAI,CAACV,KAAL,CAAWS,YAAX,GAA0B,IAA1B,CAAA;SAFqC,EAGpC1yB,cAHoC,CAAvC,CAAA;AAID,OARD,MASK;AACH,QAAA,IAAIsE,IAAI,CAACqL,GAAL,CAAS,IAAA,CAAKsiB,KAAL,CAAWS,YAAX,CAAwBnE,OAAxB,GAAkCllB,IAAI,CAACklB,OAAhD,CAA2D,GAAA,IAAA,CAAK0D,KAAL,CAAWC,aAAtE,IACC5tB,IAAI,CAACqL,GAAL,CAAS,KAAKsiB,KAAL,CAAWS,YAAX,CAAwBlE,OAAxB,GAAkCnlB,IAAI,CAACmlB,OAAhD,CAAA,GAA2D,KAAKyD,KAAL,CAAWC,aAD3E,EAC0F;UACxF,IAAKtzB,CAAAA,GAAL,CAASsuB,OAAT,CAAiBlsB,MAAM,CAACO,YAAxB,EAAsC,IAAA,CAAK0wB,KAAL,CAAWS,YAAjD,CAAA,CAAA;AACD,SAAA;;AAED9pB,QAAAA,YAAY,CAAC,IAAA,CAAKqpB,KAAL,CAAWU,eAAZ,CAAZ,CAAA;AACA,QAAA,IAAA,CAAKV,KAAL,CAAWU,eAAX,GAA6B,IAA7B,CAAA;AACA,QAAA,IAAA,CAAKV,KAAL,CAAWS,YAAX,GAA0B,IAA1B,CAAA;AACD,OAAA;AACF,KAAA;AACF,GAAA;AAED;AACF;AACA;AACA;AACA;AACA;AA5rBA,GAAA;;AAAA,EAAA,MAAA,CA6rBEmB,MA7rBF,GA6rBE,SAAA,MAAA,CAAOrX,GAAP,EAAY7N,GAAZ,EAAiB;AACf,IAAA,IAAI,IAAKsjB,CAAAA,KAAL,CAAWtV,MAAf,EAAuB;AACrB,MAAA,IAAM3O,CAAC,GAAGwO,GAAG,CAAC+R,OAAd,CAAA;AACA,MAAA,IAAMnf,CAAC,GAAGoN,GAAG,CAACgS,OAAd,CAAA;AAEA,MAAA,IAAM0B,QAAQ,GAAG;AACfhgB,QAAAA,SAAS,EAAE,CAAClC,CAAC,GAAG,IAAKikB,CAAAA,KAAL,CAAWpE,MAAhB,IAA0B,IAAA,CAAKlhB,IAAL,CAAUsQ,IAAV,CAAejU,KAAzC,GAAiD,IAAA,CAAKuU,MAAL,CAAY4L,SAA7D,GAAyEhT,KAAK,CAACC,SAAN,CAAgBC,QAAhB,CAAyB,IAAA,CAAK1J,IAAL,CAAU6pB,IAAnC,CADrE;AAEfvmB,QAAAA,QAAQ,EAAG,CAACb,CAAC,GAAG,IAAK6iB,CAAAA,KAAL,CAAWnE,MAAhB,IAA0B,IAAA,CAAKnhB,IAAL,CAAUsQ,IAAV,CAAehU,MAAzC,GAAkD,IAAA,CAAKsU,MAAL,CAAY4L,SAA9D,GAA0EhT,KAAK,CAACC,SAAN,CAAgBC,QAAhB,CAAyB,IAAK1J,CAAAA,IAAL,CAAU2iB,IAAnC,CAAA;OAFvF,CAAA;AAKA,MAAA,IAAMmH,eAAe,GAAG,IAAA,CAAK73B,GAAL,CAAS6M,WAAT,EAAxB,CAAA;MACA,IAAK7M,CAAAA,GAAL,CAAS83B,MAAT,CAAgB;AACdxmB,QAAAA,SAAS,EAAEumB,eAAe,CAACvmB,SAAhB,GAA4BggB,QAAQ,CAAChgB,SADlC;AAEdD,QAAAA,QAAQ,EAAGwmB,eAAe,CAACxmB,QAAhB,GAA2BigB,QAAQ,CAACjgB,QAAAA;OAFjD,CAAA,CAAA;AAKA,MAAA,IAAA,CAAKgiB,KAAL,CAAWpE,MAAX,GAAoB7f,CAApB,CAAA;AACA,MAAA,IAAA,CAAKikB,KAAL,CAAWnE,MAAX,GAAoB1e,CAApB,CAAA;;MAEA,IAAIT,GAAG,KAAK,KAAZ,EAAmB;QACjB,IAAK2mB,CAAAA,cAAL,CAAoB9Y,GAApB,CAAA,CAAA;AACD,OAAA;AACF,KAAA;AACF,GAAA;AAED;AACF;AACA;AACA;AACA;AA1tBA,GAAA;;AAAA,EAAA,MAAA,CA2tBEsX,cA3tBF,GA2tBE,SAAetX,cAAAA,CAAAA,GAAf,EAAoB;AAClB,IAAA,IAAI,IAAKyV,CAAAA,KAAL,CAAWtV,MAAf,EAAuB;MACrB,IAAMga,aAAa,GAAG,IAAK/3B,CAAAA,GAAL,CAAS4c,SAAT,CAAmBqB,qBAAnB,EAAtB,CAAA;AACA,MAAA,IAAA,CAAKje,GAAL,CAASoc,QAAT,CAAkBb,QAAlB,CAA2BD,IAA3B,CAAgC;QAC9BhK,SAAS,EAAE,CAAC,CAACsM,GAAG,CAAC+R,OAAJ,GAAcoI,aAAa,CAACjrB,IAA7B,IAAqCirB,aAAa,CAAC3tB,KAAnD,GAA2D,GAA5D,IAAmE1E,IAAI,CAACE,EAAxE,GAA6E,CAD1D;AAE9ByL,QAAAA,QAAQ,EAAG,EAAE,CAACuM,GAAG,CAACgS,OAAJ,GAAcmI,aAAa,CAAChrB,GAA7B,IAAoCgrB,aAAa,CAAC1tB,MAAlD,GAA2D,GAA7D,CAAA,GAAoE3E,IAAI,CAACE,EAAAA;AAFtD,OAAhC,EAGG,EAHH,CAAA,CAAA;AAID,KAAA;AACF,GAAA;AAED;AACF;AACA;AACA;AACA;AAzuBA,GAAA;;AAAA,EAAA,MAAA,CA0uBEwwB,UA1uBF,GA0uBE,SAAWxY,UAAAA,CAAAA,GAAX,EAAgB;IACd,IAAI,IAAA,CAAKyV,KAAL,CAAWG,OAAX,IAAsB,IAAKH,CAAAA,KAAL,CAAWtV,MAArC,EAA6C;AAC3C,MAAA,IAAMzN,EAAE,GAAG;AAAElB,QAAAA,CAAC,EAAEwO,GAAG,CAAC8R,OAAJ,CAAY,CAAZ,EAAeC,OAApB;AAA6Bnf,QAAAA,CAAC,EAAEoN,GAAG,CAAC8R,OAAJ,CAAY,CAAZ,CAAeE,CAAAA,OAAAA;OAA1D,CAAA;AACA,MAAA,IAAMrf,EAAE,GAAG;AAAEnB,QAAAA,CAAC,EAAEwO,GAAG,CAAC8R,OAAJ,CAAY,CAAZ,EAAeC,OAApB;AAA6Bnf,QAAAA,CAAC,EAAEoN,GAAG,CAAC8R,OAAJ,CAAY,CAAZ,CAAeE,CAAAA,OAAAA;OAA1D,CAAA;AAEA,MAAA,IAAMhb,CAAC,GAAGvE,QAAQ,CAACC,EAAD,EAAKC,EAAL,CAAlB,CAAA;MACA,IAAM+lB,KAAK,GAAG,EAAM1hB,IAAAA,CAAC,GAAG,IAAKye,CAAAA,KAAL,CAAWO,SAArB,CAAA,GAAkC,KAAK7lB,IAAL,CAAUsQ,IAAV,CAAejU,KAAjD,GAAyD,IAAKuU,CAAAA,MAAL,CAAY6L,SAAnF,CAAA;MAEA,IAAKxqB,CAAAA,GAAL,CAAS0oB,IAAT,CAAc,KAAK1oB,GAAL,CAASupB,YAAT,EAAA,GAA0B+M,KAAxC,CAAA,CAAA;;AAEA,MAAA,IAAA,CAAKrB,MAAL,CAAY;QACVtF,OAAO,EAAE,CAACrf,EAAE,CAAClB,CAAH,GAAOmB,EAAE,CAACnB,CAAX,IAAgB,CADf;QAEVwgB,OAAO,EAAE,CAACtf,EAAE,CAACE,CAAH,GAAOD,EAAE,CAACC,CAAX,IAAgB,CAAA;OAF3B,CAAA,CAAA;;AAKA,MAAA,IAAA,CAAK6iB,KAAL,CAAWO,SAAX,GAAuBhf,CAAvB,CAAA;AACD,KAAA;AACF,GAAA;AAED;AACF;AACA;AACA;AACA;AACA;AACA;AAnwBA,GAAA;;AAAA,EAAA,MAAA,CAowBE8hB,cApwBF,GAowBE,SAAe9Y,cAAAA,CAAAA,GAAf,EAAoB;AAClB,IAAA,IAAMjL,GAAG,GAAGD,IAAI,CAACC,GAAL,EAAZ,CAAA;AACA,IAAA,IAAA,CAAK0gB,KAAL,CAAWM,YAAX,CAAwBnZ,IAAxB,CAA6B,CAAC7H,GAAD,EAAMiL,GAAG,CAAC+R,OAAV,EAAmB/R,GAAG,CAACgS,OAAvB,CAA7B,CAAA,CAAA;IAEA,IAAIpd,QAAQ,GAAG,IAAf,CAAA;;AAEA,IAAA,KAAK,IAAIR,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,IAAA,CAAKqhB,KAAL,CAAWM,YAAX,CAAwBtoB,MAA5C,GAAqD;AACnD,MAAA,IAAI,IAAKgoB,CAAAA,KAAL,CAAWM,YAAX,CAAwB,CAAxB,CAA2B3hB,CAAAA,CAA3B,CAAgCW,GAAAA,GAAG,GAAGnR,cAA1C,EAA0D;QACxD,IAAK6xB,CAAAA,KAAL,CAAWM,YAAX,CAAwB3R,MAAxB,CAA+BhQ,CAA/B,EAAkC,CAAlC,CAAA,CAAA;AACD,OAFD,MAGK,IAAIQ,QAAQ,IAAI,IAAK6gB,CAAAA,KAAL,CAAWM,YAAX,CAAwB,CAAxB,CAAA,CAA2B3hB,CAA3B,CAAgCQ,GAAAA,QAAhC,GAA2ChR,cAAc,GAAG,EAA5E,EAAgF;QACnF,IAAK6xB,CAAAA,KAAL,CAAWM,YAAX,CAAwB3R,MAAxB,CAA+B,CAA/B,EAAkChQ,CAAlC,CAAA,CAAA;AACAA,QAAAA,CAAC,GAAG,CAAJ,CAAA;QACAQ,QAAQ,GAAG,KAAK6gB,KAAL,CAAWM,YAAX,CAAwB,CAAxB,CAA2B3hB,CAAAA,CAA3B,CAAX,CAAA;AACD,OAJI,MAKA;QACHA,CAAC,EAAA,CAAA;QACDQ,QAAQ,GAAG,KAAK6gB,KAAL,CAAWM,YAAX,CAAwB,CAAxB,CAA2B3hB,CAAAA,CAA3B,CAAX,CAAA;AACD,OAAA;AACF,KAAA;GAvxBL,CAAA;;AAAA,EAAA,OAAA,aAAA,CAAA;AAAA,CAAA,CAAmC6d,eAAnC,CAAA;;ACpBA;AACA;AACA;AACA;AACA;;AACA,IAAamI,QAAb,gBAAA,UAAA,gBAAA,EAAA;AAAA,EAAA,cAAA,CAAA,QAAA,EAAA,gBAAA,CAAA,CAAA;;AAEE;AACF;AACA;AACE,EAAA,SAAA,QAAA,CAAYh4B,GAAZ,EAAiB;AAAA,IAAA,IAAA,mBAAA,CAAA;;AAAA,IAAA,IAAA,KAAA,CAAA;;AACf,IAAA,KAAA,GAAA,gBAAA,CAAA,IAAA,CAAA,IAAA,EAAMA,GAAN,CAAA,IAAA,IAAA,CAAA;AAEA;AACJ;AACA;AACA;AACA;;AACI,IAAA,KAAA,CAAKqxB,QAAL,GAAgB,IAAI9Z,KAAK,CAAC0gB,aAAV,CAAwB;AAAEC,MAAAA,KAAK,EAAE,IAAT;AAAeC,MAAAA,SAAS,EAAE,IAAA;AAA1B,KAAxB,CAAhB,CAAA;;AACA,IAAA,KAAA,CAAK9G,QAAL,CAAc+G,aAAd,CAA4B7wB,MAAM,CAACE,UAAnC,CAAA,CAAA;;AACA,IAAA,KAAA,CAAK4pB,QAAL,CAAcgH,UAAd,CAAyB7sB,SAAzB,GAAqC,YAArC,CAAA;AAEA;AACJ;AACA;AACA;AACA;;AACI,IAAA,KAAA,CAAKunB,KAAL,GAAa,IAAIxb,KAAK,CAAC+gB,KAAV,EAAb,CAAA;AAEA;AACJ;AACA;AACA;AACA;;AACI,IAAA,KAAA,CAAK5F,MAAL,GAAc,IAAInb,KAAK,CAACghB,iBAAV,CAA4B,EAA5B,EAAgC,EAAA,GAAK,CAArC,EAAwC,CAAxC,EAA2C,CAAA,GAAI92B,aAA/C,CAAd,CAAA;AAEA;AACJ;AACA;AACA;AACA;;IACI,KAAKf,CAAAA,IAAL,GAAY,KAAKV,CAAAA,GAAL,CAASsmB,OAAT,CAAiB/lB,UAAjB,EAAZ,CAAA;AACA,IAAA,KAAA,CAAKG,IAAL,CAAU4xB,QAAV,IAAwB3wB,mBAAAA,GAAAA,EAAAA,EAAAA,mBAAAA,CAAAA,cAAxB,IAAyC,IAAzC,EAAA,mBAAA,CAAA,CAAA;AAEA;AACJ;AACA;AACA;AACA;;AACI,IAAA,KAAA,CAAK4vB,aAAL,GAAqB,IAAIha,KAAK,CAACihB,KAAV,EAArB,CAAA;;AACA,IAAA,KAAA,CAAKjH,aAAL,CAAmB1lB,GAAnB,CAAuB,MAAKnL,IAA5B,CAAA,CAAA;;AACA,IAAA,KAAA,CAAKqyB,KAAL,CAAWlnB,GAAX,CAAe,MAAK0lB,aAApB,CAAA,CAAA;AAEA;AACJ;AACA;AACA;AACA;;;AACI,IAAA,KAAA,CAAKqB,SAAL,GAAiB,IAAIrb,KAAK,CAACkhB,SAAV,EAAjB,CAAA;AAEA;AACJ;AACA;AACA;;IACI,KAAK/e,CAAAA,SAAL,GAAiB,IAAjB,CAAA;AAEA;AACJ;AACA;AACA;;IACI,KAAK2P,CAAAA,KAAL,GAAa,KAAb,CAAA;AAEA;AACJ;AACA;AACA;AACA;;AACI,IAAA,KAAA,CAAKqP,eAAL,GAAuBhwB,QAAQ,CAACC,aAAT,CAAuB,KAAvB,CAAvB,CAAA;AACA,IAAA,KAAA,CAAK+vB,eAAL,CAAqBltB,SAArB,GAAiC,sBAAjC,CAAA;IACA,KAAKktB,CAAAA,eAAL,CAAqBlW,KAArB,CAA2BmW,UAA3B,GAAwC,KAAA,CAAK34B,GAAL,CAAS2e,MAAT,CAAgBwM,gBAAxD,CAAA;AACA,IAAA,KAAA,CAAKuN,eAAL,CAAqBlW,KAArB,CAA2BtE,MAA3B,GAAoC,KAAA,CAAKle,GAAL,CAAS2e,MAAT,CAAgBmM,SAAhB,GAA4B,MAA5B,GAAqC,SAAzE,CAAA;;AACA,IAAA,KAAA,CAAK4N,eAAL,CAAqB7W,WAArB,CAAiC,KAAKwP,CAAAA,QAAL,CAAcgH,UAA/C,CAAA,CAAA;;AACA,IAAA,KAAA,CAAKr4B,GAAL,CAAS4c,SAAT,CAAmBiF,WAAnB,CAA+B,MAAK6W,eAApC,CAAA,CAAA;;AAEA14B,IAAAA,GAAG,CAACskB,EAAJ,CAAOliB,MAAM,CAACsB,YAAd,EAAA,sBAAA,CAAA,KAAA,CAAA,CAAA,CAAA;AACA1D,IAAAA,GAAG,CAACskB,EAAJ,CAAOliB,MAAM,CAACwB,YAAd,EAAA,sBAAA,CAAA,KAAA,CAAA,CAAA,CAAA;AACA5D,IAAAA,GAAG,CAACskB,EAAJ,CAAOliB,MAAM,CAACgB,gBAAd,EAAA,sBAAA,CAAA,KAAA,CAAA,CAAA,CAAA;AACApD,IAAAA,GAAG,CAACskB,EAAJ,CAAOliB,MAAM,CAACM,cAAd,EAAA,sBAAA,CAAA,KAAA,CAAA,CAAA,CAAA;;AAEA,IAAA,KAAA,CAAK4f,IAAL,EAAA,CAAA;;AA/Ee,IAAA,OAAA,KAAA,CAAA;AAgFhB,GAAA;AAED;AACF;AACA;;;AAzFA,EAAA,IAAA,MAAA,GAAA,QAAA,CAAA,SAAA,CAAA;;EAAA,MA0FEriB,CAAAA,OA1FF,GA0FE,SAAU,OAAA,GAAA;AACR;AACA,IAAA,IAAA,CAAKoxB,QAAL,CAAcuH,gBAAd,CAA+B,IAA/B,EAFQ;;AAKR,IAAA,IAAA,CAAKC,iBAAL,CAAuB,IAAK9F,CAAAA,KAA5B,EALQ;;;AAQR,IAAA,IAAA,CAAK/yB,GAAL,CAAS4c,SAAT,CAAmBkF,WAAnB,CAA+B,KAAK4W,eAApC,CAAA,CAAA;AAEA,IAAA,OAAO,KAAKA,eAAZ,CAAA;AACA,IAAA,OAAO,KAAKrH,QAAZ,CAAA;AACA,IAAA,OAAO,KAAK0B,KAAZ,CAAA;AACA,IAAA,OAAO,KAAKL,MAAZ,CAAA;AACA,IAAA,OAAO,KAAKhyB,IAAZ,CAAA;AACA,IAAA,OAAO,KAAK6wB,aAAZ,CAAA;AACA,IAAA,OAAO,KAAKqB,SAAZ,CAAA;;AAEA,IAAA,gBAAA,CAAA,SAAA,CAAM3yB,OAAN,CAAA,IAAA,CAAA,IAAA,CAAA,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AACA;AAnHA,GAAA;;AAAA,EAAA,MAAA,CAoHEgd,WApHF,GAoHE,SAAYW,WAAAA,CAAAA,GAAZ,EAAiB;AACf;IACA,QAAQA,GAAG,CAACV,IAAZ;AACE;MACA,KAAK9a,MAAM,CAACsB,YAAZ;AAA8B,QAAA,IAAA,CAAKo1B,eAAL,EAAA,CAAA;;AAAwB,QAAA,MAAA;;MACtD,KAAK12B,MAAM,CAACwB,YAAZ;AAA8B,QAAA,IAAA,CAAKm1B,eAAL,EAAA,CAAA;;AAAwB,QAAA,MAAA;;MACtD,KAAK32B,MAAM,CAACgB,gBAAZ;AAA8B,QAAA,IAAA,CAAK41B,mBAAL,EAAA,CAAA;;AAA4B,QAAA,MAAA;;MAC1D,KAAK52B,MAAM,CAACM,cAAZ;QACE,IAAIkb,GAAG,CAACtL,IAAJ,CAAS,CAAT,EAAYmO,QAAZ,CAAqB,SAArB,CAAJ,EAAqC;AACnC,UAAA,IAAA,CAAKuY,mBAAL,EAAA,CAAA;AACD,SAAA;;QACD,IAAIpb,GAAG,CAACtL,IAAJ,CAAS,CAAT,EAAYmO,QAAZ,CAAqB,WAArB,CAAJ,EAAuC;AACrC,UAAA,IAAA,CAAKiY,eAAL,CAAqBlW,KAArB,CAA2BtE,MAA3B,GAAoC,IAAA,CAAKle,GAAL,CAAS2e,MAAT,CAAgBmM,SAAhB,GAA4B,MAA5B,GAAqC,SAAzE,CAAA;AACD,SAAA;;AACD,QAAA,MAAA;AACF;AAbF,KAAA;AAeA;;AACD,GAAA;AAED;AACF;AACA;AA1IA,GAAA;;EAAA,MA2IExI,CAAAA,IA3IF,GA2IE,SAAO,IAAA,GAAA;AACL,IAAA,IAAA,CAAKoW,eAAL,CAAqBlW,KAArB,CAA2B1hB,OAA3B,GAAqC,CAArC,CAAA;AACD,GAAA;AAED;AACF;AACA;AAjJA,GAAA;;EAAA,MAkJEyhB,CAAAA,IAlJF,GAkJE,SAAO,IAAA,GAAA;AACL,IAAA,IAAA,CAAKmW,eAAL,CAAqBlW,KAArB,CAA2B1hB,OAA3B,GAAqC,CAArC,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AAzJA,GAAA;;EAAA,MA0JEg4B,CAAAA,eA1JF,GA0JE,SAAkB,eAAA,GAAA;AAChB,IAAA,IAAA,CAAKzH,QAAL,CAAc4H,OAAd,CAAsB,IAAA,CAAKlrB,IAAL,CAAUsQ,IAAV,CAAejU,KAArC,EAA4C,IAAK2D,CAAAA,IAAL,CAAUsQ,IAAV,CAAehU,MAA3D,CAAA,CAAA;AACA,IAAA,IAAA,CAAKqoB,MAAL,CAAY5B,MAAZ,GAAqB,IAAK/iB,CAAAA,IAAL,CAAU+iB,MAA/B,CAAA;IACA,IAAK4B,CAAAA,MAAL,CAAYwG,sBAAZ,EAAA,CAAA;AACA,IAAA,IAAA,CAAKnrB,IAAL,CAAUoK,WAAV,GAAwB,IAAxB,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AApKA,GAAA;;EAAA,MAqKE4gB,CAAAA,eArKF,GAqKE,SAAkB,eAAA,GAAA;AAChB,IAAA,IAAA,CAAKrG,MAAL,CAAYpC,GAAZ,GAAkB,IAAKviB,CAAAA,IAAL,CAAU2iB,IAA5B,CAAA;IACA,IAAKgC,CAAAA,MAAL,CAAYwG,sBAAZ,EAAA,CAAA;AACA,IAAA,IAAA,CAAKnrB,IAAL,CAAUoK,WAAV,GAAwB,IAAxB,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AA9KA,GAAA;;EAAA,MA+KE6gB,CAAAA,mBA/KF,GA+KE,SAAsB,mBAAA,GAAA;IACpB,IAAKtG,CAAAA,MAAL,CAAYnX,QAAZ,CAAqB4d,GAArB,CAAyB,CAAzB,EAA4B,CAA5B,EAA+B,CAA/B,CAAA,CAAA;AACA,IAAA,IAAA,CAAKzG,MAAL,CAAY0G,MAAZ,CAAmB,IAAKrrB,CAAAA,IAAL,CAAU8O,SAA7B,CAAA,CAAA;;AACA,IAAA,IAAI,IAAK8B,CAAAA,MAAL,CAAYqL,OAAhB,EAAyB;MACvB,IAAK0I,CAAAA,MAAL,CAAYnX,QAAZ,CAAqB8d,IAArB,CAA0B,IAAA,CAAKtrB,IAAL,CAAU8O,SAApC,EAA+Cyc,cAA/C,CAA8D,KAAK3a,MAAL,CAAYqL,OAAZ,GAAsB,CAApF,EAAuFuP,MAAvF,EAAA,CAAA;AACD,KAAA;;AACD,IAAA,IAAA,CAAKxrB,IAAL,CAAUoK,WAAV,GAAwB,IAAxB,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AACA;AACA;AA7LA,GAAA;;AAAA,EAAA,MAAA,CA8LEqhB,YA9LF,GA8LE,SAAa9f,YAAAA,CAAAA,SAAb,EAAwB;AACtB,IAAA,IAAMqC,OAAO,GAAG,IAAKrC,CAAAA,SAAL,KAAmB,IAAnB,GAA0BA,SAAS,GAAG,IAAA,CAAKA,SAA3C,GAAuD,CAAvE,CAAA;IACA,IAAKA,CAAAA,SAAL,GAAiBA,SAAjB,CAAA;IAEA,IAAK1Z,CAAAA,GAAL,CAASsuB,OAAT,CAAiBlsB,MAAM,CAACE,aAAxB,EAAuCoX,SAAvC,EAAkDqC,OAAlD,CAAA,CAAA;AACAjI,IAAAA,IAAI,CAAC,IAAK9T,CAAAA,GAAL,CAASoc,QAAV,EAAoB,UAAAC,CAAC,EAAA;AAAA,MAAA,OAAIA,CAAC,CAACP,MAAF,CAASC,OAAT,CAAJ,CAAA;AAAA,KAArB,CAAJ,CAAA;;AAEA,IAAA,IAAI,KAAKhO,IAAL,CAAU0rB,QAAV,GAAqB,CAArB,IAA0B/f,SAAS,GAAG,IAAK3L,CAAAA,IAAL,CAAU0rB,QAAtB,GAAiC,KAAK9a,MAAL,CAAY8L,eAA3E,EAA4F;MAC1F,IAAKzqB,CAAAA,GAAL,CAAS05B,eAAT,EAAA,CAAA;AACD,KAAA;;AAED,IAAA,IAAI,IAAK3rB,CAAAA,IAAL,CAAUoK,WAAd,EAA2B;AACzB,MAAA,IAAA,CAAKwhB,MAAL,EAAA,CAAA;AACA,MAAA,IAAA,CAAK5rB,IAAL,CAAUoK,WAAV,GAAwB,KAAxB,CAAA;AACD,KAAA;AACF,GAAA;AAED;AACF;AACA;AACA;AACA;AACA;AApNA,GAAA;;EAAA,MAqNEwhB,CAAAA,MArNF,GAqNE,SAAS,MAAA,GAAA;IACP,IAAKtI,CAAAA,QAAL,CAAcsI,MAAd,CAAqB,KAAK5G,KAA1B,EAAiC,KAAKL,MAAtC,CAAA,CAAA;AACA,IAAA,IAAA,CAAK1yB,GAAL,CAASsuB,OAAT,CAAiBlsB,MAAM,CAACkB,MAAxB,CAAA,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AACA;AACA;AA/NA,GAAA;;AAAA,EAAA,MAAA,CAgOE7C,UAhOF,GAgOE,SAAWE,UAAAA,CAAAA,WAAX,EAAwB;AAAA,IAAA,IAAA,MAAA,GAAA,IAAA,CAAA;;AACtB,IAAA,IAAA,CAAKoN,IAAL,CAAUwR,QAAV,GAAqB5e,WAAW,CAAC4e,QAAjC,CAAA;IAEA,IAAKvf,CAAAA,GAAL,CAASsmB,OAAT,CAAiB7lB,UAAjB,CAA4B,IAAA,CAAKC,IAAjC,EAAuCC,WAAvC,CAAA,CAAA;;IAEA,IAAI,CAAC,IAAK0oB,CAAAA,KAAV,EAAiB;AACf,MAAA,IAAA,CAAKgI,QAAL,CAAcuH,gBAAd,CAA+B,UAAAh0B,CAAC,EAAA;AAAA,QAAA,OAAI,MAAI,CAAC40B,YAAL,CAAkB50B,CAAlB,CAAJ,CAAA;OAAhC,CAAA,CAAA;MACA,IAAKykB,CAAAA,KAAL,GAAa,IAAb,CAAA;AACD,KAAA;;IAED,IAAKrpB,CAAAA,GAAL,CAASmY,WAAT,EAAA,CAAA;IAEA,IAAKnY,CAAAA,GAAL,CAASsuB,OAAT,CAAiBlsB,MAAM,CAACe,eAAxB,EAAyCxC,WAAzC,CAAA,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AACA;AACA;AApPA,GAAA;;AAAA,EAAA,MAAA,CAqPEi5B,eArPF,GAqPE,SAAA,eAAA,CAAgBra,QAAhB,EAA0B7e,IAA1B,EAA4C;AAAA,IAAA,IAAlBA,IAAkB,KAAA,KAAA,CAAA,EAAA;MAAlBA,IAAkB,GAAX,KAAKA,IAAM,CAAA;AAAA,KAAA;;AAC1C;AACA;IACA,IAAMm5B,eAAe,GAAG,IAAA,CAAK75B,GAAL,CAASs1B,UAAT,CAAoBnC,iBAApB,CAAsC5T,QAAtC,CAAxB,CAAA;IAEA7e,IAAI,CAAC4wB,QAAL,CAAc6H,GAAd,CACE,CAACU,eAAe,CAAC3G,IADnB,EAEE,CAAC2G,eAAe,CAAC5G,GAFnB,EAGE,CAAC4G,eAAe,CAACne,IAHnB,EAIE,KAJF,CAAA,CAAA;AAMD,GAAA;AAED;AACF;AACA;AACA;AACA;AACA;AAvQA,GAAA;;AAAA,EAAA,MAAA,CAwQEoe,mBAxQF,GAwQE,SAAA,mBAAA,CAAoBxP,gBAApB,EAAsC5pB,IAAtC,EAAiE;AAAA,IAAA,IAA3BA,IAA2B,KAAA,KAAA,CAAA,EAAA;MAA3BA,IAA2B,GAApB,KAAK6wB,aAAe,CAAA;AAAA,KAAA;;IAC/D,IAAMsI,eAAe,GAAG,IAAA,CAAK75B,GAAL,CAASs1B,UAAT,CAAoBtC,qBAApB,CAA0C1I,gBAA1C,CAAxB,CAAA;AAEA5pB,IAAAA,IAAI,CAAC4wB,QAAL,CAAc6H,GAAd,CACEU,eAAe,CAAC3G,IADlB,EAEE2G,eAAe,CAAC5G,GAFlB,EAGE4G,eAAe,CAACne,IAHlB,EAIE,KAJF,CAAA,CAAA;AAMD,GAAA;AAED;AACF;AACA;AACA;AACA;AACA;AACA;AAzRA,GAAA;;AAAA,EAAA,MAAA,CA0RE9a,UA1RF,GA0RE,SAAA,UAAA,CAAWD,WAAX,EAAwBqY,OAAxB,EAAiC;AAAA,IAAA,IAAA,MAAA,GAAA,IAAA,CAAA;;AAC/B,IAAA,IAAM+gB,gBAAgB,GAAG3kB,kBAAkB,CAAC4D,OAAD,CAA3C,CAAA;AACA,IAAA,IAAMghB,YAAY,IAAG,MAAA,IAAUhhB,OAAb,CAAlB,CAF+B;;AAK/B,IAAA,IAAMihB,KAAK,GAAG,IAAI1iB,KAAK,CAACihB,KAAV,EAAd,CAAA;IACA,IAAM93B,IAAI,GAAG,IAAA,CAAKV,GAAL,CAASsmB,OAAT,CAAiB/lB,UAAjB,CAA4B,GAA5B,CAAb,CAAA;IACA,IAAKP,CAAAA,GAAL,CAASsmB,OAAT,CAAiB7lB,UAAjB,CAA4BC,IAA5B,EAAkCC,WAAlC,EAA+C,IAA/C,CAAA,CAAA;IACA,IAAKX,CAAAA,GAAL,CAASsmB,OAAT,CAAiBzlB,iBAAjB,CAAmCH,IAAnC,EAAyC,CAAzC,CAAA,CAAA;AACA,IAAA,IAAA,CAAKk5B,eAAL,CAAqBj5B,WAAW,CAAC4e,QAAjC,EAA2C7e,IAA3C,CAAA,CAAA;IACA,IAAKo5B,CAAAA,mBAAL,CAAyB9gB,OAAO,CAACsR,gBAAjC,EAAmD2P,KAAnD,EAV+B;;AAa/B,IAAA,IAAIF,gBAAJ,EAAsB;MACpB,IAAMljB,aAAa,GAAG,IAAA,CAAK7W,GAAL,CAASs1B,UAAT,CAAoBze,aAApB,CAAkCmC,OAAlC,CAAtB,CAAA;MACA,IAAM6e,eAAe,GAAG,IAAK73B,CAAAA,GAAL,CAAS6M,WAAT,EAAxB,CAFoB;;AAKpB,MAAA,IAAMqtB,YAAY,GAAG,IAAI3iB,KAAK,CAAC0Y,OAAV,CAAkB,CAAlB,EAAqB,CAArB,EAAwB,CAAxB,CAArB,CAAA;AACAgK,MAAAA,KAAK,CAACE,iBAAN,CAAwBD,YAAxB,EAAsCrjB,aAAa,CAACvF,SAAd,GAA0BumB,eAAe,CAACvmB,SAAhF,EANoB;;AASpB,MAAA,IAAM8oB,cAAc,GAAG,IAAI7iB,KAAK,CAAC0Y,OAAV,CAAkB,CAAlB,EAAqB,CAArB,EAAwB,CAAxB,CAA2BoK,CAAAA,KAA3B,CAAiC,IAAA,CAAK3H,MAAL,CAAY4H,iBAAZ,CAA8B,IAAI/iB,KAAK,CAAC0Y,OAAV,EAA9B,CAAjC,CAAqFsK,CAAAA,SAArF,EAAvB,CAAA;MACAN,KAAK,CAACE,iBAAN,CAAwBC,cAAxB,EAAwCvjB,aAAa,CAACxF,QAAd,GAAyBwmB,eAAe,CAACxmB,QAAjF,CAAA,CAAA;AACD,KAAA;;IAED4oB,KAAK,CAACpuB,GAAN,CAAUnL,IAAV,CAAA,CAAA;AACA,IAAA,IAAA,CAAKqyB,KAAL,CAAWlnB,GAAX,CAAeouB,KAAf,CAAA,CAAA;AAEA,IAAA,IAAMO,SAAS,GAAG,IAAIzhB,SAAJ,CAAc;AAC9Be,MAAAA,UAAU,EAAE;AACVhZ,QAAAA,OAAO,EAAE;AAAEiZ,UAAAA,KAAK,EAAE,GAAT;AAAcC,UAAAA,GAAG,EAAE,GAAA;SADlB;QAEV0O,IAAI,EAAKsR,YAAY,GAAG;AAAEjgB,UAAAA,KAAK,EAAE,IAAA,CAAK/Z,GAAL,CAASupB,YAAT,EAAT;UAAkCvP,GAAG,EAAEhB,OAAO,CAAC0P,IAAAA;AAA/C,SAAH,GAA2D/d,SAAAA;OAHpD;MAK9BiP,QAAQ,EAAIZ,OAAO,CAACpY,UALU;AAM9BsY,MAAAA,MAAM,EAAM,UANkB;MAO9Be,MAAM,EAAM,SAACH,MAAAA,CAAAA,UAAD,EAAgB;QAC1B,MAAI,CAAC9Z,GAAL,CAASsmB,OAAT,CAAiBzlB,iBAAjB,CAAmCH,IAAnC,EAAyCoZ,UAAU,CAAChZ,OAApD,CAAA,CAAA;;AACA,QAAA,MAAI,CAACd,GAAL,CAASsmB,OAAT,CAAiBzlB,iBAAjB,CAAmC,MAAI,CAACH,IAAxC,EAA8C,CAAIoZ,GAAAA,UAAU,CAAChZ,OAA7D,CAAA,CAAA;;AAEA,QAAA,IAAIk5B,YAAJ,EAAkB;AAChB,UAAA,MAAI,CAACh6B,GAAL,CAAS0oB,IAAT,CAAc5O,UAAU,CAAC4O,IAAzB,CAAA,CAAA;AACD,SAAA;;QAED,MAAI,CAAC1oB,GAAL,CAASmY,WAAT,EAAA,CAAA;AACD,OAAA;AAhB6B,KAAd,CAAlB,CAAA;AAmBAqiB,IAAAA,SAAS,CACNpgB,IADH,CACQ,UAACqgB,SAAD,EAAe;AACnB,MAAA,IAAIA,SAAJ,EAAe;AACb;QACA,MAAI,CAACh6B,UAAL,CAAgBE,WAAhB,CAAA,CAAA;;QACA,MAAI,CAACX,GAAL,CAASsmB,OAAT,CAAiBzlB,iBAAjB,CAAmC,MAAI,CAACH,IAAxC,EAA8C,CAA9C,CAAA,CAAA;;AACA,QAAA,MAAI,CAACk5B,eAAL,CAAqBj5B,WAAW,CAAC4e,QAAjC,CAAA,CAAA;;AACA,QAAA,MAAI,CAACua,mBAAL,CAAyB9gB,OAAO,CAACsR,gBAAjC,EALa;;;AAQb,QAAA,IAAIyP,gBAAJ,EAAsB;AACpB,UAAA,MAAI,CAAC/5B,GAAL,CAAS83B,MAAT,CAAgB9e,OAAhB,CAAA,CAAA;AACD,SAAA;AACF,OAXD,MAYK;AACH,QAAA,MAAI,CAAChZ,GAAL,CAASsmB,OAAT,CAAiBvlB,cAAjB,CAAgCJ,WAAhC,CAAA,CAAA;AACD,OAAA;;AAED,MAAA,MAAI,CAACoyB,KAAL,CAAWjnB,MAAX,CAAkBmuB,KAAlB,CAAA,CAAA;;MACAv5B,IAAI,CAACygB,QAAL,CAAcK,OAAd,EAAA,CAAA;MACA9gB,IAAI,CAACygB,QAAL,GAAgB,IAAhB,CAAA;KApBJ,CAAA,CAAA;AAuBA,IAAA,OAAOqZ,SAAP,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AACA;AAxWA,GAAA;;AAAA,EAAA,MAAA,CAyWE3B,iBAzWF,GAyWE,SAAkB9kB,iBAAAA,CAAAA,MAAlB,EAA0B;AAAA,IAAA,IAAA,MAAA,GAAA,IAAA,CAAA;;AACxBA,IAAAA,MAAM,CAAC2mB,QAAP,CAAgB,UAACzN,IAAD,EAAU;MACxB,IAAIA,IAAI,CAAC9L,QAAT,EAAmB;QACjB8L,IAAI,CAAC9L,QAAL,CAAcK,OAAd,EAAA,CAAA;AACD,OAAA;;MAED,IAAIyL,IAAI,CAAC5L,QAAT,EAAmB;QACjB,IAAI5N,KAAK,CAACC,OAAN,CAAcuZ,IAAI,CAAC5L,QAAnB,CAAJ,EAAkC;AAChC4L,UAAAA,IAAI,CAAC5L,QAAL,CAAcpV,OAAd,CAAsB,UAACoV,QAAD,EAAc;YAClC,IAAIA,QAAQ,CAAChL,GAAb,EAAkB;cAChBgL,QAAQ,CAAChL,GAAT,CAAamL,OAAb,EAAA,CAAA;AACD,aAAA;;AAEDH,YAAAA,QAAQ,CAACG,OAAT,EAAA,CAAA;WALF,CAAA,CAAA;AAOD,SARD,MASK;AACH,UAAA,IAAIyL,IAAI,CAAC5L,QAAL,CAAchL,GAAlB,EAAuB;AACrB4W,YAAAA,IAAI,CAAC5L,QAAL,CAAchL,GAAd,CAAkBmL,OAAlB,EAAA,CAAA;AACD,WAAA;;UAEDyL,IAAI,CAAC5L,QAAL,CAAcG,OAAd,EAAA,CAAA;AACD,SAAA;AACF,OAAA;;MAED,IAAIyL,IAAI,CAACzL,OAAL,IAAgB,EAAEyL,IAAI,YAAY1V,KAAK,CAAC+gB,KAAxB,CAApB,EAAoD;AAClDrL,QAAAA,IAAI,CAACzL,OAAL,EAAA,CAAA;AACD,OAAA;;MAED,IAAIyL,IAAI,KAAKlZ,MAAb,EAAqB;QACnB,MAAI,CAAC8kB,iBAAL,CAAuB5L,IAAvB,CAAA,CAAA;AACD,OAAA;KA9BH,CAAA,CAAA;GA1WJ,CAAA;;AAAA,EAAA,OAAA,QAAA,CAAA;AAAA,CAAA,CAA8B4C,eAA9B,CAAA;;ACTA;AACA;AACA;AACA;AACA;;AACA,IAAa8K,aAAb,gBAAA,UAAA,gBAAA,EAAA;AAAA,EAAA,cAAA,CAAA,aAAA,EAAA,gBAAA,CAAA,CAAA;;AAEE;AACF;AACA;AACE,EAAA,SAAA,aAAA,CAAY36B,GAAZ,EAAiB;AAAA,IAAA,IAAA,KAAA,CAAA;;AACf,IAAA,KAAA,GAAA,gBAAA,CAAA,IAAA,CAAA,IAAA,EAAMA,GAAN,CAAA,IAAA,IAAA,CAAA;AAEA;AACJ;AACA;AACA;AACA;;AACI,IAAA,KAAA,CAAKmf,MAAL,GAAc,IAAI5H,KAAK,CAACqjB,UAAV,EAAd,CAAA;;AACA,IAAA,KAAA,CAAKzb,MAAL,CAAY0b,eAAZ,CAA4B,MAA5B,CAAA,CAAA;;AACA,IAAA,IAAI,KAAKlc,CAAAA,MAAL,CAAYyM,eAAhB,EAAiC;AAC/B,MAAA,KAAA,CAAKjM,MAAL,CAAY2b,kBAAZ,CAA+B,IAA/B,CAAA,CAAA;AACD,KAAA;;AACD,IAAA,IAAI,KAAKnc,CAAAA,MAAL,CAAYuM,cAAZ,IAA8B,OAAO,KAAKvM,CAAAA,MAAL,CAAYuM,cAAnB,KAAsC,QAAxE,EAAkF;AAChF,MAAA,KAAA,CAAK/L,MAAL,CAAY4b,gBAAZ,CAA6B,KAAKpc,CAAAA,MAAL,CAAYuM,cAAzC,CAAA,CAAA;AACD,KAAA;;AAfc,IAAA,OAAA,KAAA,CAAA;AAgBhB,GAAA;AAED;AACF;AACA;;;AAzBA,EAAA,IAAA,MAAA,GAAA,aAAA,CAAA,SAAA,CAAA;;EAAA,MA0BEjrB,CAAAA,OA1BF,GA0BE,SAAU,OAAA,GAAA;AACR,IAAA,IAAA,CAAK+6B,YAAL,EAAA,CAAA;;AACA,IAAA,gBAAA,CAAA,SAAA,CAAM/6B,OAAN,CAAA,IAAA,CAAA,IAAA,CAAA,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAvCA,GAAA;;AAAA,EAAA,MAAA,CAwCEI,WAxCF,GAwCE,SAAA,WAAA,CAAYF,QAAZ,EAAsBG,WAAtB,EAAmC;IACjC,OAAO,IAAA,CAAKN,GAAL,CAASsmB,OAAT,CAAiBjmB,WAAjB,CAA6BF,QAA7B,EAAuCG,WAAvC,CAAP,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AA/CA,GAAA;;EAAA,MAgDE06B,CAAAA,YAhDF,GAgDE,SAAA,YAAA,GAAe;AAEd,GAAA;AAED;AACF;AACA;AACA;AACA;AACA;AAzDA,GAAA;;AAAA,EAAA,MAAA,CA0DE7a,QA1DF,GA0DE,SAAA,QAAA,CAAS8a,GAAT,EAAc/a,UAAd,EAA0B;AAAA,IAAA,IAAA,MAAA,GAAA,IAAA,CAAA;;AACxB,IAAA,IAAI,IAAKvB,CAAAA,MAAL,CAAYuM,cAAZ,IAA8B,OAAO,IAAKvM,CAAAA,MAAL,CAAYuM,cAAnB,KAAsC,UAAxE,EAAoF;MAClF,IAAK/L,CAAAA,MAAL,CAAY4b,gBAAZ,CAA6B,IAAA,CAAKpc,MAAL,CAAYuM,cAAZ,CAA2B+P,GAA3B,CAA7B,CAAA,CAAA;AACD,KAAA;;AAED,IAAA,OAAO,IAAI3xB,OAAJ,CAAY,UAACC,OAAD,EAAUwV,MAAV,EAAqB;MACtC,IAAIpF,QAAQ,GAAG,CAAf,CAAA;AACAuG,MAAAA,UAAU,IAAIA,UAAU,CAACvG,QAAD,CAAxB,CAAA;;MAEA,MAAI,CAACwF,MAAL,CAAYpX,IAAZ,CACEkzB,GADF,EAEE,UAACxrB,MAAD,EAAY;AACVkK,QAAAA,QAAQ,GAAG,GAAX,CAAA;AACAuG,QAAAA,UAAU,IAAIA,UAAU,CAACvG,QAAD,CAAxB,CAAA;QACApQ,OAAO,CAACkG,MAAD,CAAP,CAAA;OALJ,EAOE,UAACzG,CAAD,EAAO;QACL,IAAIA,CAAC,CAACkyB,gBAAN,EAAwB;UACtB,IAAMC,WAAW,GAAGnyB,CAAC,CAACxB,MAAF,GAAWwB,CAAC,CAACoyB,KAAb,GAAqB,GAAzC,CAAA;;UACA,IAAID,WAAW,GAAGxhB,QAAlB,EAA4B;AAC1BA,YAAAA,QAAQ,GAAGwhB,WAAX,CAAA;AACAjb,YAAAA,UAAU,IAAIA,UAAU,CAACvG,QAAD,CAAxB,CAAA;AACD,WAAA;AACF,SAAA;OAdL,EAgBE,UAAC3E,GAAD,EAAS;QACP+J,MAAM,CAAC/J,GAAD,CAAN,CAAA;OAjBJ,CAAA,CAAA;AAoBD,KAxBM,CAAP,CAAA;AAyBD,GAAA;AAED;AACF;AACA;AACA;AACA;AACA;AA/FA,GAAA;;AAAA,EAAA,MAAA,CAgGEkK,SAhGF,GAgGE,SAAA,SAAA,CAAU+b,GAAV,EAAe/a,UAAf,EAA2B;IACzB,OAAO,IAAA,CAAKC,QAAL,CAAc8a,GAAd,EAAmB/a,UAAnB,CACJ9F,CAAAA,IADI,CACC,UAAA3K,MAAM,EAAA;AAAA,MAAA,OAAI,IAAInG,OAAJ,CAAY,UAACC,OAAD,EAAUwV,MAAV,EAAqB;QAC/C,IAAM/G,GAAG,GAAGtP,QAAQ,CAAC2yB,eAAT,CAAyB,8BAAzB,EAAyD,KAAzD,CAAZ,CAAA;;QACArjB,GAAG,CAAC4I,MAAJ,GAAa,YAAM;AACjB0a,UAAAA,GAAG,CAACC,eAAJ,CAAoBvjB,GAAG,CAAC1E,GAAxB,CAAA,CAAA;UACA/J,OAAO,CAACyO,GAAD,CAAP,CAAA;SAFF,CAAA;;QAIAA,GAAG,CAAC6I,OAAJ,GAAc9B,MAAd,CAAA;QACA/G,GAAG,CAAC1E,GAAJ,GAAUgoB,GAAG,CAACE,eAAJ,CAAoB/rB,MAApB,CAAV,CAAA;AACD,OARe,CAAJ,CAAA;AAAA,KADP,CAAP,CAAA;AAUD,GAAA;AAED;AACF;AACA;AACA;AACA;AAjHA,GAAA;;AAAA,EAAA,MAAA,CAkHEgsB,eAlHF,GAkHE,SAAgBt7B,eAAAA,CAAAA,QAAhB,EAA0B;IACxB,IAAI,IAAA,CAAKH,GAAL,CAASsmB,OAAT,CAAiBlmB,eAAjB,CAAiCD,QAAjC,CAAJ,EAAgD;MAC9C,OAAO,IAAA,CAAKH,GAAL,CAASsmB,OAAT,CAAiBjmB,WAAjB,CAA6BF,QAA7B,CAAP,CAAA;AACD,KAFD,MAGK;MACH,OAAOmJ,OAAO,CAACC,OAAR,EAAP,CAAA;AACD,KAAA;GAxHL,CAAA;;AAAA,EAAA,OAAA,aAAA,CAAA;AAAA,CAAA,CAAmCsmB,eAAnC,CAAA;;ACHA,IAAM6L,KAAK,GAAG;AAAEC,EAAAA,IAAI,EAAE,CAAR;AAAWC,EAAAA,OAAO,EAAE,CAApB;AAAuBC,EAAAA,MAAM,EAAE,CAA/B;AAAkCx4B,EAAAA,KAAK,EAAE,CAAA;AAAzC,CAAd,CAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AACA,IAAay4B,OAAb,gBAAA,UAAA,kBAAA,EAAA;AAAA,EAAA,cAAA,CAAA,OAAA,EAAA,kBAAA,CAAA,CAAA;;AAEE;AACF;AACA;AACA;EACE,SAAY97B,OAAAA,CAAAA,GAAZ,EAAiBqe,IAAjB,EAAuB;AAAA,IAAA,IAAA,KAAA,CAAA;;IACrB,KAAMre,GAAAA,kBAAAA,CAAAA,IAAAA,CAAAA,IAAAA,EAAAA,GAAN,EAAW,aAAX,CAAA,IAAA,IAAA,CAAA;AAEA;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACI,IAAA,KAAA,CAAK+N,IAAL,GAAA,QAAA,CAAA,EAAA,EACK,KAAKA,CAAAA,IADV,EAEKsQ,IAFL,EAAA;MAGEgV,KAAK,EAAGqI,KAAK,CAACC,IAHhB;AAIEvxB,MAAAA,KAAK,EAAG,CAJV;AAKEC,MAAAA,MAAM,EAAE,CALV;AAME+T,MAAAA,GAAG,EAAK,EANV;AAOEO,MAAAA,MAAM,EAAE,IAPV;AAQElU,MAAAA,IAAI,EAAI,IAAA;AARV,KAAA,CAAA,CAAA;AAWA;AACJ;AACA;AACA;AACA;AACA;;AACI,IAAA,KAAA,CAAKwa,OAAL,GAAevc,QAAQ,CAACC,aAAT,CAAuB,KAAvB,CAAf,CAAA;AACA,IAAA,KAAA,CAAKsc,OAAL,CAAazZ,SAAb,GAAyB,qBAAzB,CAAA;;AACA,IAAA,KAAA,CAAKoR,SAAL,CAAeiF,WAAf,CAA2B,MAAKoD,OAAhC,CAAA,CAAA;AAEA;AACJ;AACA;AACA;AACA;AACA;;;AACI,IAAA,KAAA,CAAK+C,KAAL,GAAatf,QAAQ,CAACC,aAAT,CAAuB,KAAvB,CAAb,CAAA;AACA,IAAA,KAAA,CAAKqf,KAAL,CAAWxc,SAAX,GAAuB,mBAAvB,CAAA;;AACA,IAAA,KAAA,CAAKoR,SAAL,CAAeiF,WAAf,CAA2B,MAAKmG,KAAhC,CAAA,CAAA;;AAEA,IAAA,KAAA,CAAKpL,SAAL,CAAehT,gBAAf,CAAgC,eAAhC,EAAA,sBAAA,CAAA,KAAA,CAAA,CAAA,CAAA;;AAEA,IAAA,KAAA,CAAKgT,SAAL,CAAe4F,KAAf,CAAqBzV,GAArB,GAA2B,SAA3B,CAAA;AACA,IAAA,KAAA,CAAK6P,SAAL,CAAe4F,KAAf,CAAqB1V,IAArB,GAA4B,SAA5B,CAAA;AA/CqB,IAAA,OAAA,KAAA,CAAA;AAgDtB,GAAA;AAED;AACF;AACA;;;AA1DA,EAAA,IAAA,MAAA,GAAA,OAAA,CAAA,SAAA,CAAA;;EAAA,MA2DE7M,CAAAA,OA3DF,GA2DE,SAAU,OAAA,GAAA;AACR,IAAA,OAAO,KAAK+nB,KAAZ,CAAA;AACA,IAAA,OAAO,KAAK/C,OAAZ,CAAA;;AAEA,IAAA,kBAAA,CAAA,SAAA,CAAMhlB,OAAN,CAAA,IAAA,CAAA,IAAA,CAAA,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AACA;AAtEA,GAAA;;AAAA,EAAA,MAAA,CAuEEgd,WAvEF,GAuEE,SAAYjU,WAAAA,CAAAA,CAAZ,EAAe;AACb;IACA,QAAQA,CAAC,CAACkU,IAAV;AACE;AACA,MAAA,KAAK,eAAL;QAAsB,IAAK6e,CAAAA,iBAAL,CAAuB/yB,CAAvB,CAAA,CAAA;;AAA2B,QAAA,MAAA;AACjD;AAHF,KAAA;AAKA;;AACD,GAAA;AAED;AACF;AACA;AACA;AACA;AArFA,GAAA;;EAAA,MAsFE2C,CAAAA,MAtFF,GAsFE,SAAS,MAAA,GAAA;AACP,IAAA,MAAM,IAAItM,QAAJ,CAAa,2BAAb,CAAN,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAnGA,GAAA;;AAAA,EAAA,MAAA,CAoGEkjB,IApGF,GAoGE,SAAK5D,IAAAA,CAAAA,MAAL,EAAa;IACX,IAAI,IAAA,CAAK5Q,IAAL,CAAUslB,KAAV,KAAoBqI,KAAK,CAACC,IAA9B,EAAoC;AAClC,MAAA,MAAM,IAAIt8B,QAAJ,CAAa,8CAAb,CAAN,CAAA;AACD,KAAA;;IAED,IAAIsf,MAAM,CAACnT,SAAX,EAAsB;AACpBO,MAAAA,UAAU,CAAC,IAAK6Q,CAAAA,SAAN,EAAiB+B,MAAM,CAACnT,SAAxB,CAAV,CAAA;AACD,KAAA;;AAED,IAAA,IAAA,CAAKyZ,OAAL,CAAaf,SAAb,GAAyBvF,MAAM,CAACsG,OAAhC,CAAA;AAEA,IAAA,IAAM+W,IAAI,GAAG,IAAA,CAAKpf,SAAL,CAAeqB,qBAAf,EAAb,CAAA;IACA,IAAKlQ,CAAAA,IAAL,CAAU3D,KAAV,GAAkB4xB,IAAI,CAAClmB,KAAL,GAAakmB,IAAI,CAAClvB,IAApC,CAAA;IACA,IAAKiB,CAAAA,IAAL,CAAU1D,MAAV,GAAmB2xB,IAAI,CAACnmB,MAAL,GAAcmmB,IAAI,CAACjvB,GAAtC,CAAA;AAEA,IAAA,IAAA,CAAKgB,IAAL,CAAUslB,KAAV,GAAkBqI,KAAK,CAACr4B,KAAxB,CAAA;IAEA,IAAK6kB,CAAAA,IAAL,CAAUvJ,MAAV,CAAA,CAAA;AAEA,IAAA,IAAA,CAAK5Q,IAAL,CAAUtD,IAAV,GAAiBkU,MAAM,CAAClU,IAAxB,CAAA;AACA,IAAA,IAAA,CAAKsD,IAAL,CAAUslB,KAAV,GAAkBqI,KAAK,CAACE,OAAxB,CAAA;AAEA,IAAA,IAAA,CAAK57B,GAAL,CAASsuB,OAAT,CAAiBlsB,MAAM,CAACqB,YAAxB,EAAsC,IAAKsK,CAAAA,IAAL,CAAUtD,IAAhD,EAAsD,IAAtD,CAAA,CAAA;;AAEA,IAAA,IAAA,CAAKwxB,YAAL,EAAA,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AACA;AACA;AApIA,GAAA;;AAAA,EAAA,MAAA,CAqIE/T,IArIF,GAqIE,SAAKvJ,IAAAA,CAAAA,MAAL,EAAa;AACX,IAAA,IAAI,KAAK5Q,IAAL,CAAUslB,KAAV,KAAoBqI,KAAK,CAACE,OAA1B,IAAqC,IAAA,CAAK7tB,IAAL,CAAUslB,KAAV,KAAoBqI,KAAK,CAACr4B,KAAnE,EAA0E;AACxE,MAAA,MAAM,IAAIhE,QAAJ,CAAa,uCAAb,CAAN,CAAA;AACD,KAAA;;IAED,IAAKsf,CAAAA,MAAL,GAAcA,MAAd,CAAA;IAEA,IAAM/Z,CAAC,GAAG,IAAA,CAAKgY,SAAf,CAAA;AACA,IAAA,IAAMzM,CAAC,GAAG,IAAK6X,CAAAA,KAAf,CARW;;AAWX,IAAA,IAAMxF,KAAK,GAAG;MACZ0Z,QAAQ,EAAGrlB,aAAa,CAAC8H,MAAM,CAACpD,QAAR,EAAkB,YAAlB,EAAgC,KAAhC,CADZ;AAEZnR,MAAAA,KAAK,EAAM,IAAA,CAAK2D,IAAL,CAAU3D,KAFT;AAGZC,MAAAA,MAAM,EAAK,IAAA,CAAK0D,IAAL,CAAU1D,MAHT;AAIZ0C,MAAAA,GAAG,EAAQ,CAJC;AAKZD,MAAAA,IAAI,EAAO,CALC;AAMZqvB,MAAAA,QAAQ,EAAG,CANC;AAOZC,MAAAA,SAAS,EAAE,CAAA;AAPC,KAAd,CAXW;;AAsBX,IAAA,IAAA,CAAKC,wBAAL,CAA8B7Z,KAA9B,EAAqC7D,MAArC,EAtBW;;;IAyBX,IAAIkF,OAAO,GAAG,KAAd,CAAA;;IACA,IAAIrB,KAAK,CAACzV,GAAN,GAAY,KAAKgB,IAAL,CAAUuuB,MAA1B,EAAkC;AAChC9Z,MAAAA,KAAK,CAAC0Z,QAAN,CAAe,CAAf,IAAoB,QAApB,CAAA;AACArY,MAAAA,OAAO,GAAG,IAAV,CAAA;KAFF,MAIK,IAAIrB,KAAK,CAACzV,GAAN,GAAYyV,KAAK,CAACnY,MAAlB,GAA2B,IAAA,CAAKrK,GAAL,CAAS+N,IAAT,CAAcsQ,IAAd,CAAmBhU,MAAnB,GAA4B,IAAK0D,CAAAA,IAAL,CAAUuuB,MAArE,EAA6E;AAChF9Z,MAAAA,KAAK,CAAC0Z,QAAN,CAAe,CAAf,IAAoB,KAApB,CAAA;AACArY,MAAAA,OAAO,GAAG,IAAV,CAAA;AACD,KAAA;;IACD,IAAIrB,KAAK,CAAC1V,IAAN,GAAa,KAAKiB,IAAL,CAAUuuB,MAA3B,EAAmC;AACjC9Z,MAAAA,KAAK,CAAC0Z,QAAN,CAAe,CAAf,IAAoB,OAApB,CAAA;AACArY,MAAAA,OAAO,GAAG,IAAV,CAAA;KAFF,MAIK,IAAIrB,KAAK,CAAC1V,IAAN,GAAa0V,KAAK,CAACpY,KAAnB,GAA2B,IAAA,CAAKpK,GAAL,CAAS+N,IAAT,CAAcsQ,IAAd,CAAmBjU,KAAnB,GAA2B,IAAK2D,CAAAA,IAAL,CAAUuuB,MAApE,EAA4E;AAC/E9Z,MAAAA,KAAK,CAAC0Z,QAAN,CAAe,CAAf,IAAoB,MAApB,CAAA;AACArY,MAAAA,OAAO,GAAG,IAAV,CAAA;AACD,KAAA;;AACD,IAAA,IAAIA,OAAJ,EAAa;AACX,MAAA,IAAA,CAAKwY,wBAAL,CAA8B7Z,KAA9B,EAAqC7D,MAArC,CAAA,CAAA;AACD,KA5CU;;;IA+CX/Z,CAAC,CAAC4d,KAAF,CAAQzV,GAAR,GAAcyV,KAAK,CAACzV,GAAN,GAAY,IAA1B,CAAA;IACAnI,CAAC,CAAC4d,KAAF,CAAQ1V,IAAR,GAAe0V,KAAK,CAAC1V,IAAN,GAAa,IAA5B,CAAA;IAEAqD,CAAC,CAACqS,KAAF,CAAQzV,GAAR,GAAcyV,KAAK,CAAC2Z,QAAN,GAAiB,IAA/B,CAAA;IACAhsB,CAAC,CAACqS,KAAF,CAAQ1V,IAAR,GAAe0V,KAAK,CAAC4Z,SAAN,GAAkB,IAAjC,CAAA;IAEA,IAAMG,MAAM,GAAG/Z,KAAK,CAAC0Z,QAAN,CAAezlB,IAAf,CAAoB,GAApB,CAAf,CAAA;;AACA,IAAA,IAAI8lB,MAAM,KAAK,IAAA,CAAKxuB,IAAL,CAAUqQ,GAAzB,EAA8B;MAC5BxZ,CAAC,CAAC8G,SAAF,CAAYI,MAAZ,mBAAmC,IAAKiC,CAAAA,IAAL,CAAUqQ,GAA7C,CAAA,CAAA;AAEA,MAAA,IAAA,CAAKrQ,IAAL,CAAUqQ,GAAV,GAAgBme,MAAhB,CAAA;MACA33B,CAAC,CAAC8G,SAAF,CAAYG,GAAZ,mBAAgC,IAAKkC,CAAAA,IAAL,CAAUqQ,GAA1C,CAAA,CAAA;AACD,KAAA;AACF,GAAA;AAED;AACF;AACA;AACA;AAtMA,GAAA;;EAAA,MAuMEkE,CAAAA,IAvMF,GAuME,SAAO,IAAA,GAAA;AACL,IAAA,IAAA,CAAK1F,SAAL,CAAelR,SAAf,CAAyBI,MAAzB,CAAgC,sBAAhC,CAAA,CAAA;AACA,IAAA,IAAA,CAAKiC,IAAL,CAAUslB,KAAV,GAAkBqI,KAAK,CAACG,MAAxB,CAAA;IAEA,IAAK77B,CAAAA,GAAL,CAASsuB,OAAT,CAAiBlsB,MAAM,CAACW,YAAxB,EAAsC,IAAA,CAAKgL,IAAL,CAAUtD,IAAhD,CAAA,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AACA;AAlNA,GAAA;;AAAA,EAAA,MAAA,CAmNEsxB,iBAnNF,GAmNE,SAAkB/yB,iBAAAA,CAAAA,CAAlB,EAAqB;AACnB,IAAA,IAAIA,CAAC,CAACwzB,YAAF,KAAmB,WAAvB,EAAoC;MAClC,QAAQ,IAAA,CAAKzuB,IAAL,CAAUslB,KAAlB;QACE,KAAKqI,KAAK,CAACE,OAAX;AACE,UAAA,IAAA,CAAKhf,SAAL,CAAelR,SAAf,CAAyBG,GAAzB,CAA6B,sBAA7B,CAAA,CAAA;AACA,UAAA,IAAA,CAAKkC,IAAL,CAAUslB,KAAV,GAAkBqI,KAAK,CAACr4B,KAAxB,CAAA;AACA,UAAA,MAAA;;QAEF,KAAKq4B,KAAK,CAACG,MAAX;AACE,UAAA,IAAA,CAAK9tB,IAAL,CAAUslB,KAAV,GAAkBqI,KAAK,CAACC,IAAxB,CAAA;AACA,UAAA,IAAA,CAAK17B,OAAL,EAAA,CAAA;AACA,UAAA,MAAA;;AATJ,OAAA;AAcD,KAAA;AACF,GAAA;AAED;AACF;AACA;AACA;AACA;AACA;AA3OA,GAAA;;AAAA,EAAA,MAAA,CA4OEo8B,wBA5OF,GA4OE,SAAA,wBAAA,CAAyB7Z,KAAzB,EAAgC7D,MAAhC,EAAwC;IACtC,IAAI8d,SAAS,GAAG,KAAhB,CAAA;;AAEA,IAAA,IAAI,CAAC9d,MAAM,CAAC+d,GAAZ,EAAiB;MACf/d,MAAM,CAAC+d,GAAP,GAAa;AACXtyB,QAAAA,KAAK,EAAG,CADG;AAEXC,QAAAA,MAAM,EAAE,CAAA;OAFV,CAAA;AAID,KAAA;;AAED,IAAA,QAAQmY,KAAK,CAAC0Z,QAAN,CAAe,CAAf,CAAR;AACE,MAAA,KAAK,QAAL;QACE1Z,KAAK,CAACzV,GAAN,GAAY4R,MAAM,CAAC5R,GAAP,GAAa4R,MAAM,CAAC+d,GAAP,CAAWryB,MAAxB,GAAiC,KAAK0D,IAAL,CAAUuuB,MAA3C,GAAoD,IAAA,CAAKvuB,IAAL,CAAUia,KAA1E,CAAA;QACAxF,KAAK,CAAC2Z,QAAN,GAAiB,CAAC,KAAKpuB,IAAL,CAAUia,KAAX,GAAmB,CAApC,CAAA;AACAyU,QAAAA,SAAS,GAAG,IAAZ,CAAA;AACA,QAAA,MAAA;;AAEF,MAAA,KAAK,QAAL;AACEja,QAAAA,KAAK,CAACzV,GAAN,GAAY4R,MAAM,CAAC5R,GAAP,GAAa4R,MAAM,CAAC+d,GAAP,CAAWryB,MAAX,GAAoB,CAAjC,GAAqCmY,KAAK,CAACnY,MAAN,GAAe,CAAhE,CAAA;AACAmY,QAAAA,KAAK,CAAC2Z,QAAN,GAAiB3Z,KAAK,CAACnY,MAAN,GAAe,CAAf,GAAmB,IAAA,CAAK0D,IAAL,CAAUia,KAA9C,CAAA;AACA,QAAA,MAAA;;AAEF,MAAA,KAAK,KAAL;AACExF,QAAAA,KAAK,CAACzV,GAAN,GAAY4R,MAAM,CAAC5R,GAAP,GAAayV,KAAK,CAACnY,MAAnB,GAA4B,IAAA,CAAK0D,IAAL,CAAUuuB,MAAtC,GAA+C,IAAKvuB,CAAAA,IAAL,CAAUia,KAArE,CAAA;AACAxF,QAAAA,KAAK,CAAC2Z,QAAN,GAAiB3Z,KAAK,CAACnY,MAAvB,CAAA;AACAoyB,QAAAA,SAAS,GAAG,IAAZ,CAAA;AACA,QAAA,MAAA;AAEF;AAlBF,KAAA;;AAqBA,IAAA,QAAQja,KAAK,CAAC0Z,QAAN,CAAe,CAAf,CAAR;AACE,MAAA,KAAK,OAAL;AACE,QAAA,IAAIO,SAAJ,EAAe;UACbja,KAAK,CAAC1V,IAAN,GAAa6R,MAAM,CAAC7R,IAAP,GAAc6R,MAAM,CAAC+d,GAAP,CAAWtyB,KAAX,GAAmB,CAAjC,GAAqC,IAAA,CAAK2D,IAAL,CAAUuuB,MAA/C,GAAwD,IAAA,CAAKvuB,IAAL,CAAUia,KAA/E,CAAA;AACAxF,UAAAA,KAAK,CAAC4Z,SAAN,GAAkB,IAAKruB,CAAAA,IAAL,CAAUuuB,MAA5B,CAAA;AACD,SAHD,MAIK;UACH9Z,KAAK,CAAC1V,IAAN,GAAa6R,MAAM,CAAC7R,IAAP,GAAc6R,MAAM,CAAC+d,GAAP,CAAWtyB,KAAzB,GAAiC,KAAK2D,IAAL,CAAUuuB,MAA3C,GAAoD,IAAA,CAAKvuB,IAAL,CAAUia,KAA3E,CAAA;UACAxF,KAAK,CAAC4Z,SAAN,GAAkB,CAAC,KAAKruB,IAAL,CAAUia,KAAX,GAAmB,CAArC,CAAA;AACD,SAAA;;AACD,QAAA,MAAA;;AAEF,MAAA,KAAK,QAAL;AACExF,QAAAA,KAAK,CAAC1V,IAAN,GAAa6R,MAAM,CAAC7R,IAAP,GAAc6R,MAAM,CAAC+d,GAAP,CAAWtyB,KAAX,GAAmB,CAAjC,GAAqCoY,KAAK,CAACpY,KAAN,GAAc,CAAhE,CAAA;AACAoY,QAAAA,KAAK,CAAC4Z,SAAN,GAAkB5Z,KAAK,CAACpY,KAAN,GAAc,CAAd,GAAkB,IAAA,CAAK2D,IAAL,CAAUia,KAA9C,CAAA;AACA,QAAA,MAAA;;AAEF,MAAA,KAAK,MAAL;AACE,QAAA,IAAIyU,SAAJ,EAAe;UACbja,KAAK,CAAC1V,IAAN,GAAa6R,MAAM,CAAC7R,IAAP,GAAc0V,KAAK,CAACpY,KAApB,GAA4BuU,MAAM,CAAC+d,GAAP,CAAWtyB,KAAX,GAAmB,CAA/C,GAAmD,IAAK2D,CAAAA,IAAL,CAAUuuB,MAA7D,GAAsE,IAAA,CAAKvuB,IAAL,CAAUia,KAA7F,CAAA;AACAxF,UAAAA,KAAK,CAAC4Z,SAAN,GAAkB5Z,KAAK,CAACpY,KAAN,GAAc,IAAA,CAAK2D,IAAL,CAAUuuB,MAAxB,GAAiC,IAAA,CAAKvuB,IAAL,CAAUia,KAAV,GAAkB,CAArE,CAAA;AACD,SAHD,MAIK;AACHxF,UAAAA,KAAK,CAAC1V,IAAN,GAAa6R,MAAM,CAAC7R,IAAP,GAAc0V,KAAK,CAACpY,KAApB,GAA4B,IAAA,CAAK2D,IAAL,CAAUuuB,MAAtC,GAA+C,IAAKvuB,CAAAA,IAAL,CAAUia,KAAtE,CAAA;AACAxF,UAAAA,KAAK,CAAC4Z,SAAN,GAAkB5Z,KAAK,CAACpY,KAAxB,CAAA;AACD,SAAA;;AACD,QAAA,MAAA;AAEF;AA5BF,KAAA;AA8BD,GAAA;AAED;AACF;AACA;AACA;AA9SA,GAAA;;EAAA,MA+SE6xB,CAAAA,YA/SF,GA+SE,SAAe,YAAA,GAAA;AAAA,IAAA,IAAA,MAAA,GAAA,IAAA,CAAA;;IACb,IAAMU,MAAM,GAAG,IAAK1X,CAAAA,OAAL,CAAa2X,gBAAb,CAA8B,KAA9B,CAAf,CAAA;;AAEA,IAAA,IAAID,MAAM,CAACtxB,MAAP,GAAgB,CAApB,EAAuB;MACrB,IAAMwxB,QAAQ,GAAG,EAAjB,CAAA;AAEAF,MAAAA,MAAM,CAAC1wB,OAAP,CAAe,UAAC0iB,KAAD,EAAW;QACxBkO,QAAQ,CAACriB,IAAT,CAAc,IAAIlR,OAAJ,CAAY,UAACC,OAAD,EAAa;UACrColB,KAAK,CAAC/N,MAAN,GAAerX,OAAf,CAAA;UACAolB,KAAK,CAAC9N,OAAN,GAAgBtX,OAAhB,CAAA;AACD,SAHa,CAAd,CAAA,CAAA;OADF,CAAA,CAAA;AAOAD,MAAAA,OAAO,CAACwzB,GAAR,CAAYD,QAAZ,CACGziB,CAAAA,IADH,CACQ,YAAM;AACV,QAAA,IAAI,MAAI,CAACrM,IAAL,CAAUslB,KAAV,KAAoBqI,KAAK,CAACE,OAA1B,IAAqC,MAAI,CAAC7tB,IAAL,CAAUslB,KAAV,KAAoBqI,KAAK,CAACr4B,KAAnE,EAA0E;AACxE,UAAA,IAAM24B,IAAI,GAAG,MAAI,CAACpf,SAAL,CAAeqB,qBAAf,EAAb,CAAA;;UACA,MAAI,CAAClQ,IAAL,CAAU3D,KAAV,GAAkB4xB,IAAI,CAAClmB,KAAL,GAAakmB,IAAI,CAAClvB,IAApC,CAAA;UACA,MAAI,CAACiB,IAAL,CAAU1D,MAAV,GAAmB2xB,IAAI,CAACnmB,MAAL,GAAcmmB,IAAI,CAACjvB,GAAtC,CAAA;;AACA,UAAA,MAAI,CAACmb,IAAL,CAAU,MAAI,CAACvJ,MAAf,CAAA,CAAA;AACD,SAAA;OAPL,CAAA,CAAA;AASD,KAAA;GArUL,CAAA;;AAAA,EAAA,OAAA,OAAA,CAAA;AAAA,CAAA,CAA6B+C,iBAA7B,CAAA;;AC7BA;AACA;AACA;AACA;AACA;;AACA,IAAaqb,eAAb,gBAAA,UAAA,gBAAA,EAAA;AAAA,EAAA,cAAA,CAAA,eAAA,EAAA,gBAAA,CAAA,CAAA;;AAEE;AACF;AACA;AACE,EAAA,SAAA,eAAA,CAAY/8B,GAAZ,EAAiB;AAAA,IAAA,IAAA,KAAA,CAAA;;AACf,IAAA,KAAA,GAAA,gBAAA,CAAA,IAAA,CAAA,IAAA,EAAMA,GAAN,CAAA,IAAA,IAAA,CAAA;AAEA,IAAA,IAAMg9B,WAAW,GAAG,IAAIlB,OAAJ,CAAY,KAAA,CAAK97B,GAAjB,CAApB,CAAA;AAEA;AACJ;AACA;AACA;AACA;AACA;AACA;;AACI,IAAA,KAAA,CAAKqe,IAAL,GAAY;AACV2J,MAAAA,KAAK,EAAGtS,QAAQ,CAAC5H,QAAQ,CAACkvB,WAAW,CAAChV,KAAb,EAAoB,gBAApB,CAAT,EAAgD,EAAhD,CADN;AAEVsU,MAAAA,MAAM,EAAE5mB,QAAQ,CAAC5H,QAAQ,CAACkvB,WAAW,CAACpgB,SAAb,EAAwB,cAAxB,CAAT,EAAkD,EAAlD,CAAA;KAFlB,CAAA;AAKAogB,IAAAA,WAAW,CAAC/8B,OAAZ,EAAA,CAAA;AAjBe,IAAA,OAAA,KAAA,CAAA;AAkBhB,GAAA;AAED;AACF;AACA;;;AA3BA,EAAA,IAAA,MAAA,GAAA,eAAA,CAAA,SAAA,CAAA;;EAAA,MA4BEA,CAAAA,OA5BF,GA4BE,SAAU,OAAA,GAAA;AACR,IAAA,OAAO,KAAKoe,IAAZ,CAAA;;AAEA,IAAA,gBAAA,CAAA,SAAA,CAAMpe,OAAN,CAAA,IAAA,CAAA,IAAA,CAAA,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA5CA,GAAA;;AAAA,EAAA,MAAA,CA6CEL,MA7CF,GA6CE,SAAO+e,MAAAA,CAAAA,MAAP,EAAe;IACb,IAAMse,OAAO,GAAG,IAAInB,OAAJ,CAAY,KAAK97B,GAAjB,EAAsB,IAAKqe,CAAAA,IAA3B,CAAhB,CAAA;IACA4e,OAAO,CAAC1a,IAAR,CAAa5D,MAAb,CAAA,CAAA;AAEA,IAAA,OAAOse,OAAP,CAAA;GAjDJ,CAAA;;AAAA,EAAA,OAAA,eAAA,CAAA;AAAA,CAAA,CAAqCpN,eAArC,CAAA;;AC6BAtY,KAAK,CAAC2lB,KAAN,CAAYpa,OAAZ,GAAsB,IAAtB,CAAA;AAEA;AACA;AACA;AACA;AACA;;AACA,IAAaqa,MAAb,gBAAA,UAAA,aAAA,EAAA;AAAA,EAAA,cAAA,CAAA,MAAA,EAAA,aAAA,CAAA,CAAA;;AAEE;AACF;AACA;AACA;AACA;AACE,EAAA,SAAA,MAAA,CAAYnkB,OAAZ,EAAqB;AAAA,IAAA,IAAA,KAAA,CAAA;;AACnB,IAAA,KAAA,GAAA,aAAA,CAAA,IAAA,CAAA,IAAA,CAAA,IAAA,IAAA,CAAA;IAEAzR,MAAM,CAACQ,IAAP,EAAA,CAHmB;;AAMnB,IAAA,IAAI,CAACR,MAAM,CAACG,gBAAZ,EAA8B;AAC5B,MAAA,MAAM,IAAIrI,QAAJ,CAAa,yBAAb,CAAN,CAAA;AACD,KAAA;;AAED,IAAA,IAAIkI,MAAM,CAACK,eAAP,KAA2B,CAA/B,EAAkC;AAChC,MAAA,MAAM,IAAIvI,QAAJ,CAAa,sCAAb,CAAN,CAAA;AACD,KAAA;AAED;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACI,IAAA,KAAA,CAAK0O,IAAL,GAAY;AACVsb,MAAAA,KAAK,EAAc,KADT;AAEVjH,MAAAA,SAAS,EAAU,KAFT;AAGVjK,MAAAA,WAAW,EAAQ,KAHT;AAIVmT,MAAAA,UAAU,EAAS,KAJT;MAKVzO,SAAS,EAAU,IAAItF,KAAK,CAAC0Y,OAAV,CAAkB,CAAlB,EAAqB,CAArB,EAAwBxuB,aAAxB,CALT;AAMVivB,MAAAA,IAAI,EAAe,IANT;AAOVkH,MAAAA,IAAI,EAAe,IAPT;AAQV9G,MAAAA,MAAM,EAAa,IART;AASVsM,MAAAA,iBAAiB,EAAE,KATT;AAUVvG,MAAAA,gBAAgB,EAAG,IAVT;AAWVwG,MAAAA,cAAc,EAAK,IAXT;MAYV5D,QAAQ,EAAW,CAAC,CAZV;AAaVtE,MAAAA,gBAAgB,EAAG,EAbT;AAcV9W,MAAAA,IAAI,EAAe;AACjBjU,QAAAA,KAAK,EAAG,CADS;AAEjBC,QAAAA,MAAM,EAAE,CAAA;OAhBA;AAkBVkV,MAAAA,QAAQ,EAAW;AACjBC,QAAAA,SAAS,EAAM,CADE;AAEjBC,QAAAA,UAAU,EAAK,CAFE;AAGjBC,QAAAA,YAAY,EAAG,CAHE;AAIjBC,QAAAA,aAAa,EAAE,CAJE;AAKjBC,QAAAA,QAAQ,EAAO,CALE;AAMjBC,QAAAA,QAAQ,EAAO,CANE;AAOjBC,QAAAA,WAAW,EAAI,CAPE;AAQjBC,QAAAA,SAAS,EAAM,CARE;AASjBC,QAAAA,QAAQ,EAAO,CAAA;AATE,OAAA;KAlBrB,CAAA;AA+BA;AACJ;AACA;AACA;AACA;;AACI,IAAA,KAAA,CAAKrB,MAAL,GAAcsN,SAAS,CAACjT,OAAD,CAAvB,CAAA;AAEA;AACJ;AACA;AACA;AACA;;IACI,KAAK3M,CAAAA,MAAL,GAAe,OAAO2M,OAAO,CAAC4D,SAAf,KAA6B,QAA9B,GAA0ClU,QAAQ,CAAC40B,cAAT,CAAwBtkB,OAAO,CAAC4D,SAAhC,CAA1C,GAAuF5D,OAAO,CAAC4D,SAA7G,CAAA;IACA,KAAKvQ,CAAAA,MAAL,CAAY3K,WAAZ,CAAA,GAAA,sBAAA,CAAA,KAAA,CAAA,CAAA;AAEA;AACJ;AACA;AACA;AACA;;AACI,IAAA,KAAA,CAAKkb,SAAL,GAAiBlU,QAAQ,CAACC,aAAT,CAAuB,KAAvB,CAAjB,CAAA;;AACA,IAAA,KAAA,CAAKiU,SAAL,CAAelR,SAAf,CAAyBG,GAAzB,CAA6B,eAA7B,CAAA,CAAA;;AACA,IAAA,KAAA,CAAKQ,MAAL,CAAYwV,WAAZ,CAAwB,MAAKjF,SAA7B,CAAA,CAAA;AAEA;AACJ;AACA;AACA;AACA;AACA;;;IACI,KAAK0J,CAAAA,OAAL,GAAe,IAAI,KAAA,CAAK3H,MAAL,CAAY2H,OAAZ,CAAoB,CAApB,CAAJ,gCAAiC,KAAK3H,CAAAA,MAAL,CAAY2H,OAAZ,CAAoB,CAApB,CAAjC,CAAf,CA/FmB;;AAiGnB;AACJ;AACA;AACA;AACA;AACA;;IACI,KAAK3E,CAAAA,QAAL,GAAgB,EAAhB,CAAA;AAEA;AACJ;AACA;AACA;AACA;AACA;;IACI,KAAKkI,CAAAA,OAAL,GAAe,EAAf,CAAA;AAEA;AACJ;AACA;AACA;;AACI,IAAA,KAAA,CAAKwH,QAAL,GAAgB,IAAI2G,QAAJ,CAAhB,sBAAA,CAAA,KAAA,CAAA,CAAA,CAAA;AAEA;AACJ;AACA;AACA;;AACI,IAAA,KAAA,CAAK/Y,aAAL,GAAqB,IAAI0b,aAAJ,CAArB,sBAAA,CAAA,KAAA,CAAA,CAAA,CAAA;AAEA;AACJ;AACA;AACA;;AACI,IAAA,KAAA,CAAK4C,aAAL,GAAqB,IAAInK,aAAJ,CAArB,sBAAA,CAAA,KAAA,CAAA,CAAA,CAAA;AAEA;AACJ;AACA;AACA;;AACI,IAAA,KAAA,CAAKkC,UAAL,GAAkB,IAAIlF,UAAJ,CAAlB,sBAAA,CAAA,KAAA,CAAA,CAAA,CAAA;AAEA;AACJ;AACA;AACA;;AACI,IAAA,KAAA,CAAKjR,MAAL,GAAc,IAAIsO,MAAJ,CAAd,sBAAA,CAAA,KAAA,CAAA,CAAA,CAAA;AAEA;AACJ;AACA;AACA;;AACI,IAAA,KAAA,CAAK9K,MAAL,GAAc,IAAIoK,MAAJ,CAAd,sBAAA,CAAA,KAAA,CAAA,CAAA,CAAA;AAEA;AACJ;AACA;AACA;;AACI,IAAA,KAAA,CAAKjH,KAAL,GAAa,IAAIkJ,KAAJ,CAAb,sBAAA,CAAA,KAAA,CAAA,CAAA,CAAA;AAEA;AACJ;AACA;AACA;;AACI,IAAA,KAAA,CAAKiO,OAAL,GAAe,IAAIF,eAAJ,CAAf,sBAAA,CAAA,KAAA,CAAA,CAAA,CAAA;AAEA;AACJ;AACA;AACA;;AACI,IAAA,KAAA,CAAKlX,YAAL,GAAoB,IAAI0I,YAAJ,CAApB,sBAAA,CAAA,KAAA,CAAA,CAAA,CAAA;AAEA;AACJ;AACA;AACA;;AACI,IAAA,KAAA,CAAKoG,OAAL,GAAe,IAAIlG,OAAJ,CAAf,sBAAA,CAAA,KAAA,CAAA,CAAA,CAAA;AAEA;AACJ;AACA;AACA;;AACI,IAAA,KAAA,CAAKrS,QAAL,GAAgB;AACdsM,MAAAA,IAAI,EAAE,IAAI5N,OAAJ,CAAY,UAACtL,KAAD,EAAW;QAC3B,KAAKzB,CAAAA,IAAL,CAAU2iB,IAAV,GAAiB,KAAA,CAAK4E,UAAL,CAAgB9E,cAAhB,CAA+BhhB,KAA/B,CAAjB,CAAA;AACA,QAAA,KAAA,CAAKzB,IAAL,CAAU6pB,IAAV,GAAiB,KAAKtC,CAAAA,UAAL,CAAgB7E,UAAhB,CAA2B,KAAA,CAAK1iB,IAAL,CAAU2iB,IAArC,CAAjB,CAAA;;AACA,QAAA,KAAA,CAAKpC,OAAL,CAAalsB,MAAM,CAACwB,YAApB,EAAkC4L,KAAlC,CAAA,CAAA;OAHI,EAIH,MAAKmP,MAAL,CAAYwL,cAJT,EAIyB,CAJzB,EAI4B,GAJ5B,CADQ;MAOd5O,QAAQ,EAAE,IAAIY,YAAJ,CAAiB;AACzB7K,QAAAA,SAAS,EAAE,IAAIwJ,OAAJ,CAAY,IAAZ,EAAkB,MAAK6D,MAAL,CAAYyL,WAA9B,EAA2C,CAA3C,EAA8C,CAAI1kB,GAAAA,IAAI,CAACE,EAAvD,EAA2D,IAA3D,CADc;QAEzByL,QAAQ,EAAG,IAAIyJ,OAAJ,CAAY,IAAZ,EAAkB,KAAA,CAAK6D,MAAL,CAAY0L,UAA9B,EAA0C,CAAC3kB,IAAI,CAACE,EAAN,GAAW,CAArD,EAAwDF,IAAI,CAACE,EAAL,GAAU,CAAlE,CAAA;OAFH,EAGP,UAAC2V,QAAD,EAAc;QACf,KAAK+Z,CAAAA,UAAL,CAAgB9D,wBAAhB,CAAyCjW,QAAzC,EAAmD,KAAA,CAAKxN,IAAL,CAAU8O,SAA7D,CAAA,CAAA;;AACA,QAAA,KAAA,CAAKyR,OAAL,CAAalsB,MAAM,CAACgB,gBAApB,EAAsCmY,QAAtC,CAAA,CAAA;OALQ,CAAA;KAPZ,CAAA;;AAgBA,IAAA,KAAA,CAAKiiB,cAAL,EAAA,CAAA;;IAEA,KAAKD,CAAAA,aAAL,CAAmB5T,IAAnB,EAAA,CAAA;;IAEA,KAAK8T,CAAAA,eAAL,GAAuBvrB,QAAQ,CAAC,YAAA;AAAA,MAAA,OAAM,KAAKgQ,CAAAA,SAAL,CAAe,QAAf,CAAN,CAAA;AAAA,KAAD,EAAiC,GAAjC,CAA/B,CArMmB;;AAwMnB,IAAA,KAAA,CAAKwb,MAAL,CAAY,KAAA,CAAK/e,MAAL,CAAYN,IAAxB,EAxMmB;;;AA2MnB,IAAA,KAAA,CAAKM,MAAL,CAAYkL,OAAZ,CAAoB5d,OAApB,CAA4B,UAAoB,IAAA,EAAA;AAAA,MAAA,IAAlByI,MAAkB,GAAA,IAAA,CAAA,CAAA,CAAA;AAAA,UAAVipB,IAAU,GAAA,IAAA,CAAA,CAAA,CAAA,CAAA;AAC9C,MAAA,KAAA,CAAK9T,OAAL,CAAanV,MAAM,CAAC1T,EAApB,CAAA,GAA0B,IAAI0T,MAAJ,CAAiBipB,sBAAAA,CAAAA,KAAAA,CAAAA,EAAAA,IAAjB,CAA1B,CAD8C;KAAhD,CAAA,CAAA;;AAGA7pB,IAAAA,IAAI,CAAC,KAAA,CAAK+V,OAAN,EAAe,UAAAnV,MAAM,EAAA;AAAA,MAAA,OAAIA,MAAM,CAACiV,IAAX,oBAAIjV,MAAM,CAACiV,IAAP,EAAJ,CAAA;KAArB,CAAJ,CA9MmB;;IAiNnB,KAAKhH,CAAAA,MAAL,CAAYqK,UAAZ,CAAuB,MAAKrO,MAAL,CAAYgE,MAAnC,CAAA,CAjNmB;;;AAoNnB,IAAA,IAAI,KAAKhE,CAAAA,MAAL,CAAYxe,QAAhB,EAA0B;AACxB,MAAA,KAAA,CAAKy9B,WAAL,CAAiB,KAAKjf,CAAAA,MAAL,CAAYxe,QAA7B,CAAA,CAAA;AACD,KAAA;;IAEDmL,WAAW,CAAC,KAAKsR,CAAAA,SAAN,EAAiB,eAAjB,EAAkCrV,MAAM,CAACI,cAAP,CAAsBsB,OAAxD,CAAX,CAAA;IACA1B,MAAM,CAACI,cAAP,CAAsB0B,OAAtB,CAA8B+Q,IAA9B,CAAmC,UAAA0I,OAAO,EAAA;MAAA,OAAIxX,WAAW,CAAC,KAAKsR,CAAAA,SAAN,EAAiB,eAAjB,EAAkCkG,OAAlC,CAAf,CAAA;AAAA,KAA1C,EAzNmB;;AA4NnB,IAAA,KAAA,CAAK0G,IAAL,CAAUpnB,MAAM,CAACkB,MAAjB,EAAyB,YAAM;AAC7B,MAAA,IAAI,KAAKqb,CAAAA,MAAL,CAAYgE,MAAhB,EAAwB;AACtB,QAAA,KAAA,CAAK/F,SAAL,CAAelR,SAAf,CAAyBG,GAAzB,CAA6B,iBAA7B,CAAA,CAAA;;QACA,KAAK8W,CAAAA,MAAL,CAAYJ,IAAZ,EAAA,CAAA;AACD,OAJ4B;;;MAO7B,IAAI,CAACtO,KAAK,CAAC,KAAA,CAAK0K,MAAL,CAAY8L,eAAb,CAAV,EAAyC;AACvC,QAAA,KAAA,CAAK1c,IAAL,CAAU0rB,QAAV,GAAqBoE,WAAW,CAAClrB,GAAZ,EAArB,CAAA;AACD,OAAA;;AAED,MAAA,KAAA,CAAK5E,IAAL,CAAUsb,KAAV,GAAkB,IAAlB,CAAA;AAEAvf,MAAAA,UAAU,CAAC,YAAM;QACf,KAAKoY,CAAAA,SAAL,CAAe,MAAf,CAAA,CAAA;;AAEA,QAAA,KAAA,CAAKoM,OAAL,CAAalsB,MAAM,CAACiB,KAApB,CAAA,CAAA;OAHQ,EAIP,CAJO,CAAV,CAAA;KAbF,CAAA,CAAA;;AA5NmB,IAAA,OAAA,KAAA,CAAA;AA+OpB,GAAA;AAED;AACF;AACA;AACA;;;AA3PA,EAAA,IAAA,MAAA,GAAA,MAAA,CAAA,SAAA,CAAA;;EAAA,MA4PEpD,CAAAA,OA5PF,GA4PE,SAAU,OAAA,GAAA;AACR,IAAA,IAAA,CAAKmoB,SAAL,EAAA,CAAA;;AACA,IAAA,IAAA,CAAKqO,mBAAL,EAAA,CAAA;AACA,IAAA,IAAA,CAAK5rB,cAAL,EAAA,CAAA;AAEAiJ,IAAAA,IAAI,CAAC,IAAA,CAAK+V,OAAN,EAAe,UAAAnV,MAAM,EAAA;MAAA,OAAIA,MAAM,CAACzU,OAAP,EAAJ,CAAA;AAAA,KAArB,CAAJ,CAAA;AACA,IAAA,OAAO,KAAK4pB,OAAZ,CAAA;AAEA,IAAA,IAAA,CAAKlI,QAAL,CAAcxL,KAAd,GAAsBlK,OAAtB,CAA8B,UAAAgW,KAAK,EAAA;MAAA,OAAIA,KAAK,CAAChiB,OAAN,EAAJ,CAAA;KAAnC,CAAA,CAAA;AACA,IAAA,IAAA,CAAK0hB,QAAL,CAActW,MAAd,GAAuB,CAAvB,CAAA;IAEA,IAAKkyB,CAAAA,aAAL,CAAmBt9B,OAAnB,EAAA,CAAA;IACA,IAAKoxB,CAAAA,QAAL,CAAcpxB,OAAd,EAAA,CAAA;IACA,IAAKgf,CAAAA,aAAL,CAAmBhf,OAAnB,EAAA,CAAA;IACA,IAAKq1B,CAAAA,UAAL,CAAgBr1B,OAAhB,EAAA,CAAA;IACA,IAAKqmB,CAAAA,OAAL,CAAarmB,OAAb,EAAA,CAAA;AAEA,IAAA,IAAA,CAAKoM,MAAL,CAAYyV,WAAZ,CAAwB,KAAKlF,SAA7B,CAAA,CAAA;AACA,IAAA,OAAO,IAAKvQ,CAAAA,MAAL,CAAY3K,WAAZ,CAAP,CAAA;AAEA,IAAA,OAAO,KAAK2K,MAAZ,CAAA;AACA,IAAA,OAAO,KAAKuQ,SAAZ,CAAA;AAEA,IAAA,OAAO,KAAKuC,MAAZ,CAAA;AACA,IAAA,OAAO,KAAKwD,MAAZ,CAAA;AACA,IAAA,OAAO,KAAKmD,KAAZ,CAAA;AACA,IAAA,OAAO,KAAKmX,OAAZ,CAAA;AACA,IAAA,OAAO,KAAKpX,YAAZ,CAAA;AACA,IAAA,OAAO,KAAK8O,OAAZ,CAAA;AACA,IAAA,OAAO,KAAKvY,QAAZ,CAAA;AAEA,IAAA,OAAO,KAAKuC,MAAZ,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AAjSA,GAAA;;AAAA,EAAA,MAAA,CAkSEuD,SAlSF,GAkSE,SAAU4b,SAAAA,CAAAA,MAAV,EAAkB;AAAA,IAAA,IAAA,MAAA,GAAA,IAAA,CAAA;;AAChB,IAAA,IAAI,CAAC,IAAA,CAAK/vB,IAAL,CAAUsb,KAAf,EAAsB;AACpB,MAAA,OAAA;AACD,KAAA;;AAED,IAAA,IAAI,CAAC,IAAA,CAAKtb,IAAL,CAAUqU,SAAf,EAA0B;AACxB;AAEA,MAAA,IAAA,CAAKrU,IAAL,CAAUqU,SAAV,GAAsB,IAAtB,CAAA;AAEA,MAAA,IAAA,CAAKT,QAAL,CAAcQ,KAAd,CAAoB,UAACF,KAAD,EAAW;AAC7BA,QAAAA,KAAK,CAACC,SAAN,EAAA,CAAA;AACA,QAAA,OAAO,MAAI,CAACnU,IAAL,CAAUqU,SAAV,KAAwB,IAA/B,CAAA;OAFF,CAAA,CAAA;AAKA,MAAA,IAAA,CAAKrU,IAAL,CAAUqU,SAAV,GAAsB,KAAtB,CAAA;KAVF,MAYK,IAAI,IAAKrU,CAAAA,IAAL,CAAUqU,SAAV,KAAwB,KAA5B,EAAmC;AACtC,MAAA,IAAA,CAAKrU,IAAL,CAAUqU,SAAV,GAAsB,KAAtB,CADsC;;AAItCtY,MAAAA,UAAU,CAAC,YAAM;AACf,QAAA,MAAI,CAACiE,IAAL,CAAUqU,SAAV,GAAsB,KAAtB,CAAA;;QACA,MAAI,CAACF,SAAL,CAAe4b,MAAf,CAAA,CAAA;AACD,OAHS,CAAV,CAAA;AAID,KAAA;AACF,GAAA;AAED;AACF;AACA;AACA;AACA;AAlUA,GAAA;;AAAA,EAAA,MAAA,CAmUEC,SAnUF,GAmUE,SAAUC,SAAAA,CAAAA,QAAV,EAAoB;AAClB,IAAA,IAAI,OAAOA,QAAP,KAAoB,QAAxB,EAAkC;AAChC,MAAA,OAAO,IAAKnU,CAAAA,OAAL,CAAamU,QAAb,CAAP,CAAA;AACD,KAFD,MAGK;AACH,MAAA,IAAMC,UAAU,GAAGxpB,aAAa,CAACupB,QAAD,EAAWtU,cAAX,CAAhC,CAAA;MACA,OAAOuU,UAAU,GAAG,IAAA,CAAKpU,OAAL,CAAaoU,UAAU,CAACj9B,EAAxB,CAAH,GAAiC2J,SAAlD,CAAA;AACD,KAAA;AACF,GAAA;AAED;AACF;AACA;AACA;AAhVA,GAAA;;EAAA,MAiVEkC,CAAAA,WAjVF,GAiVE,SAAc,WAAA,GAAA;IACZ,OAAO,IAAA,CAAKyoB,UAAL,CAAgBze,aAAhB,CAA8B,IAAKuF,CAAAA,QAAL,CAAcb,QAAd,CAAuB1B,OAArD,CAAP,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AAxVA,GAAA;;EAAA,MAyVE0P,CAAAA,YAzVF,GAyVE,SAAe,YAAA,GAAA;AACb,IAAA,OAAO,IAAKnN,CAAAA,QAAL,CAAcsM,IAAd,CAAmB7O,OAA1B,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AAhWA,GAAA;;EAAA,MAiWEqkB,CAAAA,OAjWF,GAiWE,SAAU,OAAA,GAAA;IACR,OAAY,QAAA,CAAA,EAAA,EAAA,IAAA,CAAKnwB,IAAL,CAAUsQ,IAAtB,CAAA,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AAxWA,GAAA;;EAAA,MAyWEmG,CAAAA,mBAzWF,GAyWE,SAAsB,mBAAA,GAAA;IACpB,OAAO,IAAA,CAAKzW,IAAL,CAAUqvB,iBAAjB,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AAhXA,GAAA;;EAAA,MAiXE7vB,CAAAA,mBAjXF,GAiXE,SAAsBA,qBAAA,GAAA;IACpB,IAAIhG,MAAM,CAACO,eAAX,EAA4B;AAC1B,MAAA,OAAOyF,mBAAmB,CAAC,IAAKqP,CAAAA,SAAN,CAA1B,CAAA;AACD,KAFD,MAGK;MACH,OAAO,IAAA,CAAK7O,IAAL,CAAUud,UAAjB,CAAA;AACD,KAAA;AACF,GAAA;AAED;AACF;AACA;AA5XA,GAAA;;EAAA,MA6XEnT,CAAAA,WA7XF,GA6XE,SAAc,WAAA,GAAA;AACZ,IAAA,IAAA,CAAKpK,IAAL,CAAUoK,WAAV,GAAwB,IAAxB,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AApYA,GAAA;;EAAA,MAqYEic,CAAAA,QArYF,GAqYE,SAAW,QAAA,GAAA;IACT,IAAI,IAAA,CAAKxX,SAAL,CAAe8Q,WAAf,KAA+B,IAAK3f,CAAAA,IAAL,CAAUsQ,IAAV,CAAejU,KAA9C,IAAuD,IAAKwS,CAAAA,SAAL,CAAeuhB,YAAf,KAAgC,IAAA,CAAKpwB,IAAL,CAAUsQ,IAAV,CAAehU,MAA1G,EAAkH;AAChH,MAAA,IAAA,CAAK0D,IAAL,CAAUsQ,IAAV,CAAejU,KAAf,GAAuB1E,IAAI,CAACooB,KAAL,CAAW,IAAA,CAAKlR,SAAL,CAAe8Q,WAA1B,CAAvB,CAAA;AACA,MAAA,IAAA,CAAK3f,IAAL,CAAUsQ,IAAV,CAAehU,MAAf,GAAwB3E,IAAI,CAACooB,KAAL,CAAW,IAAA,CAAKlR,SAAL,CAAeuhB,YAA1B,CAAxB,CAAA;AACA,MAAA,IAAA,CAAKpwB,IAAL,CAAU+iB,MAAV,GAAmB,IAAA,CAAK/iB,IAAL,CAAUsQ,IAAV,CAAejU,KAAf,GAAuB,IAAK2D,CAAAA,IAAL,CAAUsQ,IAAV,CAAehU,MAAzD,CAAA;AACA,MAAA,IAAA,CAAK0D,IAAL,CAAU6pB,IAAV,GAAiB,IAAKtC,CAAAA,UAAL,CAAgB7E,UAAhB,CAA2B,IAAA,CAAK1iB,IAAL,CAAU2iB,IAArC,CAAjB,CAAA;MAEA,IAAKpC,CAAAA,OAAL,CAAalsB,MAAM,CAACsB,YAApB,EAAkC,IAAA,CAAKw6B,OAAL,EAAlC,CAAA,CAAA;;AACA,MAAA,IAAA,CAAKT,eAAL,EAAA,CAAA;AACD,KAAA;AACF,GAAA;AAED;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAzZA,GAAA;;AAAA,EAAA,MAAA,CA0ZEG,WA1ZF,GA0ZE,SAAA,WAAA,CAAYQ,IAAZ,EAAkBplB,OAAlB,EAAgC;AAAA,IAAA,IAAA,qBAAA;AAAA,QAAA,MAAA,GAAA,IAAA,CAAA;;AAAA,IAAA,IAAdA,OAAc,KAAA,KAAA,CAAA,EAAA;AAAdA,MAAAA,OAAc,GAAJ,EAAI,CAAA;AAAA,KAAA;;IAC9B,IAAKiG,CAAAA,aAAL,CAAmB+b,YAAnB,EAAA,CAAA;AACA,IAAA,CAAA,qBAAA,GAAA,IAAA,CAAKjtB,IAAL,CAAUswB,mBAAV,KAA+B5jB,IAAAA,GAAAA,KAAAA,CAAAA,GAAAA,qBAAAA,CAAAA,MAA/B,GAF8B;;AAK9B,IAAA,IAAI,CAAC,IAAA,CAAK1M,IAAL,CAAUsb,KAAf,EAAsB;AACpB,MAAA,IAAI,EAAE,kBAAA,IAAsBrQ,OAAxB,CAAJ,EAAsC;AACpCA,QAAAA,OAAO,CAACsR,gBAAR,GAA2B,IAAK3L,CAAAA,MAAL,CAAY2L,gBAAvC,CAAA;AACD,OAAA;;AACD,MAAA,IAAI,EAAE,UAAA,IAActR,OAAhB,CAAJ,EAA8B;AAC5BA,QAAAA,OAAO,CAACuG,QAAR,GAAmB,IAAKZ,CAAAA,MAAL,CAAYY,QAA/B,CAAA;AACD,OAAA;AACF,KAAA;;IAED,IAAIvG,OAAO,CAACpY,UAAR,KAAuB+J,SAAvB,IAAoCqO,OAAO,CAACpY,UAAR,KAAuB,IAA/D,EAAqE;MACnEoY,OAAO,CAACpY,UAAR,GAAqBM,kBAArB,CAAA;AACD,KAAA;;AACD,IAAA,IAAI8X,OAAO,CAACslB,UAAR,KAAuB3zB,SAA3B,EAAsC;MACpCqO,OAAO,CAACslB,UAAR,GAAqB,IAArB,CAAA;AACD,KAAA;;AACD,IAAA,IAAItlB,OAAO,CAACuM,OAAR,KAAoB5a,SAAxB,EAAmC;AACjCqO,MAAAA,OAAO,CAACuM,OAAR,GAAkB,IAAK5G,CAAAA,MAAL,CAAY4G,OAA9B,CAAA;AACD,KAAA;;AACD,IAAA,IAAIvM,OAAO,CAAC2M,WAAR,KAAwBhb,SAA5B,EAAuC;AACrCqO,MAAAA,OAAO,CAAC2M,WAAR,GAAsB,IAAKhH,CAAAA,MAAL,CAAYgH,WAAlC,CAAA;AACD,KAAA;;AAED,IAAA,IAAMoU,gBAAgB,GAAG3kB,kBAAkB,CAAC4D,OAAD,CAA3C,CAAA;AACA,IAAA,IAAMghB,YAAY,IAAG,MAAUhhB,IAAAA,OAAb,CAAlB,CAAA;;IAEA,IAAI+gB,gBAAgB,IAAIC,YAAxB,EAAsC;AACpC,MAAA,IAAA,CAAK5R,SAAL,EAAA,CAAA;AACD,KAAA;;AAED,IAAA,IAAA,CAAKmW,SAAL,EAAA,CAAA;AAEA,IAAA,IAAA,CAAK5f,MAAL,CAAYxe,QAAZ,GAAuBi+B,IAAvB,CAAA;AACA,IAAA,IAAA,CAAKzf,MAAL,CAAY4G,OAAZ,GAAsBvM,OAAO,CAACuM,OAA9B,CAAA;AACA,IAAA,IAAA,CAAK5G,MAAL,CAAYgH,WAAZ,GAA0B3M,OAAO,CAAC2M,WAAlC,CAAA;;AAEA,IAAA,IAAM6Y,IAAI,GAAG,SAAPA,IAAO,CAACxpB,GAAD,EAAS;MACpB,MAAI,CAACmK,MAAL,CAAYmD,IAAZ,EAAA,CAAA;;AAEA,MAAA,MAAI,CAACvU,IAAL,CAAUsvB,cAAV,GAA2B,IAA3B,CAAA;;AAEA,MAAA,IAAItoB,YAAY,CAACC,GAAD,CAAhB,EAAuB;AACrB,QAAA,OAAO,KAAP,CAAA;OADF,MAGK,IAAIA,GAAJ,EAAS;AACZ,QAAA,MAAI,CAAC2N,MAAL,CAAY2J,UAAZ,CAAuB,EAAvB,CAAA,CAAA;;QACA,MAAI,CAACmS,SAAL,CAAe,MAAI,CAAC9f,MAAL,CAAYyE,IAAZ,CAAiBqI,SAAhC,CAAA,CAAA;;QACAvW,OAAO,CAACJ,KAAR,CAAcE,GAAd,CAAA,CAAA;AACA,QAAA,MAAMA,GAAN,CAAA;AACD,OALI,MAMA;AACH,QAAA,MAAI,CAAC0P,cAAL,EAAA,CAAA;;QACA,MAAI,CAAC/B,MAAL,CAAY2J,UAAZ,CAAuB,MAAI,CAAC3N,MAAL,CAAY4G,OAAnC,CAAA,CAAA;;AACA,QAAA,OAAO,IAAP,CAAA;AACD,OAAA;KAlBH,CAAA;;IAqBA,IAAK5C,CAAAA,MAAL,CAAY2J,UAAZ,CAAA,MAAA,IAA8B,KAAK3N,MAAL,CAAYoL,UAAZ,IAA0B,EAAxD,CAAA,GAAA,OAAA,CAAA,CAAA;;IACA,IAAI/Q,OAAO,CAACslB,UAAR,IAAsB,CAAC,IAAKvwB,CAAAA,IAAL,CAAUsb,KAArC,EAA4C;MAC1C,IAAKlK,CAAAA,MAAL,CAAYoD,IAAZ,EAAA,CAAA;AACD,KAAA;;IAED,IAAM8a,cAAc,GAAG,IAAK/W,CAAAA,OAAL,CAAajmB,WAAb,CAAyB,KAAKse,MAAL,CAAYxe,QAArC,EAA+C6Y,OAAO,CAACuG,QAAvD,CAAA,CACpBnF,IADoB,CACf,UAACzZ,WAAD,EAAiB;AACrB;MACA,IAAIA,WAAW,CAACR,QAAZ,KAAyB,MAAI,CAACwe,MAAL,CAAYxe,QAAzC,EAAmD;AACjD,QAAA,MAAI,CAACmmB,OAAL,CAAavlB,cAAb,CAA4BJ,WAA5B,CAAA,CAAA;;AACA,QAAA,MAAMkU,aAAa,EAAnB,CAAA;AACD,OAAA;;AACD,MAAA,OAAOlU,WAAP,CAAA;AACD,KARoB,CAAvB,CAAA;;IAUA,IAAI,CAACqY,OAAO,CAACpY,UAAT,IAAuB,CAAC,IAAA,CAAKmN,IAAL,CAAUsb,KAAlC,IAA2C,CAAC,IAAK/C,CAAAA,OAAL,CAAapmB,kBAAb,CAAgC,KAAKye,MAAL,CAAYxe,QAA5C,CAAhD,EAAuG;MACrG,IAAK4N,CAAAA,IAAL,CAAUsvB,cAAV,GAA2BA,cAAc,CACtCjjB,IADwB,CACnB,UAACzZ,WAAD,EAAiB;QACrB,MAAI,CAAC0wB,QAAL,CAAc9O,IAAd,EAAA,CAAA;;AACA,QAAA,MAAI,CAAC8O,QAAL,CAAc5wB,UAAd,CAAyBE,WAAzB,CAAA,CAAA;;AACA,QAAA,MAAI,CAAC0wB,QAAL,CAAcuI,eAAd,CAA8Bj5B,WAAW,CAAC4e,QAA1C,CAAA,CAAA;;AACA,QAAA,MAAI,CAAC8R,QAAL,CAAcyI,mBAAd,CAAkC9gB,OAAO,CAACsR,gBAA1C,CAAA,CAAA;;AAEA,QAAA,IAAI0P,YAAJ,EAAkB;AAChB,UAAA,MAAI,CAACtR,IAAL,CAAU1P,OAAO,CAAC0P,IAAlB,CAAA,CAAA;AACD,SAAA;;AACD,QAAA,IAAIqR,gBAAJ,EAAsB;UACpB,MAAI,CAACjC,MAAL,CAAY9e,OAAZ,CAAA,CAAA;AACD,SAAA;AACF,OAbwB,EAcxBoB,IAdwB,CAcnBokB,IAdmB,EAcbA,IAda,CAA3B,CAAA;AAeD,KAhBD,MAiBK;MACH,IAAKzwB,CAAAA,IAAL,CAAUsvB,cAAV,GAA2BA,cAAc,CACtCjjB,IADwB,CACnB,UAACzZ,WAAD,EAAiB;QACrB,MAAI,CAACwe,MAAL,CAAYmD,IAAZ,EAAA,CAAA;;AAEA,QAAA,MAAI,CAACvU,IAAL,CAAUswB,mBAAV,GAAgC,MAAI,CAAChN,QAAL,CAAczwB,UAAd,CAAyBD,WAAzB,EAAsCqY,OAAtC,CAAhC,CAAA;QACA,OAAO,MAAI,CAACjL,IAAL,CAAUswB,mBAAV,CACJjkB,IADI,CACC,UAACqgB,SAAD,EAAe;AACnB,UAAA,MAAI,CAAC1sB,IAAL,CAAUswB,mBAAV,GAAgC,IAAhC,CAAA;;UACA,IAAI,CAAC5D,SAAL,EAAgB;AACd,YAAA,MAAM5lB,aAAa,EAAnB,CAAA;AACD,WAAA;AACF,SANI,CAAP,CAAA;AAOD,OAZwB,EAaxBuF,IAbwB,CAanBokB,IAbmB,EAabA,IAba,CAA3B,CAAA;AAcD,KAAA;;IAED,OAAO,IAAA,CAAKzwB,IAAL,CAAUsvB,cAAjB,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AACA;AACA;AAhhBA,GAAA;;AAAA,EAAA,MAAA,CAihBEqB,UAjhBF,GAihBE,SAAW1lB,UAAAA,CAAAA,OAAX,EAAoB;AAAA,IAAA,IAAA,MAAA,GAAA,IAAA,CAAA;;AAClB,IAAA,IAAM2lB,SAAS,GACV,QAAA,CAAA,EAAA,EAAA,IAAA,CAAKhgB,MADK,EAEV3F,OAFU,CAAf,CAAA;;AAKAlF,IAAAA,IAAI,CAACkF,OAAD,EAAU,UAACxJ,KAAD,EAAQmE,GAAR,EAAgB;AAC5B,MAAA,IAAIiY,kBAAkB,CAACjY,GAAD,CAAtB,EAA6B;AAC3BsB,QAAAA,OAAO,CAAC2W,kBAAkB,CAACjY,GAAD,CAAnB,CAAP,CAAA;AACA,QAAA,OAAA;AACD,OAAA;;AAED,MAAA,IAAI,CAAChU,MAAM,CAACD,SAAP,CAAiBysB,cAAjB,CAAgCte,IAAhC,CAAqC+b,QAArC,EAA+CjW,GAA/C,CAAL,EAA0D;AACxD,QAAA,MAAM,IAAItU,QAAJ,CAA+BsU,iBAAAA,GAAAA,GAA/B,CAAN,CAAA;AACD,OAAA;;AAED,MAAA,IAAIgY,gBAAgB,CAAChY,GAAD,CAApB,EAA2B;AACzB,QAAA,MAAM,IAAItU,QAAJ,CAAassB,gBAAgB,CAAChY,GAAD,CAA7B,CAAN,CAAA;AACD,OAAA;;AAED,MAAA,IAAIqY,cAAc,CAACrY,GAAD,CAAlB,EAAyB;AACvB,QAAA,MAAI,CAACgL,MAAL,CAAYhL,GAAZ,CAAmBqY,GAAAA,cAAc,CAACrY,GAAD,CAAd,CAAoBnE,KAApB,EAA2BmvB,SAA3B,CAAnB,CAAA;AACD,OAFD,MAGK;AACH,QAAA,MAAI,CAAChgB,MAAL,CAAYhL,GAAZ,IAAmBnE,KAAnB,CAAA;AACD,OAAA;;AAED,MAAA,QAAQmE,GAAR;AACE,QAAA,KAAK,SAAL,CAAA;AACA,QAAA,KAAK,aAAL;UACE,MAAI,CAACgP,MAAL,CAAY2J,UAAZ,CAAuB,MAAI,CAAC3N,MAAL,CAAY4G,OAAnC,CAAA,CAAA;;AACA,UAAA,MAAA;;AAEF,QAAA,KAAK,MAAL;UACE,MAAI,CAACmY,MAAL,CAAYluB,KAAZ,CAAA,CAAA;;AACA,UAAA,MAAA;;AAEF,QAAA,KAAK,kBAAL;AACE,UAAA,MAAI,CAAC6hB,QAAL,CAAcyI,mBAAd,CAAkCtqB,KAAlC,CAAA,CAAA;;AACA,UAAA,MAAA;;AAEF,QAAA,KAAK,QAAL,CAAA;AACA,QAAA,KAAK,MAAL;UACE,MAAI,CAACmT,MAAL,CAAYqK,UAAZ,CAAuB,MAAI,CAACrO,MAAL,CAAYgE,MAAnC,CAAA,CAAA;;AACA,UAAA,MAAA;;AAEF,QAAA,KAAK,WAAL,CAAA;AACA,QAAA,KAAK,WAAL;AACE,UAAA,MAAI,CAAC6a,cAAL,EAAA,CAAA;;AACA,UAAA,MAAA;;AAEF,QAAA,KAAK,QAAL,CAAA;AACA,QAAA,KAAK,QAAL;AACE,UAAA,MAAI,CAACphB,QAAL,CAAcsM,IAAd,CAAmB7M,QAAnB,CAA4B,MAAI,CAACyZ,UAAL,CAAgBjF,cAAhB,CAA+B,MAAI,CAACtiB,IAAL,CAAU2iB,IAAzC,CAA5B,CAAA,CAAA;;UACA,MAAI,CAACpC,OAAL,CAAalsB,MAAM,CAACwB,YAApB,EAAkC,MAAI,CAAC2lB,YAAL,EAAlC,CAAA,CAAA;;AACA,UAAA,MAAA;;AAEF,QAAA,KAAK,kBAAL;AACE,UAAA,MAAI,CAAC8H,QAAL,CAAcqH,eAAd,CAA8BlW,KAA9B,CAAoCmW,UAApC,GAAiD,MAAI,CAACha,MAAL,CAAYwM,gBAA7D,CAAA;AACA,UAAA,MAAA;;AAEF,QAAA,KAAK,gBAAL;AACE,UAAA,MAAI,CAACzG,cAAL,EAAA,CAAA;;AACA,UAAA,MAAA;AApCJ,OAAA;AAyCD,KA9DG,CAAJ,CAAA;AAgEA,IAAA,IAAA,CAAKvM,WAAL,EAAA,CAAA;IACA,IAAK+J,CAAAA,SAAL,CAAe,aAAf,CAAA,CAAA;IAEA,IAAKoM,CAAAA,OAAL,CAAalsB,MAAM,CAACM,cAApB,EAAoC/C,MAAM,CAACuL,IAAP,CAAY8N,OAAZ,CAApC,CAAA,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AACA;AACA;AACA;AAnmBA,GAAA;;AAAA,EAAA,MAAA,CAomBE4lB,SApmBF,GAomBE,SAAA,SAAA,CAAUC,MAAV,EAAkBrvB,KAAlB,EAAyB;AAAA,IAAA,IAAA,gBAAA,CAAA;;AACvB,IAAA,IAAA,CAAKkvB,UAAL,EAAA,gBAAA,GAAA,EAAA,EAAA,gBAAA,CAAmBG,MAAnB,CAAA,GAA4BrvB,KAA5B,EAAA,gBAAA,EAAA,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AA3mBA,GAAA;;EAAA,MA4mBEkV,CAAAA,cA5mBF,GA4mBE,SAAiB,cAAA,GAAA;AACf,IAAA,IAAA,CAAK3W,IAAL,CAAU0rB,QAAV,GAAqB,KAAK9a,MAAL,CAAY8F,cAAZ,GAA6BoZ,WAAW,CAAClrB,GAAZ,EAA7B,GAAiD,CAAC,CAAvE,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AAnnBA,GAAA;;EAAA,MAonBEmsB,CAAAA,gBApnBF,GAonBE,SAAmB,gBAAA,GAAA;AACjB,IAAA,IAAA,CAAK/wB,IAAL,CAAU0rB,QAAV,GAAqB,CAAC,CAAtB,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AA3nBA,GAAA;;AAAA,EAAA,MAAA,CA4nBEC,eA5nBF,GA4nBE,SAAgB7V,eAAAA,CAAAA,OAAhB,EAAiC;AAAA,IAAA,IAAjBA,OAAiB,KAAA,KAAA,CAAA,EAAA;AAAjBA,MAAAA,OAAiB,GAAP,KAAO,CAAA;AAAA,KAAA;;AAC/B,IAAA,IAAIA,OAAO,IAAI,CAAC,IAAKW,CAAAA,mBAAL,EAAhB,EAA4C;AAC1C,MAAA,OAAA;AACD,KAAA;;AACD,IAAA,IAAI,CAACX,OAAD,IAAY,IAAKW,CAAAA,mBAAL,EAAhB,EAA4C;AAC1C,MAAA,OAAA;AACD,KAAA;;IAED,IAAI,CAACX,OAAL,EAAc;AACZ,MAAA,IAAA,CAAKuE,SAAL,EAAA,CAAA;AACD,KAAA;;AAED,IAAA,IAAA,CAAKhM,QAAL,CAAcb,QAAd,CAAuBG,IAAvB,CAA4B;AAC1BpK,MAAAA,SAAS,EAAE,IAAA,CAAKqN,MAAL,CAAY+L,eAAZ,GAA8B,CAAA;AADf,KAA5B,EAEGhlB,IAAI,CAACqL,GAAL,CAAS,IAAK4N,CAAAA,MAAL,CAAY+L,eAAZ,GAA8B,IAAA,CAAK/L,MAAL,CAAY4L,SAAnD,CAFH,CAAA,CAAA;AAIA,IAAA,IAAA,CAAKnO,QAAL,CAAcb,QAAd,CAAuBD,IAAvB,CAA4B;MAC1BjK,QAAQ,EAAE,IAAKsN,CAAAA,MAAL,CAAYgM,aAAAA;AADI,KAA5B,EAEGjlB,IAAI,CAACqL,GAAL,CAAS,IAAK4N,CAAAA,MAAL,CAAY+L,eAAZ,GAA8B,IAAA,CAAK/L,MAAL,CAAY4L,SAAnD,CAFH,CAAA,CAAA;AAIA,IAAA,IAAA,CAAKxc,IAAL,CAAUqvB,iBAAV,GAA8B,IAA9B,CAAA;;IAEA,IAAI,CAACvZ,OAAL,EAAc;AACZ,MAAA,IAAA,CAAKyK,OAAL,CAAalsB,MAAM,CAACC,UAApB,EAAgC,IAAhC,CAAA,CAAA;AACD,KAAA;AACF,GAAA;AAED;AACF;AACA;AACA;AA1pBA,GAAA;;EAAA,MA2pBE08B,CAAAA,cA3pBF,GA2pBE,SAAiB,cAAA,GAAA;IACf,IAAI,IAAA,CAAKva,mBAAL,EAAJ,EAAgC;AAC9B,MAAA,IAAA,CAAKpI,QAAL,CAAcb,QAAd,CAAuBK,IAAvB,EAAA,CAAA;AAEA,MAAA,IAAA,CAAK7N,IAAL,CAAUqvB,iBAAV,GAA8B,KAA9B,CAAA;AAEA,MAAA,IAAA,CAAK9O,OAAL,CAAalsB,MAAM,CAACC,UAApB,EAAgC,KAAhC,CAAA,CAAA;AACD,KAAA;AACF,GAAA;AAED;AACF;AACA;AACA;AAxqBA,GAAA;;EAAA,MAyqBEsiB,CAAAA,gBAzqBF,GAyqBE,SAAmB,gBAAA,GAAA;IACjB,IAAI,IAAA,CAAKH,mBAAL,EAAJ,EAAgC;AAC9B,MAAA,IAAA,CAAKua,cAAL,EAAA,CAAA;AACD,KAFD,MAGK;AACH,MAAA,IAAA,CAAKrF,eAAL,EAAA,CAAA;AACD,KAAA;AACF,GAAA;AAED;AACF;AACA;AACA;AArrBA,GAAA;;AAAA,EAAA,MAAA,CAsrBE+E,SAtrBF,GAsrBE,SAAUn/B,SAAAA,CAAAA,OAAV,EAAmB;IACjB,IAAKq1B,CAAAA,OAAL,CAAapS,IAAb,CAAkB;MAChBvhB,EAAE,EAAWoD,GAAG,CAACI,KADD;AAEhBmqB,MAAAA,KAAK,EAAQqQ,SAFG;AAGhBpQ,MAAAA,IAAI,EAAStvB,OAHG;AAIhBovB,MAAAA,WAAW,EAAE,KAAA;KAJf,CAAA,CAAA;AAMD,GAAA;AAED;AACF;AACA;AAjsBA,GAAA;;EAAA,MAksBE6P,CAAAA,SAlsBF,GAksBE,SAAY,SAAA,GAAA;AACV,IAAA,IAAA,CAAK5J,OAAL,CAAarS,IAAb,CAAkBle,GAAG,CAACI,KAAtB,CAAA,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AACA;AACA;AA3sBA,GAAA;;AAAA,EAAA,MAAA,CA4sBEszB,MA5sBF,GA4sBE,SAAOvc,MAAAA,CAAAA,QAAP,EAAiB;IACf,IAAMvS,CAAC,GAAG,IAAA,CAAKslB,OAAL,CAAalsB,MAAM,CAACG,aAApB,EAAmCgZ,QAAnC,CAAV,CAAA;;AACA,IAAA,IAAIvS,CAAC,CAAC6rB,kBAAF,EAAJ,EAA4B;AAC1B,MAAA,OAAA;AACD,KAAA;;AAED,IAAA,IAAMhe,aAAa,GAAG,IAAA,CAAKooB,MAAL,CAAYp7B,aAAa,CAACE,mBAA1B,EAA+C,IAAA,CAAKuxB,UAAL,CAAgBze,aAAhB,CAA8B0E,QAA9B,CAA/C,CAAtB,CAAA;AACA,IAAA,IAAA,CAAKa,QAAL,CAAcb,QAAd,CAAuBM,QAAvB,CAAgChF,aAAhC,CAAA,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AACA;AA1tBA,GAAA;;AAAA,EAAA,MAAA,CA2tBEqoB,OA3tBF,GA2tBE,SAAQlmB,OAAAA,CAAAA,OAAR,EAAiB;AAAA,IAAA,IAAA,MAAA,GAAA,IAAA,CAAA;;AACf,IAAA,IAAA,CAAKoP,SAAL,EAAA,CAAA;;AAEA,IAAA,IAAM2R,gBAAgB,GAAG3kB,kBAAkB,CAAC4D,OAAD,CAA3C,CAAA;AACA,IAAA,IAAMghB,YAAY,IAAG,MAAUhhB,IAAAA,OAAb,CAAlB,CAAA;IAEA,IAAMmmB,cAAc,GAAG,EAAvB,CAAA;IACA,IAAIvlB,QAAJ,CAPe;;AAUf,IAAA,IAAImgB,gBAAJ,EAAsB;AACpB,MAAA,IAAMljB,aAAa,GAAG,IAAA,CAAKooB,MAAL,CAAYp7B,aAAa,CAACC,oBAA1B,EAAgD,IAAA,CAAKwxB,UAAL,CAAgBze,aAAhB,CAA8BmC,OAA9B,CAAhD,CAAtB,CAAA;AACA,MAAA,IAAM6e,eAAe,GAAG,IAAA,CAAKhrB,WAAL,EAAxB,CAFoB;;MAKpB,IAAMuyB,OAAO,GAAG3uB,cAAc,CAAConB,eAAe,CAACvmB,SAAjB,EAA4BuF,aAAa,CAACvF,SAA1C,CAA9B,CAAA;MAEA6tB,cAAc,CAAC7tB,SAAf,GAA2B;QAAEyI,KAAK,EAAE8d,eAAe,CAACvmB,SAAzB;AAAoC0I,QAAAA,GAAG,EAAE6d,eAAe,CAACvmB,SAAhB,GAA4B8tB,OAAAA;OAAhG,CAAA;MACAD,cAAc,CAAC9tB,QAAf,GAA0B;QAAE0I,KAAK,EAAE8d,eAAe,CAACxmB,QAAzB;QAAmC2I,GAAG,EAAEnD,aAAa,CAACxF,QAAAA;OAAhF,CAAA;AAEAuI,MAAAA,QAAQ,GAAG,IAAK0b,CAAAA,UAAL,CAAgBvE,eAAhB,CAAgC/X,OAAO,CAAC9B,KAAxC,EAA+CjG,QAAQ,CAAC4mB,eAAD,EAAkBhhB,aAAlB,CAAvD,CAAX,CAAA;AACD,KArBc;;;AAwBf,IAAA,IAAImjB,YAAJ,EAAkB;AAChB,MAAA,IAAMqF,KAAK,GAAG35B,IAAI,CAACqL,GAAL,CAASiI,OAAO,CAAC0P,IAAR,GAAe,IAAKa,CAAAA,YAAL,EAAxB,CAAd,CAAA;MAEA4V,cAAc,CAACzW,IAAf,GAAsB;QAAE3O,KAAK,EAAE,IAAKwP,CAAAA,YAAL,EAAT;QAA8BvP,GAAG,EAAEhB,OAAO,CAAC0P,IAAAA;OAAjE,CAAA;;MAEA,IAAI,CAAC9O,QAAL,EAAe;AACb;AACAA,QAAAA,QAAQ,GAAG,IAAK0b,CAAAA,UAAL,CAAgBvE,eAAhB,CAAgC/X,OAAO,CAAC9B,KAAxC,EAA+CxR,IAAI,CAACE,EAAL,GAAU,CAAV,GAAcy5B,KAAd,GAAsB,GAArE,CAAX,CAAA;AACD,OAAA;AACF,KAjCc;;;IAoCf,IAAI,CAACzlB,QAAL,EAAe;AACb,MAAA,IAAImgB,gBAAJ,EAAsB;QACpB,IAAKjC,CAAAA,MAAL,CAAY9e,OAAZ,CAAA,CAAA;AACD,OAAA;;AACD,MAAA,IAAIghB,YAAJ,EAAkB;AAChB,QAAA,IAAA,CAAKtR,IAAL,CAAU1P,OAAO,CAAC0P,IAAlB,CAAA,CAAA;AACD,OAAA;;MAED,OAAO,IAAI3P,SAAJ,EAAP,CAAA;AACD,KAAA;;AAED,IAAA,IAAA,CAAKhL,IAAL,CAAU8oB,gBAAV,GAA6B,IAAI9d,SAAJ,CAAc;AACzCe,MAAAA,UAAU,EAAEqlB,cAD6B;AAEzCvlB,MAAAA,QAAQ,EAAIA,QAF6B;AAGzCV,MAAAA,MAAM,EAAM,WAH6B;MAIzCe,MAAM,EAAM,SAACH,MAAAA,CAAAA,UAAD,EAAgB;AAC1B,QAAA,IAAIigB,gBAAJ,EAAsB;UACpB,MAAI,CAACjC,MAAL,CAAYhe,UAAZ,CAAA,CAAA;AACD,SAAA;;AACD,QAAA,IAAIkgB,YAAJ,EAAkB;AAChB,UAAA,MAAI,CAACtR,IAAL,CAAU5O,UAAU,CAAC4O,IAArB,CAAA,CAAA;AACD,SAAA;AACF,OAAA;AAXwC,KAAd,CAA7B,CAAA;AAcA,IAAA,IAAA,CAAK3a,IAAL,CAAU8oB,gBAAV,CAA2Bzc,IAA3B,CAAgC,YAAM;AACpC,MAAA,MAAI,CAACrM,IAAL,CAAU8oB,gBAAV,GAA6B,IAA7B,CAAA;;AACA,MAAA,MAAI,CAACnS,cAAL,EAAA,CAAA;KAFF,CAAA,CAAA;IAKA,OAAO,IAAA,CAAK3W,IAAL,CAAU8oB,gBAAjB,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AACA;AApyBA,GAAA;;EAAA,MAqyBEyI,CAAAA,aAryBF,GAqyBE,SAAgB,aAAA,GAAA;AAAA,IAAA,IAAA,MAAA,GAAA,IAAA,CAAA;;AACd,IAAA,IAAI,IAAKvxB,CAAAA,IAAL,CAAU8oB,gBAAd,EAAgC;AAC9B,MAAA,OAAO,IAAIvtB,OAAJ,CAAY,UAACC,OAAD,EAAa;AAC9B,QAAA,MAAI,CAACwE,IAAL,CAAU8oB,gBAAV,CAA2Bzc,IAA3B,CAAgC7Q,OAAhC,CAAA,CAAA;;AACA,QAAA,MAAI,CAACwE,IAAL,CAAU8oB,gBAAV,CAA2Bpc,MAA3B,EAAA,CAAA;;AACA,QAAA,MAAI,CAAC1M,IAAL,CAAU8oB,gBAAV,GAA6B,IAA7B,CAAA;AACD,OAJM,CAAP,CAAA;AAKD,KAND,MAOK;MACH,OAAOvtB,OAAO,CAACC,OAAR,EAAP,CAAA;AACD,KAAA;AACF,GAAA;AAED;AACF;AACA;AACA;AACA;AAtzBA,GAAA;;AAAA,EAAA,MAAA,CAuzBEmf,IAvzBF,GAuzBE,SAAKe,IAAAA,CAAAA,KAAL,EAAY;AACV,IAAA,IAAA,CAAKrN,QAAL,CAAcsM,IAAd,CAAmB7M,QAAnB,CAA4B4N,KAA5B,CAAA,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AA9zBA,GAAA;;AAAA,EAAA,MAAA,CA+zBEb,MA/zBF,GA+zBE,SAAOnN,MAAAA,CAAAA,IAAP,EAAiB;AAAA,IAAA,IAAVA,IAAU,KAAA,KAAA,CAAA,EAAA;AAAVA,MAAAA,IAAU,GAAH,CAAG,CAAA;AAAA,KAAA;;AACf,IAAA,IAAA,CAAKW,QAAL,CAAcsM,IAAd,CAAmBjN,IAAnB,CAAwBA,IAAxB,CAAA,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AAt0BA,GAAA;;AAAA,EAAA,MAAA,CAu0BEqN,OAv0BF,GAu0BE,SAAQrN,OAAAA,CAAAA,IAAR,EAAkB;AAAA,IAAA,IAAVA,IAAU,KAAA,KAAA,CAAA,EAAA;AAAVA,MAAAA,IAAU,GAAH,CAAG,CAAA;AAAA,KAAA;;AAChB,IAAA,IAAA,CAAKW,QAAL,CAAcsM,IAAd,CAAmBjN,IAAnB,CAAwB,CAACA,IAAzB,CAAA,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AA90BA,GAAA;;AAAA,EAAA,MAAA,CA+0BEiiB,MA/0BF,GA+0BE,SAAOrf,MAAAA,CAAAA,IAAP,EAAa;AAAA,IAAA,IAAA,MAAA,GAAA,IAAA,CAAA;;IACX,CAAC,OAAD,EAAU,QAAV,CAAA,CAAoBpS,OAApB,CAA4B,UAACszB,GAAD,EAAS;AACnC,MAAA,IAAIlhB,IAAI,IAAIA,IAAI,CAACkhB,GAAD,CAAhB,EAAuB;QACrB,IAAI,WAAA,CAAYjzB,IAAZ,CAAiB+R,IAAI,CAACkhB,GAAD,CAArB,CAAJ,EAAiC;AAC/BlhB,UAAAA,IAAI,CAACkhB,GAAD,CAAJ,IAAa,IAAb,CAAA;AACD,SAAA;;QACD,MAAI,CAAClzB,MAAL,CAAYmW,KAAZ,CAAkB+c,GAAlB,CAAyBlhB,GAAAA,IAAI,CAACkhB,GAAD,CAA7B,CAAA;AACD,OAAA;KANH,CAAA,CAAA;AASA,IAAA,IAAA,CAAKnL,QAAL,EAAA,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AA/1BA,GAAA;;EAAA,MAg2BEoL,CAAAA,eAh2BF,GAg2BE,SAAkB,eAAA,GAAA;IAChB,IAAIj4B,MAAM,CAACO,eAAX,EAA4B;MAC1B6F,iBAAiB,CAAC,IAAKiP,CAAAA,SAAN,CAAjB,CAAA;AACD,KAFD,MAGK;AACH,MAAA,IAAA,CAAKA,SAAL,CAAelR,SAAf,CAAyBG,GAAzB,CAA6B,2BAA7B,CAAA,CAAA;AACA,MAAA,IAAA,CAAKuoB,QAAL,EAAA,CAAA;;AACA,MAAA,IAAA,CAAKmJ,aAAL,CAAmBhJ,mBAAnB,CAAuC,IAAvC,CAAA,CAAA;AACD,KAAA;AACF,GAAA;AAED;AACF;AACA;AACA;AA92BA,GAAA;;EAAA,MA+2BE1pB,CAAAA,cA/2BF,GA+2BE,SAAiBA,gBAAA,GAAA;IACf,IAAI,IAAA,CAAK0C,mBAAL,EAAJ,EAAgC;MAC9B,IAAIhG,MAAM,CAACO,eAAX,EAA4B;QAC1B+C,cAAc,EAAA,CAAA;AACf,OAFD,MAGK;AACH,QAAA,IAAA,CAAK+R,SAAL,CAAelR,SAAf,CAAyBI,MAAzB,CAAgC,2BAAhC,CAAA,CAAA;AACA,QAAA,IAAA,CAAKsoB,QAAL,EAAA,CAAA;;AACA,QAAA,IAAA,CAAKmJ,aAAL,CAAmBhJ,mBAAnB,CAAuC,KAAvC,CAAA,CAAA;AACD,OAAA;AACF,KAAA;AACF,GAAA;AAED;AACF;AACA;AACA;AA/3BA,GAAA;;EAAA,MAg4BE/N,CAAAA,gBAh4BF,GAg4BE,SAAmB,gBAAA,GAAA;AACjB,IAAA,IAAI,CAAC,IAAA,CAAKjZ,mBAAL,EAAL,EAAiC;AAC/B,MAAA,IAAA,CAAKiyB,eAAL,EAAA,CAAA;AACD,KAFD,MAGK;AACH,MAAA,IAAA,CAAK30B,cAAL,EAAA,CAAA;AACD,KAAA;AACF,GAAA;AAED;AACF;AACA;AA34BA,GAAA;;EAAA,MA44BE2rB,CAAAA,oBA54BF,GA44BE,SAAuB,oBAAA,GAAA;IACrB,IAAK+G,CAAAA,aAAL,CAAmB9I,cAAnB,EAAA,CAAA;AACD,GAAA;AAED;AACF;AACA;AAl5BA,GAAA;;EAAA,MAm5BEgC,CAAAA,mBAn5BF,GAm5BE,SAAsB,mBAAA,GAAA;IACpB,IAAK8G,CAAAA,aAAL,CAAmB7I,eAAnB,EAAA,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AACA;AACA;AACA;AA75BA,GAAA;;AAAA,EAAA,MAAA,CA85BE+K,cA95BF,GA85BE,SAAA,cAAA,CAAeC,WAAf,EAA4BjK,QAA5B,EAAsC;AAAA,IAAA,IAAA,MAAA,GAAA,IAAA,CAAA;;AACpC,IAAA,IAAA,CAAK1nB,IAAL,CAAUonB,gBAAV,CAA2BuK,WAA3B,CAA0C,GAAA;AAAEjK,MAAAA,QAAQ,EAARA,QAAAA;KAA5C,CAAA;AAEA,IAAA,OAAO,YAAM;AACX,MAAA,OAAO,MAAI,CAAC1nB,IAAL,CAAUonB,gBAAV,CAA2BuK,WAA3B,CAAP,CAAA;KADF,CAAA;AAGD,GAAA;AAED;AACF;AACA;AACA;AACA;AA16BA,GAAA;;EAAA,MA26BEtX,CAAAA,SA36BF,GA26BE,SAAY,SAAA,GAAA;AACV,IAAA,IAAA,CAAKkG,OAAL,CAAalsB,MAAM,CAACuB,QAApB,CAAA,CAAA;AAEA,IAAA,IAAA,CAAKm7B,gBAAL,EAAA,CAAA;AACA,IAAA,IAAA,CAAKC,cAAL,EAAA,CAAA;IACA,OAAO,IAAA,CAAKO,aAAL,EAAP,CAAA;AACD,GAAA;AAED;AACF;AACA;AACA;AAt7BA,GAAA;;EAAA,MAu7BE9B,CAAAA,cAv7BF,GAu7BE,SAAiB,cAAA,GAAA;IACf,IAAKphB,CAAAA,QAAL,CAAcsM,IAAd,CAAmBrN,QAAnB,CAA4B,IAAA,CAAKsD,MAAL,CAAY6L,SAAZ,GAAwB,EAApD,CAAA,CAAA;AACA,IAAA,IAAA,CAAKpO,QAAL,CAAcb,QAAd,CAAuBF,QAAvB,CAAgC9D,KAAK,CAACC,SAAN,CAAgBC,QAAhB,CAAyB,IAAKkH,CAAAA,MAAL,CAAY4L,SAAZ,GAAwB,EAAjD,CAAhC,CAAA,CAAA;GAz7BJ,CAAA;;AAAA,EAAA,OAAA,MAAA,CAAA;AAAA,CAAA,CAA4B/L,YAA5B;;;;"}